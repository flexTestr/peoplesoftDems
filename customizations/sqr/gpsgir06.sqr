!***********************************************************************
! GPSGIR06 :  IR21 - Notification of Cessation of Employment Report    *
!***********************************************************************
!***********************************************************************
!                                                                      *
!                                                                      *
!                                                                      *
! This software and related documentation are provided under a         *
! license agreement containing restrictions on use and                 *
! disclosure and are protected by intellectual property                *
! laws. Except as expressly permitted in your license agreement        *
! or allowed by law, you may not use, copy, reproduce,                 *
! translate, broadcast, modify, license, transmit, distribute,         *
! exhibit, perform, publish or display any part, in any form or        *
! by any means. Reverse engineering, disassembly, or                   *
! decompilation of this software, unless required by law for           *
! interoperability, is prohibited.                                     *
! The information contained herein is subject to change without        *
! notice and is not warranted to be error-free. If you find any        *
! errors, please report them to us in writing.                         *
!                                                                      *
!                                                                      *
! Copyright (C) 1988, 2017, Oracle and/or its affiliates.              *
! All Rights Reserved.                                                 *
!***********************************************************************
!                                                                      *
!       $Release:  HR92                                                !
!           $Bug:  27039774                                            !
!***********************************************************************
! Modification History                                                 *
! Dated      Author  ICE       Changes                                 *
! 28/11/02   KWH    549705000  Include setubdb in setup section        *
!17/7/2007  Shilpa 1674199000 SQR modified so that the report prints   *
!                              employer name of 70 characters long     *
!10/9/2007  Shilpa 1692404000  Modified SQR so that the footer         *
!                              information gets printed correctly in   *
!                              the report                              *
!***********************************************************************
!


#define widthofpage  110
#define widthofpage2 110
#define widthofpage3 140

#define debugY
#Include 'setenv.sqc'  !Set environment


begin-setup

#Include 'setupdb.sqc'


Declare-Layout This_Report
      PAPER-SIZE    = (11.7 , 15)
      orientation   = portrait
      top-margin    = 0.30
      left-margin   = 0.1
      Line-Height   = 11.3
End-Declare

Declare-Layout Appendix2_Report
      PAPER-SIZE    = (15 , 12)
      orientation   = landscape
      top-margin    = 0.30
      left-margin   = 0.5
      Line-Height   = 11.3
End-Declare

Declare-Layout Appendix3_Report
      PAPER-SIZE    = (15 , 12)
      orientation   = landscape
      top-margin    = 0.30
      left-margin   = 0.5
      Line-Height   = 11.3
End-Declare

DECLARE-PRINTER default-hp
      !type          = HPLASERJET
      font          = 5
      point-size    = 7
End-Declare

  Declare-Report This_Report
       Printer-Type=HPLASERJET
       LayOut=This_Report
  End-Declare


Declare-Report Appendix2_Report
     Printer-Type=HPLASERJET
     LayOut=Appendix2_Report
End-Declare

DECLARE-REPORT Appendix3_Report
     Printer-Type=HPLASERJET
     LayOut=Appendix3_Report
END-DECLARE

end-setup

begin-report

  do Init-DateTime
  do Init-Number
  do Get-Current-DateTime
  Let $AsOfDate = $AsOfToday
  do Init-Report
  do Stdapi-Term
end-Report

!***********************************************************************
!  Procedure: Init-Report                                              *
!             The main driving procedure                               *
!***********************************************************************
begin-Procedure Init-Report

  do Stdapi-Init
  do S-Parameters

  Let #P1Year = #TaxYear -1

  Let $P1Year = edit(#P1Year,'9999')

  Let $P1YearEnd_Dt = $P1Year || '1231'

  Let $InDate1 = $P1Year || '0101'
  Let $InDate2 = $P1Year || '1231'
  Do Count-LeapDays ($indate1,$indate2,#P1Leapdays)
  if #P1Leapdays = 0
     Let #P1DivYear = 365
  else
     Let #P1DivYear = 366
  end-if

  do Format-DateTime ($P1YearEnd_Dt, $P1YearEnd_Dt, {DEFCMP}, '', 'native')

  Let #PrcsYear = 0
  Let $CalcToDt = $PrcsToDT
  do Load-Bnft-Code-Rate

  Let #PrcsYear = 1
  Let $CalcToDt  = $P1yearEnd_Dt
  do Load-Bnft-Code-Rate

  move 'IR21 Form Print' to $ReportTitle
  display $ReportTitle

  do Initialise-Variables
  do Get-Company-Details
  do Process-Main

end-procedure

!
!***********************************************************************
!  Procedure: Initialise-Vars                                          *
!             Initialise runtime variables for use with each employee  *
!***********************************************************************
begin-procedure Initialise-Vars

  Let #CYPerc2Value = 0
  Let #P1Perc2Value = 0

  Let #CYTotalc6    = 0
  Let #P1Totalc6    = 0
  Let $Prev_Emplid = ''

end-procedure

!
!***********************************************************************
!  Procedure: Initialise-Variables                                     *
!             Initialise variables for use within the program.         *
!***********************************************************************
begin-procedure Initialise-Variables

  let #StdFont     = 5                  !Times Roman proportional
  let #StmtPntSize = 7                  !statement point-size
  let #ChkPntSize  = 9                  !check point-size

end-procedure


!***********************************************************************
! Procedure: Get-Company-Details                                       *
!            Gets the Company Details that are printed on the form.    *
!***********************************************************************
begin-procedure Get-Company-Details

  begin-SELECT
CO.GPSG_REGISTERED_NM
CO.GPSG_CPY_DESCR
CO.GPSG_ADDRESS1
CO.GPSG_ADDRESS2
CO.GPSG_ADDRESS3
CO.POSTAL
CO.GPSG_CPY_TAX_REF
CO.PHONE
CO.GPSG_FAX
CO.GPSG_TAX_CONT_ID
CO.GPSG_CPY_SIGNATORY
CO.GPSG_ROB_ROC_TYPE
CO.GPSG_ROB_ROC_NO
CO.GPSG_OHQ_STATUS
CO.GPSG_8B_INCORP_DT

  FROM PS_GPSG_IRAS_CPY CO
 WHERE CO.GPSG_CPY_TAX_REF = $Company_Tax_Ref
   AND CO.EFFDT = (SELECT MAX(EFFDT)
                     FROM PS_GPSG_IRAS_CPY
                    WHERE GPSG_CPY_TAX_REF = CO.GPSG_CPY_TAX_REF
                      AND EFFDT <= $PrcsToDt)
  end-SELECT

  let $Company_Tax_Ref = rtrim(&CO.GPSG_CPY_TAX_REF, ' ')
  If rtrim(&CO.GPSG_ROB_ROC_TYPE,' ') = '7'
     Let $ROB_ROC_No   = &CO.GPSG_ROB_ROC_NO
  end-if
  If rtrim(&CO.GPSG_ROB_ROC_TYPE,' ') = '8'
     Let $ROB_ROC_No   = &CO.GPSG_ROB_ROC_NO
  end-if
  If rtrim(&CO.GPSG_ROB_ROC_TYPE,' ') = 'U'
     Let $ROB_ROC_No   = &CO.GPSG_ROB_ROC_NO
  end-if
  If rtrim(&CO.GPSG_ROB_ROC_TYPE,' ') = 'N' or rtrim(&CO.GPSG_ROB_ROC_TYPE,' ') = 'O'
     Let $ROB_ROC_No   = $Company_Tax_Ref
  end-if

  let $Co_Tax_Contact = &CO.GPSG_CPY_SIGNATORY
  do Format-DateTime(&CO.GPSG_8B_INCORP_DT, $Incorp_dt, {DEFCMP}, '', '')
  let $Co_Phone = rtrim(&CO.PHONE, ' ')
  let $Co_Tax_Contact_Id = rtrim(&CO.GPSG_TAX_CONT_ID, ' ')
  let $Co_Name = rtrim(&CO.GPSG_REGISTERED_NM, ' ')
  if $Co_Name = ''
     let $Co_Name = &CO.GPSG_CPY_DESCR
  else
     let $Co_Name = &CO.GPSG_REGISTERED_NM
  end-if
  uppercase $Co_Name
  Let #Co_len     = Length($Co_Name)
  If #Co_len      <= 45
    Let $Co_Name1 = $Co_Name
    Let $Co_Name2 = ' '
  else
    Let #Co_Diff   = #Co_Len - 45
    Let $Co_Name1 = Substr($Co_Name,1,45)
    Let $Co_Name2 = Substr($Co_Name,46,#Co_Diff)
  end-if

  let $Co_Address1 = rtrim(&CO.GPSG_ADDRESS1,' ') || ' '
  let $Co_Address2 = rtrim(&CO.GPSG_ADDRESS2,' ') || ' '
  let $Co_Address3 = rtrim(&CO.GPSG_ADDRESS3,' ') || ' '
  let $Co_City_Zip = rtrim(&CO.POSTAL,' ') || ' '

  begin-select
P.NAME
JC.DESCR
J.EMPL_RCD

  Let $empl_rcd = &J.EMPL_RCD
  FROM PS_JOB J
     , PS_PERSON_NAME P
     , PS_JOBCODE_TBL JC
 WHERE P.EMPLID        = J.EMPLID
   AND P.EMPLID        = $Co_Tax_Contact_Id
   AND J.EMPL_RCD      = $empl_rcd
   AND J.JOBCODE       = JC.JOBCODE
   AND J.SETID_JOBCODE = JC.SETID
   AND J.EFFDT         = (SELECT MAX(J1.EFFDT)
                            FROM PS_JOB J1
                           WHERE J1.EMPLID = J.EMPLID
                             AND J1.EFFDT <= $PrcsToDt)
   AND JC.EFFDT        = (SELECT MAX(JC1.EFFDT)
                            FROM PS_JOBCODE_TBL JC1
                           WHERE JC1.JOBCODE = J.JOBCODE
                             AND JC1.SETID   = JC.SETID
                             AND JC1.EFFDT  <= J.EFFDT)
   AND J.EFFSEQ        = (SELECT MAX(J2.EFFSEQ)
                            FROM PS_JOB J2
                           WHERE J2.EMPLID = J.EMPLID
                             AND J2.EFFDT = J.EFFDT)
  end-select

begin-SELECT
EADD.EMAIL_ADDR

   Move &EADD.EMAIL_ADDR to $Email_add

FROM PS_EMAIL_ADDRESSES EADD
WHERE EADD.EMPLID = $Co_Tax_Contact_Id
AND EADD.PREF_EMAIL_FLAG = 'Y'
End-SELECT

  if rtrim(&P.NAME, ' ') <> ''
     let $Co_Tax_Contact = rtrim(&P.NAME, ' ')
  end-if

  uppercase $Co_Tax_Contact
  let $Co_Designation = rtrim(&JC.DESCR, ' ')
  uppercase $Co_Designation

end-procedure

!
!***********************************************************************
! Procedure: Process-Main                                              *
!            Control the process either by choosing paygroup or by     *
!            Employee ID's entered on the run control panel            *
!***********************************************************************
begin-procedure Process-Main

#ifdef UNIX
   let $delimiter = '/'
#else
   let $delimiter = '\'
#endif

  Let $Empls = 'N'
  Do Get-Output-Directory

  USE-REPORT Appendix2_Report
    Let $File1 = 'APPENDIX2'
    let #PointPos = - 3 + length($sqr-report)
    let $FileExtension = substr($sqr-report, #PointPos,4)
    let $sqr-report = $Output_Directory || $delimiter || $File1 || $FileExtension
  New-Report $sqr-report
  
  USE-REPORT Appendix3_Report
    Let $File1 = 'APPENDIX3'
    let #PointPos = - 3 + length($sqr-report)
    let $FileExtension = substr($sqr-report, #PointPos,4)
    let $sqr-report = $Output_Directory || $delimiter || $File1 || $FileExtension
  New-Report $sqr-report

  if rtrim($Paygroup,' ') <> ''
     Do Print-Paygroup-Select
  else
     Do Print-Employee-Select
  End-if

end-procedure

!
!***********************************************************************
! Procedure: Print-Paygroup-Select                                     *
!            Control the process by choosing employees' belonging to   *
!            paygroup entered on the run control panel                 *
!***********************************************************************
Begin-Procedure Print-Paygroup-Select
  Let $WhereClause = ' AND PIHS.GP_PAYGROUP = ' || '''' || $Paygroup || ''''
  Do Get-IR21-Data

End-Procedure

!
!***********************************************************************
! Procedure: Print-Employee-Select                                     *
!            Control the process by choosing employees' entered on the *
!            run control panel                                         *
!***********************************************************************
Begin-Procedure Print-Employee-Select

!Check for child records

!#ifdef UNIX
!   let $delimiter = '/'
!#else
!   let $delimiter = '\'
!#endif
!
!  Let $Empls = 'N'
!  Do Get-Output-Directory
!
!  USE-REPORT Appendix2_Report
!    Let $File1 = 'APPENDIX2'
!    let #PointPos = - 3 + length($sqr-report)
!    let $FileExtension = substr($sqr-report, #PointPos,4)
!    let $sqr-report = $Output_Directory || $delimiter || $File1 || $FileExtension
!  New-Report $sqr-report

begin-select
EMPL.EMPLID
EMPL.BALANCE_GRP_NUM
     move &EMPL.EMPLID            to $Emplid
     move &EMPL.BALANCE_GRP_NUM to $Bal_Grp

     Let $WhereClause = ' AND PIHS.EMPLID = ' || '''' || $Emplid || ''''
     Let $WhereClause = $WhereClause || ' AND PIHS.BALANCE_GRP_NUM = ''' || $Bal_Grp || ''''

     Let $Empls = 'Y'

     Do Get-IR21-Data

    FROM PS_GPSG_RC_IRASEMP EMPL
   WHERE EMPL.OPRID = $Prcs_OprID
     AND EMPL.RUN_CNTL_ID = $Prcs_Run_Cntl_ID
   ORDER BY EMPL.EMPLID
  end-select

  if $Empls = 'N'
     Let $WhereClause = ''
     Do Get-IR21-Data
  end-if


end-procedure

!
!**************************************************
!Procedure:     Get-IR21-Data                     *
!               Get IR21 Details for the Employee *
!**************************************************
Begin-Procedure Get-IR21-Data
  Let $Furnished_status = ' '
  Let $Furnished_status_1 = ' '
  Let $Address1 = ' '
   Let $Address2 = ' '
  Let $Address3 = ' '
  Let $Postal = ' '
  Let $GPSG_ER_PAR_TX_RS = ' '
  Do Initialise-Vars


Begin-SELECT
PIHS.EMPLID
PIHS.BALANCE_GRP_NUM
PIHS.GPSG_CPY_TAX_REF
PIHS.GPSG_TAX_YEAR
PIHS.GPSG_8A_STATUS
PIHS.GPSG_ISSUE_DATE
PIHS.GP_PAYGROUP
PIHS.GPSG_REGISTERED_NM
PIHS.GPSG_ADDRESS1
PIHS.GPSG_ADDRESS2
PIHS.GPSG_ADDRESS3
PIHS.NAME
PIHS.NAME_PREFIX
PIHS.NATIONAL_ID_TYPE
PIHS.NATIONAL_ID
PIHS.PERM_STATUS_DT_SGP
PIHS.GPSG_ADDRESS1_OTH
PIHS.GPSG_ADDRESS2_OTH
PIHS.GPSG_ADDRESS3_OTH
PIHS.BIRTHDATE
PIHS.SEX
PIHS.NATIONALITY
PIHS.MAR_STATUS
PIHS.MAR_STATUS_DT
PIHS.PHONE
PIHS.JOB_DESCR
PIHS.GPSG_ARRIVAL_DT
PIHS.HIRE_DT
PIHS.TERMINATION_DT
PIHS.GPSG_DEPART_DT
PIHS.GPSG_RESIG_DT
PIHS.GPSG_CESS_RSN
PIHS.COMP_FREQUENCY
PIHS.GPSG_MTH_CESS_RSN
PIHS.GPSG_TAX_WHELD
PIHS.GPSG_LAST_PAY_DT
PIHS.GPSG_LAST_SAL
PIHS.GPSG_PERIOD
PIHS.GPSG_NONE_WHELD
PIHS.GPSG_BASIS_WHELD
PIHS.GPSG_EMPL_BANK
PIHS.GPSG_IR21_EMPLR
PIHS.GPSG_ER_PAYS_TAX
PIHS.GPSG_ER_PAR_TX_RS
PIHS.GPSG_SPOUSE_NAME
PIHS.GPSG_SPOUSE_BDATE
PIHS.GPSG_SPOUSE_ID
PIHS.GPSG_SPOUSE_NAT
PIHS.GPSG_EMPLR_SCHL
!PIHR.GPSG_8B_REMARKS
PIDS.EFFDT                   &CurrEffdt
PIDS.EFFSEQ                  &CurrEffSeq
PIDS.GPSG_IR21_TYPE          &IR21Type
PIDS.GPSG_TAX_YR_START
PIDS.GPSG_TAX_YR_END
PIDS.GPSG_TAX_YR_STRT_1
PIDS.GPSG_TAX_YR_END_1
PIDS.GPSG_8A_INCOME_TOT
PIDS.GPSG_8A_INC_TOT_1
PIDS.GPSG_8A_CNT_BONUS
PIDS.GPSG_8A_CNT_BNS_1
PIDS.GPSG_8A_NC_BONUS
PIDS.GPSG_8A_NC_BNS_1
PIDS.GPSG_BONUS_DT
PIDS.GPSG_8A_DIR_FEE
PIDS.GPSG_DIR_FEE_DT
PIDS.GPSG_8A_DIR_FEE_1
PIDS.GPSG_8A_COMMSN
PIDS.GPSG_8A_COMMSN_1
PIDS.GPSG_8A_ALLOW_TOT
PIDS.GPSG_8A_ALLW_TOT_1
PIDS.GPSG_8A_GRATUITY
PIDS.GPSG_8A_GRATUITY_1
PIDS.GPSG_8A_NOTICE
PIDS.GPSG_8A_NOTICE_1
PIDS.GPSG_8A_LOSS_OFFIC
PIDS.GPSG_8A_LOSS_OFF_1
PIDS.GPSG_8A_RETIRE
PIDS.GPSG_RETIRE_FUND
PIDS.GPSG_8A_RETIRE_1
PIDS.GPSG_8A_OS_PENSION
PIDS.GPSG_8A_OS_PENS_1
PIDS.GPSG_OS_PENS_FUND
PIDS.GPSG_CPF_VOL_ER
PIDS.GPSG_CPF_VOL_ER_1
PIDS.GPSG_8A_SHARE_GAIN
PIDS.GPSG_8A_SHARE_GN_1
PIDS.GPSG_ESOP_APPLIC
PIDS.GPSG_8A_BIK
PIDS.GPSG_8A_BIK_1
PIDS.GPSG_CPF_COMP_EE
PIDS.GPSG_CPF_COMP_EE_1
PIDS.GPSG_PENS_FUND
PIDS.GPSG_CPF_VOL_EE
PIDS.GPSG_CPF_VOL_EE_1
PIDS.GPSG_8A_DONATIONS
PIDS.GPSG_8A_DONATNS_1
PIDS.GPSG_TOTAL_MBMF
PIDS.GPSG_TOTAL_MBMF_1
!PIDS.GPSG_8A_MBMF_IND
PIDS.GPSG_8A_CCHEST_IND
PIDS.GPSG_8A_SINDA_IND
PIDS.GPSG_8A_CDAC_IND
PIDS.GPSG_8A_ECF_IND
PIDS.GPSG_8A_YMF_IND
PIHS.GPSG_LOM_NOTICE
PIHS.GPSG_TNW_REASON
PIHS.GPSG_IR21_MONIES
PIHS.GPSG_SPOUSE_INCOME
PIDS.GPSG_DATE_PAYMENT

   let $Nid = &PIHS.NATIONAL_ID
   let $Nid_Type = &PIHS.NATIONAL_ID_TYPE
   Do Format_NationalID($Nid, $Nid_Type)
   Let $ADDRESS1_OTH =  &PIHS.GPSG_ADDRESS1_OTH
   Let $ADDRESS2_OTH =  &PIHS.GPSG_ADDRESS2_OTH
   Let $ADDRESS3_OTH =  &PIHS.GPSG_ADDRESS3_OTH
   Let $GPSG_ER_PAR_TX_RS = &PIHS.GPSG_ER_PAR_TX_RS

   use-report This_Report
    Let #CYDiffDays     = 0
    Let #P1DiffDays     = 0

    ! If the current row is an amended row then we need to get the previous row for the Last Amended Date

    Let $Emplid  = &PIHS.EMPLID
    Let $Bal_Grp = &PIHS.BALANCE_GRP_NUM
    Let $LOM_Notice = &PIHS.GPSG_LOM_NOTICE
    Let $TNW_Reason = &PIHS.GPSG_TNW_REASON
    Let $IR21_Monies = &PIHS.GPSG_IR21_MONIES
    Let $Spouse_income = &PIHS.GPSG_SPOUSE_INCOME
    Let $Date_Payment = &PIDS.GPSG_DATE_PAYMENT

    Let $LastAmended_Dt = ''

    let #UIN_Line = 0
    if ((Rtrim(&PIHS.NATIONAL_ID_TYPE, ' ') = 'PR' or RTrim(&PIHS.NATIONAL_ID_TYPE, ' ') = 'IC' )
    and (Rtrim(&PIHS.NATIONAL_ID_TYPE, ' ') <> 'MI1' and  Rtrim(&PIHS.NATIONAL_ID_TYPE, ' ') <> 'MI2' and Rtrim(&PIHS.NATIONAL_ID_TYPE, ' ') <> 'MI3'))
       let #UIN_Line = 1
    end-if

    if Rtrim(&PIHS.NATIONAL_ID_TYPE, ' ') = 'MI1' OR  Rtrim(&PIHS.NATIONAL_ID_TYPE, ' ') = 'MI2' OR Rtrim(&PIHS.NATIONAL_ID_TYPE, ' ') = 'MI3'
       let #UIN_Line = 2
    end-if

    if &IR21Type = 'M' or &IR21Type = 'D'
       Do Get-Previous-Row-Data
    End-if
    Do Get-Mail-Pers-Address 

    Let #GapValue = 2
    Do Print-Employee-Page1

    Do Collect-Appendix1-Data

    If #TaxYear >= 2014
     do Fetch_values-Employee-Page3_Currentyear
     do Fetch_values-Employee-Page4_Currentyear
  !  do Update-BIK-Value-Currentyear
    End-if


    Let #GapValue = 3
    Do Print-Employee-Page2

   If #TaxYear < 2014

    If #P1IR21Total <> 0 or #CYIR21Total <> 0 
       do Print-Employee-Page3
       do Print-Employee-Page4
   
     end-if
  end-if


    If #TaxYear >= 2014
     do Print-Employee-Page3_Currentyear
    do Print-Employee-Page4_Currentyear
    do Update-BIK-Value-Currentyear
    End-if

   DO Select-Appendix3

    use-report Appendix2_Report
    do Print-Employee-Page5

     If #TaxYear < 2014
    Do Update-Issue-Status
    End-if

   FROM PS_GPSG_IR21_HDR PIHS, PS_GPSG_IR21_DTL PIDS

  WHERE PIHS.GPSG_CPY_TAX_REF = $Company_Tax_Ref
    AND PIHS.GPSG_TAX_YEAR    = #TaxYear
    AND PIHS.EMPLID           = PIDS.EMPLID
    AND PIHS.BALANCE_GRP_NUM  = PIDS.BALANCE_GRP_NUM
    AND PIHS.GPSG_CPY_TAX_REF = PIDS.GPSG_CPY_TAX_REF
    AND PIHS.GPSG_TAX_YEAR    = PIDS.GPSG_TAX_YEAR
    AND PIDS.EFFDT            = (SELECT MAX(PIDS1.EFFDT)
                                   FROM PS_GPSG_IR21_DTL PIDS1
                                  WHERE PIDS1.EMPLID            = PIDS.EMPLID
                                    AND  PIDS1.BALANCE_GRP_NUM  = PIDS.BALANCE_GRP_NUM
                                    AND  PIDS1.GPSG_CPY_TAX_REF = PIDS.GPSG_CPY_TAX_REF
                                    AND  PIDS1.GPSG_TAX_YEAR    = PIDS.GPSG_TAX_YEAR
                                    AND  PIDS1.EFFDT           <= $Create_Date)
    AND PIDS.EFFSEQ = (SELECT MAX(PIDS2.EFFSEQ)
                         FROM PS_GPSG_IR21_DTL PIDS2
                        WHERE PIDS2.EMPLID            = PIDS.EMPLID
                          AND  PIDS2.BALANCE_GRP_NUM  = PIDS.BALANCE_GRP_NUM
                          AND  PIDS2.GPSG_CPY_TAX_REF = PIDS.GPSG_CPY_TAX_REF
                          AND  PIDS2.GPSG_TAX_YEAR    = PIDS.GPSG_TAX_YEAR
                          AND  PIDS2.EFFDT            = PIDS.EFFDT)
    [$WhereClause]
  End-SELECT
End-Procedure

begin-procedure Get-Mail-Pers-Address
   Let $Email = ''

begin-SELECT
E.EMAIL_ADDR   &E.EMAIL_ADDR 
    Let $Email =  &E.EMAIL_ADDR
FROM PS_EMAIL_ADDRESSES E
WHERE E.EMPLID = $Emplid
AND E.PREF_EMAIL_FLAG = 'Y'
end-SELECT

   ! Move &E.EMAIL_ADDR to $Email

begin-SELECT
ADDR.EFFDT
FROM PS_ADDRESSES ADDR
WHERE ADDR.EMPLID = $Emplid
AND ADDR.EFFDT = (SELECT MAX(EFFDT)
                    FROM PS_ADDRESSES
                    WHERE EMPLID = ADDR.EMPLID)
End-SELECT

    Move &ADDR.EFFDT to $AddEffdt

begin-SELECT
PH.ADDRESS1
PH.ADDRESS2
PH.CITY
PH.POSTAL
PH.COUNTRY
PH.STATE
CN.DESCRSHORT

     Let $Address1 = ltrim(rtrim(&PH.ADDRESS1,' '),' ')
     Let $Address2 = ltrim(rtrim(&PH.ADDRESS2,' '),' ') ||
                     ltrim(rtrim(&PH.CITY,' '),' ') || ltrim(rtrim(&PH.STATE,' '),' ')
     Let $Address3 = ltrim(rtrim(&CN.DESCRSHORT,' '),' ')
     Let $Postal   = ltrim(rtrim(&PH.POSTAL,' '),' ')

FROM PS_PERSON_ADDR_HOM PH, PS_COUNTRY_TBL CN
  WHERE PH.EMPLID = $Emplid
  AND CN.COUNTRY = 'SGP'
  AND PH.COUNTRY = CN.COUNTRY
  AND PH.ASOFDATE = (SELECT MAX(PH1.ASOFDATE) FROM PS_PERSON_ADDR_HOM PH1
                       WHERE PH1.EMPLID = PH.EMPLID
                       AND PH1.ASOFDATE <= $Asoftoday)
end-SELECT


End-Procedure


!***********************************************************************
!  Procedure: Get-Previous-Row-Data                                    *
!             Get the Previous Row data for Last Issued IR21           *
!***********************************************************************
Begin-Procedure Get-Previous-Row-Data

  Begin-SELECT
PREV.EFFDT
PREV.EFFSEQ
     Move &PREV.EFFDT to $LastAmended_Dt

   FROM PS_GPSG_IR21_DTL PREV
  WHERE PREV.GPSG_CPY_TAX_REF = $Company_Tax_Ref
    AND PREV.GPSG_TAX_YEAR    = #TaxYear
    AND PREV.EMPLID           = $Emplid
    AND PREV.BALANCE_GRP_NUM  = $Bal_Grp
    AND PREV.EFFDT            = (SELECT MAX(PREV1.EFFDT)
                                   FROM PS_GPSG_IR21_DTL PREV1
                                  WHERE PREV1.GPSG_CPY_TAX_REF = PREV.GPSG_CPY_TAX_REF
                                    AND PREV1.GPSG_TAX_YEAR    = PREV.GPSG_TAX_YEAR
                                    AND PREV1.EMPLID           = PREV.EMPLID
                                    AND PREV1.BALANCE_GRP_NUM  = PREV.BALANCE_GRP_NUM
                                    AND PREV1.EFFDT           <= &CurrEffdt
                                    AND ((PREV1.EFFDT          = &CurrEffdt
                                      AND PREV1.EFFSEQ < &CurrEffseq)
                                       OR PREV1.EFFDT < &CurrEffdt))
    AND PREV.EFFSEQ           = (SELECT MAX(PREV2.EFFSEQ)
                                   FROM PS_GPSG_IR21_DTL PREV2
                                  WHERE PREV2.GPSG_CPY_TAX_REF = PREV.GPSG_CPY_TAX_REF
                                    AND PREV2.GPSG_TAX_YEAR    = PREV.GPSG_TAX_YEAR
                                    AND PREV2.EMPLID           = PREV.EMPLID
                                    AND PREV2.BALANCE_GRP_NUM  = PREV.BALANCE_GRP_NUM
                                    AND PREV2.EFFDT            = PREV.EFFDT
                                    AND ((PREV2.EFFDT          = &CurrEffdt
                                      AND PREV2.EFFSEQ         < &CurrEffseq)
                                       OR PREV2.EFFDT          < &CurrEffdt))
  End-SELECT

End-Procedure

!
!***********************************************************************
!  Procedure: Print-Child-Details                                      *
!             Get the Child Details of the Employee                    *
!***********************************************************************
begin-procedure Print-Child-Details

  BEGIN-SELECT
PICD.EMPLID
PICD.BALANCE_GRP_NUM
PICD.GPSG_CPY_TAX_REF
PICD.GPSG_TAX_YEAR
PICD.DEPENDENT_BENEF
PICD.NAME
PICD.SEX
PICD.BIRTHDATE
PICD.GPSG_EMPLR_SCHL

      add 3 to #row
      print &PICD.NAME            (#row,8)
      if &PICD.SEX = 'M'
         print 'Male'             (#row,48)
      end-if
      if &PICD.SEX = 'F'
         print 'Female'           (#row,48)
      end-if

      print &PICD.BIRTHDATE       (#row,57) edit 'DD/MM/YYYY'
      print &PICD.GPSG_EMPLR_SCHL (#row,79)

            add -2 to #row

   FROM PS_GPSG_IR21_CHILD PICD
     WHERE PICD.EMPLID           = $Emplid
       AND PICD.BALANCE_GRP_NUM  = $Bal_Grp
       AND PICD.GPSG_CPY_TAX_REF = $Company_Tax_Ref
       AND PICD.GPSG_TAX_YEAR    = #TaxYear
  End-SELECT

End-Procedure

!
!*****************************************************
!Procedure:     Collect-Appendix1-Data               *
!               Collect Appendix 1 Details into Vars *
!*****************************************************
Begin-Procedure Collect-Appendix1-Data

  Let $Furnished_status = ' '
  Let $Furnished_status_1 = ' '
  Let $RES2_ADDR1 = ''
  Let $RES2_ADDR2 = ''
  Let $RES2_ADDR3 = ''
  Let $RES2_PerFrom1 = ''
  Let $RES2_PerFrom2 = ''
  Let $RES2_PerTo1 = ''
  Let $RES2_PerTo2 = ''
  Let #CYDiffDays_Res2 = 0
  Let #P1DiffDays_Res2 = 0
  Let $Furnished_Res2_sts = ''
  Let $Furnished_Res2_sts1 = ''
  Let #GPSG_AP8A_RES2_VAL_APP1 = 0
  Let #GPSG_AP8A_RES2_VL_P_APP1 = 0
  Let #CYNoSharing_Res2 = 1
  Let #P1NoSharing_Res2 = 1
  Let #CY_EE_RENT_RES2 = 0
  Let #CY_ER_RENT_RES2 = 0
  Let #P1_EE_RENT_RES2 = 0
  Let #P1_ER_RENT_RES2 = 0
  
   

BEGIN-SELECT
PA1S.GPSG_RES_TYPE
PA1S.GPSG_ADDRESS1
PA1S.GPSG_ADDRESS2
PA1S.GPSG_ADDRESS3
PA1S.GPSG_AP8A_RES_VAL
PA1S.GPSG_AP8A_RES_VL_1
PA1S.GPSG_AP8A_RES_FR
PA1S.GPSG_AP8A_RES_FR_1
PA1S.GPSG_AP8A_RES_TO
PA1S.GPSG_AP8A_RES_TO_1
PA1S.GPSG_AP8A_ER_RENT
PA1S.GPSG_AP8A_ER_RNT_1
PA1S.GPSG_AP8A_EE_RENT
PA1S.GPSG_AP8A_EE_RNT_1
PA1S.GPSG_AP8A_RES_SHR
PA1S.GPSG_AP8A_RES_SH_1
PA1S.GPSG_AP8A_HTL_SLFN
PA1S.GPSG_AP8A_HTSLFN_1
PA1S.GPSG_AP8A_HTL_SLFD
PA1S.GPSG_AP8A_HTSLFD_1
PA1S.GPSG_AP8A_HTL_WIFN
PA1S.GPSG_AP8A_HTLWIFN1
PA1S.GPSG_AP8A_HTL_WIFD
PA1S.GPSG_AP8A_HTLWIFD1
PA1S.GPSG_AP8A_HTL_CH8N
PA1S.GPSG_AP8A_HTCH8N_1
PA1S.GPSG_AP8A_HTL_CH8D
PA1S.GPSG_AP8A_HTCH8D_1
PA1S.GPSG_AP8A_HTL_CH3N
PA1S.GPSG_AP8A_HTCH3N_1
PA1S.GPSG_AP8A_HTL_CH3D
PA1S.GPSG_AP8A_HTCH3D_1
PA1S.GPSG_AP8A_HTL_CH0N
PA1S.GPSG_AP8A_HTL_CH0D
PA1S.GPSG_AP8A_HTCH0N_1
PA1S.GPSG_AP8A_HTCH0D_1
PA1S.GPSG_AP8A_RES_VL_P
PA1S.GPSG_FURNISHED
PA1S.GPSG_FURNISHED_1
PA1S.GPSG_AP8A_ER_HTL
PA1S.GPSG_AP8A_ER_HTL_1
PA1S.GPSG_AP8A_EE_HTL
PA1S.GPSG_AP8A_EE_HTL_1


      show 'Emplid=' $Emplid
      show 'Res Type=' &PA1S.GPSG_RES_TYPE
      
      If ( &PA1S.GPSG_RES_TYPE = '2')
      let $RES2_ADDR1 = ltrim(rtrim(&PA1S.GPSG_ADDRESS1, ' '), ' ')
      let $RES2_ADDR2 = ltrim(rtrim(&PA1S.GPSG_ADDRESS1, ' '), ' ')
      let $RES2_ADDR3 = ltrim(rtrim(&PA1S.GPSG_ADDRESS1, ' '), ' ')
      Let $RES2_PerFrom1 = &PA1S.GPSG_AP8A_RES_FR
      Let $RES2_PerFrom2 = &PA1S.GPSG_AP8A_RES_FR_1
      Let $RES2_PerTo1 = &PA1S.GPSG_AP8A_RES_TO
      Let $RES2_PerTo2 = &PA1S.GPSG_AP8A_RES_TO_1
      
      Let $Furnished_Res2_sts = &PA1S.GPSG_FURNISHED
      Let $Furnished_Res2_sts1 = &PA1S.GPSG_FURNISHED_1
      
      Do Calc-diff-days (&PA1S.GPSG_AP8A_RES_FR, &PA1S.GPSG_AP8A_RES_TO, #CYDiffDays_Res2)
      Do Calc-diff-days (&PA1S.GPSG_AP8A_RES_FR_1, &PA1S.GPSG_AP8A_RES_TO_1, #P1DiffDays_Res2)
      
      move &PA1S.GPSG_AP8A_RES_VAL to #GPSG_AP8A_RES2_VAL_APP1
      move &PA1S.GPSG_AP8A_RES_VL_P to #GPSG_AP8A_RES2_VL_P_APP1

      Do Calc-diff-days (&PA1S.GPSG_AP8A_RES_FR, &PA1S.GPSG_AP8A_RES_TO, #CYDiffDays_Res2)
      Do Calc-diff-days (&PA1S.GPSG_AP8A_RES_FR_1, &PA1S.GPSG_AP8A_RES_TO_1, #P1DiffDays_Res2)
      
      
        If &PA1S.GPSG_AP8A_RES_SHR  = 0
          Let #CYNoSharing_Res2 = 1
        else
          Let #CYNoSharing_Res2 = &PA1S.GPSG_AP8A_RES_SHR
       end-if

       If &PA1S.GPSG_AP8A_RES_SH_1 = 0
          Let #P1NoSharing_Res2 = 1
       else
          Let #P1NoSharing_Res2 = &PA1S.GPSG_AP8A_RES_SH_1
       end-if
       
       Let #CY_EE_RENT_RES2 = trunc(&PA1S.GPSG_AP8A_EE_RENT,0)
       Let #CY_ER_RENT_RES2 = trunc(&PA1S.GPSG_AP8A_ER_RENT,0)
       
       Let #P1_EE_RENT_RES2 = trunc(&PA1S.GPSG_AP8A_EE_RNT_1,0)
       Let #P1_ER_RENT_RES2 = trunc(&PA1S.GPSG_AP8A_ER_RNT_1,0)
        
      End-If
      
        
      

      Let $Furnished_status = &PA1S.GPSG_FURNISHED
      Let $Furnished_status_1 = &PA1S.GPSG_FURNISHED_1

    Do Calc-diff-days (&PA1S.GPSG_AP8A_RES_FR, &PA1S.GPSG_AP8A_RES_TO, #CYDiffDays)
    Do Calc-diff-days (&PA1S.GPSG_AP8A_RES_FR_1, &PA1S.GPSG_AP8A_RES_TO_1, #P1DiffDays)

      FROM PS_GPSG_IR21_APP1 PA1S
     WHERE PA1S.GPSG_CPY_TAX_REF = $Company_Tax_Ref
       AND PA1S.GPSG_TAX_YEAR    = #TaxYear
       AND PA1S.EMPLID           = $Emplid
       AND PA1S.BALANCE_GRP_NUM  = $Bal_Grp
       ORDER BY PA1S.GPSG_RES_TYPE DESC
  END-SELECT

  do Collect-Appendix1-Bnft

End-Procedure
!
!***********************************************************************
!  Procedure: Collect-Appendix1-Bnft                                   *
!             Load the Employee Details of Appendix 1 Benefit          *
!***********************************************************************
begin-Procedure Collect-Appendix1-Bnft

  Let #CYFurniture    = 0
  Let #P1Furniture    = 0
  Let #CYRefrigerator = 0
  Let #P1Refrigerator = 0
  Let #CYVCR          = 0
  Let #P1VCR          = 0
  Let #CYWashMach     = 0
  Let #P1WashMach     = 0
  Let #CYDryer        = 0
  Let #P1Dryer        = 0
  Let #CYDishWasher   = 0
  Let #P1DishWasher   = 0
  Let #CYACUnit       = 0
  Let #P1ACUnit       = 0
  Let #CYACCentral    = 0
  Let #P1ACCentral    = 0
  Let #CYACSitting    = 0
  Let #P1ACSitting    = 0
  Let #CYACAddl       = 0
  Let #P1ACAddl       = 0
  Let #CYACBedroom    = 0
  Let #P1ACBedroom    = 0
  Let #CYTV           = 0
  Let #P1TV           = 0
  Let #CYRadio        = 0
  Let #P1Radio        = 0
  Let #CYAmp          = 0
  Let #P1Amp          = 0
  Let #CYHiFi         = 0
  Let #P1HiFi         = 0
  Let #CYGuitar       = 0
  Let #P1Guitar       = 0
  Let #CYComputer     = 0
  Let #P1Computer     = 0
  Let #CYOrgan        = 0
  Let #P1Organ        = 0
  Let #CYPool         = 0
  Let #P1Pool         = 0
  Let #CYFan          = 0
  Let #P1Fan          = 0
  Let #CYAirCooler    = 0
  Let #P1AirCooler    = 0
  Let #CYIron         = 0
  Let #P1Iron         = 0
  Let #CYToaster      = 0
  Let #P1Toaster      = 0
  Let #CYVacuumCleaner= 0
  Let #P1VacuumCleaner= 0
  Let #CYJuicer       = 0
  Let #P1Juicer       = 0
  Let #CYBlender      = 0
  Let #P1Blender      = 0
  Let #CYKettle       = 0
  Let #P1Kettle       = 0
  Let #CYCooker       = 0
  Let #P1Cooker       = 0
  Let #CYWaterHeater  = 0
  Let #P1WaterHeater  = 0
  Let #CYOven         = 0
  Let #P1Oven         = 0
  Let #CYLightFit     = 0
  Let #P1LightFit     = 0
  Let #CYFloorPolish  = 0
  Let #P1FloorPolish  = 0
  Let #CYLawnMover    = 0
  Let #P1LawnMover    = 0
  Let #CYPUB          = 0
  Let #P1PUB          = 0
  Let #CYPhone        = 0
  Let #P1Phone        = 0
  Let #CYPager        = 0
  Let #P1Pager        = 0
  Let #CYSuitcase     = 0
  Let #P1Suitcase     = 0
  Let #CYGolfBag      = 0
  Let #P1GolfBag      = 0
  Let #CYCamera       = 0
  Let #P1Camera       = 0
  Let #CYServant      = 0
  Let #P1Servant      = 0
  Let #CYDriver       = 0
  Let #P1Driver       = 0
  Let #CYGardener     = 0
  Let #P1Gardener     = 0
  Let #CYOthers       = 0
  Let #P1Others       = 0
  Let #CYFax          = 0
  Let #P1Fax          = 0
  Let #CYHomeLeave    = 0
  Let #P1HomeLeave    = 0
  Let #CYEmplrPdInt   = 0
  Let #P1EmplrPdInt   = 0
  Let #CYInsPremium   = 0
  Let #P1InsPremium   = 0
  Let #CYHolidayFare  = 0
  Let #P1HolidayFare  = 0
  Let #CYEducatnExp   = 0
  Let #P1EducatnExp   = 0
  Let #CYClubFees     = 0
  Let #P1ClubFees     = 0
  Let #CYAssetGain    = 0
  Let #P1AssetGain    = 0
  Let #CYVehicleCost  = 0
  Let #P1VehicleCost  = 0
  Let #CYCarBnft      = 0
  Let #P1CarBnft      = 0
  Let #CYOtherBnft    = 0
  Let #P1OtherBnft    = 0
  Let #CYNonMonAward  = 0
  Let #P1NonMonAward  = 0
  Let #CY_TotalOth = 0
  Let #P1_TotalOth = 0

  BEGIN-SELECT
PA1B.GPSG_BEN_TYPE
PA1B.GPSG_BEN_UNIT_TYPE
PA1B.GPSG_UNIT_CNT
PA1B.GPSG_UNIT_CNT_1
PA1B.GPSG_UNIT_VAL
PA1B.GPSG_UNIT_VAL_1

    Evaluate &PA1B.GPSG_BEN_TYPE
       when = '001'
              Let #CYFurniture    = &PA1B.GPSG_UNIT_CNT
              Let #P1Furniture    = &PA1B.GPSG_UNIT_CNT_1
       when = '002'
              Let #CYRefrigerator = &PA1B.GPSG_UNIT_CNT
              Let #P1Refrigerator = &PA1B.GPSG_UNIT_CNT_1
        when = '003'
              Let #CYVCR          = &PA1B.GPSG_UNIT_CNT
              Let #P1VCR          = &PA1B.GPSG_UNIT_CNT_1
       when = '004'
              Let #CYWashMach     = &PA1B.GPSG_UNIT_CNT
              Let #P1WashMach     = &PA1B.GPSG_UNIT_CNT_1
       when = '005'
              Let #CYDryer        = &PA1B.GPSG_UNIT_CNT
              Let #P1Dryer        = &PA1B.GPSG_UNIT_CNT_1
       when = '006'
              Let #CYDishWasher   = &PA1B.GPSG_UNIT_CNT
              Let #P1DishWasher   = &PA1B.GPSG_UNIT_CNT_1
       when = '007'
              Let #CYACUnit       = &PA1B.GPSG_UNIT_CNT
              Let #P1ACUnit       = &PA1B.GPSG_UNIT_CNT_1
       when = '008'
              Let #CYACCentral    = &PA1B.GPSG_UNIT_CNT
              Let #P1ACCentral    = &PA1B.GPSG_UNIT_CNT_1
       when = '009'
              Let #CYACSitting    = &PA1B.GPSG_UNIT_CNT
              Let #P1ACSitting    = &PA1B.GPSG_UNIT_CNT_1
       when = '010'
              Let #CYACAddl       = &PA1B.GPSG_UNIT_CNT
              Let #P1ACAddl       = &PA1B.GPSG_UNIT_CNT_1
       when = '011'
              Let #CYACBedroom    = &PA1B.GPSG_UNIT_CNT
              Let #P1ACBedroom    = &PA1B.GPSG_UNIT_CNT_1
       when = '012'
              Let #CYTV           = &PA1B.GPSG_UNIT_CNT
              Let #P1TV           = &PA1B.GPSG_UNIT_CNT_1
       when = '013'
              Let #CYRadio        = &PA1B.GPSG_UNIT_CNT
              Let #P1Radio        = &PA1B.GPSG_UNIT_CNT_1
       when = '014'
              Let #CYAmp          = &PA1B.GPSG_UNIT_CNT
              Let #P1Amp          = &PA1B.GPSG_UNIT_CNT_1
       when = '015'
              Let #CYHiFi         = &PA1B.GPSG_UNIT_CNT
              Let #P1HiFi         = &PA1B.GPSG_UNIT_CNT_1
       when = '016'
              Let #CYGuitar       = &PA1B.GPSG_UNIT_CNT
              Let #P1Guitar       = &PA1B.GPSG_UNIT_CNT_1
       when = '017'
              Let #CYComputer     = &PA1B.GPSG_UNIT_CNT
              Let #P1Computer     = &PA1B.GPSG_UNIT_CNT_1
       when = '018'
              Let #CYOrgan        = &PA1B.GPSG_UNIT_CNT
              Let #P1Organ        = &PA1B.GPSG_UNIT_CNT_1
       when = '019'
              Let #CYPool         = &PA1B.GPSG_UNIT_CNT
              Let #P1Pool         = &PA1B.GPSG_UNIT_CNT_1
       when = '030'
              Let #CYFan          = &PA1B.GPSG_UNIT_CNT
              Let #P1Fan          = &PA1B.GPSG_UNIT_CNT_1
       when = '031'
              Let #CYAirCooler    = &PA1B.GPSG_UNIT_CNT
              Let #P1AirCooler    = &PA1B.GPSG_UNIT_CNT_1
       when = '032'
              Let #CYIron         = &PA1B.GPSG_UNIT_CNT
              Let #P1Iron         = &PA1B.GPSG_UNIT_CNT_1
       when = '033'
              Let #CYToaster      = &PA1B.GPSG_UNIT_CNT
              Let #P1Toaster      = &PA1B.GPSG_UNIT_CNT_1
       when = '035'
              Let #CYVacuumCleaner= &PA1B.GPSG_UNIT_CNT
              Let #P1VacuumCleaner= &PA1B.GPSG_UNIT_CNT_1
       when = '036'
              Let #CYJuicer       = &PA1B.GPSG_UNIT_CNT
              Let #P1Juicer       = &PA1B.GPSG_UNIT_CNT_1
       when = '037'
              Let #CYBlender      = &PA1B.GPSG_UNIT_CNT
              Let #P1Blender      = &PA1B.GPSG_UNIT_CNT_1
       when = '038'
              Let #CYKettle       = &PA1B.GPSG_UNIT_CNT
              Let #P1Kettle       = &PA1B.GPSG_UNIT_CNT_1
       when = '039'
              Let #CYCooker       = &PA1B.GPSG_UNIT_CNT
              Let #P1Cooker       = &PA1B.GPSG_UNIT_CNT_1
       when = '040'
              Let #CYWaterHeater  = &PA1B.GPSG_UNIT_CNT
              Let #P1WaterHeater  = &PA1B.GPSG_UNIT_CNT_1
       when = '041'
              Let #CYOven         = &PA1B.GPSG_UNIT_CNT
              Let #P1Oven         = &PA1B.GPSG_UNIT_CNT_1
       when = '042'
              Let #CYLightFit     = &PA1B.GPSG_UNIT_CNT
              Let #P1LightFit     = &PA1B.GPSG_UNIT_CNT_1
       when = '043'
              Let #CYFloorPolish  = &PA1B.GPSG_UNIT_CNT
              Let #P1FloorPolish  = &PA1B.GPSG_UNIT_CNT_1
       when = '044'
              Let #CYLawnMover    = &PA1B.GPSG_UNIT_CNT
              Let #P1LawnMover    = &PA1B.GPSG_UNIT_CNT_1
       when = '020'
              Let #CYPUB          = trunc(&PA1B.GPSG_UNIT_VAL,0)
              Let #P1PUB          = trunc(&PA1B.GPSG_UNIT_VAL_1,0)
       when = '021'
              Let #CYPhone        = trunc(&PA1B.GPSG_UNIT_VAL,0)
              Let #P1Phone        = trunc(&PA1B.GPSG_UNIT_VAL_1,0)
       when = '022'
              Let #CYPager        = trunc(&PA1B.GPSG_UNIT_VAL,0)
              Let #P1Pager        = trunc(&PA1B.GPSG_UNIT_VAL_1,0)
       when = '023'
              Let #CYSuitcase     = trunc(&PA1B.GPSG_UNIT_VAL,0)
              Let #P1Suitcase     = trunc(&PA1B.GPSG_UNIT_VAL_1,0)
       when = '024'
              Let #CYGolfBag      = trunc(&PA1B.GPSG_UNIT_VAL,0)
              Let #P1GolfBag      = trunc(&PA1B.GPSG_UNIT_VAL_1,0)
       when = '025'
              Let #CYCamera       = trunc(&PA1B.GPSG_UNIT_VAL,0)
              Let #P1Camera       = trunc(&PA1B.GPSG_UNIT_VAL_1,0)
       when = '026'
              Let #CYServant      = trunc(&PA1B.GPSG_UNIT_VAL,0)
              Let #P1Servant      = trunc(&PA1B.GPSG_UNIT_VAL_1,0)
       when = '027'
              Let #CYDriver       = trunc(&PA1B.GPSG_UNIT_VAL,0)
              Let #P1Driver       = trunc(&PA1B.GPSG_UNIT_VAL_1,0)
       when = '028'
              If(&PA1B.GPSG_UNIT_VAL <= 420)
                Let #CYGardener     = trunc(&PA1B.GPSG_UNIT_VAL,0)
              else
                Let #CYGardener   = 420
              end-if
              If(&PA1B.GPSG_UNIT_VAL_1 <= 420)
                Let #P1Gardener     = trunc(&PA1B.GPSG_UNIT_VAL_1,0)
              else
                Let #P1Gardener   = 420
              end-if
       when = '029'
              Let #CYOthers       = trunc(&PA1B.GPSG_UNIT_VAL,0)
              Let #P1Others       = trunc(&PA1B.GPSG_UNIT_VAL_1,0)
       when = '034'
              Let #CYFax          = &PA1B.GPSG_UNIT_VAL
              Let #P1Fax          = &PA1B.GPSG_UNIT_VAL_1
       when = '045'
              Let #CYHomeLeave    = trunc(&PA1B.GPSG_UNIT_VAL,0)
              Let #P1HomeLeave    = trunc(&PA1B.GPSG_UNIT_VAL_1,0)
       when = '046'
              Let #CYEmplrPdInt   = trunc(&PA1B.GPSG_UNIT_VAL,0)
              Let #P1EmplrPdInt   = trunc(&PA1B.GPSG_UNIT_VAL_1,0)
       when = '047'
              Let #CYInsPremium   = trunc(&PA1B.GPSG_UNIT_VAL,0)
              Let #P1InsPremium   = trunc(&PA1B.GPSG_UNIT_VAL_1,0)
       when = '048'
              Let #CYHolidayFare  = trunc(&PA1B.GPSG_UNIT_VAL,0)
              Let #P1HolidayFare  = trunc(&PA1B.GPSG_UNIT_VAL_1,0)
       when = '049'
              Let #CYEducatnExp   = trunc(&PA1B.GPSG_UNIT_VAL,0)
              Let #P1EducatnExp   = trunc(&PA1B.GPSG_UNIT_VAL_1,0)
       when = '050'
              Let #CYClubFees     = trunc(&PA1B.GPSG_UNIT_VAL,0)
              Let #P1ClubFees     = trunc(&PA1B.GPSG_UNIT_VAL_1,0)
       when = '051'
              Let #CYAssetGain    = trunc(&PA1B.GPSG_UNIT_VAL,0)
              Let #P1AssetGain    = trunc(&PA1B.GPSG_UNIT_VAL_1,0)
       when = '052'
              Let #CYVehicleCost  = trunc(&PA1B.GPSG_UNIT_VAL,0)
              Let #P1VehicleCost  = trunc(&PA1B.GPSG_UNIT_VAL_1,0)
       when = '053'
              Let #CYCarBnft      = trunc(&PA1B.GPSG_UNIT_VAL,0)
              Let #P1CarBnft      = trunc(&PA1B.GPSG_UNIT_VAL_1,0)
       when = '054'
              Let #CYOtherBnft    = trunc(&PA1B.GPSG_UNIT_VAL,0)
              Let #P1OtherBnft    = trunc(&PA1B.GPSG_UNIT_VAL_1,0)
       when = '055'
              Let #CYNonMonAward  = trunc(&PA1B.GPSG_UNIT_VAL,0)
              Let #P1NonMonAward  = trunc(&PA1B.GPSG_UNIT_VAL_1,0)
    End-Evaluate

   FROM PS_GPSG_IR21_BNF PA1B
     WHERE PA1B.GPSG_CPY_TAX_REF = $Company_Tax_Ref
      AND  PA1B.GPSG_TAX_YEAR    = #TaxYear
      AND  PA1B.EMPLID           = $Emplid
      AND  PA1B.BALANCE_GRP_NUM  = $Bal_Grp
  END-SELECT

  If &PA1S.GPSG_AP8A_RES_SHR  = 0
     Let #CYNoSharing = 1
  else
     Let #CYNoSharing = &PA1S.GPSG_AP8A_RES_SHR
  end-if

  If &PA1S.GPSG_AP8A_RES_SH_1 = 0
     Let #P1NoSharing = 1
  else
     Let #P1NoSharing = &PA1S.GPSG_AP8A_RES_SH_1
  end-if

  Let #CYSubTotal4A_J = trunc(&PIDS.GPSG_8A_COMMSN,0) + trunc(&PIDS.GPSG_8A_ALLOW_TOT,0)  + trunc(&PIDS.GPSG_8A_GRATUITY,0) + trunc(&PIDS.GPSG_8A_NOTICE,0) + trunc(&PIDS.GPSG_8A_LOSS_OFFIC,0) + -
                        trunc(&PIDS.GPSG_8A_RETIRE,0) + trunc(&PIDS.GPSG_8A_OS_PENSION,0) + trunc(&PIDS.GPSG_CPF_VOL_ER,0) + trunc(&PIDS.GPSG_8A_SHARE_GAIN,0)

! Were are not adding Benefits in Kind Amount to calculate the total rem

   Let #P1SubTotal4A_J = trunc(&PIDS.GPSG_8A_COMMSN_1,0) + trunc(&PIDS.GPSG_8A_ALLW_TOT_1,0) + trunc(&PIDS.GPSG_8A_GRATUITY_1,0) + trunc(&PIDS.GPSG_8A_NOTICE_1 + &PIDS.GPSG_8A_LOSS_OFF_1,0) + -
                         trunc(&PIDS.GPSG_8A_RETIRE_1,0) + trunc(&PIDS.GPSG_8A_OS_PENS_1 ,0) + trunc(&PIDS.GPSG_CPF_VOL_ER_1 ,0) + trunc(&PIDS.GPSG_8A_SHARE_GN_1,0)

   Let #CYTotal1_4 = trunc(&PIDS.GPSG_8A_INCOME_TOT,0) + trunc(&PIDS.GPSG_8A_CNT_BONUS,0) + trunc(&PIDS.GPSG_8A_NC_BONUS,0) + trunc(&PIDS.GPSG_8A_DIR_FEE,0)  + #CYSubTotal4A_J
   Let #P1Total1_4 = trunc(&PIDS.GPSG_8A_INC_TOT_1,0) + trunc(&PIDS.GPSG_8A_CNT_BNS_1,0) + trunc(&PIDS.GPSG_8A_NC_BNS_1,0) + trunc(&PIDS.GPSG_8A_DIR_FEE_1,0) + #P1SubTotal4A_J

! Current Year Rates / Values
      Let #CYRtAnFurniture = #CYRtFurniture * 12
      if(#CYRtAnFurniture > 120 or #CYRtAnFurniture = 0 )
        let #CYRtAnFurniture = 120
      end-if

      Let #CYRtAnRefrigerator =  #CYRtRefrigerator * 12
      if (#CYRtAnRefrigerator > 120 or #CYRtAnRefrigerator = 0 )
        let #CYRtAnRefrigerator = 120
      end-if

      Let #CYRtAnVCR = #CYRtVCR * 12
      if(#CYRtAnVCR > 240 or #CYRtAnVCR = 0 )
        let #CYRtAnVCR = 240
      end-if

      Let #CYRtAnWashMach = #CYRtWashMach * 12
      if(#CYRtAnWashMach > 180 or #CYRtAnWashMach = 0)
        let #CYRtAnWashMach = 180
      end-if

      Let #CYRtAnDryer = #CYRtDryer * 12
      if(#CYRtAnDryer > 180 or #CYRtAnDryer = 0)
        let #CYRtAnDryer = 180
      end-if

      Let #CYRtAnDishWasher = #CYRtDishWasher * 12
      if(#CYRtAnDishWasher > 180 or #CYRtAnDishWasher = 0)
        let #CYRtAnDishWasher = 180
      end-if

      Let #CYRtAnACUnit = #CYRtACUnit * 12
      if (#CYRtAnACUnit > 120 or #CYRtAnACUnit = 0)
        let #CYRtAnACUnit = 120
      end-if

      Let #CYRtAnACCentral = #CYRtACCentral * 12
      if( #CYRtAnACCentral > 180 or #CYRtAnACCentral = 0)
        let #CYRtAnACCentral = 180
      end-if

      Let #CYRtAnACSitting = #CYRtACSitting * 12
      if(#CYRtAnACSitting > 180 or #CYRtAnACSitting = 0)
        let #CYRtAnACSitting = 180
      end-if

      Let #CYRtAnACAddl = #CYRtACAddl * 12
      if( #CYRtAnACAddl > 120 or #CYRtAnACAddl = 0)
        let #CYRtAnACAddl = 120
      end-if

      Let #CYRtAnTV = #CYRtTV * 12
      if( #CYRtAnTV > 360 or #CYRtAnTV = 0)
        let #CYRtAnTV = 360
      end-if

      Let #CYRtAnRadio = #CYRtRadio * 12
      if(#CYRtAnRadio > 360 or #CYRtAnRadio = 0)
        let #CYRtAnRadio = 360
      end-if

      Let #CYRtAnAmp = #CYRtAmp * 12
      if(#CYRtAnAmp > 360 or #CYRtAnAmp = 0)
        let #CYRtAnAmp = 360
      end-if

      Let #CYRtAnHifi = #CYRtHifi * 12
      if(#CYRtAnHifi > 360 or #CYRtAnHifi = 0)
        let #CYRtAnHifi = 360
      end-if

      Let #CYRtAnGuitar = #CYRtGuitar * 12
      if(#CYRtAnGuitar > 360 or #CYRtAnGuitar = 0)
        let #CYRtAnGuitar = 360
      end-if

      Let #CYRtAnComputer = #CYRtComputer * 12
      if( #CYRtAnComputer > 480 or #CYRtAnComputer = 0)
        let #CYRtAnComputer = 480
      end-if

      Let #CYRtAnOrgan = #CYRtOrgan * 12
      if(#CYRtAnOrgan > 480 or #CYRtAnOrgan = 0)
        let #CYRtAnOrgan = 480
      end-if

      Let #CYRtAnPool = #CYRtPool * 12
      if( #CYRtAnPool > 1200 or #CYRtAnPool = 0)
        let #CYRtAnPool = 1200
      end-if

      Let #CYTotalFurniture     = Round(#CYFurniture    * #CYRtAnFurniture       * #CYDiffDays / #CYDivYear / #CYNoSharing, 2)
      Let #CYTotalFan           = Round(#CYFan          * #CYRtFan          * 12 * #CYDiffDays / #CYDivYear / #CYNoSharing, 2)
      Let #CYTotalAirCooler     = Round(#CYAirCooler    * #CYRtAirCooler    * 12 * #CYDiffDays / #CYDivYear / #CYNoSharing, 2)
      Let #CYTotalIron          = Round(#CYIron         * #CYRtIron         * 12 * #CYDiffDays / #CYDivYear / #CYNoSharing, 2)
      Let #CYTotalToaster       = Round(#CYToaster      * #CYRtToaster      * 12 * #CYDiffDays / #CYDivYear / #CYNoSharing, 2)
      Let #CYTotalTV            = Round(#CYTv           * #CYRtAnTV              * #CYDiffDays / #CYDivYear / #CYNoSharing, 2)
      Let #CYTotalRadio         = Round(#CYRadio        * #CYRtAnRadio           * #CYDiffDays / #CYDivYear / #CYNoSharing, 2)
      Let #CYTotalAmp           = Round(#CYAmp          * #CYRtAnAmp             * #CYDiffDays / #CYDivYear / #CYNoSharing, 2)
      Let #CYTotalHiFi          = Round(#CYHifi         * #CYRtAnHifi            * #CYDiffDays / #CYDivYear / #CYNoSharing, 2)
      Let #CYTotalGuitar        = Round(#CYGuitar       * #CYRtAnGuitar          * #CYDiffDays / #CYDivYear / #CYNoSharing, 2)
      Let #CYTotalLightFit      = Round(#CYLightFit     * #CYRtLightFit     * 12 * #CYDiffDays / #CYDivYear / #CYNoSharing, 2)
      Let #CYTotalRefrigerator  = Round(#CYRefrigerator * #CYRtAnRefrigerator    * #CYDiffDays / #CYDivYear / #CYNoSharing, 2)
      Let #CYTotalWashMach      = Round(#CYWashMach     * #CYRtAnWashMach        * #CYDiffDays / #CYDivYear / #CYNoSharing, 2)
      Let #CYTotalACUnit        = Round(#CYACUnit       * #CYRtAnACUnit          * #CYDiffDays / #CYDivYear / #CYNoSharing, 2)
      Let #CYTotalACCentral     = Round(#CYACCentral    * #CYRtAnACCentral       * #CYDiffDays / #CYDivYear / #CYNoSharing, 2)
      Let #CYTotalACSitting     = Round(#CYACSitting    * #CYRtAnACSitting       * #CYDiffDays / #CYDivYear / #CYNoSharing, 2)
      Let #CYTotalACAddl        = Round(#CYACAddl       * #CYRtAnACAddl          * #CYDiffDays / #CYDivYear / #CYNoSharing, 2)
      Let #CYTotalACBedroom     = Round(#CYACBedroom    * #CYRtACBedroom    * 12 * #CYDiffDays / #CYDivYear / #CYNoSharing, 2)
      Let #CYTotalComputer      = Round(#CYComputer     * #CYRtAnComputer        * #CYDiffDays / #CYDivYear / #CYNoSharing, 2)
      Let #CYTotalOrgan         = Round(#CYOrgan        * #CYRtAnOrgan           * #CYDiffDays / #CYDivYear / #CYNoSharing, 2)

      Let #CYTotalFax           = #CYFax

      !Let #CYTotalGuitar        = Round(#CYGuitar       * #CYRtGuitar       * 12 * #CYDiffDays / #CYDivYear / #CYNoSharing, 2)
      Let #CYTotalVacuumCleaner = Round(#CYVacuumCleaner* #CYRtVacuumCleaner * 12  * #CYDiffDays/#CYDivYear / #CYNoSharing, 2)
      Let #CYTotalVCR           = Round(#CYVCr          * #CYRtAnVCR               * #CYDiffDays/#CYDivYear / #CYNoSharing, 2)
      Let #CYTotalJuicer        = Round(#CYJuicer       * #CYRtJuicer        * 12  * #CYDiffDays/#CYDivYear / #CYNoSharing, 2)
      Let #CYTotalBlender       = Round(#CYBlender      * #CYRtBlender       * 12  * #CYDiffDays/#CYDivYear / #CYNoSharing, 2)
      Let #CYTotalKettle        = Round(#CYKettle       * #CYRtKettle        * 12  * #CYDiffDays/#CYDivYear / #CYNoSharing, 2)
      Let #CYTotalCooker        = Round(#CYCooker       * #CYRtCooker        * 12  * #CYDiffDays/#CYDivYear / #CYNoSharing, 2)
      Let #CYTotalWaterHeater   = Round(#CYWaterHeater  * #CYRtWaterHeater   * 12  * #CYDiffDays/#CYDivYear / #CYNoSharing, 2)
      Let #CYTotalOven          = Round(#CYOven         * #CYRtOven          * 12  * #CYDiffDays/#CYDivYear / #CYNoSharing, 2)
      Let #CYTotalDishWasher    = Round(#CYDishWasher   * #CYRtAnDishWasher        * #CYDiffDays/#CYDivYear / #CYNoSharing, 2)
      Let #CYTotalDryer         = Round(#CYDryer        * #CYRtAnDryer             * #CYDiffDays/#CYDivYear / #CYNoSharing, 2)
      Let #CYTotalFloorPolish   = Round(#CYFloorPolish  * #CYRtFloorPolish   * 12  * #CYDiffDays/#CYDivYear / #CYNoSharing, 2)
      Let #CYTotalLawnMover     = Round(#CYLawnMover    * #CYRtLawnMover     * 12  * #CYDiffDays/#CYDivYear / #CYNoSharing, 2)
      Let #CYTotalPool          = Round(#CYPool         * #CYRtAnPool              * #CYDiffDays/#CYDivYear / #CYNoSharing, 2)

      Let #CYTotalOthers        = #CYPUB + #CYPhone + #CYPager + #CYServant + #CYGolfBag + #CYCamera + #CYSuitCase
           Let #CY_TotalOth = #CYPUB + #CYPhone + #CYPager + #CYGolfBag + #CYCamera + #CYSuitCase  


      Let #CYTotalHomeLeave    = #CYHomeLeave
      Let #CYTotalEmplrPdInt   = #CYEmplrPdInt
      Let #CYTotalInsPremium   = #CYInsPremium
      Let #CYTotalHolidayFare  = #CYHolidayFare
      Let #CYTotalEducatnExp   = #CYEducatnExp
      Let #CYTotalClubFees     = #CYClubFees
      Let #CYTotalAssetGain    = #CYAssetGain
      Let #CYTotalVehicleCost  = #CYVehicleCost
      Let #CYTotalCarBnft      = #CYCarBnft
      Let #CYTotalOtherBnft    = #CYOtherBnft
      Let #CYTotalNonMonAward  = #CYNonMonAward

! 1st Previous Year Rates / Values

      Let #P1RtAnFurniture = #P1RtFurniture * 12
      if(#P1RtAnFurniture > 120 or #P1RtAnFurniture = 0 )
        let #P1RtAnFurniture = 120
      end-if

      Let #P1RtAnRefrigerator =  #P1RtRefrigerator * 12
      if (#P1RtAnRefrigerator > 120 or #P1RtAnRefrigerator = 0 )
        let #P1RtAnRefrigerator = 120
      end-if

      Let #P1RtAnVCR = #P1RtVCR * 12
      if(#P1RtAnVCR > 240 or #P1RtAnVCR = 0 )
        let #P1RtAnVCR = 240
      end-if

      Let #P1RtAnWashMach = #P1RtWashMach * 12
      if(#P1RtAnWashMach > 180 or #P1RtAnWashMach = 0)
        let #P1RtAnWashMach = 180
      end-if

      Let #P1RtAnDryer = #P1RtDryer * 12
      if(#P1RtAnDryer > 180 or #P1RtAnDryer = 0)
        let #P1RtAnDryer = 180
      end-if

      Let #P1RtAnDishWasher = #P1RtDishWasher * 12
      if(#P1RtAnDishWasher > 180 or #P1RtAnDishWasher = 0)
        let #P1RtAnDishWasher = 180
      end-if

      Let #P1RtAnACUnit = #P1RtACUnit * 12
      if (#P1RtAnACUnit > 120 or #P1RtAnACUnit = 0)
        let #P1RtAnACUnit = 120
      end-if

      Let #P1RtAnACCentral = #P1RtACCentral * 12
      if( #P1RtAnACCentral > 180 or #P1RtAnACCentral = 0)
        let #P1RtAnACCentral = 180
      end-if

      Let #P1RtAnACSitting = #P1RtACSitting * 12
      if(#P1RtAnACSitting > 180 or #P1RtAnACSitting = 0)
        let #P1RtAnACSitting = 180
      end-if


      Let #P1RtAnACAddl = #P1RtACAddl * 12
      if( #P1RtAnACAddl > 120 or #P1RtAnACAddl = 0)
        let #P1RtAnACAddl = 120
      end-if

      Let #P1RtAnTV = #P1RtTV * 12
      if( #P1RtAnTV > 360 or #P1RtAnTV = 0)
        let #P1RtAnTV = 360
      end-if

      Let #P1RtAnRadio = #P1RtRadio * 12
      if(#P1RtAnRadio > 360 or #P1RtAnRadio = 0)
        let #P1RtAnRadio = 360
      end-if

      Let #P1RtAnAmp = #P1RtAmp * 12
      if(#P1RtAnAmp > 360 or #P1RtAnAmp = 0)
        let #P1RtAnAmp = 360
      end-if

      Let #P1RtAnHifi = #P1RtHifi * 12
      if(#P1RtAnHifi > 360 or #P1RtAnHifi = 0)
        let #P1RtAnHifi = 360
      end-if

      Let #P1RtAnGuitar = #P1RtGuitar * 12
      if(#P1RtAnGuitar > 360 or #P1RtAnGuitar = 0)
        let #P1RtAnGuitar = 360
      end-if

      Let #P1RtAnComputer = #P1RtComputer * 12
      if( #P1RtAnComputer > 480 or #P1RtAnComputer = 0)
        let #P1RtAnComputer = 480
      end-if

      Let #P1RtAnOrgan = #P1RtOrgan * 12
      if(#P1RtAnOrgan > 480 or #P1RtAnOrgan = 0)
        let #P1RtAnOrgan = 480
      end-if

      Let #P1RtAnPool = #P1RtPool * 12
      if( #P1RtAnPool > 1200 or #P1RtAnPool = 0)
        let #P1RtAnPool = 1200
      end-if

      Let #P1TotalFurniture     = Round((#P1Furniture    * #P1RtAnFurniture         * #P1DiffDays)/#P1DivYear / #P1NoSharing, 2)
      Let #P1TotalFan           = Round((#P1Fan          * #P1RtFan           * 12  * #P1DiffDays)/#P1DivYear / #P1NoSharing, 2)
      Let #P1TotalAirCooler     = Round((#P1AirCooler    * #P1RtAirCooler     * 12  * #P1DiffDays)/#P1DivYear / #P1NoSharing, 2)
      Let #P1TotalIron          = Round((#P1Iron         * #P1RtIron          * 12  * #P1DiffDays)/#P1DivYear / #P1NoSharing, 2)
      Let #P1TotalToaster       = Round((#P1Toaster      * #P1RtToaster       * 12  * #P1DiffDays)/#P1DivYear / #P1NoSharing, 2)
      Let #P1TotalTV            = Round((#P1Tv           * #P1RtTV            * 12  * #P1DiffDays)/#P1DivYear / #P1NoSharing, 2)
      Let #P1TotalRadio         = Round((#P1Radio        * #P1RtAnRadio             * #P1DiffDays)/#P1DivYear / #P1NoSharing, 2)
      Let #P1TotalAmp           = Round((#P1Amp          * #P1RtAnAmp               * #P1DiffDays)/#P1DivYear / #P1NoSharing, 2)
      Let #P1TotalHiFi          = Round((#P1Hifi         * #P1RtAnHifi              * #P1DiffDays)/#P1DivYear / #P1NoSharing, 2)
      Let #P1TotalLightFit      = Round((#P1LightFit     * #P1RtLightFit      * 12  * #P1DiffDays)/#P1DivYear / #P1NoSharing, 2)
      Let #P1TotalRefrigerator  = Round((#P1Refrigerator * #P1RtAnRefrigerator      * #P1DiffDays)/#P1DivYear / #P1NoSharing, 2)
      Let #P1TotalWashMach      = Round((#P1WashMach     * #P1RtAnWashMach          * #P1DiffDays)/#P1DivYear / #P1NoSharing, 2)
      Let #P1TotalACUnit        = Round((#P1ACUnit       * #P1RtAnACUnit            * #P1DiffDays)/#P1DivYear / #P1NoSharing, 2)
      Let #P1TotalACCentral     = Round((#P1ACCentral    * #P1RtAnACCentral         * #P1DiffDays)/#P1DivYear / #P1NoSharing, 2)
      Let #P1TotalACSitting     = Round((#P1ACSitting    * #P1RtAnACSitting         * #P1DiffDays)/#P1DivYear / #P1NoSharing, 2)
      Let #P1TotalACAddl        = Round((#P1ACAddl       * #P1RtAnACAddl            * #P1DiffDays)/#P1DivYear / #P1NoSharing, 2)
      Let #P1TotalACBedroom     = Round((#P1ACBedroom    * #P1RtACBedroom     * 12  * #P1DiffDays)/#P1DivYear / #P1NoSharing, 2)
      Let #P1TotalComputer      = Round((#P1Computer     * #P1RtAnComputer          * #P1DiffDays)/#P1DivYear / #P1NoSharing, 2)
      Let #P1TotalOrgan         = Round((#P1Organ        * #P1RtAnOrgan             * #P1DiffDays)/#P1DivYear / #P1NoSharing, 2)

      Let #P1TotalGuitar        = Round((#P1Guitar       * #P1RtAnGuitar            * #P1DiffDays)/#P1DivYear / #P1NoSharing, 2)

      Let #P1TotalFax           =   #P1FAx

      Let #P1TotalVacuumCleaner = Round((#P1VacuumCleaner* #P1RtVacuumCleaner * 12  * #P1DiffDays)/#P1DivYear / #P1NoSharing, 2)
      Let #P1TotalVCR           = Round((#P1VCr          * #P1RtAnVCR               * #P1DiffDays)/#P1DivYear / #P1NoSharing, 2)
      Let #P1TotalJuicer        = Round((#P1Juicer       * #P1RtJuicer        * 12  * #P1DiffDays)/#P1DivYear / #P1NoSharing, 2)
      Let #P1TotalBlender       = Round((#P1Blender      * #P1RtBlender       * 12  * #P1DiffDays)/#P1DivYear / #P1NoSharing, 2)
      Let #P1TotalKettle        = Round((#P1Kettle       * #P1RtKettle        * 12  * #P1DiffDays)/#P1DivYear / #P1NoSharing, 2)
      Let #P1TotalCooker        = Round((#P1Cooker       * #P1RtCooker        * 12  * #P1DiffDays)/#P1DivYear / #P1NoSharing, 2)
      Let #P1TotalWaterHeater   = Round((#P1WaterHeater  * #P1RtWaterHeater   * 12  * #P1DiffDays)/#P1DivYear / #P1NoSharing, 2)
      Let #P1TotalOven          = Round((#P1Oven         * #P1RtOven          * 12  * #P1DiffDays)/#P1DivYear / #P1NoSharing, 2)
      Let #P1TotalDishWasher    = Round((#P1DishWasher   * #P1RtAnDishWasher        * #P1DiffDays)/#P1DivYear / #P1NoSharing, 2)
      Let #P1TotalDryer         = Round((#P1Dryer        * #P1RtAnDryer             * #P1DiffDays)/#P1DivYear / #P1NoSharing, 2)
      Let #P1TotalFloorPolish   = Round((#P1FloorPolish  * #P1RtFloorPolish   * 12  * #P1DiffDays)/#P1DivYear / #P1NoSharing, 2)
      Let #P1TotalLawnMover     = Round((#P1LawnMover    * #P1RtLawnMover     * 12  * #P1DiffDays)/#P1DivYear / #P1NoSharing, 2)
      Let #P1TotalPool          = Round((#P1Pool         * #P1RtAnPool              * #P1DiffDays)/#P1DivYear / #P1NoSharing, 2)

      Let #P1TotalOthers        = #P1PUB + #P1Phone + #P1Pager + #P1Servant + #P1GolfBag + #P1Camera + #P1SuitCase
      Let #P1_TotalOth        = #P1PUB + #P1Phone + #P1Pager + #P1GolfBag + #P1Camera + #P1SuitCase

      Let #P1TotalHomeLeave    = #P1HomeLeave
      Let #P1TotalEmplrPdInt   = #P1EmplrPdInt
      Let #P1TotalInsPremium   = #P1InsPremium
      Let #P1TotalHolidayFare  = #P1HolidayFare
      Let #P1TotalEducatnExp   = #P1EducatnExp
      Let #P1TotalClubFees     = #P1ClubFees
      Let #P1TotalAssetGain    = #P1AssetGain
      Let #P1TotalVehicleCost  = #P1VehicleCost
      Let #P1TotalCarBnft      = #P1CarBnft
      Let #P1TotalOtherBnft    = #P1OtherBnft
      Let #P1TotalNonMonAward  = #P1NonMonAward


! We need to add the variables to calculate the Total Remuneration for Value of Residence.

      Let   #CYTotalNo2  = #CYTotalRefrigerator + #CYTotalVCR
      Let   #CYTotalNo3  = #CYTotalWashMach + #CYTotalDryer + #CYTotalDishWasher
      Let   #CYTotalNo8  = #CYTotalACCentral + #CYTotalACSitting
      Let   #CYTotalNo8A = #CYTotalACAddl + #CYTotalACBedroom
      Let   #CYTotalNo9  = #CYTotalTV + #CYTotalRadio + #CYTotalAmp + #CYTotalHiFi + #CYTotalGuitar
      Let   #CYTotalNo10 = #CYTotalComputer + #CYTotalOrgan
      Let   #CYTotalNo11 = #CYTotalJuicer + #CYTotalBlender + #CYTotalKettle + #CYTotalCooker + #CYTotalWaterHeater
                         + #CYTotalFan + #CYTotalAirCooler + #CYTotalIron + #CYTotalToaster + #CYTotalLightFit
                         + #CYTotalFax + #CYTotalVacuumCleaner + #CYTotalOven + #CYTotalFloorPolish + #CYTotalLawnMover
                         + #CYOthers

      Let #CYGrandTotal1 = #CYTotalFurniture +
                           #CYTotalNo2 +
                           #CYTotalNo3 +
                           #CYTotalACUnit +
                           #CYTotalNo8 +
                           #CYTotalNo8A +
                           #CYTotalNo9 +
                           #CYTotalNo10 +
                           #CYTotalPool +
                           #CYTotalNo11

     do Format-DateTime(&PIHS.HIRE_DT, $Hire_Dt, {DEFCMP}, '', '')
     do Format-DateTime(&PIHS.TERMINATION_DT, $Term_Dt, {DEFCMP}, '', '')

     Let $TaxYear    = EDIT(#TaxYear,'9999')
     Let $YearBegin = $TaxYear || '0101'
     Let $YearEnd = $TaxYear || '1231'

     if #CYDiffDays > 0
        If $YearBegin > $Hire_Dt
           Do Format-DateTime($YearBegin, $From, {DEFCMP}, '', 'native')
        else
           Let $From = &PIHS.HIRE_DT
        end-if

        Let $To = &PIHS.TERMINATION_DT

        Do Calc-diff-days($From, $To, #CYEmpDays)

        if #CYEmpDays < #CYDiffDays
            Let #CYEmpDays = #CYDiffDays
        end-if
     else
        Let #CYEmpDays = 1
     end-if

     Let #CYTotalRem    = Round((#CYTotal1_4 + #CYTotalHomeLeave   + #CYTotalEmplrPdInt  + #CYTotalInsPremium
                                             + #CYTotalHolidayFare + #CYTotalEducatnExp  + #CYTotalClubFees
                                             + #CYTotalAssetGain   + #CYTotalVehicleCost + #CYTotalCarBnft
                                             + #CYTotalOtherBnft   + #CYTotalNonMonAward)
                              * #CYDiffDays / #CYEmpDays
                              + #CYGrandTotal1 + #CYTotalOthers + #CYDriver + #CYGardener, 2)

                                   Let #CYTotalTenPercRem = Round(#CYTotalRem * .10, 2)

     Let #CYTotalResidValue = 0

     Let #CY_EE_RENT = trunc(&PA1S.GPSG_AP8A_EE_RENT,0)
     Let #CY_ER_RENT = trunc(&PA1S.GPSG_AP8A_ER_RENT,0)

     if #CY_ER_RENT  < #CYTotalTenPercRem
     Let #CYTotalResidValue = #CY_ER_RENT
     else
        Let #CYTotalResidValue = trunc(#CYTotalTenPercRem,0)
     end-if

     Let #CYTotalResidValue = #CYTotalResidValue - #CY_EE_RENT + #CYGrandTotal1
     Let #CYTotalResidValue = trunc(#CYTotalResidValue,0)
     if #CYTotalResidValue < 0
        Let #CYTotalResidValue = 0
     end-if

! Calculate the variables for Total Residence Value for Previous Year

      Let   #P1TotalNo2  = #P1TotalRefrigerator + #P1TotalVCR
      Let   #P1TotalNo3  = #P1TotalWashMach + #P1TotalDryer + #P1TotalDishWasher
      Let   #P1TotalNo8  = #P1TotalACCentral + #P1TotalACSitting
      Let   #P1TotalNo8A = #P1TotalACAddl + #P1TotalACBedroom
      Let   #P1TotalNo9  = #P1TotalTV + #P1TotalRadio + #P1TotalAmp + #P1TotalHiFi + #P1TotalGuitar
      Let   #P1TotalNo10 = #P1TotalComputer + #P1TotalOrgan
      Let   #P1TotalNo11 = #P1TotalJuicer + #P1TotalBlender + #P1TotalKettle + #P1TotalCooker + #P1TotalWaterHeater
                         + #P1TotalFan + #P1TotalAirCooler + #P1TotalIron + #P1TotalToaster + #P1TotalLightFit
                         + #P1TotalFax + #P1TotalVacuumCleaner + #P1TotalOven + #P1TotalFloorPolish + #P1TotalLawnMover
                         + #P1Others

      Let #P1GrandTotal1 = #P1TotalFurniture +
                           #P1TotalNo2 +
                           #P1TotalNo3 +
                           #P1TotalACUnit +
                           #P1TotalNo8 +
                           #P1TotalNo8A +
                           #P1TotalNo9 +
                           #P1TotalNo10 +
                           #P1TotalPool +
                           #P1TotalNo11

     Let $PrevYear  = EDIT(#TaxYear - 1,'9999')
     Let $YearBegin = $PrevYear || '0101'
     Let $YearEnd   = $PrevYear || '1231'

     if #P1DiffDays > 0
        If $YearBegin <= $Hire_Dt
           Let $From = &PIHS.HIRE_DT
        else
           Do Format-DateTime($YearBegin, $From, {DEFCMP}, '', 'native')
        end-if

        Do Format-DateTime($YearEnd, $To, {DEFCMP}, '', 'native')

        Do Calc-diff-days($From, $To, #P1EmpDays)

        if #P1EmpDays < #P1DiffDays
            Let #P1EmpDays = #P1DiffDays
        end-if
     else
        Let #P1EmpDays = 1
     end-if

     Let #P1TotalRem    = Round((#P1Total1_4 + #P1TotalHomeLeave   + #P1TotalEmplrPdInt  + #P1TotalInsPremium
                                             + #P1TotalHolidayFare + #P1TotalEducatnExp  + #P1TotalClubFees
                                             + #P1TotalAssetGain   + #P1TotalVehicleCost + #P1TotalCarBnft
                                             + #P1TotalOtherBnft   + #P1TotalNonMonAward)
                              * #P1DiffDays / #P1EmpDays
                              + #P1GrandTotal1 + #P1TotalOthers + #P1Driver + #P1Gardener, 2)

     Let #P1TotalTenPercRem = (#P1TotalRem * .10)
     Let #P1TotalResidValue = 0

     Let #P1_EE_RENT = trunc(&PA1S.GPSG_AP8A_EE_RNT_1,0)
     Let #P1_ER_RENT = trunc(&PA1S.GPSG_AP8A_ER_RNT_1,0)

     if #P1_ER_RENT  < #P1TotalTenPercRem
        Let #P1TotalResidValue = #P1_ER_RENT
     else
        Let #P1TotalResidValue = trunc(#P1TotalTenPercRem,0)
     end-if

     Let #P1TotalResidValue = #P1TotalResidValue - #P1_EE_RENT + #P1GrandTotal1
     Let #P1TotalResidValue = trunc(#P1TotalResidValue, 0)
     if #P1TotalResidValue < 0
        Let #P1TotalResidValue = 0
     end-if

    if( #CYRtAnAbv20Yrs > 3000 or #CYRtAnAbv20Yrs = 0)
        let #CYRtAnAbv20Yrs = 3000
    end-if
    if( #CYRtAnAbv20Yrs > 3000 or #CYRtAnAbv20Yrs = 0)
        let #CYRtAnAbv20Yrs = 3000
    end-if
    if( #CYRtAnBet8_20Yrs > 1200 or #CYRtAnBet8_20Yrs = 0)
        let #CYRtAnBet8_20Yrs = 1200
    end-if
    if( #CYRtAnBet3_7yrs > 600 or #CYRtAnBet3_7yrs = 0)
        let #CYRtAnBet3_7yrs = 600
    end-if
    if( #CYRtAnLess3Yrs > 300 or #CYRtAnLess3Yrs = 0)
        let #CYRtAnLess3Yrs = 300
    end-if

      if( #P1RtAnAbv20Yrs > 3000 or #P1RtAnAbv20Yrs = 0)
        let #P1RtAnAbv20Yrs = 3000
    end-if
    if( #P1RtAnAbv20Yrs > 3000 or #P1RtAnAbv20Yrs = 0)
        let #P1RtAnAbv20Yrs = 3000
    end-if
    if( #P1RtAnBet8_20Yrs > 1200 or #P1RtAnBet8_20Yrs = 0)
        let #P1RtAnBet8_20Yrs = 1200
    end-if
    if( #P1RtAnBet3_7yrs > 600 or #P1RtAnBet3_7yrs = 0)
        let #P1RtAnBet3_7yrs = 600
    end-if
    if( #P1RtAnLess3Yrs > 300 or #P1RtAnLess3Yrs = 0)
        let #P1RtAnLess3Yrs = 300
    end-if


     Let #CYAbv20Value = trunc(Round(&PA1S.GPSG_AP8A_HTL_SLFN    * #CYRtAnAbv20Yrs * (&PA1S.GPSG_AP8A_HTL_SLFD/#CYDivYear) , 2),0)
     Let #P1Abv20Value = trunc(Round(&PA1S.GPSG_AP8A_HTSLFN_1 * #P1RtAnAbv20Yrs * (&PA1S.GPSG_AP8A_HTSLFD_1/#P1DivYear), 2),0)

     Let #CYWifeValue = trunc(Round(&PA1S.GPSG_AP8A_HTL_WIFN    * #CYRtAnAbv20Yrs * (&PA1S.GPSG_AP8A_HTL_WIFD/#CYDivYear) , 2),0)
     Let #P1WifeValue = trunc(Round(&PA1S.GPSG_AP8A_HTLWIFN1 * #P1RtAnAbv20Yrs * (&PA1S.GPSG_AP8A_HTLWIFD1/#P1DivYear), 2),0)

     Let #CY8_20Value = trunc(Round(&PA1S.GPSG_AP8A_HTL_CH8N  * #CYRtAnBet8_20Yrs * (&PA1S.GPSG_AP8A_HTL_CH8D/#CYDivYear) , 2),0)
     Let #P18_20Value = trunc(Round(&PA1S.GPSG_AP8A_HTCH8N_1 * #P1RtAnBet8_20Yrs * (&PA1S.GPSG_AP8A_HTCH8D_1/#P1DivYear), 2),0)

     Let #CY3_7Value  = trunc(Round(&PA1S.GPSG_AP8A_HTL_CH3N   * #CYRtAnBet3_7yrs * (&PA1S.GPSG_AP8A_HTL_CH3D/#CYDivYear), 2),0)
     Let #P13_7Value  = trunc(Round(&PA1S.GPSG_AP8A_HTCH3N_1  * #P1RtAnBet3_7yrs * (&PA1S.GPSG_AP8A_HTCH3D_1/#P1DivYear), 2),0)

     Let #CYLess3Value = trunc(Round(&PA1S.GPSG_AP8A_HTL_CH0N * #CYRtAnLess3Yrs * (&PA1S.GPSG_AP8A_HTL_CH0D/#CYDivYear), 2),0)
     Let #P1Less3Value = trunc(Round(&PA1S.GPSG_AP8A_HTCH0N_1  * #P1RtAnLess3Yrs * (&PA1S.GPSG_AP8A_HTCH0D_1/#P1DivYear), 2), 0)

     if #CYAbv20Value <> 0 or #CYWifeValue <> 0 or #CY8_20Value <> 0 or #CY3_7Value <> 0 or #CYLess3Value <> 0
        Let #CYPerc2Value   =  trunc(Round((&PA1S.GPSG_AP8A_HTL_SLFD/#CYDivYear) *  (0.02 * &PIDS.GPSG_8A_INCOME_TOT), 2),0)
        Let #CYTotalc6 = #CYAbv20Value + #CYWifeValue + #CY8_20Value + #CY3_7Value + #CYLess3Value + #CYPerc2Value
     else
        Let #CYPerc2Value = 0
        Let #CYTotalc6    = 0
     End-if

     if #P1Abv20Value <> 0 or #P1WifeValue <> 0 or #P18_20Value <> 0 or #P13_7Value <> 0 or #P1Less3Value <> 0
        Let #P1Perc2Value   =  trunc(Round((&PA1S.GPSG_AP8A_HTSLFD_1/#P1DivYear) *  (0.02 * &PIDS.GPSG_8A_INC_TOT_1), 2),0)
        Let #P1Totalc6 = #P1Abv20Value + #P1WifeValue + #P18_20Value + #P13_7Value + #P1Less3Value + #P1Perc2Value
     else
        Let #P1Perc2Value = 0
        Let #P1Totalc6    = 0
     End-if
      let #CYGrandTotal2 = #CYTotalOthers + #CYDriver + #CYGardener
      Let #CYIR21Total = #CYTotalResidValue  + #CYGrandTotal2  + #CYTotalc6
                       + #CYHomeLeave
                       + #CYEmplrPdInt
                       + #CYInsPremium
                       + #CYHolidayFare
                       + #CYEducatnExp
                       + #CYClubFees
                       + #CYAssetGain
                       + #CYVehicleCost
                       + #CYCarBnft
                       + #CYOtherBnft
                       + #CYNonMonAward

      let #P1GrandTotal2 = #P1TotalOthers + #P1Driver + #P1Gardener
      Let #P1IR21Total = #P1TotalResidValue  + #P1GrandTotal2  + #P1Totalc6
                       + #P1HomeLeave
                       + #P1EmplrPdInt
                       + #P1InsPremium
                       + #P1HolidayFare
                       + #P1EducatnExp
                       + #P1ClubFees
                       + #P1AssetGain
                       + #P1VehicleCost
                       + #P1CarBnft
                       + #P1OtherBnft
                       + #P1NonMonAward


end-Procedure

!
!***********************************************************************
!  Procedure: Print-Employee-Page1                                     *
!             First Page of New format of IR21                         *
!***********************************************************************
begin-procedure Print-Employee-Page1

  USE-REPORT This_Report
  graphic                                (6,2,{widthofpage}) box 69
  Alter-Printer
    Font = #StdFont
    Point-Size = 14

  print 'FORM IR21'      (3,55) BOLD

  Alter-Printer
    Font = #StdFont
    Point-Size = 10

  print 'Comptroller of Income Tax'     (6,2)
  print '55 Newton Road Revenue House'  (7,2)
  print 'Singapore 307987'              (8,2)
  print 'Tel:  1800-3568655'            (6,90)
  print 'Fax:  6351 2707'               (7,90)

  print 'Website:http://www.iras.gov.sg' (8,90)


  print 'NOTIFICATION OF A NON-CITIZEN EMPLOYEE''S CESSATION OF' (6,30) Bold CENTER
  print '        EMPLOYMENT OR DEPARTURE FROM SINGAPORE'         (7,33) Bold CENTER
  graphic                                ( 8,2,{widthofpage}) Horz-Line

  print 'This form is to be completed by the employer. It will take about 10 minutes to complete. Please get ready the employees''s personal particulars and ' (9,2)
  print 'employment income details for the year of cessation and the prior year.Do read explanatory notes <i> when completing this form.' (10,2)

  graphic                                        (12,2,{widthofpage}) box 1 3 5
  print 'A|'         (12,2) Bold
  print 'TYPE OF FORM IR21 (Please cross (X) where appropriate) <i>' (12,4) Bold
  print '1'         (13,3)
  graphic           (13,4,3) box 2
  print 'Original'  (13,9)

  print '2'         (13,25)
  graphic           (13,26,3) box 2
  print 'Additional, this is in addition' (13,30)
  print 'to Form IR21 dated___________________ '        (14,30)

  print '3'         (13,70)
  graphic           (13,71,3) box 2
  print 'Amended, this supersedes' (13,75)
  print 'Form IR21 dated_______________________ '         (14,75)

  print '1 *Company Tax Ref No'    (16,2)
  print '2 Company''s Name'        (16,52)
  print '3 Company''s Address'     (17,2)
  print 'Blk/Hse No'               (18,8)
  print 'Sty/Unit'                 (18,54)
  print 'Street Name'              (19,7)
  print 'Singapore Postal Code'    (20,70)

  print '1 Full Name of Employee as per NRIC/ FIN'                (23,2)
  print '  (Mr/Mrs/Miss/Mdm)'  (24,2)
  print '2 Identification No.'  (25,2)
  print 'NRIC '                 (26,11)
  !print 'FIN '                  (26,56)
  !print 'Malaysian IC(if applicable)'  (26,78)  
  print '3 Mailing Address[Please inform your employee to update his/her latest contact details with IRAS.] ' (27,2) 
!  print 'Address line 1'(28,8)
  !print 'Sty/Unit'     (28,54)
 ! print 'Address line 2'  (29,8)
 ! print 'Address line 3'  (30,8)
  !print 'Singapore Postal Code'   (30,70)
  print 'Effective Date of Mailing Address'  (31,3)
  print '4 Date of Birth '        (32,2)
  print '5 Gender* '              (32,40)
  print '6 Nationality '          (32,70)
  print '7 Marital Status '       (33,2)
  print '8 Contact No. '              (33,40)
  print '9 Email Address'         (33,70)
  print '10 Date of Arrival, if known <i>'    (36,2)
  print '11 Date of Commencement' (36,29)
  !print '(DD/MM/YY)'             (36,45)
  print '12 Date of Cessation/Overseas Posting <i>'    (36,55)
  !print '(DD/MM/YY)'             (36,67)
  print '13 Date of Departure,if known'   (36,82)
  print '14 Date of Resignation / Termination Notice Given (DD/MM/YY)' (38,2)
  print '15 Designation'               (38,50)
  print '16 Give Reasons if less than one month''s notice is given to IRAS before employee''s cessation' (40,2)
    graphic                               (41,3,3) box 1
  print 'Absconded / Left without notice'                           (41, 6)
  graphic                               (41,34,3) box 1
  print 'Immediate Resignation / Short Notice '                            (41, 37)
  graphic                               (42,3,3) box 1
  print 'Resigned whilst overseas / on Home Leave '                            (42, 6)
  graphic                               (42,34,3) box 1
  print 'Others. Give details: '                              (42, 37)
  graphic  (42,55,25)  horz-line
  
      If $LOM_Notice = 'A'
         print 'X'                                    (41,4) 
      End-if

      If $LOM_Notice = 'I'
         print 'X'                                    (41,35) 
      End-if

      If $LOM_Notice = 'R'
         print 'X'                                    (42,4) 
      End-if

      If $LOM_Notice = 'O'
         print 'X'                                    (42,35) 
      End-if

  print '17 Amount of Monies Withheld pending Tax' (43,2)
  print '   Clearance'     (44,2)
  
          
  print 'S$'                           (46,13)
  print ' Cts'                         (46,35)
           

  print '.'                            (48,31) BOLD


  print '18       Are these all the monies you can withhold from the date of notification of '   (43,40)
  print '         resignation/termination/overseas posting?' (44,41)

  graphic                               (44,69,3) box 1
  print 'Yes'                           (44, 73)
  graphic                               (44,76,3) box 1
  print 'No'                            (44, 80)
  print '18a.    Give reason if you have selected ''No'' for D18 above or reported $0.00 under D17'               (45, 40)


   If $IR21_Monies = 'Y'
         print 'X'                                    (44,70) 
      End-if

    If $IR21_Monies = 'N'
        print 'X'                                    (44,77) 
     End-if

  
  graphic                               (46,40,3) box 1
  print 'Resigned after payday'                           (46, 44)
  graphic                               (46,73,3) box 1
  print 'Salary already paid via bank'                            (46,77)
  graphic                               (48,40,3) box 1
  print 'Did not return from leave'                           (48, 44)
  graphic                               (48,73,3) box 1
  print 'Employee owes company monies'                 (48,77)
  !graphic                               (48,55,3) box 1
  !print 'Others. Give details'                 (48, 58)
  graphic  (49,63,25)  horz-line
  
      
       
       If $TNW_Reason = 'R'
         print 'X'                                    (46,41) 
      End-if

      If $TNW_Reason = 'S'
         print 'X'                                    (46,74) 
      End-if

      If $TNW_Reason = 'D'
         print 'X'                                    (48,41) 
      End-if

      If $TNW_Reason = 'E'
         print 'X'                                    (48,74) 
      End-if

       If $TNW_Reason = 'O'
         print 'X'                                    (48,56) 
      End-if

  print '19 Date Last Salary Paid'     (50,2)

  print '20 Amount of Last Salary Paid' (50,38)

  print '21 Period applicable for Last Salary Paid'     (50,80)

  print '22 Name of Bank to which employee''s salary is credited' (52,2)
  print '23 Name & Tel No of New Employer, if known'              (52,55)

  print '24 Employee''s Income Tax Borne by Employer'     (54,2)
  print '** <i>'                     (55,2)   BOLD
  graphic                                                 (55,30,3) box 1
  print 'No'                                              (55,34)
  graphic                                                 (55,40,3) box 1
  print 'Yes, Fully borne'                                (55,44)
  graphic                                                 (55,58,3) box 1
  print 'Yes, Partially borne. Give Details:'             (55,62)

  print '1 Name of'                    (58,2)
  print '  spouse'                     (59,2)
  print '2 Date of'                    (58,35)
  print '  Birth'                      (59,36)
  print '3 Ident No'                   (58,58)
  print '4 Date of'                    (58,85)
  print '  marriage'                   (59,85)

  print '6 Is spouse''s annual income more than $4,000?' (61,35)

  print '5 Nationality'                 (61,2)
  graphic                                                 (62,36,3) box 1
  print 'Yes'                                              (62,40)
  print 'Please specify the name and address of spouses current employer, if known'  (62,45)
  graphic                                                 (63,36,3) box 1
  print 'No'                                (63,40)
! underline
  graphic   (63,45,30) horz-line

         If $Spouse_income = 'Y'
         print 'X'                                    (62,37) 
        
    ELSE
         print 'X'                                    (63,37) 
   End-if

  print '7 Children''s Particulars (To provide the name of children according to the order of birth and furnish  information as an attachment if the no. of rows provided is in insufficient.)' (64,2)
  graphic                               (66,2,{widthofpage}) box 1
  print 'No'                            (66,3)
  print 'Name of Child'                 (66,15)
  print 'Gender'                        (66,48)
  print 'Date of Birth'                 (66,60)
  print 'State name of school if child is above 16 years old' (66,78)

! Lines/Boxes for Section B & C

! Box format for ROC/ROB/Others section B1.
  graphic  (17,19,28)  horz-line

! Underline for Company name

  graphic  (17,65,45) horz-line
  graphic  (18,65,45) horz-line
! Underline for Company Address

  graphic   (19,19,30) horz-line
  graphic   (19,60,5)   horz-line
  print '-' (19,65)
  graphic   (19,66,44) horz-line
  graphic   (20,19,91) horz-line
  graphic   (21,19,45)  horz-line
  graphic   (21,85,25) horz-line

! Box for Employee name

  graphic  (24,19,91) horz-line

! Box for NRIC Number

  graphic  (26,15,40)  horz-line

! Box for FIN Number

  graphic  (26,59,18)  horz-line

  ! Box for Malaysian IC

  graphic  (26,94,16)  horz-line

! Box For Current Address

  graphic   (28,19,91)  horz-line
  graphic   (29,19,91) horz-line
  graphic   (30,19,91)  horz-line
  !graphic   (30,85,25) horz-line
  graphic   (31,25,37)  horz-line

! Horz line for DOB/Sex/Nationality
  graphic  (32,19,15) horz-line
  graphic  (32,50,15) horz-line
  graphic  (32,85,25) horz-line

! Horz Line for MS/Tel No/E-mail
  graphic  (33,19,15) horz-line
  graphic  (33,50,15) horz-line
  graphic  (33,85,25) horz-line

! Horz Line for Arrival Date
  graphic  (37,5,18) horz-line

! Horz-line for Commencement Date
  graphic  (37,33,18) horz-line

! Horz Line for cessation Date
  graphic  (37,53,18) horz-line

!Horz Line for departure Date
  graphic  (37,83,18) horz-line

!Horz Line for Date Resignation Tendered

  graphic  (39,5,18) horz-line

! Under line for Designation
  graphic (39,52,50) horz-line

! Under line for Reason for cessation/departure

 ! graphic  (41,5,105) horz-line

! Box for Amount of Monies

  graphic  (48,6,23) horz-line
  graphic  (48,34,5) horz-line  

! Horz Line for Date last Salary Paid
  graphic  (51,3,15) horz-line

! Horz Line for Amount of last salary paid
  graphic  (51,40,15) horz-line

! Horz Line for period Applicable for Last Salary Paid

  graphic  (51,82,20) horz-line

! Box for Reason if no monies withheld

!  graphic  (46,60,50) horz-line

! Under line for 24 Name of Bank

  graphic  (53,6,46) horz-line

! Under line for 25 Name & Tel No of New Employer

  graphic  (53,58,52) horz-line

! Under Line for D1 Name of Spouse

  graphic  (59,10,20) horz-line

! Under Line for Date of Birth

  graphic  (59,40,13) horz-line

! Under Line for Ident No
  graphic  (59,65,14) horz-line

! Under Line for Date of Marriage
  graphic  (59,95,15) horz-line

! Under Line for Nationality


  graphic  (61,10,20) horz-line

! Under Line for 6 Name & Add of Spouse's Current Employer

  graphic  (61,55,55) horz-line

! Horz line for Child section

  graphic                                        (65,2,{widthofpage}) horz-line
  graphic                                        (66,2,{widthofpage}) horz-line
  graphic                                        (67,2,{widthofpage}) horz-line
  graphic                                        (68,2,{widthofpage}) horz-line
  graphic                                        (69,2,{widthofpage}) horz-line


  print '1' (67,3)
  print '2' (68,3)
  print '3' (69,3)
  !print '4' (70,3)

! Vertical line for Child section

  graphic  (65,5,4)  vert-line
  graphic  (65,48,4) vert-line
  graphic  (65,55,4) vert-line
  graphic  (65,78,4) vert-line

! Section for Office Use begins.

! Lines before and after heading of "Office Use".
  graphic                                        (68,2,{widthofpage}) horz-line
  graphic                                        (70,2,{widthofpage}) horz-line

  graphic                                        (72,3,3) box 2
  print '1'                                      (72,4)
  print 'APP/'                                   (72,7)
  print 'ATT'                                    (73,7)

  graphic                                        (72,12,3) box 2
  print '4'                                      (72,13)
  print 'Dfee/ESOP/'                             (72,16)
  print 'EXCPF/LS'                               (73,16)

  graphic                                        (72,27,3) box 2
  print '7'                                      (72,28)
  print 'TOT'                                    (72,31)

  graphic                                        (72,37,3) box 2
  print '9'                                      (72,38)
  print 'NEMPT'                                  (72,41)

  graphic                                        (72,48,3) box 2
  print 'MS'                                     (72,49)
  print 'Std/Trnee/DTR/EMB/NRE/NOR/SA/'              (72,52)
  print 'NCB/RB/CR/Decd/Incpl/Nsgd/Addr'             (73,52)

  print 'Date Rec''d'         (71,85)
  print 'Finalised by & Date' (73,85)

  let $ftr = 'IRIN 112/2/'
  print $ftr        (81,2)
  let $tempyr = to_char(#TaxYear)
  Print $tempyr (81,9)
  print 'Page 1 of 2' (82,) center

! Lines before Date Recd
  graphic  (70,84,4) vert-line

! Lines for Date Recd ends
  graphic  (72,84,28) horz-line


  print '*Please delete where not applicable'    (75,8)
  print '**Please cross (x) appropriate box(if applicable)'  (75,43)
  print '<i> Refer to Explanatory Notes'  (75,80)

  graphic                                        (15,2,{widthofpage}) box 1 3 5
  print 'B|  EMPLOYER''S PARTICULARS' (15,2)   BOLD
  graphic                                        (22,2,{widthofpage}) box 1 3 5
  print 'C|  EMPLOYEE''S PERSONAL PARTICULARS'    (22,2) BOLD
  graphic                                        (35,2,{widthofpage}) box 1 3 5
  print 'D|  EMPLOYEE''S EMPLOYMENT RECORDS'      (35,2) BOLD
  graphic                                        (57,2,{widthofpage}) box 1 3 5
  print 'E|  SPOUSE''S AND CHILDREN''S PARTICULARS (Please complete for dependants relief claims)' (57,2) BOLD
  print 'FOR OFFICIAL USE'                         (70,3) BOLD

  Do Print-Page1-Values
end-procedure


!***********************************************************************
!  Procedure: Draw-Box                                                 *
!***********************************************************************
begin-procedure Draw-Box (#TotRepeat,#StartRow,#StartCol,#RepDiff)

  Let #Repeat = 0
  Let #RepCol = #StartCol
  graphic  (#StartRow,#StartCol,1) vert-line
  Let #EndPos = #RepDiff * #TotRepeat
  Let #EndCol = #StartCol + #EndPos
  graphic  (#StartRow,#EndCol,1) vert-line
  let #StartRow = #StartRow + 1
  graphic  (#StartRow,#RepCol,#EndPos) horz-line

End-Procedure

!
!***********************************************************************
!  Procedure: Print-Employee-Page2                                     *
!             Second Page of New format of IR21                        *
!***********************************************************************
begin-procedure Print-Employee-Page2

  graphic                                        (6,2,{widthofpage2}) box 64

  Alter-Printer
    Font = #StdFont
    Point-Size = 14

  print 'FORM IR21'                              (3,) BOLD Center

  Alter-Printer
    Font = #StdFont
    Point-Size = 10

  graphic                                        (6,2,{widthofpage2}) box 1 3 5
  print 'F| INCOME RECEIVED/TO BE RECEIVED DURING THE YEAR OF CESSATION/DEPARTURE AND THE PRIOR YEAR' (6,3) BOLD

  graphic                                        (7,2,{widthofpage2}) box 1
  print 'Employee''s Name:'         (7,3)  BOLD
  print 'FIN/NRIC No.:'             (7,71) BOLD
  print 'Provide amount for each of the relevant year(s) on calendar year basis'  (8,62)
  graphic  (8,60,52) horz-line

  print 'Year of Cessation'         (9,65) BOLD
  print 'Year Prior to Year of Cessation' (9,90) BOLD
    graphic  (6,65,1) vert-line

! Line under Year of Cessation Field
 graphic  (9,60,52) horz-line

  ! vert line before Provide amount for each of the relevant year(s) on calendar year basis
  graphic  (8,60,1) vert-line

! Vert Line before year of Cessation
  graphic  (8,60,1) vert-line

! Vert Line after year of Cessation
  graphic  (8,85,1) vert-line

  print 'D D / M M / Y Y'       (10,67)
  print 'D D / M M / Y Y'       (10,91)

! Box for From Date

  print 'From '                 (11,55)

  graphic                                        (11,62,21) box 1

! box for 1st year of Cessation

  graphic                                        (11,87,21) box 1

! Boxes for To Dates
  print 'To '                 (13,55)
  print 'INCOME <i>'             (13,3)   BOLD
  print 'S$'                  (14,70)
  print 'c'                   (14,85)
  print 'S$'                  (14,97)
  print 'c'                   (14,108)

  graphic                                        (13,62,21) BOX 1

! box for 1st year of Cessation

  graphic                                        (13,87,21) BOX 1

! Gross Salary and Fees

  print '1 Gross Salary, Fees, Leave Pay, Wages and Overtime Pay' (15,3)
  print '.00'                      (15,84)
  print '.00'                      (15,109)

  Do Draw-Box (7,14,62,3)
  Do Draw-Box (7,14,87,3)

! 2a. Contractual Bonus

  print '2(a) Contractual bonus '    (17,3)
  print '.00'                        (17,84)
  print '.00'                        (17,109)

  Do Draw-Box (7,16,62,3)
  Do Draw-Box (7,16,87,3)

! 2b. Non-Contractual Bonus
  print '(b) Non-Contractual bonus ' (18,4)
  print '.00'                        (18,84)
  print '.00'                        (18,109)

  Do Draw-Box (7,17,62,3)
  Do Draw-Box (7,17,87,3)

! 3. Director's Fees
  print 'State date declared payable ____________________' (19,7)

  print '3 Director''s Fees '        (20,3)
  print '.00'                        (20,84)
  print '.00'                        (20,109)

  Do Draw-Box (7,19,62,3)
  Do Draw-Box (7,19,87,3)

  print 'Approved at the company''s AGM/EGM on _______________' (21,4)

  graphic  (22,2,{widthofpage2}) horz-line

  print '4  OTHERS '               (23,3) BOLD

! (A) Gross Commission

  print '(a) Gross Commission '    (24,3)
  print '.00'                      (24,84)
  print '.00'                      (24,109)

  Do Draw-Box (7,23,62,3)
  Do Draw-Box (7,23,87,3)

! (b) Allowances

  print '(b) Allowances '(26,3)
  print '.00'                      (26,84)
  print '.00'                      (26,109)

  Do Draw-Box (7,25,62,3)
  Do Draw-Box (7,25,87,3)

! (c) Gratuity / Ex-Gratia

  print '(c) Gratuity / Ex-gratia payment'(28,3)
  print '.00'                      (28,84)
  print '.00'                      (28,109)

  Do Draw-Box (7,27,62,3)
  Do Draw-Box (7,27,87,3)

! (d) Payment-In-Lieu of Notice

  print '(d) Notice Pay '(30,3)

  print '.00'                      (30,84)
  print '.00'                      (30,109)

  Do Draw-Box (7,29,62,3)
  Do Draw-Box (7,29,87,3)

! (e) Compensation for Loss of Office

  print '(e) Compensation for loss of Office <i>' (32,3)
  
  print 'Reason for payment' (33,5)
  graphic                     (33, 20, 30) horz-line
  print 'Length of Service within company/group' (33,70)
  graphic                     (33, 101,3) Horz-Line
  print '.' (33,104) bold
  graphic                     (33, 104,3) Horz-Line
  print 'year(s)' (33,107)
  print 'Basis of arriving at the payment'      (34,5)
  print 'Monthly Salary' (34,70)
  graphic                     (34,102,6) horz-line
  print '.00'                (34,106) bold

  graphic                                     (34, 30, 20) Horz-Line

  print '.00'                      (32,84)
  print '.00'                      (32,109)

  Do Draw-Box (7,31,62,3)
  Do Draw-Box (7,31,87,3)

! (f) Retirement Benefits

  print '(f) Retirement benefits including gratuities/pension/commutation of' (36,3)
  print '    pension/lump sum payments etc. from Pension/Provident Fund '    (37,3)
  print '    Name of Fund'                                            (38,3)
  graphic  (38,22,30) horz-line
  print '    Date of Payment'                                            (39,3)
  graphic  (39,22,30) horz-line
  print $Date_Payment   (39,21)

  print '.00'                      (38,84)
  print '.00'                      (38,109)

  Do Draw-Box (7,37,62,3)
  Do Draw-Box (7,37,87,3)

! (g) contributions made by employer to any Pension/Provident Fund'

  print '(g) Contributions made by employer to any Pension/Provident' (41,3)
  print '    Fund constituted outside Singapore . ' (42,3)
  print '<i>' (42,25) bold
  print '    Name of Fund'                                            (43,3)
  graphic  (43,22,30) horz-line

  print '.00'                      (43,84)
  print '.00'                      (43,109)

  Do Draw-Box (7,42,62,3)
  Do Draw-Box (7,42,87,3)

! (h) Excess/Voluntary contribution to CPF by employer'

  print '(h) Excess/Voluntary contribution to CPF by employer'        (45,3)
  print '(Complete the Form IR8S)'       (46,5) bold

  print '.00'                      (46,84)
  print '.00'                      (46,109)

  Do Draw-Box (7,45,62,3)
  Do Draw-Box (7,45,87,3)

! (i) Gains and Profits from Shar Options

  print '(i) Gains or profits from Employee Stock Option (ESOP)/ other forms'          (48,3)
  print '    of Employee Share Ownership (ESOW) Plans <i>'                            (49,3) 
  !print '<i>' (49,32) BOLD
  print '    (Complete Appendix 2)'                            (50,3) BOLD
  
  print '    Cross "x" the box if there is employee has unexercised/unvested:'     (51,3) BOLD
  graphic                                                         (52,5,2) box 1
  print '    ESOP/ESOW granted before 1 Jan 2003'   (52,7) BOLD
  graphic                                                         (52,37,2) box 1
  print '   ESOP/ESOW granted on or after 1 Jan 2003 and tracking option applies'   (52,39) BOLD

  print '.00'                      (49,84)
  print '.00'                      (49,109)

  Do Draw-Box (7,48,62,3)
  Do Draw-Box (7,48,87,3)

! (j) Value of Benefits-in-Kinds

  print '(j) Value of Benefits-in-Kinds'                             (54,3)
  print '(To cross [x] the box if Appendix 1 is completed)'                                (55,3)  BOLD
  graphic                                        (55,54,2) box 1
  print '.00'                      (55,84)
  print '.00'                      (55,109)

  Do Draw-Box (7,54,62,3)
  Do Draw-Box (7,54,87,3)

! subtotal of Items 4a to 4j

  print 'SUBTOTAL OF Items 4(a) to 4(j)' (56,35) BOLD
  print '.00'                            (56,84)
  print '.00'                            (56,109)

  Do Draw-Box (7,55,62,3)
  Do Draw-Box (7,55,87,3)

! Total of items 1 to 4
  print 'TOTAL OF ITEMS 1 TO 4'    (58,39)  BOLD
  print '.00'                      (58,84)  BOLD
  print '.00'                      (58,109) BOLD

  Do Draw-Box (7,57,62,3)
  Do Draw-Box (7,57,87,3)

  graphic  (59,2,{widthofpage2}) horz-line


  print 'DEDUCTIONS '            (60,3) BOLD
  print '5 EMPLOYEE''S                               contribution to *CPF/Designated' (61,3)
  print 'COMPULSORY'                (61,13) BOLD
  print 'Pension or Provident Fund' (62,4)
  print 'Name of Fund'              (63,4)
  graphic                           (63,20,30) HORZ-LINE
  print '.00'                       (63,84)
  print '.00'                       (63,109)

  Do Draw-Box (7,62,62,3)
  Do Draw-Box (7,62,87,3)

  print '6 DONATIONS'              (64,3) BOLD
  print 'deducted from salaries for Yayasan Mendaki Fund/'              (64,13) 
  print 'Community Chest of Singapore/SINDA/CDAC/ECF/Other tax'         (65,5) 
  print 'exempt donations'  (66,5)
  
! donations deducted thru salaries.
  print '.00'                      (65,84)
  print '.00'                      (65,109)

  Do Draw-Box (7,64,62,3)
  Do Draw-Box (7,64,87,3)

  print '7 Contributions deducted through salaries for Mosque Building Fund' (67,3)

  print '.00'                      (67,84)
  print '.00'                      (67,109)

  Do Draw-Box (7,66,62,3)
  Do Draw-Box (7,66,87,3)
  graphic                                        (69,2,{widthofpage2}) box 1 3 5
  print 'G   DECLARATION' (69,3) BOLD

  print 'I,the undersigned, hereby give notice under Section 68 of the Income Tax Act, that the employee named in this form will cease to be' (70,2)
  print 'employed and/or will probably leave Singapore on the date(s) stated. I also certify that the information given in this form and in ' (71,2)
  print 'any documents attached is true, correct and complete' (72,2)

  graphic  (73,2,30)   horz-line
  graphic  (73,35,30)  horz-line
  graphic  (73,70,20)  horz-line
  graphic  (73,93,18) horz-line
  print 'Full name of Authorised Personnel ' (74,2)

  print 'Designation'   (74,43)
  print 'Signature'     (74,75)
  print 'Date'          (74,96)

  graphic  (76,2,30)  horz-line
  graphic  (76,35,30) horz-line
  graphic  (76,70,20) horz-line
  graphic  (76,93,18) horz-line

  print &CO.GPSG_CPY_SIGNATORY   (73,2)
  print $Co_Designation          (73,36)
  print $Co_Tax_Contact          (76,2)
  print &CO.PHONE                (76,36)
  print &CO.GPSG_FAX             (76,72)
  print $Email_Add               (76,94)

  print 'Name of Contact Person'  (77,2)
  print 'Contact No'              (77,40)
  print 'Fax No.'                     (77,75)
  print 'Email Address'           (77,95)

  print $ftr                      (81,2)
  let $tempyr = to_char(#TaxYear)
  Print $tempyr (81,9)
 print 'Page 2 of 2' (81,) center


  Do Print-Page2-Values

end-procedure

!***********************************************************************
!  Procedure: Print-Employee-Page3                                     *
!             Second Page of New format of IR21                        *
!***********************************************************************
begin-procedure Print-Employee-Page3

  Alter-Printer
    Font = #StdFont
    Point-Size = 14

  print 'FORM IR21-APPENDIX 1'               (3,) CENTER BOLD

  Alter-Printer
    Font = #StdFont
    Point-Size = 10

  graphic                                    (6,1,{widthofpage2}) box 1 3 5

  print 'Value of Benefits-in-kind Provided' (6,) CENTER BOLD
  print 'This form is to be completed by the employer if applicable. Please read the  Explanatory Notes.It will take about 10 minutes to fill in this form ' (7,1)
  print 'Please get ready the details of benefits-in-kind provided for year of cessation and the prior year.' (8,1)
  graphic                                    (7,1,{widthofpage2}) box 3

  print 'Employee''s Name:'                  (10,2)
  print 'FIN/NRIC No.:'                      (10,70)

  graphic (12,3,50) box 3
  print 'Note:This page is applicable to benefits-in-kind provided up' ( 12,5,60) bold
  print  'to 31.12.2013. To complete Section D and/or E if the benefits'  ( 13,5,60) bold
  print  'are provided from 1.1.2014.' ( 14,5,50) bold

  graphic (10,1,{widthofpage2}) box 1
  graphic (9,68,1) vert-line

  print 'A.         Place of Residence provided by Employer' (15,1) BOLD

  print 'Address:'                           (16,1)

  graphic (16,10,45) horz-line
  graphic (17,10,45) horz-line

  graphic                                   (12,60,51) box 1
  print 'Provide values for each of the relevant year(s).' (12,73)
  graphic                                   (13,60,51) box 1
  graphic                                   (12,85,1)  vert-line

  print 'Year of Cessation'                 (13,65) BOLD

  print 'Year Prior to Year of Cessation'   (13,90) BOLD

  print '1. Period during which the premise was occupied' (19,1)

  print ') From'                            (19,35) BOLD
  print ') To'                              (20,35) BOLD

! Under Lines for Cessation Year and prior year

  graphic                                   (19,60,24)  horz-line
  graphic                                   (19,86,24)  horz-line
  graphic                                   (20,60,24)  horz-line
  graphic                                   (20,86,24)  horz-line

  graphic                                   (23,60,51) box 7

! Lines and boxes grayed for A2 to A6.

  graphic                                   (28,60,51) box 2 3 6
  graphic                                   (22,85,8) vert-line


  Let #Counter = 0
  Let #SLine = 23
  While #Counter <=3
     graphic                                (#SLine,60,51) horz-line
     Add 1 to #SLine
     if #Counter = 0
        Add 1 to #SLine
     End-if
     Add 1 to #Counter
  end-while


  print '2. Number of days occupying the premise' (23,1)

  print '3. Number of employee(s) sharing the premise' (24,1)
  print '(exclude family members)'               (25,3) BOLD
  print '4. Rent paid by employee'               (26,1)

  print '5. Annual Value or Actual Rent paid by' (27,1)
  print 'Employer'                               (27,25) BOLD
  print '6.Value of Place of Residence'  (28,1) bold

  graphic                                        (29,1,58) box 2 0 9
  print '7. Taxable benefit of Accommodation, Furniture & Fittings' (29,1) BOLD
  print '    (A6+B9)  '               (30,3) BOLD

  print 'B. Furniture & Fittings/Driver/Gardener Provided' (35,1) BOLD
  
  graphic                                        (55,1,58)  box 4 0 9
  graphic                                        (55,60,51) box 4 0 9
  graphic                                        (63,1,58)  box 2 0 9
  graphic                                        (63,60,51) box 2 0 9
  graphic                                        (37,1,58)  box 28
  graphic                                        (37,60,51) box 28

  Let #Counter = 0
  Let #SLine = 39
  While #Counter <= 15
     graphic  (#SLine,1,58)  horz-line
     graphic  (#SLine,60,51) horz-line
     Add 1 to #SLine
     if #Counter = 1 or #Counter = 2 or #Counter = 4 or #Counter = 6
      or #Counter = 9 or #Counter = 11 or #Counter = 14
        Add 1 to #SLine
     End-if

     if #Counter = 10
        Add 3 to #SLine
     End-if

     Add 1 to #Counter
  end-while
  print 'Items'          (37,10) BOLD
  print 'A'              (37,39) BOLD
  print 'No of Units'    (38,37)
  print 'B'              (37,52) BOLD
  print 'Rate/Unit'      (38,50)
  print 'p.a ($)'        (39,51)

  print 'Value =' (37,72)
  print 'A x B'                           (37,80) BOLD
  print 'x (No. of days/365) ($)'         (37,85)
  print 'Please apportion the values to the share applicable to this employee' (38,61)

  graphic  (36,31,16) vert-line
  graphic  (36,48,16) vert-line
  graphic  (58,48,2) vert-line
  graphic  (60,14,2) vert-line

  Let #PL = 40

  print '1. Furniture: Hard & Soft'         (#PL,2)
  if(#CYRtAnFurniture > 120 or #CYRtAnFurniture = 0 )
    let #CYRtAnFurniture = 120
  end-if
  print #CYRtAnFurniture                    (#PL,50) edit '$9999.99'

  graphic  (#PL,40,2) vert-line
  Add 1 to #PL
  print '2. Refrigerator/ Video '           (#PL,2)
  if (#CYRtAnRefrigerator > 120 or #CYRtAnRefrigerator = 0 )
    let #CYRtAnRefrigerator = 120
  end-if
  print #CYRtAnRefrigerator                 (#PL,50) edit '$9999.99'
  print '/'                                 (#PL,58)
  Add 1 to #PL
  print '   Recorder'                          (#PL,2)
  if(#CYRtAnVCR > 240 or #CYRtAnVCR = 0 )
    let #CYRtAnVCR = 240
  end-if
  print #CYRtAnVCR                          (#PL,50)  edit '$9999.99'

  graphic  (#PL,37,2) vert-line
  graphic  (#PL,42,2) vert-line
  Add 1 to #PL
  print '3. Washing Machine / Dryer / ' (#PL,2)
  if(#CYRtAnWashMach > 180 or #CYRtAnWashMach = 0)
    let #CYRtAnWashMach = 180
  end-if
  print #CYRtAnWashMach                     (#PL,50)  edit '$9999.99'
  Add 1 to #PL
  print '   Dish Washer'                           (#PL,2)

  Add 1 to #PL
  print '4. Air-conditioning - Unit'        (#PL,2)
  if (#CYRtAnACUnit > 120 or #CYRtAnACUnit = 0)
    let #CYRtAnACUnit = 120
  end-if

  print #CYRtAnACUnit                       (#PL,50)  edit '$9999.99'

  graphic                                   (#PL,40,2) vert-line
  Add 1 to #PL
  print '   Central Air-conditioning:-'        (#PL,2)
  if( #CYRtAnACCentral > 180 or #CYRtAnACCentral = 0)
    let #CYRtAnACCentral = 180
  end-if
  print #CYRtAnACCentral                    (#PL,50)  edit '$9999.99'
  Add 1 to #PL

  print '- Dining room / Sitting room'      (#PL,3)
  Add 1 to #PL

  print '- Additional Room'                 (#PL,3)
  if( #CYRtAnACAddl > 120 or #CYRtAnACAddl = 0)
    let #CYRtAnACAddl = 120
  end-if
  print #CYRtAnACAddl                       (#PL,50)  edit '$9999.99'

  graphic                                   (#PL,35,2) vert-line
  graphic                                   (#PL,38,2) vert-line
  graphic                                   (#PL,42,2) vert-line
  graphic                                   (#PL,45,2) vert-line
  Add 1 to #PL
  print '5. TV/Radio/Amplifier/Hi-Fi/ '      (#PL,2)
  if( #CYRtAnTV > 360 or #CYRtAnTV = 0)
    let #CYRtAnTV = 360
  end-if
  print #CYRtAnTV                             (#PL,50)  edit '$9999.99'
  Add 1 to #PL
  print '   Electric Guitar'                            (#PL,2)

  graphic                                   (#PL,40,1) vert-line
  Add 1 to #PL
  print '6. Computer / Organ'               (#PL,2)
  if( #CYRtAnComputer > 480 or #CYRtAnComputer = 0)
    let #CYRtAnComputer = 480
  end-if
  print #CYRtAnComputer                     (#PL,50)  edit '$9999.99'
  Add 1 to #PL

  print '7. Swimming Pool'                  (#PL,2)
  if( #CYRtAnPool > 1200 or #CYRtAnPool = 0)
    let #CYRtAnPool = 1200
  end-if
  print #CYRtAnPool                         (#PL,50) edit '$9,999.99'
  Add 1 to #PL

  print '8. Others '                         (#PL,2)
  Add 2 to #PL

  print '9. Taxable Value of furniture & fittings (Total of B1 to B8)' (#PL,2) BOLD
  Add 1 to #PL
  print '   to be included in the computation of Taxable Value of' (#PL,2) BOLD
  Add 1 to #PL
  print '   Place of Residence (Item A6) above (see Explanatory' (#PL,2) BOLD
  Add 1 to #PL
  print '   Note B)'                  (#PL,2) BOLD

  Add 1 to #PL
  print '10.PUB/Telephone/Pager/Suitcase/Golf Bag &' (#PL,2)
  print 'Actual'                            (#PL,50)
  Add 1 to #PL
  print '   Accessories/Camera/Servant'        (#PL,2)
  print 'Amount'                            (#PL,50)

  Add 1 to #PL
  print '11.Driver'                         (#PL,2)
  print 'Annual wages X (private / total mileage)' (#PL,15)

  Add 1 to #PL
  print '12.Gardener'                       (#PL,2)
  print '$420/yr or Actual wages, whichever is lower' (#PL,15)

  Add 1 to #PL
  print '13.Taxable Value of Driver/Gardener/PUB, etc' (#PL,2) BOLD
  Add 1 to #PL
  print ' (B10+B11+B12)'            (#PL,3) BOLD

! Vertical line drawing before the graying of bottom box causes problems
! therefore the line is drawn after graying.

  graphic  (39,85,25) vert-line


  let $ftrA = 'IRIN 112/A1-2/'
  print $ftrA                               (72,2)
  let $tempyr = to_char(#TaxYear)
  Print $tempyr (72,11)
  print 'Page 1 of 2'                       (72,) center


  Do Print-Page3-Values

End-Procedure

!***********************************************************************
!  Procedure: Print-Employee-Page4                                     *
!             Second Page of New format of IR21                        *
!***********************************************************************
begin-procedure Print-Employee-Page4

  Alter-Printer
    Font = #StdFont
    Point-Size = 14

  print 'FORM IR21-APPENDIX 1'      (3,50)  CENTER BOLD

  Alter-Printer
    Font = #StdFont
    Point-Size = 10
  graphic                                        (6,1,{widthofpage2}) box 2 3 5

  print 'Value of Benefits-in-kind Provided' (6,52) CENTER BOLD
  graphic                                        (6,1,{widthofpage2}) box 1

  print 'Employee''s Name:'         (7,2)
  print 'FIN/ NRIC No.:'            (7,75)

  graphic (6,74,1) vert-line

  graphic                                   (9,60,51) box 1
  print 'Provide values for each of the relevant year(s).' (9,73)
  
  graphic                                   (10,60,51) box 1
  graphic                                   (9,85,1)  vert-line


  print 'Year of Cessation'                 (10,65) BOLD

  print 'Year Prior to Year of Cessation'   (10,87) BOLD


  print 'C. Hotel Accomodation Provided' (13,1) BOLD
  print '   (See Explanatory Note C)'    (14,1) BOLD

  graphic                                        (17,1,58)  box 10
  graphic                                        (17,60,51) box 10

! Lines and boxes grayed for A2 to A6.

  Let #Counter = 0
  Let #SLine = 19
  While #Counter <=6

     graphic  (#SLine,1,58) horz-line
     graphic  (#SLine,60,51) horz-line
     Add 1 to #SLine
     Add 1 to #Counter
  end-while

  graphic                                        (26,1,58)  box 2 1 5
  graphic                                        (26,60,51) box 2 1 5

  graphic  (16,18,8) vert-line
  graphic  (16,30,8) vert-line
  graphic  (16,45,8) vert-line

  graphic  (19,85,8) vert-line

  print 'Value = A x B x (C' (18,80) BOLD
  print '/365) ($)'          (18,93)

  print 'Provided To:' (17,4)
  print 'A '           (17,24) BOLD
  print 'No. of'       (18,22)
  print 'Persons'      (19,22)

  print 'B' (17,38) BOLD
  print 'Rate/Person' (18,35)
  print 'p.a'         (19,37)

  print 'C' (17,53) BOLD
  print 'No of days' (18,50)

  print '1. Self'                                        (20,2)
  print '2. Wife/Child> 20 yrs'                          (21,2)
  print '3. Child- 8 to 20 yrs'                          (22,2)
  print '4. Child- 3 to 7 yrs'                           (23,2)
  print '5. Child- < 3 yrs old'                          (24,2)
  print '6. Plus 2% of Basic Salary for period provided' (25,2) BOLD
  print '7. Taxable Value of Hotel Accommodation Provided' (26,2) BOLD
  print '   (Total of C1 to C6)'                            (27,2) BOLD

  if( #CYRtAnAbv20Yrs > 3000 or #CYRtAnAbv20Yrs = 0)
    let #CYRtAnAbv20Yrs = 3000
  end-if
  print #CYRtAnAbv20Yrs   (20,35)  edit '$9,999.99'

  if( #CYRtAnAbv20Yrs > 3000 or #CYRtAnAbv20Yrs = 0)
    let #CYRtAnAbv20Yrs = 3000
  end-if
  print #CYRtAnAbv20Yrs   (21,35)  edit '$9,999.99'

  if( #CYRtAnBet8_20Yrs > 1200 or #CYRtAnBet8_20Yrs = 0)
    let #CYRtAnBet8_20Yrs = 1200
  end-if
  print #CYRtAnBet8_20Yrs (22,35)  edit '$9,999.99'

  if( #CYRtAnBet3_7yrs > 600 or #CYRtAnBet3_7yrs = 0)
    let #CYRtAnBet3_7yrs = 600
  end-if
  print #CYRtAnBet3_7yrs  (23,35)  edit '$999.99'

  if( #CYRtAnLess3Yrs > 300 or #CYRtAnLess3Yrs = 0)
    let #CYRtAnLess3Yrs = 300
  end-if
  print #CYRtAnLess3Yrs   (24,35)  edit '$999.99'

! Section D begins here

  print 'D. Others' (29,2) BOLD

  graphic                                        (30,1,58)  box 20
  graphic                                        (30,60,51) box 20

  graphic                                        (51,1,58)  box 3 1 5
  graphic                                        (51,60,51) box 3 1 5

  graphic  (29,85,24) vert-line

  print 'Total value of benefits-in-kind (Total OF A6, B13, C7, D12)' (51,2) BOLD
  print 'to be reflected in item 4(j) of Form IR21 - pg 2'            (52,2) BOLD

  Let #PL = 30
  print '1. Cost of home leave passage'                                (#PL,2)
  print '(See Explanatory Note D)'                                     (#PL,31) BOLD
  Add 2 to #PL
  print '   Pioneer/Export/OHQ Status:'                                  (#PL,2) BOLD
  graphic                                        (#PL,32,4) BOX 1
  graphic                                        (#PL,42,4) BOX 1
  print 'Yes'                                    (#PL,37) BOLD
  print 'No'                                     (#PL,50) BOLD

  Add 1 to #PL
  print '2. Interest payment made by the employer to a third party'      (#PL,2)
  Add 1 to #PL
  print '   on behalf of an employee and/or loans  provided by'          (#PL,2)
  Add 1 to #PL
  print '   employer interest free or at a rate  below market'           (#PL,2)
  Add 1 to #PL
  print '   rate to the employee who has  substantial shareholding'      (#PL,2)
  Add 1 to #PL
  print '   or control or influence over the company.'                   (#PL,2)
  Add 1 to #PL
  print '3. Life Insurance premiums paid by the employer'                (#PL,2)
  Add 1 to #PL
  print '4. Free or subsidised holidays including air passage etc.'      (#PL,2)
  Add 1 to #PL
  print '5. Educational expenses including tutor provided'               (#PL,2)
  Add 1 to #PL
  print '6. Non-monetary awards for long service (excluding awards'      (#PL,2)
  Add 1 to #PL
  print '   with little commercial value)'                               (#PL,2)
  Add 1 to #PL
  print '7. Entrance/transfer fees and annual subscription to social or' (#PL,2)
  Add 1 to #PL
  print '   recreational clubs'                                          (#PL,2)
  Add 1 to #PL
  print '8. Gains from assets, e.g. vehicles, property, etc sold to'     (#PL,2)
  Add 1 to #PL
  print '   employees at a price lower than open market value.'          (#PL,2)
  Add 1 to #PL
  print '9. Full cost of motor vehicle given to employee'                (#PL,2)
  Add 1 to #PL
  print '10.Car benefit'                                                 (#PL,2)
  print '(see Explanatory Note E)'                                       (#PL,17) BOLD
  Add 1 to #PL
  print '11.Other benefits which do not fall within the above items'     (#PL,2)
  Add 1 to #PL
  print '12.Total D1 to D11'                                             (#PL,2)
  Add 1 to #PL

  Let #Counter = 0
  Let #SLine = 31
  While #Counter <=10
        graphic  (#SLine,1,58) horz-line
        graphic  (#SLine,60,51) horz-line
        Add 1 to #SLine
        if #Counter = 0
           Add 4 to #SLine
        End-if
        if #Counter = 4 or #Counter = 5 or #Counter = 6
           Add 1 to #SLine
        End-if

     Add 1 to #Counter
  end-while

  graphic  (61,2,35)   horz-line
  graphic  (61,39,25)  horz-line
  graphic  (61,67,20)  horz-line
  graphic  (61,92,18) horz-line
  print 'Full name of Authorised Personnel ' (63,2)

  print 'Designation'   (63,41)
  print 'Signature'     (63,70)
  print 'Date'          (63,97)

  graphic  (66,2,35)  horz-line
  graphic  (66,39,25) horz-line
  graphic  (66,67,20) horz-line
  graphic  (66,92,18) horz-line

  print &CO.GPSG_CPY_SIGNATORY   (61,2)
  print $Co_Designation          (61,40)
  print $Co_Tax_Contact          (66,2)
  print &CO.PHONE                (66,40)
  print &CO.GPSG_FAX             (66,70)
  print $Email_add               (66,93)

  print 'Name of Contact Person' (68,2)
  print 'Contact No'             (68,41)
  print 'Fax         '           (68,70)
  print 'Email Address'          (68,97)

  print $ftrA                    (78,2)
  let $tempyr = to_char(#TaxYear)
  Print $tempyr (78,11)
   print 'Page 2 of 2'           (78,) center

  Do Print-Page4-Values
End-Procedure

!
!***********************************************************************
!  Procedure: Print-Page1-Values                                       *
!             Print values For Page 1                                  *
!***********************************************************************
begin-Procedure Print-Page1-Values

         Let #AmountLen = 8

      If &IR21Type = 'O'
         print 'X'                                    (13,4) BOLD
      End-if

      If &IR21Type = 'D'
         print 'X'                                    (13,27) BOLD
      End-if

      If &IR21Type = 'M'
         print 'X'                                    (13,72) BOLD
      End-if

      if rtrim($LastAmended_Dt,' ') <> ''
       If(&IR21Type = 'D')
         print $LastAmended_Dt                         (14,50) BOLD edit 'DD/MM/YYYY'
         !graphic                                       (10,100,8) horz-line
       Else
        if(&IR21Type = 'M' )
         print $LastAmended_Dt                         (14,100) BOLD edit 'DD/MM/YYYY'
        End-if
       End-If
      end-if

      do Print-With-Gaps (16,20,$ROB_ROC_No,0,2,'')  ! ROB/ROC/Others
      do Print-With-Gaps (16,66,$Co_Name1,0,1,'')     ! Company Name
      do Print-With-Gaps (17,66,$Co_Name2,0,1,'')     ! Company Name
      do Print-With-Gaps (18,20,$Co_Address1,0,1,'')
      do Print-With-Gaps (19,20,$Co_Address2,0,1,'')
      do Print-With-Gaps (20,20,$Co_Address3,0,1,'')
      do Print-With-Gaps (20,85,$Co_City_Zip,0,1,'')

      Let $PrnName = rtrim(&PIHS.NAME_PREFIX,' ') || ' ' || &PIHS.NAME

      do Print-With-Gaps (24,21,$PrnName,0,2,'')
     Alter-Printer
    Font = #StdFont
    Point-Size = 8

      if #UIN_Line = 1 
         do Print-With-Gaps (26,17,$Nid,0,2,'')
      else
       if Rtrim(&PIHS.NATIONAL_ID_TYPE, ' ') <> 'MI1' and  Rtrim(&PIHS.NATIONAL_ID_TYPE, ' ') <> 'MI2' and Rtrim(&PIHS.NATIONAL_ID_TYPE, ' ') <> 'MI3'
         do Print-With-Gaps (26,60,$Nid,0,2,'')
      end-if
      end-if

      IF #UIN_Line = 2
         do  Print-With-Gaps   (26,95,$Nid,0,1,'')
      end-if

   Alter-Printer
    Font = #StdFont
    Point-Size = 10
      print $ADDRESS1_OTH                        (28,21)               ! Address Line 1
      print $ADDRESS2_OTH                        (29,21)               ! Address Line 2
      print $ADDRESS3_OTH                        (30,21)               ! Address Line 3
      !print $Postal                          (30,30)               !Postal

     ! Print $AddEffdt                                (31,30) edit 'DD/MM/YYYY'

      print &PIHS.BIRTHDATE                          (32,20) edit 'DD/MM/YYYY'
      IF rtrim(&PIHS.SEX,' ') = 'M'
         print 'Male'                                (32,51)
      end-if
      IF rtrim(&PIHS.SEX,' ') = 'F'
         print 'Female'                              (32,51)
      end-if

      print &PIHS.NATIONALITY                        (32,86)

      Let $FieldName  = 'MAR_STATUS'
      Let $FieldValue = &PIHS.MAR_STATUS
      Do Read-Translate-Table

      print $XLatLongName                            (33,20)
      print &PIHS.PHONE                              (33,51)
      print $Email                                   (33,86)

      print &PIHS.GPSG_ARRIVAL_DT                (37,8)   edit DD/MM/YYYY
      print &PIHS.HIRE_DT                        (37,36)  edit DD/MM/YYYY
      print &PIHS.TERMINATION_DT                 (37,58)  edit DD/MM/YYYY
      print &PIHS.GPSG_DEPART_DT                 (37,88) edit DD/MM/YYYY

      print &PIHS.GPSG_RESIG_DT                  (39,8)   edit DD/MM/YYYY

      print  &PIHS.JOB_DESCR                     (39,52)

      print  &PIHS.GPSG_MTH_CESS_RSN             (42,55)

      IF &PIHS.GPSG_TAX_WHELD <> 0
         Do Print-Amounts (48,12,35,&PIHS.GPSG_TAX_WHELD)
      End-if

      print &PIHS.GPSG_LAST_PAY_DT               (51,5) EDIT 'DD/MM/YYYY'

      if &PIHS.GPSG_LAST_SAL <> 0
         print &PIHS.GPSG_LAST_SAL               (51,41) edit '999,999,999.99'
      end-if

      print &PIHS.GPSG_PERIOD                    (51,84)
      !do Print-With-Gaps (46,62,&PIHS.GPSG_NONE_WHELD,0,2,'')
            print  &PIHS.GPSG_NONE_WHELD   (48,72)

      if rtrim(&PIHS.GPSG_ER_PAYS_TAX,' ') = 'N'
         print 'X'                               (55,31)
      End-If

      if rtrim(&PIHS.GPSG_ER_PAYS_TAX,' ') = 'Y'
         print 'X'                               (55,41)
      End-If

      if rtrim(&PIHS.GPSG_ER_PAYS_TAX,' ') = 'P'
         print 'X'                               (55,59)
        graphic  (55,82,28)  horz-line

      print $GPSG_ER_PAR_TX_RS                   (55,82)
      End-If

      print &PIHS.GPSG_EMPL_BANK                 (53,7)
      print &PIHS.GPSG_IR21_EMPLR                (53,60)

      print &PIHS.GPSG_SPOUSE_NAME               (59,12)
      print &PIHS.GPSG_SPOUSE_BDATE              (59,42) EDIT 'DD/MM/YYYY'
      print &PIHS.GPSG_SPOUSE_ID                 (59,65)
      print &PIHS.MAR_STATUS_DT                  (59,96) EDIT 'DD/MM/YYYY'
      print &PIHS.GPSG_SPOUSE_NAT                (61,10)

      print &PIHS.GPSG_EMPLR_SCHL                (63,60)

      Let #row = 64
      do Print-Child-Details

  new-page
End-Procedure

!***********************************************************************
!  Procedure: Print-Page2-Values                                       *
!             Print values For Page 2                                  *
!***********************************************************************
begin-Procedure Print-Page2-Values

  Let #AmountLen = 7

  Print $PrnName          (7,18) BOLD
  Print $Nid              (7,88) BOLD


  Print &PIDS.GPSG_TAX_YR_START  (11,68) edit 'DD/MM/YYYY' BOLD
  Print &PIDS.GPSG_TAX_YR_STRT_1 (11,92) edit 'DD/MM/YYYY' BOLD

  Print &PIDS.GPSG_TAX_YR_END    (13,68) edit 'DD/MM/YYYY' BOLD
  Print &PIDS.GPSG_TAX_YR_END_1  (13,92) edit 'DD/MM/YYYY' BOLD

  Do Print-With-Gaps (13,56,$CYTo_Dt,0,2,'B')      ! Print Employment Termination Dt of current year
  Do Print-With-Gaps (13,82,$P1To_Dt,0,2,'B')      ! Print Employment Termination Dt of 1st Previous year

  Do Print-Amounts (15,63,0,&PIDS.GPSG_8A_INCOME_TOT)
  Do Print-Amounts (15,88,0,&PIDS.GPSG_8A_INC_TOT_1)

  Do Print-Amounts (17,63,0,&PIDS.GPSG_8A_CNT_BONUS)
  Do Print-Amounts (17,88,0,&PIDS.GPSG_8A_CNT_BNS_1)

  Do Print-Amounts (18,63,0,&PIDS.GPSG_8A_NC_BONUS)
  Do Print-Amounts (18,88,0,&PIDS.GPSG_8A_NC_BNS_1)

  print &PIDS.GPSG_BONUS_DT            (19,27)  edit 'DD/MM/YYYY'

  Do Print-Amounts (20,63,0,&PIDS.GPSG_8A_DIR_FEE)
  Do Print-Amounts (20,88,0,&PIDS.GPSG_8A_DIR_FEE_1)

  print &PIDS.GPSG_DIR_FEE_DT          (21,32)  edit 'DD/MM/YYYY'

  Do Print-Amounts (24,63,0,&PIDS.GPSG_8A_COMMSN)
  Do Print-Amounts (24,88,0,&PIDS.GPSG_8A_COMMSN_1)

  Do Print-Amounts (26,63,0,&PIDS.GPSG_8A_ALLOW_TOT)
  Do Print-Amounts (26,88,0,&PIDS.GPSG_8A_ALLW_TOT_1)

  Do Print-Amounts (28,63,0,&PIDS.GPSG_8A_GRATUITY)
  Do Print-Amounts (28,88,0,&PIDS.GPSG_8A_GRATUITY_1)

  Do Print-Amounts (30,63,0,&PIDS.GPSG_8A_NOTICE)
  Do Print-Amounts (30,88,0,&PIDS.GPSG_8A_NOTICE_1)

  Do Print-Amounts (32,63,0,&PIDS.GPSG_8A_LOSS_OFFIC)
  Do Print-Amounts (32,88,0,&PIDS.GPSG_8A_LOSS_OFF_1)

  Do Print-Amounts (39,63,0,&PIDS.GPSG_8A_RETIRE)
  Do Print-Amounts (39,88,0,&PIDS.GPSG_8A_RETIRE_1)

  print &PIDS.GPSG_RETIRE_FUND    (39,22)

  Do Print-Amounts (43,63,0,&PIDS.GPSG_8A_OS_PENSION)
  Do Print-Amounts (43,88,0,&PIDS.GPSG_8A_OS_PENS_1)

  print &PIDS.GPSG_OS_PENS_FUND  (43,22)

  Do Print-Amounts (46,63,0,&PIDS.GPSG_CPF_VOL_ER)
  Do Print-Amounts (46,88,0,&PIDS.GPSG_CPF_VOL_ER_1)

  Do Print-Amounts (49,63,0,&PIDS.GPSG_8A_SHARE_GAIN)
  Do Print-Amounts (49,88,0,&PIDS.GPSG_8A_SHARE_GN_1)

  if #CYIR21Total <> 0 or #P1IR21Total <> 0
     print 'X'     (55,54)   BOLD
  end-if

!  Print Benefit-in-kind amount from Appendix 1

  Let #Pg2CYIR21Total = trunc(#CYIR21Total,0)
  Let #Pg2P1IR21Total =  trunc(#P1IR21Total,0)

  ! Do Print-Amounts (55,63,0,#Pg2CYIR21Total)
  Do Print-Amounts (55,63,0,#tot_val_ben)
  Do Print-Amounts (55,88,0,#Pg2P1IR21Total)

!  Add BIK amounts to Other Income subtotal & print

  Let #CYSubTotal4A_J = #CYSubTotal4A_J + #Pg2CYIR21Total
  Let #P1SubTotal4A_J = #P1SubTotal4A_J + #Pg2P1IR21Total

  Do Print-Amounts (56,63,0,#CYSubTotal4A_J)
  Do Print-Amounts (56,88,0,#P1SubTotal4A_J)

!  Add Other Income Subtotal to Total Income & print

  Let #CYTotal1_4 = #CYTotal1_4 + #Pg2CYIR21Total
  Let #P1Total1_4 = #P1Total1_4 + #Pg2P1IR21Total

  Do Print-Amounts (58,63,0,#CYTotal1_4)
  Do Print-Amounts (58,88,0,#P1Total1_4)

  Do Print-Amounts (63,63,0,&PIDS.GPSG_CPF_COMP_EE)
  Do Print-Amounts (63,88,0,&PIDS.GPSG_CPF_COMP_EE_1)

  print &PIDS.GPSG_PENS_FUND   (63,20)

  Do Print-Amounts (65,63,0,&PIDS.GPSG_8A_DONATIONS)
  Do Print-Amounts (65,88,0,&PIDS.GPSG_8A_DONATNS_1)

  Let $DonationStr  = ''
  Let $DonationStr1 = ''
  Let #TotSelected = 0
  if &PIDS.GPSG_8A_YMF_IND = 'Y'
     Let #TotSelected = 1
     Let $DonationStr = 'Mendaki Fund'
  end-if
  if &PIDS.GPSG_8A_CCHEST_IND = 'Y'
     if #TotSelected = 0
        Let $DonationStr = 'Com Chest'
        Let #TotSelected = 1
     else
        Let #TotSelected = #TotSelected +1
        Let $DonationStr = $DonationStr || '/Com Chest'
     End-if
  End-if
  Let #TotSelected = 0
  if &PIDS.GPSG_8A_SINDA_IND = 'Y'
     Let #TotSelected = 1
     Let $DonationStr1 = 'SINDA'
  End-if
  if &PIDS.GPSG_8A_CDAC_IND = 'Y'
     If #TotSelected = 0
        Let #TotSelected = 1
        Let $DonationStr1 = 'CDAC'
     else
        Let #TotSelected = #TotSelected + 1
        Let $DonationStr1 = $DonationStr1 || '/CDAC'
     end-if
   end-if
   if &PIDS.GPSG_8A_ECF_IND = 'Y'
     If #TotSelected = 0
        Let #TotSelected = 1
        Let $DonationStr1 = 'ECF'
     else
        Let #TotSelected = #TotSelected + 1
        Let $DonationStr1 = $DonationStr1 || '/ECF'
     end-if
   end-if
   if rtrim($DonationStr,' ') = ''
   
      print $DonationStr1   (66,20)
      graphic               (66,20,30) HORZ-LINE
   else
    let $DonationStr = $DonationStr ||'/'|| $DonationStr1
    print $DonationStr  (66,20)
    graphic                           (66,20,30) HORZ-LINE
   end-if

  Do Print-Amounts (66,63,0,&PIDS.GPSG_TOTAL_MBMF )
  Do Print-Amounts (66,88,0,&PIDS.GPSG_TOTAL_MBMF_1 )

  new-page

End-Procedure

!***********************************************************************
!  Procedure: Print-Page3-Values                                       *
!             Print values For Page 3                                  *
!***********************************************************************
begin-Procedure Print-Page3-Values

      Print $PrnName                     (10,22)
      Print $Nid                         (10,85)

      let $Address1 = &PA1S.GPSG_ADDRESS1
      let $Address2 = &PA1S.GPSG_ADDRESS2
      let $Address1 = $Address1||','||$Address2
      print $Address1                     (16,10)
      print &PA1S.GPSG_ADDRESS3           (17,10)

      print &PA1S.GPSG_AP8A_RES_FR       (19,65)   edit 'DD/MM/YYYY'
      print &PA1S.GPSG_AP8A_RES_FR_1     (19,95)  edit 'DD/MM/YYYY'

      print &PA1S.GPSG_AP8A_RES_TO       (20,65)   edit 'DD/MM/YYYY'
      print &PA1S.GPSG_AP8A_RES_TO_1     (20,95)  edit 'DD/MM/YYYY'

      print #CYDiffDays                  (23,70)   edit '999'
      print #P1DiffDays                  (23,100)  edit '999'

      print &PA1S.GPSG_AP8A_RES_SHR      (24,70)   edit '999'
      print &PA1S.GPSG_AP8A_RES_SH_1     (24,100)  edit '999'

      print #CY_EE_RENT         (26,65)   edit '99999999.99'
      print #P1_EE_RENT         (26,95)  edit '99999999.99'

      print #CY_ER_RENT        (27,65)   edit '99999999.99'
      print #P1_ER_RENT        (27,95)  edit '99999999.99'


      if rtrim(&PA1S.GPSG_AP8A_RES_FR,' ') <> ''
         print #CYTotalResidValue        (28,65)   edit '99999999.99'
      end-if

      if rtrim(&PA1S.GPSG_AP8A_RES_FR_1,' ') <> ''
         print #P1TotalResidValue        (28,95)  edit '99999999.99'
      end-if
      
      


! Current Year Figures

      print #CYFurniture              (40,39)  edit '99'
      print #CYRefrigerator           (41,35)  edit '99'
      print #CYVCR                    (41,43)  edit '99'
      print #CYWashMach               (43,33)  edit '99'
      print #CYDryer                  (43,38)  edit '99'
      print #CYDishWasher             (43,44)  edit '99'
      print #CYACUnit                 (45,39)  edit '99'
      print #CYACCentral              (46,35)  edit '99'
      print #CYACSitting              (46,43)  edit '99'
      Let #CYACAddl = #CYACAddl + #CYACBedroom
      print #CYACAddl                 (48,39)  edit '99'
      print #CYTV                     (49,32)  edit '99'
      print #CYRadio                  (49,35)  edit '99'
      print #CYAmp                    (49,39)  edit '99'
      print #CYHiFi                   (49,42)  edit '99'
      print #CYGuitar                 (49,45)  edit '99'
      print #CYComputer               (51,35)  edit '99'
      print #CYOrgan                  (51,43)  edit '99'
      print #CYPool                   (52,39)  edit '99'

      print #CYTotalFurniture         (40,65)  edit '99999999.99'
      print #CYTotalNo2               (41,65)  edit '99999999.99'
      print #CYTotalNo3               (43,65)  edit '99999999.99'
      print #CYTotalACUnit            (45,65)  edit '99999999.99'
      print #CYTotalNo8               (46,65)  edit '99999999.99'
      print #CYTotalNo8A              (48,65)  edit '99999999.99'
      print #CYTotalNo9               (49,65)  edit '99999999.99'
      print #CYTotalNo10              (51,65)  edit '99999999.99'
      print #CYTotalPool              (52,65)  edit '99999999.99'
      print #CYTotalNo11              (53,65)  edit '99999999.99'
      print #CYGrandTotal1            (56,65)  edit '99999999.99'
      print #CYTotalOthers            (59,65)  edit '99999999.99'
      print #CYDriver                 (61,65)  edit '99999999.99'
      print #CYGardener               (62,65)  edit '99999999.99'
      print #CYGrandTotal2            (64,65)  edit '99999999.99'

! Previous Year Year Figures

      print #P1TotalFurniture         (40,90)  edit '99999999.99'
      print #P1TotalNo2               (41,90)  edit '99999999.99'
      print #P1TotalNo3               (43,90)  edit '99999999.99'
      print #P1TotalACUnit            (45,90)  edit '99999999.99'
      print #P1TotalNo8               (46,90)  edit '99999999.99'
      print #P1TotalNo8A              (48,90)  edit '99999999.99'
      print #P1TotalNo9               (49,90)  edit '99999999.99'
      print #P1TotalNo10              (51,90)  edit '99999999.99'
      print #P1TotalPool              (52,90)  edit '99999999.99'
      print #P1TotalNo11              (53,90)  edit '99999999.99'
      print #P1GrandTotal1            (56,90)  edit '99999999.99'
      print #P1TotalOthers            (59,90)  edit '99999999.99'
      print #P1Driver                 (61,90)  edit '99999999.99'
      print #P1Gardener               (62,90)  edit '99999999.99'
      print #P1GrandTotal2            (64,90)  edit '99999999.99'

      new-page
End-Procedure

!***********************************************************************
!  Procedure: Print-Page4-Values                                       *
!             Print values For Page 4                                  *
!***********************************************************************
begin-Procedure Print-Page4-Values

      Print $PrnName      (7,22) BOLD
      Print $Nid          (7,85) BOLD

      print &PA1S.GPSG_AP8A_HTL_SLFN        (20,23) BOLD edit '99'
      print &PA1S.GPSG_AP8A_HTL_SLFD        (20,48) BOLD edit '999'

      print &PA1S.GPSG_AP8A_HTL_WIFN             (21,23) BOLD edit '99'
      print &PA1S.GPSG_AP8A_HTL_WIFD             (21,48) BOLD edit '999'

      print &PA1S.GPSG_AP8A_HTL_CH8N        (22,23) BOLD edit '99'
      print &PA1S.GPSG_AP8A_HTL_CH8D        (22,48) BOLD edit '999'

      print &PA1S.GPSG_AP8A_HTL_CH3N    (23,23) BOLD edit '99'
      print &PA1S.GPSG_AP8A_HTL_CH3D    (23,48) BOLD edit '999'

      print &PA1S.GPSG_AP8A_HTL_CH0N  (24,23) BOLD edit '99'
      print &PA1S.GPSG_AP8A_HTL_CH0D  (24,48) BOLD edit '999'

      print #CYAbv20Value        (20,68)   BOLD edit '9999999.99'
      print #P1Abv20Value        (20,97)  BOLD edit '9999999.99'

      print #CYWifeValue        (21,68)   BOLD edit '9999999.99'
      print #P1WifeValue        (21,97)  BOLD edit '9999999.99'

      print #CY8_20Value         (22,68)  BOLD edit '9999999.99'
      print #P18_20Value         (22,97)  BOLD edit '9999999.99'

      print #CY3_7Value          (23,68)  BOLD edit '9999999.99'
      print #P13_7Value          (23,97)  BOLD edit '9999999.99'

      print #CYLess3Value        (24,68)  BOLD edit '9999999.99'
      print #P1Less3Value        (24,97)  BOLD edit '9999999.99'

! Calculate 2% Basic Salary only if hotel accomodation was provided

      if  #CYAbv20Value <> 0 or #CYWifeValue <> 0 or #CY8_20Value <> 0 or #CY3_7Value <> 0 or #CYLess3Value <> 0
          print #CYPerc2Value    (25,68) BOLD edit '9999999.99'
          print #CYTotalc6       (26,68) BOLD edit '9999999.99'
      else
          print '0.00'             (25,74) BOLD
          print '0.00'             (26,74) BOLD
      End-if

      if  #P1Abv20Value <> 0 or #P1WifeValue <> 0 or #P18_20Value <> 0 or #P13_7Value <> 0 or #P1Less3Value <> 0
          print #P1Perc2Value    (25,97) BOLD edit '9999999.99'
          print  #P1Totalc6      (26,97) BOLD edit '9999999.99'
      else
         print '0.00'             (25,103) BOLD
         print '0.00'             (26,103) BOLD
      End-if

      print #CYHomeLeave          (30,68)  BOLD edit '9999999.99'
      print #P1HomeLeave          (30,97)  BOLD edit '9999999.99'

      if #CYHomeLeave > 0 or #P1HomeLeave > 0
         if &CO.GPSG_OHQ_STATUS = 'Y'
             print 'X'            (31,33)
         else
             print 'X'            (31,43)
         end-if
      end-if

      print #CYEmplrPdInt         (32,68)  BOLD edit '9999999.99'
      print #P1EmplrPdInt         (32,97)  BOLD edit '9999999.99'

      print #CYInsPremium         (37,68)  BOLD edit '9999999.99'
      print #P1InsPremium         (37,97)  BOLD edit '9999999.99'

      print #CYHolidayFare        (38,68)  BOLD edit '9999999.99'
      print #P1HolidayFare        (38,97)  BOLD edit '9999999.99'

      print #CYEducatnExp         (39,68)  BOLD edit '9999999.99'
      print #P1EducatnExp         (39,97)  BOLD edit '9999999.99'

      print #CYNonMonAward        (40,68)  BOLD edit '9999999.99'
      print #P1NonMonAward        (40,97)  BOLD edit '9999999.99'

      print #CYClubFees           (42,68)  BOLD edit '9999999.99'
      print #P1ClubFees           (42,97)  BOLD edit '9999999.99'

      print #CYAssetGain          (44,68)  BOLD edit '9999999.99'
      print #P1AssetGain          (44,97)  BOLD edit '9999999.99'

      print #CYVehicleCost        (46,68)  BOLD edit '9999999.99'
      print #P1VehicleCost        (46,97)  BOLD edit '9999999.99'

      print #CYCarBnft            (47,68)  BOLD edit '9999999.99'
      print #P1CarBnft            (47,97)  BOLD edit '9999999.99'

      print #CYOtherBnft          (48,68)  BOLD edit '9999999.99'
      print #P1OtherBnft          (48,97)  BOLD edit '9999999.99'

      let #CYTotalD = #CYHomeLeave + #CYEmplrPdInt + #CYInsPremium + #CYHolidayFare + #CYEducatnExp
                    + #CYNonMonAward + #CYClubFees + #CYAssetGain + #CYVehicleCost + #CYCarBnft + #CYOtherBnft

      let #P1TotalD = #P1HomeLeave + #P1EmplrPdInt + #P1InsPremium + #P1HolidayFare + #P1EducatnExp
                    + #P1NonMonAward + #P1ClubFees + #P1AssetGain + #P1VehicleCost + #P1CarBnft + #P1OtherBnft

      print #CYTotalD             (49,68)  BOLD edit '9999999.99'
      print #P1TotalD             (49,97)  BOLD edit '9999999.99'
      print #CYIR21Total          (51,66)  BOLD edit '999999999.99'
      print #P1IR21Total          (51,95)  BOLD edit '999999999.99'

      If #TaxYear < 2014
      Do Update-BIK-Value
          new-page
      end-if
End-Procedure

!***********************************************************************
!  Procedure: Get-Output-Directory                                     *
!***********************************************************************
begin-procedure Get-Output-Directory

Begin-Select
RQ.RUNLOCATION
OD.PRCSOUTPUTDIR
OD.OUTDEST
RQ.OUTDESTFORMAT

    let $OUTDESTFORMAT = rtrim(&RQ.OUTDESTFORMAT,' ')
    let $RUNLOCATION   = rtrim(&RQ.RUNLOCATION,' ')
    let $PRCSOUTPUTDIR = rtrim(&OD.PRCSOUTPUTDIR,' ')
    let $OUTDEST       = rtrim(&OD.OUTDEST,' ')
    let $Output_Directory = $PRCSOUTPUTDIR



FROM PSPRCSPARMS OD , PSPRCSRQST  RQ
WHERE OD.PRCSINSTANCE  = RQ.PRCSINSTANCE
AND   OD.PRCSINSTANCE  = #prcs_process_instance
End-Select



end-Procedure Get-Output-Directory

!***********************************************************************
!  Procedure: Prepare_Data                                             *
!             IR21 Appendix 2 - Gains/Profits from Stock Options       *
!***********************************************************************
begin-procedure Prepare-Data

  !Do Get-Output-Directory

  USE-REPORT Appendix2_Report

  let #row = 1
  alter-printer
     Font       = #StdFont
     Point-Size = 14

  print 'FORM IR21 - APPENDIX 2'                (#row,) CENTER bold

  alter-printer
     Font       = #StdFont
     Point-Size = #ChkPntSize

  add 1 to #row
  print 'It may take you 3 minutes to fill in this form. Please get ready the details of stock options etc. for the employee' (#row,2)
  Add 1 to #row
  graphic                                        (#row,1,{widthofpage3}) box 1 10
  !graphic                                        (#row,1,{widthofpage}) box 2

  let $Shadow_Text1 = 'Details of Gains and Profits from Employee Stock Options (ESOP) Plans/ Other Forms of Employee Share Ownership (ESOW) Plans Exercised/ Deemed Exercised for the year  ' || to_char(#TaxYear)
  print  $Shadow_Text1                           (#row,2) bold
  add 1 to #row
  graphic                                        (#row,1,{widthofpage3}) box 1 10
  alter-printer
     Font       = #StdFont
     Point-Size = 8

  !add 2 to #row
  alter-printer
     Font       = #StdFont
     Point-Size = #ChkPntSize

  print 'Employee''s Name:'                      (#row,2) bold
  print $PrnName                                 (#row,18)

  print 'FIN/NRIC No:'                           (#row,70) bold
  print $Tax_Ref_Type                            (#row,98)
  print $Nid                                     (#row,95)

  !add 1 to #row

  alter-printer
     Font       = #StdFont
     Point-Size = 7

  !add 1 to #row

  graphic                                        (#row,11,9) vert-line
  graphic                                        (#row,23,9) vert-line
  graphic                                        (#row,30,9) vert-line
  graphic                                        (#row,40,9) vert-line
  graphic                                        (#row,48,9) vert-line
  graphic                                        (#row,55,9) vert-line
  graphic                                        (#row,65,9) vert-line
  graphic                                        (#row,75,9) vert-line
  graphic                                        (#row,85,9) vert-line
  graphic                                        (#row,92,9) vert-line
  !graphic                                        (#row,119,8) vert-line 20

  add 1 to #row

  graphic                                        (#row,1,{widthofpage3}) box 10 10
  alter-printer
     Font       = #StdFont
     Point-Size = 8

  print 'Company'                                (#row,2)
  print 'Name of Company'                        (#row,12)
  print 'Type of'                                (#row,24)
  print 'Type of'                                (#row,31)
  print 'Date of'                                (#row,41)
  print 'Date of'                                (#row,49)
  print 'Exercise or'                            (#row,56)
  print 'Open Market'                            (#row,66)
  print 'Open Market'                            (#row,76)
  print 'Number'                                 (#row,86)
  print 'Gains from ESOP/ESOW Plans'             (#row,110)

  graphic                                        (#row,92,49) horz-line 7
  graphic                                        (#row,119,8) vert-line
  graphic                                        (#row,129,8) vert-line

  Add 1 to #row
  print 'Registration'                           (#row,2)
  print 'which granted the'                      (#row,12)
  print 'Plan'                                   (#row,24)
  print 'Exercise'                               (#row,31)
  print 'grant of'                               (#row,41)
  print 'Accrual* or'                            (#row,49)
  print 'Deemed Exercise'                        (#row,56)
  print 'Value per'                              (#row,66)
  print 'Value per'                              (#row,76)
  print 'of Shares'                              (#row,86)
  print 'Gross Amount Qualifying for Income Tax' (#row,93)
  print '*****Gross'                             (#row,120)
  print 'Gross Amount'                           (#row,130)

  Add 1 to #row
  print 'Number'                                 (#row,2)
  print 'ESOP/ESOW Plans.'                       (#row,12)
  print 'Granted'                                (#row,24)
  print '(To state:'                             (#row,31)
  print 'ESOP/'                                  (#row,41)
  print 'Deemed'                                 (#row,49)
  print 'Price of ESOP'                          (#row,56)
  print 'Share as at'                            (#row,66)
  print 'Share as at'                            (#row,76)
  print 'Acquired'                               (#row,86)
  print 'Exemption under :-'                     (#row,93)
  print 'Amount not'                             (#row,120)
  print 'of gains from'                          (#row,130)

  graphic                                        (#row,92,27) horz-line 7
  graphic                                        (#row,101,6) vert-line
  graphic                                        (#row,110,6) vert-line

  Add 1 to #row
  print '(To state:'                             (#row,24)
  print '1. Actual; or'                          (#row,31)
  print 'ESOW'                                   (#row,41)
  print 'Exercise'                               (#row,49)
  print 'or Price paid/'                         (#row,56)
  print 'the date of'                            (#row,66)
  print 'the date'                               (#row,76)
  print '**ERIS'                                 (#row,93)
  print '***ERIS'                                (#row,102)
  print '****ERIS'                               (#row,111)
  print 'Qualifying'                             (#row,120)
  print 'ESOP/ ESOW'                             (#row,130)

  Add 1 to #row
  print '1. ESOP; or'                            (#row,24)
  print '2.Deemed)'                              (#row,31)
  print 'plans'                                  (#row,41)
  print 'whichever is'                           (#row,49)
  print 'payable per'                            (#row,56)
  print 'Grant of'                               (#row,66)
  print 'Reflected at'                           (#row,76)
  print '(SMEs)'                                 (#row,93)
  print '(All corporations)'                     (#row,102)
  print '(Start-ups)'                            (#row,111)
  print 'for Tax'                                (#row,120)
  print 'Plans'                                  (#row,130)

  Add 1 to #row
  print '2.ESOW)'                                (#row,24)
  print 'applicable'                             (#row,49)
  print 'Share under'                            (#row,56)
  print 'ESOP/ESOW'                              (#row,66)
  print 'Column(d)'                              (#row,76)
  print 'Exemption'                              (#row,120)

  Add 1 to #row
  print 'ESOW plan'                              (#row,56)
  print 'Plan'                                   (#row,66)

  Add 1 to #row
  print '$'                                      (#row,56)
  print 'cts'                                    (#row,63)
  print '$'                                      (#row,66)
  print 'cts'                                    (#row,73)
  print '$'                                      (#row,76)
  print 'cts'                                    (#row,83)
  print '$'                                      (#row,93)
  print 'cts'                                    (#row,99)
  print '$'                                      (#row,102)
  print 'cts'                                    (#row,108)
  print '$'                                      (#row,111)
  print 'cts'                                    (#row,117)
  print '$'                                      (#row,120)
  print 'cts'                                    (#row,127)
  print '$'                                      (#row,130)
  print 'cts'                                    (#row,137)

  graphic                                        (#row,1,{widthofpage3}) horz-line 7
  Add 1 to #row
  print '(a)'                                    (#row,5)
  print '(b)'                                    (#row,17)
  print '(c1)'                                    (#row,27)
  !print '(c1)'                                   (#row,35)
  print '(c2)'                                   (#row,44)
  print '(d)'                                    (#row,50)
  print '(e)'                                    (#row,60)
  print '(f)'                                    (#row,70)
  print '(g)'                                    (#row,80)
  print '(h)'                                    (#row,88)
  print '(i)'                                    (#row,96)
  print '(j)'                                    (#row,105)
  print '(k)'                                    (#row,115)
  print '(l)'                                    (#row,124)
  print '(m)'                                    (#row,134)

  graphic                                        (#row,1,{widthofpage3}) horz-line
  add  1  to #row
  graphic                                        (#row,1,91) box 1 10 15
  graphic                                        (#row,1,{widthofpage3}) horz-line 7
  graphic                                        (#row,1,{widthofpage3}) box 1 10

!End-Procedure

!Begin-Procedure Print-Section-Esop

  print ' SECTION A: EMPLOYEE EQUITY-BASED REMUNERATION (EEBR) SCHEME' (#row,2) bold
  print '(l)=(g-e) x h'                          (#row,122,13)
  print '(m)=(l)'                                (#row,133,7)

  let #Esop_Row  =  #row
  graphic                                        (#row,92,27) box 7 0 15
  graphic                                        (#row,65,10)  box 7 0 15
  graphic                                        (#row,1,{widthofpage3})  horz-line
  graphic                                        (#row,1,6)   vert-line
  graphic                                        (#row,11,6)  vert-line
  graphic                                        (#row,23,6)  vert-line
  graphic                                        (#row,30,6)  vert-line
  graphic                                        (#row,40,6)  vert-line
  graphic                                        (#row,48,6)  vert-line
  graphic                                        (#row,55,6)  vert-line
  graphic                                        (#row,65,6)  vert-line
  graphic                                        (#row,75,6)  vert-line
  graphic                                        (#row,85,6)  vert-line
  graphic                                        (#row,92,6)  vert-line
  Subtract 1 from #row
  graphic                                        (#row,119,7) vert-line
  graphic                                        (#row,129,8) Vert-line
  graphic                                        (#row,129,12) box 8
  Add 1 to #row
  Let #i = 1
  If #Esop_Cnt <=6
        While #i <= 6
         graphic                       (#Row,1,64) box 1
         graphic                       (#Row,75,17) box 1
         graphic                       (#Row,119,22) box 1
         Add 1 to #i
         Add 1 to #row
        End-While
  End-If
   !Subtract 7 from #row
  !do Print-Esop
End-Procedure

Begin-Procedure Print-Section-Eesop
   let  #row = #Total_A_Row + 2

!***********************
! *Start of Section B  *
!***********************

  graphic                                         (#row,1,91) box 1 0 15
  print 'SECTION B: EQUITY REMUNERATION INCENTIVE SCHEME (ERIS) SMEs' (#row,2) BOLD
  print '(i) = (g-f) x h'                         (#row,94)
  print '(l) = (f-e) x h'                         (#row,122)
  print '(m) = (i) + (l)'                         (#row,132)

  let #Eesop_Row  =  #row
  graphic                                        (#row,101,18) box 7 0 15
  graphic                                         (#row,1,{widthofpage3}) box 1 10
  graphic                                        (#row,1,6)   vert-line
  graphic                                        (#row,11,6)  vert-line
  graphic                                        (#row,23,6)  vert-line
  graphic                                        (#row,30,6)  vert-line
  graphic                                        (#row,40,6)  vert-line
  graphic                                        (#row,48,6)  vert-line
  graphic                                        (#row,55,6)  vert-line
  graphic                                        (#row,65,6)  vert-line
  graphic                                        (#row,75,6)  vert-line
  graphic                                        (#row,85,6)  vert-line
  graphic                                        (#row,92,6)  vert-line
  Subtract 1 from #row
  graphic                                        (#row,101,7) vert-line
  graphic                                        (#row,119,7) vert-line
  graphic                                        (#row,129,8) Vert-line
  add  3 to #row
  Let #i = 1
  If #Eesop_Cnt <=6
        While #i < 6
            graphic                       (#Row,1,100) box 1
            graphic                       (#Row,119,22) box 1
            Add 1 to #i
            Add 1 to #row
        End-While
        let  #Total_B_Row  =  #row
   End-If
  Let $GPSG_IR21_EXR_TYP = ''
  Let $GPSG_IR21_EXER_TYP = ''

Begin-SELECT
I1.GPSG_8B_GRANT_DT
I1.GPSG_8B_MKT_VAL
I1.GPSG_8B_EXER_DT
I1.GPSG_8B_EXER_VAL
I1.GPSG_8B_EXER_PRICE
I1.GPSG_8B_SHARES_ACQ
I1.GPSG_8B_GROSS_GAIN
I1.GPSG_8B_EXEMPT_GN
I1.GPSG_8B_NONEXEMPT
I1.GPSG_8B_RCB_NUM
I1.GPSG_8B_STOCK_CPY
I1.GPSG_8B_STOCK_IND
I1.GPSG_8B_PLAN_IND
I1.GPSG_IR21_EXER_TYP

    Let $GPSG_8B_RCB_NUM      = &I1.GPSG_8B_RCB_NUM
    Let $GPSG_8B_STOCK_CPY    = &I1.GPSG_8B_STOCK_CPY
    Let $GPSG_8B_PLAN_IND     = &I1.GPSG_8B_PLAN_IND
    Let $GPSG_8B_GRANT_DT     = &I1.GPSG_8B_GRANT_DT
    Let $GPSG_8B_EXER_DT      = &I1.GPSG_8B_EXER_DT
    Let #GPSG_8B_EXER_PRICE   = &I1.GPSG_8B_EXER_PRICE
    Let #Exercise_Mkt_Val     = &I1.GPSG_8B_EXER_VAL
    Let #GPSG_8B_MKT_VAL      = &I1.GPSG_8B_MKT_VAL
    Let #GPSG_8B_SHARES_ACQ   = &I1.GPSG_8B_SHARES_ACQ
    Let #GPSG_8B_EXEMPT_GN    = &I1.GPSG_8B_EXEMPT_GN
    Let #GPSG_8B_NONEXEMPT    = &I1.GPSG_8B_NONEXEMPT
    Let #GPSG_8B_GROSS_GAIN   = &I1.GPSG_8B_GROSS_GAIN
    Let $GPSG_IR21_EXER_TYP   = &I1.GPSG_IR21_EXER_TYP

    If $GPSG_8B_PLAN_IND = '1'
        let $GPSG_8B_PLAN_TYPE = 'ESOP'
    Else
        let $GPSG_8B_PLAN_TYPE = 'ESOW'
    End-If

   evaluate $GPSG_IR21_EXER_TYP
     When = 'A'
      let $GPSG_IR21_EXR_TYP = 'Actual'
     Break
    When = 'D'
      let $GPSG_IR21_EXR_TYP = 'Deemed'
     Break
   End-Evaluate

    do Print-Eesop

FROM PS_GPSG_IR21_APP2  I1

WHERE I1.GPSG_TAX_YEAR = #TaxYear
  AND I1.EMPLID = $Emplid
  AND I1.BALANCE_GRP_NUM = $Bal_Grp
  AND I1.GPSG_CPY_TAX_REF = $Company_Tax_Ref
  AND I1.GPSG_8B_STOCK_IND = '2'
End-SELECT

  do Print-Total-Eesop


End-Procedure

Begin-Procedure Print-Section-Csop
    If #row > 55
        Add 1 to #PageNo
        new-page
        Let #row = 5
    Else
        let  #row = #Total_B_Row + 2
    End-If

  graphic                                         (#row,1,91) box 1 0 15
  print 'SECTION C: EQUITY REMUNERATION INCENTIVE SCHEME (ERIS) ALL CORPORATIONS' (#row,2) BOLD
  print '(j) = (g-f) x h'                         (#row,103)
  print '(l) = (f-e) x h'                         (#row,122)
  print '(m) = (j) + (l)'                         (#row,132)

  let #Csop_Row  =  #row
  graphic                                        (#row,92,9) box 7 0 15
  graphic                                        (#row,110,9) box 7 0 15
  graphic                                        (#row,1,{widthofpage3}) box 1 10
  graphic                                        (#row,1,6)   vert-line
  graphic                                        (#row,11,6)  vert-line
  graphic                                        (#row,23,6)  vert-line
  graphic                                        (#row,30,6)  vert-line
  graphic                                        (#row,40,6)  vert-line
  graphic                                        (#row,48,6)  vert-line
  graphic                                        (#row,55,6)  vert-line
  graphic                                        (#row,65,6)  vert-line
  graphic                                        (#row,75,6)  vert-line
  graphic                                        (#row,85,6)  vert-line
  graphic                                        (#row,92,6)  vert-line
  Subtract 1 from #row
  graphic                                        (#row,101,7) vert-line
  graphic                                        (#row,119,7) vert-line
  graphic                                        (#row,129,8) Vert-line
  add  3 to #row
  Let #i = 1
  If #Csop_Cnt <=6
        While #i < 6
            graphic                       (#Row,1,91)   box 1
            graphic                       (#row,101,9)  box 1
            graphic                       (#Row,119,22) box 1
            Add 1 to #i
            Add 1 to #row
        End-While
        let  #Total_C_Row  =  #row
   End-If
  Let $GPSG_IR21_EXR_TYP = ''
  Let $GPSG_IR21_EXER_TYP = ''

Begin-SELECT
I2.GPSG_8B_GRANT_DT
I2.GPSG_8B_MKT_VAL
I2.GPSG_8B_EXER_DT
I2.GPSG_8B_EXER_VAL
I2.GPSG_8B_EXER_PRICE
I2.GPSG_8B_SHARES_ACQ
I2.GPSG_8B_GROSS_GAIN
I2.GPSG_8B_EXEMPT_GN
I2.GPSG_8B_NONEXEMPT
I2.GPSG_8B_RCB_NUM
I2.GPSG_8B_STOCK_CPY
I2.GPSG_8B_STOCK_IND
I2.GPSG_8B_PLAN_IND
I2.GPSG_IR21_EXER_TYP

    Let $GPSG_8B_RCB_NUM      = &I2.GPSG_8B_RCB_NUM
    Let $GPSG_8B_STOCK_CPY    = &I2.GPSG_8B_STOCK_CPY
    Let $GPSG_8B_PLAN_IND     = &I2.GPSG_8B_PLAN_IND
    Let $GPSG_8B_GRANT_DT     = &I2.GPSG_8B_GRANT_DT
    Let $GPSG_8B_EXER_DT      = &I2.GPSG_8B_EXER_DT
    Let #GPSG_8B_EXER_PRICE   = &I2.GPSG_8B_EXER_PRICE
    Let #Exercise_Mkt_Val     = &I2.GPSG_8B_EXER_VAL
    Let #GPSG_8B_MKT_VAL      = &I2.GPSG_8B_MKT_VAL
    Let #GPSG_8B_SHARES_ACQ   = &I2.GPSG_8B_SHARES_ACQ
    Let #GPSG_8B_EXEMPT_GN    = &I2.GPSG_8B_EXEMPT_GN
    Let #GPSG_8B_NONEXEMPT    = &I2.GPSG_8B_NONEXEMPT
    Let #GPSG_8B_GROSS_GAIN   = &I2.GPSG_8B_GROSS_GAIN
    Let $GPSG_IR21_EXER_TYP   = &I2.GPSG_IR21_EXER_TYP

    If $GPSG_8B_PLAN_IND = '1'
        let $GPSG_8B_PLAN_TYPE = 'ESOP'
    Else
        let $GPSG_8B_PLAN_TYPE = 'ESOW'
    End-If

    evaluate $GPSG_IR21_EXER_TYP
    When = 'A'
    let $GPSG_IR21_EXR_TYP = 'Actual'
    Break
   When = 'D'
    let $GPSG_IR21_EXR_TYP = 'Deemed'
    Break
    End-Evaluate

    do Print-Csop

FROM PS_GPSG_IR21_APP2  I2

WHERE I2.GPSG_TAX_YEAR = #TaxYear
  AND I2.EMPLID = $Emplid
  AND I2.BALANCE_GRP_NUM = $Bal_Grp
  AND I2.GPSG_CPY_TAX_REF = $Company_Tax_Ref
  AND I2.GPSG_8B_STOCK_IND = '3'
End-SELECT

    do Print-Total-Csop

End-Procedure

Begin-Procedure Print-Section-Nsop
   If #row > 55
    new-page
    Let #row = 5
   Else
      let  #row = #Total_C_Row + 2
  End-If
  graphic                                         (#row,1,91) box 1 0 15
  print 'SECTION D: EQUITY REMUNERATION INCENTIVE SCHEME (ERIS) START-UPs' (#row,2) BOLD
  print '(k) = (g-f) x h'                         (#row,112)
  print '(l) = (f-e) x h'                         (#row,122)
  print '(m) = (k) + (l)'                         (#row,132)

  let #Nsop_Row  =  #row

  graphic                                        (#row,92,18) box 7 0 15
  graphic                                        (#row,1,{widthofpage3}) box 1 10
  graphic                                        (#row,1,6)   vert-line
  graphic                                        (#row,11,6)  vert-line
  graphic                                        (#row,23,6)  vert-line
  graphic                                        (#row,30,6)  vert-line
  graphic                                        (#row,40,6)  vert-line
  graphic                                        (#row,48,6)  vert-line
  graphic                                        (#row,55,6)  vert-line
  graphic                                        (#row,65,6)  vert-line
  graphic                                        (#row,75,6)  vert-line
  graphic                                        (#row,85,6)  vert-line
  graphic                                        (#row,92,6)  vert-line
  Subtract 1 from #row
  !graphic                                        (#row,101,7) vert-line
  graphic                                        (#row,119,7) vert-line
  graphic                                        (#row,129,8) Vert-line
  add  3 to #row
  Let #i = 1
  If #Nsop_Cnt <=6
        While #i < 6
            graphic                       (#Row,1,91)   box 1
            graphic                       (#row,110,31)  box 1
            Add 1 to #i
            Add 1 to #row
        End-While
        let  #Total_D_Row  =  #row
   End-If
  Let $GPSG_8B_RCB_NUM_D = ' '
  Let $GPSG_8B_STOCK_CPY_D = ' '
  Let $GPSG_IR21_EXER_TYP = ''

Begin-SELECT
I3.GPSG_8B_GRANT_DT
I3.GPSG_8B_MKT_VAL
I3.GPSG_8B_EXER_DT
I3.GPSG_8B_EXER_VAL
I3.GPSG_8B_EXER_PRICE
I3.GPSG_8B_SHARES_ACQ
I3.GPSG_8B_GROSS_GAIN
I3.GPSG_8B_EXEMPT_GN
I3.GPSG_8B_NONEXEMPT
I3.GPSG_8B_RCB_NUM
I3.GPSG_8B_STOCK_CPY
I3.GPSG_8B_STOCK_IND
I3.GPSG_8B_PLAN_IND
I3.GPSG_IR21_EXER_TYP

    Let $GPSG_8B_RCB_NUM      = &I3.GPSG_8B_RCB_NUM
    Let $GPSG_8B_STOCK_CPY    = &I3.GPSG_8B_STOCK_CPY
    Let $GPSG_8B_PLAN_IND     = &I3.GPSG_8B_PLAN_IND
    Let $GPSG_8B_GRANT_DT     = &I3.GPSG_8B_GRANT_DT
    Let $GPSG_8B_EXER_DT      = &I3.GPSG_8B_EXER_DT
    Let #GPSG_8B_EXER_PRICE   = &I3.GPSG_8B_EXER_PRICE
    Let #Exercise_Mkt_Val     = &I3.GPSG_8B_EXER_VAL
    Let #GPSG_8B_MKT_VAL      = &I3.GPSG_8B_MKT_VAL
    Let #GPSG_8B_SHARES_ACQ   = &I3.GPSG_8B_SHARES_ACQ
    Let #GPSG_8B_EXEMPT_GN    = &I3.GPSG_8B_EXEMPT_GN
    Let #GPSG_8B_NONEXEMPT    = &I3.GPSG_8B_NONEXEMPT
    Let #GPSG_8B_GROSS_GAIN   = &I3.GPSG_8B_GROSS_GAIN
    Let $GPSG_IR21_EXER_TYP   = &I3.GPSG_IR21_EXER_TYP

    If $GPSG_8B_PLAN_IND = '1'
        let $GPSG_8B_PLAN_TYPE = 'ESOP'
    Else
        let $GPSG_8B_PLAN_TYPE = 'ESOW'
    End-If

    evaluate $GPSG_IR21_EXER_TYP
    When = 'A'
     let $GPSG_IR21_EXR_TYP = 'Actual'
     Break
    When = 'D'
     let $GPSG_IR21_EXR_TYP = 'Deemed'
     Break
    End-Evaluate

    do Print-Nsop

FROM PS_GPSG_IR21_APP2  I3

WHERE I3.GPSG_TAX_YEAR = #TaxYear
  AND I3.EMPLID = $Emplid
  AND I3.BALANCE_GRP_NUM = $Bal_Grp
  AND I3.GPSG_CPY_TAX_REF = $Company_Tax_Ref
  AND I3.GPSG_8B_STOCK_IND = '4'
End-SELECT

    do Print-Total-Nsop

    Graphic                                                                  (#row,1,128) box 1 0 15
    Subtract 1 from #row
    Graphic                                                                  (#row,129,1) vert-line 10
    Add 1 to #row
    Graphic                                                                  (#row,1,{widthofpage3}) box 1 10
    print ' SECTION E: TOTAL GROSS AMOUNT OF ESOP/ ESOW GAINS (I+II+III+IV)' (#row,2) bold
    print '(THIS AMOUNT IS TO BE REFLECTED IN ITEM 4(i) OF FORM IR21)'       (#row,43) bold

    Add 2 to #row

    If #row > 55
      new-page
      Let #row = 5
    End-If
    Let $Footer1 = '*For actual exercise, state the date of Moratorium Lifted for ESOP/ ESOW Granted. If No Moratorium Imposed, state Exercise Date of ESOP/Vesting Date of ESOW Plan.'
    Let $Footer2 = '**ERIS (SMEs) - This is only applicable to gains derived from the exercise of ESOP granted on or after 1.6.2000/ restricted ESOW granted on or after 1 Jan 2002 by a qualifying company under the ERIS (SMEs)'
    Let $Footer3 = '***ERIS (ALL CORPORATIONs) - This is only applicable to gains derived from the exercise of ESOP granted on or after 1.4.2001/ restricted '
    Let $Footer3a = 'ESOW granted on or after 1.1.2002 by a qualifying company under the ERIS (ALL CORPORATIONS)'
    Let $Footer4 = '****ERIS (START-UPs) - This is only applicable to gains derived from the exercise of ESOP/ restricted '
    Let $Footer4a = 'ESOW granted on or after 16.2.2008 to 15.2.2013 and within 3 years of the qualifying company''s incorporation.'
    Let $Footer5 = '*****Including any amount of discount enjoyed by an employee on ESOP/ ESOW Plan.'
    Let $Footer6 = 'Please read the Explanatory Notes on Appendix 2.'
    print $Footer1                                          (#row,1)
    Add 1 to #row
    print $Footer2                                          (#row,1)
    print 'Please read the'                                 (#row,130)
    Add 1 to #row
    let $Footer3 = $Footer3 || ' ' ||$Footer3a
    print $Footer3                                          (#row,1)
    print 'Explanatory notes on'                            (#row,130)
    Add 1 to #row
    let $Footer4 = $Footer4 || ' ' ||$Footer4a
    print $Footer4                                          (#row,1)
    print 'Appendix 2'                                      (#row,130)
    Add 1 to #row
    print $Footer5                                          (#row,1)
    Add 1 to #Row
    !print $Footer6                                          (#row,1)
    !Add 1 to #row
    print 'DECLARATION'                                     (#row,1) bold
    Add 1 to #row
    print 'We certify that on the date of grant of ESOP/ ESOW plan, all the conditions (with reference to each respective scheme) stated in the Explanatory Notes on Appendix 2 had been met.' (#row,2) bold
    Add 2 to #row
    graphic                                                 (#row,1,30)   horz-line
    graphic                                                 (#row,35,30)  horz-line
    graphic                                                 (#row,70,20)  horz-line
    graphic                                                 (#row,95,10)  horz-line
    graphic                                                 (#row,110,30) horz-line

    print &CO.GPSG_CPY_SIGNATORY   (#row,2)
    print $Co_Designation          (#row,36)
    print $Incorp_dt               (#row,100)

    Add 1 to #row
    Print 'Full Name of Authorised Personnel'               (#row,5)
    Print 'Designation'                                     (#row,45)
    Print 'Signature'                                       (#row,78)
    Print 'Date'                                            (#row,97)
    Print 'Date of incorporation(For ERIS(Start-ups only)'  (#row,115)
    Add 2 to #row
    graphic                                                 (#row,1,30)   horz-line
    graphic                                                 (#row,35,30)  horz-line
    graphic                                                 (#row,70,20)  horz-line
    graphic                                                 (#row,95,20)  horz-line

    print $Co_Tax_Contact          (#row,2)
    print &CO.PHONE                (#row,36)
    print &CO.GPSG_FAX             (#row,72)
    print $Email_Add               (#row,96)

    Add 1 to #row
    print 'Name of Contact Person'                          (#row,7)
    print 'Contact No'                                      (#row,45)
    Print 'Fax'                                             (#row,80)
    Print 'Email Address'                                   (#row,100)

    Add 2 to #row
    Let $ftr3 = 'IRIN 112/A2-2/'
    Print $ftr3                        (#row,1)
    let $tempyr = to_char(#TaxYear)
    Print $tempyr (#row,8)
    Print 'Page 1 of 1'                                     (#row,) center
    !New-Page



End-Procedure


!***********************************************************************
!  Procedure: Print-Employee-Page5                                     *
!             The main procedure that selects the employees to print.  *
!***********************************************************************
begin-procedure Print-Employee-Page5

  let #Print-Header  = 1
  Let $GPSG_IR21_EXR_TYP = ''
  Let $GPSG_IR21_EXER_TYP = ''

begin-SELECT
I.GPSG_8B_GRANT_DT
I.GPSG_8B_MKT_VAL
I.GPSG_8B_EXER_DT
I.GPSG_8B_EXER_VAL
I.GPSG_8B_EXER_PRICE
I.GPSG_8B_SHARES_ACQ
I.GPSG_8B_GROSS_GAIN
I.GPSG_8B_EXEMPT_GN
I.GPSG_8B_NONEXEMPT
I.GPSG_8B_RCB_NUM
I.GPSG_8B_STOCK_CPY
I.GPSG_8B_STOCK_IND
I.GPSG_8B_PLAN_IND
I.GPSG_IR21_EXER_TYP


  let $GPSG_8B_RCB_NUM    =  &I.GPSG_8B_RCB_NUM
  let $GPSG_8B_STOCK_CPY  =  &I.GPSG_8B_STOCK_CPY
  LET $GPSG_8B_PLAN_IND  =   &I.GPSG_8B_PLAN_IND
  If $GPSG_8B_PLAN_IND = '1'
  let $GPSG_8B_PLAN_TYPE = 'ESOP'
  Let $GPSG_IR21_EXER_TYP   = &I.GPSG_IR21_EXER_TYP

    Evaluate $GPSG_IR21_EXER_TYP
     When = 'A'
     let $GPSG_IR21_EXR_TYP = 'Actual'
     Break
     When = 'D'
      let $GPSG_IR21_EXR_TYP = 'Deemed'
      Break
     End-Evaluate

  Else
    let $GPSG_8B_PLAN_TYPE = 'ESOW'
  End-If

  let $GPSG_8B_GRANT_DT   =  rtrim(&I.GPSG_8B_GRANT_DT, ' ')
  if  $GPSG_8B_GRANT_DT <> ''
    do Format-DateTime ($GPSG_8B_GRANT_DT, $GPSG_8B_GRANT_DT, {DEFDMY}, '', '')
  end-if

  let $GPSG_8B_EXER_DT   =  rtrim(&I.GPSG_8B_EXER_DT, ' ')
  if $GPSG_8B_EXER_DT = ''
    let $GPSG_8B_EXER_DT = 'NA'
  else
    do Format-DateTime ($GPSG_8B_EXER_DT, $GPSG_8B_EXER_DT, {DEFDMY}, '', '')
  end-if

  let #GPSG_8B_MKT_VAL    =  &I.GPSG_8B_MKT_VAL
  let #GPSG_8B_EXER_PRICE =  &I.GPSG_8B_EXER_PRICE
  let #Exercise_Mkt_Val   =  &I.GPSG_8B_EXER_VAL
  let #GPSG_8B_SHARES_ACQ =  &I.GPSG_8B_SHARES_ACQ
  let #GPSG_8B_EXEMPT_GN  =  &I.GPSG_8B_EXEMPT_GN
  let #GPSG_8B_NONEXEMPT  =  &I.GPSG_8B_NONEXEMPT
  let #GPSG_8B_GROSS_GAIN =  &I.GPSG_8B_GROSS_GAIN
  let $GPSG_8B_STOCK_IND  =  &I.GPSG_8B_STOCK_IND


  if #Print-Header = 1
     do Prepare-Data
     let #Print-Header = 0
  end-if

  if $GPSG_8B_STOCK_IND = '1'
     do Print-Esop
    ! if $GPSG_8B_STOCK_IND = '2'
    !   do Print-Eesop
    ! else
    !     do Print-Csop
    ! end-if
  end-if

FROM PS_GPSG_IR21_APP2  I

WHERE I.GPSG_TAX_YEAR = #TaxYear
  AND I.EMPLID = $Emplid
  AND I.BALANCE_GRP_NUM = $Bal_Grp
  AND I.GPSG_CPY_TAX_REF = $Company_Tax_Ref

end-SELECT

  if #Print-Header = 0
     do Totals-Print
     new-page
  end-if


end-procedure

!***********************************************************************
!  Procedure: Print-Esop                                               *
!             Print the detail records                                 *
!                                                                      *
!***********************************************************************
begin-procedure Print-Esop

  If  #ESop_Cnt  < 15
      let #Esop_Row = #Esop_Row + 1
      print $GPSG_8B_RCB_NUM              (#Esop_Row,2,10)   edit 'XXXXXXXXXX'
      print $GPSG_8B_STOCK_CPY            (#Esop_Row,12,35)
      print $GPSG_8B_PLAN_TYPE            (#Esop_Row,25,5)
      print $GPSG_IR21_EXR_TYP    (#Esop_Row,32,6)
      print $GPSG_8B_GRANT_DT             (#Esop_Row,41,11)
      print $GPSG_8B_EXER_DT              (#Esop_Row,48,11)
      print #GPSG_8B_EXER_PRICE           (#Esop_Row,56,14)  edit '9999999.99999'
      print #Exercise_Mkt_Val             (#Esop_Row,76,14)  edit '9999999.99999'
      print #GPSG_8B_SHARES_ACQ           (#Esop_Row,84,14)  edit '9999999.99999'
      print #GPSG_8B_NONEXEMPT            (#Esop_Row,120,11) edit '9999999.99'
      print #GPSG_8B_GROSS_GAIN           (#Esop_Row,132,11) edit '9999999.99'

      If #Esop_Cnt >= 6
            graphic                       (#Esop_Row,1,91) box 1
            graphic                       (#Esop_Row,119,22) box 1
            graphic                       (-1,11,1) vert-line
            graphic                       (,23,1) vert-line
            graphic                       (,30,1) vert-line
            graphic                       (,40,1) vert-line
            graphic                       (,48,1) vert-line
            graphic                       (,55,1) vert-line
            graphic                       (,65,1) vert-line
            graphic                       (,75,1) vert-line
            graphic                       (,85,1) vert-line
            graphic                       (,92,1) vert-line
            graphic                       (,119,1) vert-line
            graphic                       (,129,1) vert-line
            !Add 1 to #Esop_Row
            graphic                       (+1,92,27) box 1 0 15
            graphic                       (,65,10) box 1 0 15
            graphic                       (-1,65,1) vert-line
            graphic                       (,75,1) vert-line
      End-If

      let   #Tot_Esop_Nex  =  #Tot_Esop_Nex  + #GPSG_8B_NONEXEMPT
      let   #Tot_Esop_Gain =  #Tot_Esop_Gain + #GPSG_8B_GROSS_GAIN
      let #ESop_Cnt  =  #ESop_Cnt + 1

  end-if

end-Procedure

!***********************************************************************
!  Procedure: Print-Eesop                                              *
!             Print the detail records                                 *
!                                                                      *
!***********************************************************************
begin-procedure Print-Eesop


  If  #EeSop_Cnt  < 15
      let #Eesop_Row = #Eesop_Row + 1

      print $GPSG_8B_RCB_NUM              (#Eesop_Row,2,10)
      print $GPSG_8B_STOCK_CPY            (#Eesop_Row,12,35)
      print $GPSG_8B_PLAN_TYPE            (#Eesop_Row,25,5)
      print $GPSG_IR21_EXR_TYP     (#Eesop_Row,32,6)
      print $GPSG_8B_GRANT_DT             (#Eesop_Row,41,11)
      print $GPSG_8B_EXER_DT              (#Eesop_Row,48,11)
      print #GPSG_8B_EXER_PRICE           (#Eesop_Row,56,7) edit '999.99'
      print #GPSG_8B_MKT_VAL              (#Eesop_Row,66,7) edit '999.99'
      print #Exercise_Mkt_Val             (#Eesop_Row,76,7) edit '999.99'
      print #GPSG_8B_SHARES_ACQ           (#Eesop_Row,84,7) edit '9999999'
      print #GPSG_8B_EXEMPT_GN            (#Eesop_Row,93,11) edit '9999999.99'
      print #GPSG_8B_NONEXEMPT            (#Eesop_Row,120,11) edit '9999999.99'
      print #GPSG_8B_GROSS_GAIN           (#Eesop_Row,132,11) edit '9999999.99'

      If #Eesop_Cnt >= 6
            graphic                       (#Eesop_Row,1,100) box 1
            graphic                       (#Eesop_Row,119,22) box 1
            graphic                       (-1,11,1) vert-line
            graphic                       (,23,1) vert-line
            graphic                       (,30,1) vert-line
            graphic                       (,40,1) vert-line
            graphic                       (,48,1) vert-line
            graphic                       (,55,1) vert-line
            graphic                       (,65,1) vert-line
            graphic                       (,75,1) vert-line
            graphic                       (,85,1) vert-line
            graphic                       (,92,1) vert-line
            graphic                       (,119,1) vert-line
            graphic                       (,129,1) vert-line
            !Add 1 to #Eesop_Row
            graphic                       (+1,101,18) box 1 0 15
      End-If

      let   #Tot_Eesop_Ex   =  #Tot_Eesop_Ex   + #GPSG_8B_EXEMPT_GN
      let   #Tot_Eesop_Nex  =  #Tot_Eesop_Nex  + #GPSG_8B_NONEXEMPT
      let   #Tot_Eesop_Gain =  #Tot_Eesop_Gain + #GPSG_8B_GROSS_GAIN

      let #EEsop_Cnt  =  #EEsop_Cnt + 1
  end-if

end-Procedure

!***********************************************************************
!  Procedure: Print-Csop                                               *
!             Print the detail records                                 *
!                                                                      *
!***********************************************************************
begin-procedure Print-Csop


  If  #CSop_Cnt  < 15
      let #Csop_Row = #Csop_Row + 1

      print $GPSG_8B_RCB_NUM              (#Csop_Row,2,10)
      print $GPSG_8B_STOCK_CPY            (#Csop_Row,12,35)
      print $GPSG_8B_PLAN_TYPE            (#Csop_Row,25,5)
      print $GPSG_IR21_EXR_TYP     (#Csop_Row,32,6)
      print $GPSG_8B_GRANT_DT             (#Csop_Row,41,11)
      print $GPSG_8B_EXER_DT              (#Csop_Row,48,11)
      print #GPSG_8B_EXER_PRICE           (#Csop_Row,56,7) edit '999.99'
      print #GPSG_8B_MKT_VAL              (#Csop_Row,66,7) edit '999.99'
      print #Exercise_Mkt_Val             (#Csop_Row,76,7) edit '999.99'
      print #GPSG_8B_SHARES_ACQ           (#Csop_Row,84,7) edit '9999999'
      print #GPSG_8B_EXEMPT_GN            (#Csop_Row,102,11) edit '9999999.99'
      print #GPSG_8B_NONEXEMPT            (#Csop_Row,120,11) edit '9999999.99'
      print #GPSG_8B_GROSS_GAIN           (#Csop_Row,132,11) edit '9999999.99'

      If #Csop_Cnt >= 6
            graphic                       (#Csop_Row,1,91) box 1
            graphic                       (#Csop_Row,119,22) box 1
            graphic                       (#Csop_Row,101,9) box 1
            graphic                       (,92,9) box 1 0 15
            graphic                       (,110,9) box 1 0 15
            graphic                       (-1,11,1) vert-line
            graphic                       (,23,1) vert-line
            graphic                       (,30,1) vert-line
            graphic                       (,40,1) vert-line
            graphic                       (,48,1) vert-line
            graphic                       (,55,1) vert-line
            graphic                       (,65,1) vert-line
            graphic                       (,75,1) vert-line
            graphic                       (,85,1) vert-line
            graphic                       (,92,1) vert-line
            graphic                       (,119,1) vert-line
            graphic                       (,129,1) vert-line
           ! Add 1 to #Csop_Row

      End-If

      let   #Tot_Csop_Ex   =  #Tot_Csop_Ex   + #GPSG_8B_EXEMPT_GN
      let   #Tot_Csop_Nex  =  #Tot_Csop_Nex  + #GPSG_8B_NONEXEMPT
      let   #Tot_Csop_Gain =  #Tot_Csop_Gain + #GPSG_8B_GROSS_GAIN

      let #Csop_Cnt  =  #Csop_Cnt + 1
  end-if
end-Procedure

!***********************************************************************
!  Procedure: Print-Nsop                                               *
!             Print the detail records                                 *
!                                                                      *
!***********************************************************************
begin-procedure Print-Nsop


  If  #NSop_Cnt  < 15
      let #Nsop_Row = #Nsop_Row + 1

      print $GPSG_8B_RCB_NUM              (#Nsop_Row,2,10)
      print $GPSG_8B_STOCK_CPY            (#Nsop_Row,12,35)
      print $GPSG_8B_PLAN_TYPE            (#Nsop_Row,25,5)
      print $GPSG_IR21_EXR_TYP            (#Nsop_Row,32,6)
      print $GPSG_8B_GRANT_DT             (#Nsop_Row,41,11)
      print $GPSG_8B_EXER_DT              (#Nsop_Row,48,11)
      print #GPSG_8B_EXER_PRICE           (#Nsop_Row,56,7) edit '999.99'
      print #GPSG_8B_MKT_VAL              (#Nsop_Row,66,7) edit '999.99'
      print #Exercise_Mkt_Val             (#Nsop_Row,76,7) edit '999.99'
      print #GPSG_8B_SHARES_ACQ           (#Nsop_Row,84,7) edit '9999999'
      print #GPSG_8B_EXEMPT_GN            (#Nsop_Row,111,11) edit '9999999.99'
      print #GPSG_8B_NONEXEMPT            (#Nsop_Row,120,11) edit '9999999.99'
      print #GPSG_8B_GROSS_GAIN           (#Nsop_Row,132,11) edit '9999999.99'

      If #Nsop_Cnt >= 6
            graphic                       (#Nsop_Row,1,91) box 1
            graphic                       (#Nsop_Row,119,22) box 1
            graphic                       (,92,18) box 1 0 15
            graphic                       (-1,11,1) vert-line
            graphic                       (,23,1) vert-line
            graphic                       (,30,1) vert-line
            graphic                       (,40,1) vert-line
            graphic                       (,48,1) vert-line
            graphic                       (,55,1) vert-line
            graphic                       (,65,1) vert-line
            graphic                       (,75,1) vert-line
            graphic                       (,85,1) vert-line
            graphic                       (,92,1) vert-line
            graphic                       (,119,1) vert-line
            graphic                       (,129,1) vert-line
            !Add 1 to #Nsop_Row

      End-If

      let   #Tot_Nsop_Ex   =  #Tot_Nsop_Ex   + #GPSG_8B_EXEMPT_GN
      let   #Tot_Nsop_Nex  =  #Tot_Nsop_Nex  + #GPSG_8B_NONEXEMPT
      let   #Tot_Nsop_Gain =  #Tot_Nsop_Gain + #GPSG_8B_GROSS_GAIN

      let #Nsop_Cnt  =  #Nsop_Cnt + 1
  end-if
end-Procedure




!***********************************************************************
!  Procedure: Totals-Print                                             *
!             The main procedure to print the section totals.          *
!***********************************************************************
begin-procedure Totals-Print

  do Print-Total-Esop
  !do Print-Total-Eesop
  !do Print-Total-Csop

  let   #Tot_Esop_Nex   =  0
  let   #Tot_Esop_Gain  =  0

  let   #Tot_Eesop_Ex   =  0
  let   #Tot_Eesop_Nex  =  0
  let   #Tot_Eesop_Gain =  0

  let   #Tot_Csop_Ex    =  0
  let   #Tot_Csop_Nex   =  0
  let   #Tot_Csop_Gain  =  0

  let   #Tot_Nsop_Ex    =  0
  let   #Tot_Nsop_Nex   =  0
  let   #Tot_Nsop_Gain  =  0

  let   #Esop_Cnt  =  0
  let   #Eesop_Cnt =  0
  let   #Csop_Cnt  =  0
  let   #Nsop_Cnt  =  0

  Let   #PageNo = 1


end-procedure



!***********************************************************************
!  Procedure: Print-Total-Esop                                         *
!             Print the Total of Esop                                  *
!                                                                      *
!***********************************************************************
begin-procedure Print-Total-Esop
     If #Esop_Cnt > 6

         Let #Total_A_Row = #Esop_Row + 1
         print ' (I)'                                              (#Total_A_Row,2,4) bold
         print '      TOTAL OF GROSS ESOP/ESOW GAINS IN SECTION A' (#Total_A_Row,7) bold
         graphic                                                   (#Total_A_Row,92,27) box 1 0 15
         graphic                                                   (#Total_A_Row,92,27) box 1 10
         graphic                                                   (#Total_A_Row,1,{widthofpage3}) box 1 10
       Else
         Add 1 to #row
         print ' (I)'                                               (#row,2) bold
         print '      TOTAL OF GROSS ESOP/ESOW GAINS IN SECTION A' (#row,7) bold
         graphic                                                   (#row,92,27) box 1 0 15
         graphic                                                   (#row,92,27) box 1 10
         graphic                                                   (#row,1,{widthofpage3}) box 1 10
         Let #Total_A_Row = #row
      End-If

  print #Tot_Esop_Nex            (#Total_A_Row,120,11)  edit '9999999.99'
  print #Tot_Esop_Gain           (#Total_A_Row,132,11)  edit '9999999.99'
  Let #row = #Total_A_Row + 2

  do Print-Section-Eesop
end-Procedure

!***********************************************************************
!  Procedure: Print-Total-Eesop                                        *
!             Print the Total of Eesop                                 *
!                                                                      *
!***********************************************************************
begin-procedure Print-Total-Eesop

      If #Eesop_Cnt > 6

         Let #Total_B_Row = #Eesop_Row + 1
         print ' (II)'                                             (#Total_B_Row,2) bold
         print '      TOTAL OF GROSS ESOP/ESOW GAINS IN SECTION B' (#Total_B_Row,7) bold
         graphic                                                   (#Total_B_Row,101,18) box 1 0 15
         graphic                                                   (#Total_B_Row,92,27) box 1 10
         graphic                                                   (#Total_B_Row,1,{widthofpage3}) box 1 10
       Else
         print ' (II)'                                             (#row,2) bold
         print '      TOTAL OF GROSS ESOP/ESOW GAINS IN SECTION B' (#row,7) bold
         graphic                                                   (#row,101,18) box 1 0 15
         graphic                                                   (#row,92,27) box 1 10
         graphic                                                   (#row,1,{widthofpage3}) box 1 10
         Let #Total_B_Row = #row
       End-If

      print #Tot_Eesop_Ex            (#Total_B_Row,93,11) edit '9999999.99'
      print #Tot_Eesop_Nex           (#Total_B_Row,120,11) edit '9999999.99'
      print #Tot_Eesop_Gain          (#Total_B_Row,132,11) edit '9999999.99'
      Let #row = #Total_B_Row + 2

     do Print-Section-Csop
end-Procedure

!***********************************************************************
!  Procedure: Print-Total-Csop                                         *
!             Print the Total of Csop                                  *
!                                                                      *
!***********************************************************************
begin-procedure Print-Total-Csop

       If #Csop_Cnt > 6

         Let #Total_C_Row = #Csop_Row + 1
         print ' (III)'                                            (#Total_C_Row,2) bold
         print '      TOTAL OF GROSS ESOP/ESOW GAINS IN SECTION C' (#Total_C_Row,7) bold
         graphic                                                   (#Total_C_Row,92,9) box 1 0 15
         graphic                                                   (#Total_C_Row,110,9) box 1 0 15
         graphic                                                   (#Total_C_Row,92,27) box 1 10
         graphic                                                   (#Total_C_Row,1,{widthofpage3}) box 1 10
       Else
         print ' (III)'                                            (#row,2) bold
         print '      TOTAL OF GROSS ESOP/ESOW GAINS IN SECTION C' (#row,7) bold
         graphic                                                   (#row,92,9) box 1 0 15
         graphic                                                   (#row,110,9) box 1 0 15
         graphic                                                   (#row,92,27) box 1 10
         graphic                                                   (#row,1,{widthofpage3}) box 1 10
         Let #Total_C_Row = #row
      End-If


  print #Tot_Csop_Ex             (#Total_C_Row,102,11) edit '9999999.99'
  print #Tot_Csop_Nex            (#Total_C_Row,120,11) edit '9999999.99'
  print #Tot_Csop_Gain           (#Total_C_Row,132,11) edit '9999999.99'
  Let #row = #Total_C_Row + 2

  do Print-Section-Nsop

end-Procedure

!***********************************************************************
!  Procedure: Print-Total-Nsop                                         *
!             Print the Total of Nsop                                  *
!                                                                      *
!***********************************************************************
begin-procedure Print-Total-Nsop

       If #Nsop_Cnt > 6

         Let #Total_D_Row = #Nsop_Row + 1
         print ' (IV)'                                             (#Total_D_Row,2) bold
         print '      TOTAL OF GROSS ESOP/ESOW GAINS IN SECTION D' (#Total_D_Row,7) bold
         graphic                                                   (#Total_D_Row,92,18) box 1 0 15
         graphic                                                   (#Total_D_Row,92,27) box 1 10
         graphic                                                   (#Total_D_Row,1,{widthofpage3}) box 1 10
       Else
         print ' (IV)'                                             (#row,2) bold
         print '      TOTAL OF GROSS ESOP/ESOW GAINS IN SECTION D' (#row,7) bold
         graphic                                                   (#row,92,18) box 1 0 15
         graphic                                                   (#row,92,27) box 1 10
         graphic                                                   (#row,1,{widthofpage3}) box 1 10
         Let #Total_D_Row = #row
      End-If


  print #Tot_Nsop_Ex             (#Total_D_Row,111,11) edit '9999999.99'
  print #Tot_Nsop_Nex            (#Total_D_Row,120,11) edit '9999999.99'
  print #Tot_Nsop_Gain           (#Total_D_Row,132,11) edit '9999999.99'
  Let #row = #Total_D_Row + 2

  let #Grand_Tot_Gain  =  #Tot_Esop_Gain + #Tot_Eesop_Gain + #Tot_Csop_Gain + #Tot_Nsop_Gain
  let #Total_D_Row = #Total_D_Row + 2
  print #Grand_tot_Gain         (#Total_D_Row,132,11) edit '9999999.99'

 begin-sql

update PS_GPSG_IR21_DTL DT set DT.GPSG_8A_SHARE_GAIN = #Grand_tot_Gain
where DT.GPSG_CPY_TAX_REF = $Company_Tax_Ref
AND DT.GPSG_TAX_YEAR    = #TaxYear
AND DT.EMPLID           = $Emplid
  
end-sql

end-Procedure


!***********************************************************************
!  Procedure: Print-Comments                                           *
!             Print Explanatory Notes for completion of Appendix 8B    *
!                                                                      *
!***********************************************************************
Begin-Procedure Print-Comments

  alter-printer
     Font       = #StdFont
     Point-Size = 6

  Let #Row = #Row + 1
  let $Txt = '* EESOP - This is only applicable to gains derived from the exercise of stock options granted' ||
             ' on or after 1.6.2000 by a qualifying company under the Entrepreneurial Employee Stock Option Plan'
  print $Txt            (#row,1)

  add 1 to #row
  let $Txt ='** CSOP - This is only applicable to gains derived from the exercise of stock options granted' ||
            ' on or after 1.6.2000 under Company Stock Option Plan    *** Including any amount of discount' ||
            ' enjoyed by an employee on the stock options'
  print $Txt            (#row,1)


End-Procedure

!***********************************************************************
!  Procedure: Update-BIK-Value                                         *
!             Updated the Benefits in Kind Value into ir8a_form_sgp    *
!***********************************************************************
begin-procedure Update-BIK-Value

   let $sql-statement = 'PAY812SG.SQR,Update-Record,PS_GPSG_IR21_DTL'

  begin-SQL
     UPDATE PS_GPSG_IR21_DTL
        SET GPSG_8A_BIK   = #CYIR21Total,
            GPSG_8A_BIK_1 = #P1IR21Total

      WHERE EMPLID = $EmplId
        AND BALANCE_GRP_NUM  = $Bal_Grp
        AND GPSG_CPY_TAX_REF = $Company_Tax_Ref
        AND GPSG_TAX_YEAR    = #TaxYear
  end-SQL

end-Procedure

!***********************************************************************
!  Procedure: calc-diff-days                                           *
!             Calculate the difference between days                    *
!***********************************************************************
begin-procedure Calc-diff-days ($OccupFm_Dt, $OccupTo_Dt, :#DiffDays)

   Let #DiffDays = 0

   if rtrim($OccupFm_Dt,' ') <> ''
      Do Convert-To-DTU-Date($OccupFm_Dt, $OccupFrom)
   end-if

   if rtrim($OccupTo_Dt,' ') <> ''
      Let $OccupDT = $OccupTo_Dt

      Do Convert-To-DTU-Date($OccupTo_Dt, $OccupTo)

      Do Dtu-Diff-Days($OccupFrom, $OccupTo,#DiffDays)

      iF #DiffDays > 0
         Add 1 to #DiffDays
      end-if
      if #DiffDays > 366
         let #DiffDays = 366
      end-if
      if #DiffDays = 0
         let #DiffDays = 1
      end-if
   end-if

end-Procedure

!***********************************************************************
!  Procedure: Print-With-Gaps                                          *
!             Print values with specified gaps                         *
!***********************************************************************
begin-Procedure Print-With-Gaps (#PrtRow,#PrtCol,$CharValue,#PrtLen,#GapCount,$BOLD_Normal)

   Let $PrintValue = $CharValue

! If user has not specified any position, we will print all the values

  If #PrtLen = 0
     Let #PrtLen = length($PrintValue)
  end-if
  if #GapCount = 1
     if $Bold_Normal = 'B'
        print $PrintValue (#PrtRow,#PrtCol) BOLD
     else
        print $PrintValue (#PrtRow,#PrtCol)
     end-if
  else
     Let #LoopCount = 1
     While #LoopCount <= #PrtLen
           Let $CharPos = substr($PrintValue,#LoopCount,1)
           if $Bold_Normal = 'B'
              print $CharPos (#PrtRow,#PrtCol) BOLD
           else
              print $CharPos (#PrtRow,#PrtCol)
           end-if

           Add 1 to #LoopCount
           Add #GapCount to #PrtCol
     End-While
  end-if

End-Procedure

!***********************************************************************
!  Procedure: Load-Bnft-Code-Rate                                      *
!             Load the Benefit Code and Rates into Variables           *
!***********************************************************************
begin-Procedure Load-Bnft-Code-Rate

  BEGIN-SELECT
PAR.GPSG_BEN_TYP_U
PAR.GPSG_BEN_RATE &BnftRate
    if #PrcsYear = 0

       Evaluate &PAR.GPSG_BEN_TYP_U
          when = '001'
                 Let #CYRtFurniture      = &BnftRate
                 Let #CYRtAnFurniture    = #CYRtFurniture    * 12
          when = '002'
                 Let #CYRtRefrigerator   = &BnftRate
                 Let #CYRtAnRefrigerator = #CYRtRefrigerator * 12
           when = '003'
                 Let #CYRtVCR            = &BnftRate
                 Let #CYRtAnVCR          = #CYRtVCR          * 12
          when = '004'
                 Let #CYRtWashMach       = &BnftRate
                 Let #CYRtAnWashMach     = #CYRtWashMach     * 12
          when = '005'
                 Let #CYRtDryer          = &BnftRate
                 Let #CYRtAnDryer        = #CYRtDryer        * 12
          when = '006'
                 Let #CYRtDishWasher     = &BnftRate
                 Let #CYRtAnDishWasher   = #CYRtDishWasher   * 12
          when = '007'
                 Let #CYRtACUnit         = &BnftRate
                 Let #CYRtAnACUnit       = #CYRtACUnit       * 12
          when = '008'
                 Let #CYRtACCentral      = &BnftRate
                 Let #CYRtAnACCentral    = #CYRtACCentral    * 12
          when = '009'
                 Let #CYRtACSitting      = &BnftRate
                 Let #CYRtAnACSitting    = #CYRtACSitting    * 12
          when = '010'
                 Let #CYRtACAddl         = &BnftRate
                 Let #CYRtAnACAddl       = #CYRtACAddl       * 12
          when = '011'
                 Let #CYRtACBedroom      = &BnftRate
                 Let #CYRtAnACBedroom    = #CYRtACBedroom    * 12
          when = '012'
                 Let #CYRtTV             = &BnftRate
                 Let #CYRtAnTV           = #CYRtTV           * 12
          when = '013'
                 Let #CYRtRadio          = &BnftRate
                 Let #CYRtAnRadio        = #CYRtRadio        * 12
          when = '014'
                 Let #CYRtAmp            = &BnftRate
                 Let #CYRtAnAmp          = #CYRtAmp          * 12
          when = '015'
                 Let #CYRtHiFi           = &BnftRate
                 Let #CYRtAnHiFi         = #CYRtHiFi         * 12
          when = '016'
                 Let #CYRtGuitar         = &BnftRate
                 Let #CYRtAnGuitar       = #CYRtGuitar       * 12
          when = '017'
                 Let #CYRtComputer       = &BnftRate
                 Let #CYRtAnComputer     = #CYRtComputer     * 12
          when = '018'
                 Let #CYRtOrgan          = &BnftRate
                 Let #CYRtAnOrgan        = #CYRtOrgan        * 12
          when = '019'
                 Let #CYRtPool           = &BnftRate
                 Let #CYRtAnPool         = #CYRtPool         * 12
          when = '023'
                 Let #CYRtSuitCase       = &BnftRate
                 Let #CYAnSuitCase       = #CYRtSuitCase     * 12
          when = '024'
                 Let #CYRtGolf           = &BnftRate
                 Let #CYAnGolf           = #CYRtGolf         * 12
          when = '025'
                 Let #CYRtCamera         = &BnftRate
                 Let #CYAnCamera         = #CYRtCamera       * 12
          when = '030'
                 Let #CYRtFan            = &BnftRate
                 Let #CYRtAnFan          = #CYRtFan          * 12
          when = '031'
                 Let #CYRtAirCooler      = &BnftRate
                 Let #CYRtAnAirCooler    = #CYRtAirCooler    * 12
          when = '032'
                 Let #CYRtIron           = &BnftRate
                 Let #CYRtAnIron         = #CYRtIron         * 12
          when = '033'
                 Let #CYRtToaster        = &BnftRate
                 Let #CYRtAnToaster      = #CYRtToaster      * 12
          when = '035'
                 Let #CYRtVacuumCleaner  = &BnftRate
                 Let #CYRtAnVacuumCleaner= #CYRtVacuumCleaner* 12
          when = '036'
                 Let #CYRtJuicer         = &BnftRate
                 Let #CYRtAnJuicer       = #CYRtJuicer       * 12
          when = '037'
                 Let #CYRtBlender        = &BnftRate
                 Let #CYRtAnBlender      = #CYRtBlender      * 12
          when = '038'
                 Let #CYRtKettle         = &BnftRate
                 Let #CYRtAnKettle       = #CYRtKettle       * 12
          when = '039'
                 Let #CYRtCooker         = &BnftRate
                 Let #CYRtAnCooker       = #CYRtCooker       * 12
          when = '040'
                 Let #CYRtWaterHeater    = &BnftRate
                 Let #CYRtAnWaterHeater  = #CYRtWaterHeater  * 12
          when = '041'
                 Let #CYRtOven           = &BnftRate
                 Let #CYRtAnOven         = #CYRtOven         * 12
          when = '042'
                 Let #CYRtLightFit       = &BnftRate
                 Let #CYRtAnLightFit     = #CYRtLightFit     * 12
          when = '043'
                 Let #CYRtFloorPolish    = &BnftRate
                 Let #CYRtAnFloorPolish  = #CYRtFloorPolish  * 12
          when = '044'
                 Let #CYRtLawnMover      = &BnftRate
                 Let #CYRtAnLawnMover    = #CYRtLawnMover    * 12
          when = '056'
                 Let #CYRtAbv20Yrs       = &BnftRate
                 Let #CYRtAnAbv20Yrs     = &BnftRate       * 12
          when = '057'
                 Let #CYRtBet8_20Yrs     = &BnftRate
                 Let #CYRtAnBet8_20Yrs   = &BnftRate       * 12
          when = '058'
                 Let #CYRtBet3_7Yrs      = &BnftRate
                 Let #CYRtAnBet3_7yrs    = &BnftRate       * 12
          when = '059'
                 Let #CYRtLess3Yrs       = &BnftRate
                 Let #CYRtAnLess3Yrs     = &BnftRate        * 12
       End-Evaluate
    End-if

    if #PrcsYear = 1
       Evaluate &PAR.GPSG_BEN_TYP_U
          when = '001'
                 Let #P1RtFurniture    = &BnftRate
                 Let #P1AnFurniture    = #P1RtFurniture    * 12
          when = '002'
                 Let #P1RtRefrigerator = &BnftRate
                 Let #P1AnRefrigerator = #P1RtRefrigerator * 12
           when = '003'
                 Let #P1RtVCR          = &BnftRate
                 Let #P1AnVCR          = #P1RtVCR          * 12
          when = '004'
                 Let #P1RtWashMach     = &BnftRate
                 Let #P1AnWashMach     = #P1RtWashMach     * 12
          when = '005'
                 Let #P1RtDryer        = &BnftRate
                 Let #P1AnDryer        = #P1RtDryer        * 12
          when = '006'
                 Let #P1RtDishWasher   = &BnftRate
                 Let #P1AnDishWasher   = #P1RtDishWasher   * 12
          when = '007'
                 Let #P1RtACUnit       = &BnftRate
                 Let #P1AnACUnit       = #P1RtACUnit       * 12
          when = '008'
                 Let #P1RtACCentral    = &BnftRate
                 Let #P1AnACCentral    = #P1RtACCentral    * 12
          when = '009'
                 Let #P1RtACSitting    = &BnftRate
                 Let #P1AnACSitting    = #P1RtACSitting    * 12
          when = '010'
                 Let #P1RtACAddl       = &BnftRate
                 Let #P1AnACAddl       = #P1RtACAddl       * 12
          when = '011'
                 Let #P1RtACBedroom    = &BnftRate
                 Let #P1AnACBedroom    = #P1RtACBedroom    * 12
          when = '012'
                 Let #P1RtTV           = &BnftRate
                 Let #P1AnTV           = #P1RtTV           * 12
          when = '013'
                 Let #P1RtRadio        = &BnftRate
                 Let #P1AnRadio        = #P1RtRadio        * 12
          when = '014'
                 Let #P1RtAmp          = &BnftRate
                 Let #P1AnAmp          = #P1RtAmp          * 12
          when = '015'
                 Let #P1RtHiFi         = &BnftRate
                 Let #P1AnHiFi         = #P1RtHiFi         * 12
          when = '016'
                 Let #P1RtGuitar       = &BnftRate
                 Let #P1AnGuitar       = #P1RtGuitar       * 12
          when = '017'
                 Let #P1RtComputer     = &BnftRate
                 Let #P1AnComputer     = #P1RtComputer     * 12
          when = '018'
                 Let #P1RtOrgan        = &BnftRate
                 Let #P1AnOrgan        = #P1RtOrgan        * 12
          when = '019'
                 Let #P1RtPool         = &BnftRate
                 Let #P1AnPool         = #P1RtPool         * 12
          when = '023'
                 Let #P1RtSuitCase     = &BnftRate
                 Let #P1AnSuitCase     = #P1RtSuitCase     * 12
          when = '024'
                 Let #P1RtGolf         = &BnftRate
                 Let #P1AnGolf         = #P1RtGolf         * 12
          when = '025'
                 Let #P1RtCamera       = &BnftRate
                 Let #P1AnCamera       = #P1RtCamera       * 12
          when = '030'
                 Let #P1RtFan          = &BnftRate
                 Let #P1AnFan          = #P1RtFan          * 12
          when = '031'
                 Let #P1RtAirCooler    = &BnftRate
                 Let #P1AnAirCooler    = #P1RtAirCooler    * 12
          when = '032'
                 Let #P1RtIron         = &BnftRate
                 Let #P1AnIron         = #P1RtIron         * 12
          when = '033'
                 Let #P1RtToaster      = &BnftRate
                 Let #P1AnToaster      = #P1RtToaster      * 12
          when = '035'
                 Let #P1RtVacuumCleaner= &BnftRate
                 Let #P1AnVacuumCleaner= #P1RtVacuumCleaner* 12
          when = '036'
                 Let #P1RtJuicer       = &BnftRate
                 Let #P1AnJuicer       = #P1RtJuicer       * 12
          when = '037'
                 Let #P1RtBlender      = &BnftRate
                 Let #P1AnBlender      = #P1RtBlender      * 12
          when = '038'
                 Let #P1RtKettle       = &BnftRate
                 Let #P1AnKettle       = #P1RtKettle       * 12
          when = '039'
                 Let #P1RtCooker       = &BnftRate
                 Let #P1AnCooker       = #P1RtCooker       * 12
          when = '040'
                 Let #P1RtWaterHeater  = &BnftRate
                 Let #P1AnWaterHeater  = #P1RtWaterHeater  * 12
          when = '041'
                 Let #P1RtOven         = &BnftRate
                 Let #P1AnOven         = #P1RtOven         * 12
          when = '042'
                 Let #P1RtLightFit     = &BnftRate
                 Let #P1AnLightFit     = #P1RtLightFit     * 12
          when = '043'
                 Let #P1RtFloorPolish  = &BnftRate
                 Let #P1AnFloorPolish  = #P1RtFloorPolish  * 12
          when = '044'
                 Let #P1RtLawnMover    = &BnftRate
                 Let #P1AnLawnMover    = #P1RtLawnMover    * 12
          when = '056'
                 Let #P1RtAbv20Yrs     = &BnftRate
                 Let #P1RtAnAbv20Yrs   = &BnftRate       * 12
          when = '057'
                 Let #P1RtBet8_20Yrs   = &BnftRate
                 Let #P1RtAnBet8_20Yrs = &BnftRate       * 12
          when = '058'
                 Let #P1RtBet3_7Yrs    = &BnftRate
                 Let #P1RtAnBet3_7yrs  = &BnftRate       * 12
          when = '059'
                 Let #P1RtLess3Yrs     = &BnftRate
                 Let #P1RtAnLess3Yrs   = &BnftRate        * 12
       End-Evaluate
    End-if

  FROM PS_GPSG_APP_RATE PAR
   WHERE PAR.EFFDT = (SELECT MAX(PAR1.EFFDT)
                        FROM PS_GPSG_APP_RATE PAR1
                       WHERE PAR1.GPSG_BEN_TYP_U = PAR.GPSG_BEN_TYP_U
                         AND PAR1.EFFDT         <= $CalcToDt)
  END-SELECT

end-Procedure

!***********************************************
!Procedure:     Print-Amounts
!               Print Amounts in a formatted manner (inside boxes).
!***********************************************
Begin-Procedure Print-Amounts (#Print_Row,#Print_Col,#Print_Cent_Col,#Print_Amount)

      if #Print_Amount <> 0
         Let #Prn_Unit = trunc(#Print_Amount,0)
         Let #Prn_Cent = #Print_Amount - #Prn_Unit
         Let #Prn_Cent = #Prn_Cent * 100

         Let $Prn_Unit = edit(#Prn_Unit,'999999999999')
         Let $Prn_Cent = edit(#Prn_Cent,'09')

         Let $Prn_Unit = ltrim($Prn_Unit,' ')
         Let $Prn_Unit = rtrim($Prn_Unit,' ')

         Let $Prn_Unit = lpad($Prn_Unit,#_AmountLen,' ')

         Let $Prn_Cent = ltrim($Prn_Cent,' ')

         do Print-With-Gaps (#Print_Row,#Print_Col ,$Prn_Unit,0,#_GapValue,'B')

         if #Print_Cent_Col <> 0
            do Print-With-Gaps (#Print_Row,#Print_Cent_Col ,$Prn_Cent,0,2,'B')
         End-if
     End-if

End-Procedure

!***********************************************************************
!  Procedure: S-Parameters                                        *
!             Retrieve Run Control Parameters                          *
!***********************************************************************
begin-procedure S-Parameters

Begin-SELECT
SP.GPSG_CPY_TAX_REF
SP.GP_PAYGROUP
SP.GPSG_TAX_YEAR
SP.GPSG_CREATE_DATE

   FROM PS_GPSG_RC_IRAS SP
  WHERE SP.OPRID       = $Prcs_OprID
    AND SP.RUN_CNTL_ID = $Prcs_Run_Cntl_ID

   End-SELECT

   Let $Company_Tax_Ref    = rtrim(&SP.GPSG_CPY_TAX_REF,' ')
   Let $Paygroup   = rtrim(&SP.GP_PAYGROUP,' ')

   Let $Create_Date = rtrim(&SP.GPSG_CREATE_DATE, ' ')

   Let #TaxYear    = &SP.GPSG_TAX_YEAR
   Let $TaxYear    = EDIT(#TaxYear,'9999')

   let $PrcsFromDt = '01/01/' || $TaxYear

   do Format-DateTime($PrcsFromDt, $PrcsFromDt, {DEFDMY}, '', 'native')
   let $PrcsToDt   = '31/12/'|| $TaxYear
   do Format-DateTime($PrcsToDt, $PrcsToDt, {DEFDMY}, '', 'native')

   Let $InDate1 = $Taxyear || '0101'
   Let $InDate2 = $Taxyear || '1231'
   Do Count-LeapDays ($indate1,$indate2,#CYLeapdays)
   if #CYLeapdays = 0
      Let #CYDivYear = 365
   else
      Let #CYDivYear = 366
   end-if

End-Procedure

!***********************************************************************
! Procedure: Update-Issue-Status                                       *
!            Once the group certs are printed the group cert record is *
!            updated for on line reference whether printed or not.     *
!***********************************************************************
begin-procedure Update-Issue-Status

   let $sql-statement = 'PAY821SG.SQR,Update-Record,PS_GPSG_IR21_HDR'

   begin-SQL
      UPDATE PS_GPSG_IR21_HDR
         SET GPSG_8A_STATUS = 'Y'

       WHERE EMPLID = $Emplid
         AND BALANCE_GRP_NUM = $Bal_Grp
         AND GPSG_TAX_YEAR  = #TaxYear
         AND GPSG_CPY_TAX_REF = $Company_Tax_Ref
   end-SQL

   begin-SQL
      UPDATE PS_GPSG_IR21_APP1
         SET GPSG_AP8A_RES_VAL  = #CYTotalResidValue,
             GPSG_AP8A_RES_VL_1 = #P1TotalResidValue

       WHERE EMPLID           = $Emplid
         AND BALANCE_GRP_NUM  = $Bal_Grp
         AND GPSG_TAX_YEAR    = #TaxYear
         AND GPSG_CPY_TAX_REF = $Company_Tax_Ref
   end-SQL

end-procedure

!***********************************************************************
! Procedure: Select-Appendix3                                           *
!***********************************************************************
Begin-Procedure Select-Appendix3
Begin-Select Distinct
IRAPP3.EMPLID
   DO Print-Appendix3

FROM PS_GPSG_IR21_APP3 IRAPP3
WHERE IRAPP3.GPSG_TAX_YEAR = #TaxYear
  AND IRAPP3.EMPLID = $Emplid
  AND IRAPP3.BALANCE_GRP_NUM = $Bal_Grp
  AND IRAPP3.GPSG_CPY_TAX_REF = $Company_Tax_Ref
End-Select

End-Procedure

!***********************************************************************
! Procedure: Print Appendix3                                           *
!***********************************************************************
Begin-Procedure Print-Appendix3
   USE-REPORT Appendix3_Report
   if $Prev_Emplid <> ''
     new-page
   end-if
    let #row = 3 
   Alter-Printer
     Font = #StdFont
  Point-Size = 15

    print 'FORM IR21 - APPENDIX 3'                (#row,) CENTER bold
    add 2 to #row
   alter-printer
    Font = #StdFont
     Point-Size = 13
    print 'DETAILS OF UNEXERCISED OR RESTRICTED EMPLOYEE STOCK OPTION (ESOP) PLANS OR UNVESTED OR RESTRICTED SHARES UNDER OTHER FORMS' (#row,4) bold
    add 1 to #row
    print 'OF EMPLOYEE SHARE OWNERSHIP (ESOW) PLANS AS AT DATE OF CESSATION OF EMPLOYMENT/ DEPARTURE FROM SINGAPORE AND WOULD BE' (#row,6) bold 
    add 1 to #row
    print 'TRACKED BY EMPLOYER' (#row,) bold center
!print 'SINGAPORE AND WOULD BE TRACKED BY EMPLOYER'(#row,) CENTER bold
    add 3 to #row
   alter-printer
    Font       = #StdFont
   Point-Size = 12
   print 'This form is to be completed if the employer has been granted approval for the tracking option. It may take 2 minutes to fill in this form. Please get ready the details of stock options etc. for the employee.'(#row,1)
  
   add 3 to #row
    print 'Tax ref. (FIN / NRIC ):'    (#row,1) bold
   print $Nid     (#row,18)
  print 'Name of Employee:'    (#row,50) bold
  print $PrnName     (#row, 65)
  
   graphic    (#row,18,25)  horz-line
   graphic     (#row,65,25)  horz-line
   add 2 to #row
   graphic    (#row,1,140) box 39 6
    Subtract 1 from #row 

    graphic   (#row,14,12) vert-line
    graphic   (#row,36,12) vert-line
    graphic   (#row,48,12) vert-line
    graphic    (#row,64,12) vert-line
    graphic    (#row,80,12) vert-line
    graphic    (#row,96,12) vert-line
    graphic    (#row,112,12) vert-line
    graphic    (#row,128,12) vert-line
!Date of expiry of exercise of ESOP or date of vesting of ESOW Plan or date moratorium is lifted, as the case may be  
add 2 to #row

print 'Company'                        (#row,2)
print 'Name of Company which'          (#row,15)
print 'Indicate type of'                 (#row,37)
print 'Date of grant Of'                  (#row,49)
print 'Open Market value'                (#row,65)
print 'Market Value at'                  (#row,81)
print 'Exercise Price of '               (#row,97)
print 'No. of unexercised'               (#row,113)
print 'Date of expiry '                   (#row,129)

Add 1 to #row

print 'Registration'                     (#row,2)
print 'granted the ESOP/shares'           (#row,15)
print 'plan granted '                     (#row,37)
print 'ESOP/'            (#row,49)
print 'per share as at the'             (#row,65)
print 'time of deemed'        (#row,81)
print 'ESOP/ or Price paid/'          (#row,97)
print 'ESOP or unvested'            (#row,113)
print 'of exercise of '       (#row,129)



Add 1 to #row
print 'Number'                      (#row,2)
print 'under ESOW plan'            (#row,15)
print '1) ESOP'                     (#row,37)
print 'Shares under'                 (#row,49)
print 'date of grant of '            (#row,65)
print 'Exercise of ESOP or'          (#row,81)
print 'payable per share'            (#row,97)
print 'shares under'                 (#row,113)
print 'ESOP or date '                (#row,129)

Add 1 to #row
print 'or'                     (#row,37)
print 'ESOW Plan'                (#row,49)
print 'ESOP/shares under'   (#row,65)
print 'Deemed price'        (#row,81)
print 'under ESOW Plan ($)'        (#row,97)
print 'ESOW Plans or '         (#row,113)
print 'of vesting of'   (#row,129)

Add 1 to #row
print '2) ESOW'      (#row,37)
print 'ESOW Plan ($)'    (#row,65) 
print 'paid for shares under'     (#row,81)
print 'ESOP/ ESOW '    (#row,113)
print ' ESOW Plan or'   (#row,129)

Add 1 to #row
print ' ESOW Plan ($)'    (#row,81)
print 'Plans with'      (#row,113)
print 'date moratorium'    (#row,129)
  
Add 1 to #row
print 'moratorium imposed'    (#row,113)
print 'is lifted, as the'     (#row,129)
  
Add 1 to #row
print 'case may be'    (#row,129)   
  
Add 1 to #row
print '.' (#row,1,336) fill

alter-printer
Font       = #StdFont
Point-Size = 10
Add 1 to #row

print '(a)'   (#row,6)
print '(b)'   (#row,24)
print '(c)'    (#row,41)
print '(d)'   (#row,55)
print '(e)'    (#row,71)
print '(f)'    (#row,87)
print '(g)'    (#row,103)
print '(h)'    (#row,119)
print '(i)'    (#row,134)


graphic   (#row,1,140) horz-line 6

Add 1 to #row
graphic   (#row,1,140) box 2 3 6
Add 1 to #row
   alter-printer
   Font       = #StdFont
   Point-Size = 12
print 'SECTION A: EMPLOYEE EQUITY-BASED REMUNERATION (EEBR) SCHEME' (#row,2) bold


graphic                                         (#row,14,4) vert-line
graphic                                         (#row,36,4) vert-line
graphic                                         (#row,48,4) vert-line
graphic                                         (#row,64,4) vert-line
graphic                                         (#row,80,4) vert-line
graphic                                         (#row,96,4) vert-line
graphic                                         (#row,112,4) vert-line
graphic                                         (#row,128,4) vert-line


Let #app3_stock_count = 1


do sect1-app3-data 


if  #app3_cnt > 4
let #app3_cnt = 4
end-if

evaluate #app3_cnt

when < 1    
Add 1 to #row
graphic                                         (#row,1,140) horz-line 6
Add 1 to #row
graphic                                         (#row,1,140) horz-line 6
Add 1 to #row
graphic  (#row,1,140) horz-line 6
break

when = 1
Add 1 to #row
graphic      (#row,1,140) horz-line 6
Add 1 to #row
graphic     (#row,1,140) horz-line 6
break

when = 2
Add 1 to #row
graphic     (#row,1,140) horz-line 6
break

end-evaluate

if #app3_cnt > 3
add 1 to #row
else
add 2 to #row
end-if
graphic     (#row,1,140) box 2 3 6

Add 1 to #row

print 'SECTION B: EQUITY REMUNERATION INCENTIVE SCHEME (ERIS) SMEs' (#row,2) bold


graphic                                         (#row,14,4) vert-line
graphic                                         (#row,36,4) vert-line
graphic                                         (#row,48,4) vert-line
graphic                                         (#row,64,4) vert-line
graphic                                         (#row,80,4) vert-line
graphic                                         (#row,96,4) vert-line
graphic                                         (#row,112,4) vert-line
graphic                                         (#row,128,4) vert-line


Let #app3_stock_count = 2


do sect1-app3-data 


if  #app3_cnt > 4
let #app3_cnt = 4
end-if

evaluate #app3_cnt

when < 1    
Add 1 to #row
graphic                                         (#row,1,140) horz-line 6
Add 1 to #row
graphic                                         (#row,1,140) horz-line 6
Add 1 to #row
graphic     (#row,1,140) horz-line 6
break

when = 1
Add 1 to #row
graphic                                         (#row,1,140) horz-line 6
Add 1 to #row
graphic                                         (#row,1,140) horz-line 6
break

when = 2
Add 1 to #row
graphic                                         (#row,1,140) horz-line 6
break

end-evaluate

if #app3_cnt > 3
add 1 to #row
else
add 2 to #row
end-if
graphic                                         (#row,1,140) box 2 3 6

Add 1 to #row

print 'SECTION C: EQUITY REMUNERATION INCENTIVE SCHEME (ERIS) ALL CORPORATIONS' (#row,2) bold


graphic                                         (#row,14,3) vert-line
graphic                                         (#row,36,3) vert-line
graphic                                         (#row,48,3) vert-line
graphic                                         (#row,64,3) vert-line
graphic                                         (#row,80,3) vert-line
graphic                                         (#row,96,3) vert-line
graphic                                         (#row,112,3) vert-line
graphic                                         (#row,128,3) vert-line


Let #app3_stock_count = 3


do sect1-app3-data 


if  #app3_cnt > 3
let #app3_cnt = 3
end-if

evaluate #app3_cnt

when < 1    
Add 1 to #row
graphic                                         (#row,1,140) horz-line 6
Add 1 to #row
graphic                                         (#row,1,140) horz-line 6
break

when = 1
Add 1 to #row
graphic                                         (#row,1,140) horz-line 6
break

end-evaluate

if #app3_cnt > 2
add 1 to #row
else
add 2 to #row
end-if
graphic                                         (#row,1,140) box 2 3 6
Add 1 to #row
print 'SECTION D: EQUITY REMUNERATION INCENTIVE SCHEME (ERIS) START-UPS' (#row,2) bold


graphic                                         (#row,14,5) vert-line
graphic                                         (#row,36,5) vert-line
graphic                                         (#row,48,5) vert-line
graphic                                         (#row,64,5) vert-line
graphic                                         (#row,80,5) vert-line
graphic                                         (#row,96,5) vert-line
graphic                                         (#row,112,5) vert-line
graphic                                         (#row,128,5) vert-line


Let #app3_stock_count = 4


do sect1-app3-data 


if  #app3_cnt > 5
let #app3_cnt = 5
end-if

evaluate #app3_cnt

when < 1    
Add 1 to #row
graphic                                         (#row,1,140) horz-line 6
Add 1 to #row
graphic                                         (#row,1,140) horz-line 6
Add 1 to #row
graphic     (#row,1,140) horz-line 6
Add 1 to #row
graphic   (#row,1,140) horz-line 6
Add 1 to #row
graphic (#row,1,140) horz-line 6
break

when = 1
Add 1 to #row
graphic                                         (#row,1,140) horz-line 6
Add 1 to #row
graphic                                         (#row,1,140) horz-line 6
Add 1 to #row
graphic                                         (#row,1,140) horz-line 6
Add 1 to #row
graphic                                         (#row,1,140) horz-line 6
break

when = 2
Add 1 to #row
graphic                                         (#row,1,140) horz-line 6
Add 1 to #row
graphic                                         (#row,1,140) horz-line 6
Add 1 to #row
graphic                                         (#row,1,140) horz-line 6
break

when = 3
Add 1 to #row
graphic                                         (#row,1,140) horz-line 6
Add 1 to #row
graphic                                         (#row,1,140) horz-line 6
break
End-Evaluate



Add 2 to #row

print 'REMARKS:'    (#row,2) bold
PRINT &APP3.GPSG_8B_REMARKS   (#row,12) wrap 100 2

    alter-printer
    Font       = #StdFont
    Point-Size = 10
Add 4 to #row
print 'Full Name of Authorised Personnel:'   (#row,2) 
print &CO.GPSG_CPY_SIGNATORY     (#row,24)
graphic    (#row,24,30)  horz-line
print 'Designation:'      (#row,58)
print $Co_Designation                           (#row,67)
graphic    (#row,67,20)  horz-line
print 'Signature: '   (#row,89)
graphic    (#row,97,15)  horz-line
print 'Date:'     (#row,116)
graphic    (#row,120,11)  horz-line

Add 2 to #row
print 'Name of Contact Person:'   (#row,2) 
print $Co_Tax_Contact     (#row,18)
graphic    (#row,18,25)  horz-line
print 'Contact No.:'   (#row,45)
print &CO.PHONE     (#row,54)
graphic   (#row,54,13)  horz-line
print 'Fax No.: '    (#row,69)
print &CO.GPSG_FAX      (#row,76)
graphic    (#row,76,10)  horz-line
print 'Email Address.:'   (#row,88)
print $Email_add    (#row,100)
graphic    (#row,100,31)  horz-line 

Add 4 to #row
move #TaxYear to $app3_taxyr 

let $app3_taxyr = edit($app3_taxyr,'9999')
Let $app3_ftr = 'IRIN 112/A3-1/'||$app3_taxyr
Print $app3_ftr  (#row,1)
Print 'Page 1 of 1'    (#row,) center
let $Prev_Emplid = $Emplid

End-Procedure 

!***********************************************************************
! Procedure: sect1-app3-data                                           *
!***********************************************************************
Begin-Procedure sect1-app3-data
        
    Let #app3_cnt = 0
    Let $APP3_STOCK_IND = EDIT(#app3_stock_count,'9')
Begin-Select
APP3.GPSG_8B_GRANT_DT
APP3.GPSG_8B_MKT_VAL
APP3.GPSG_8B_EXER_DT
APP3.GPSG_8B_EXER_VAL
APP3.GPSG_8B_EXER_PRICE
APP3.GPSG_8B_SHARES_ACQ
APP3.GPSG_8B_GROSS_GAIN
APP3.GPSG_8B_EXEMPT_GN
APP3.GPSG_8B_NONEXEMPT
APP3.GPSG_8B_RCB_NUM
APP3.GPSG_8B_STOCK_CPY
APP3.GPSG_8B_STOCK_IND
APP3.GPSG_8B_PLAN_IND
APP3.GPSG_8B_REMARKS
    
    
   Let $GPSG_APP3_STOCK_IND = &APP3.GPSG_8B_STOCK_IND
   Let $Compp_RCB_Num = &APP3.GPSG_8B_RCB_NUM
   Let $Comp_Name_App3 = &APP3.GPSG_8B_STOCK_CPY
    do print-app3-data
    

FROM PS_GPSG_IR21_APP3 APP3

WHERE APP3.GPSG_TAX_YEAR = #TaxYear
  AND APP3.EMPLID = $Emplid
  AND APP3.BALANCE_GRP_NUM = $Bal_Grp
  AND APP3.GPSG_CPY_TAX_REF = $Company_Tax_Ref
  AND APP3.GPSG_8B_STOCK_IND = $APP3_STOCK_IND
End-Select  
   alter-printer
   Font       = #StdFont
   Point-Size = 12
    
End-Procedure


!***********************************************************************
! Procedure: print-app3-data                                       *
!***********************************************************************
Begin-Procedure print-app3-data
Add 1 to #app3_cnt
    alter-printer
    Font       = #StdFont
    Point-Size = 8
    
Evaluate #app3_stock_count
When = 1
When = 2    
If #app3_cnt < 5 

    Add 1 to #row
print $Compp_RCB_Num (#row,2)
print $Comp_Name_App3       (#row,15)
  Let $FieldName  = 'GPSG_8B_PLAN_IND'
Let $FieldValue = &APP3.GPSG_8B_PLAN_IND
Do Read-Translate-Table

print $XlatShortName                            (#row,37)
print &APP3.GPSG_8B_GRANT_DT    (#row,49)   EDIT 'DD/MM/YYYY'
print &APP3.GPSG_8B_MKT_VAL     (#row,65)   EDIT '9999999.99'
print &APP3.GPSG_8B_EXER_VAL    (#row,81)   EDIT '9999999.99'
print &APP3.GPSG_8B_EXER_PRICE  (#row,97)   EDIT '9999999.99'
print &APP3.GPSG_8B_SHARES_ACQ  (#row,113)  EDIT '9999999.99'
print &APP3.GPSG_8B_EXER_DT     (#row,129)  EDIT 'DD/MM/YYYY'
if #app3_cnt < 4
graphic                                         (#row,1,140) horz-line 6
end-if
 
End-If
Break

When = 3

If #app3_cnt < 4

    Add 1 to #row
print $Compp_RCB_Num (#row,2)
print $Comp_Name_App3       (#row,15)
  Let $FieldName  = 'GPSG_8B_PLAN_IND'
Let $FieldValue = &APP3.GPSG_8B_PLAN_IND
Do Read-Translate-Table

print $XlatShortName   (#row,37)
print &APP3.GPSG_8B_GRANT_DT  (#row,49) EDIT 'DD/MM/YYYY'
print &APP3.GPSG_8B_MKT_VAL   (#row,65) EDIT '9999999.99'
print &APP3.GPSG_8B_EXER_VAL (#row,81) EDIT '9999999.99'
print &APP3.GPSG_8B_EXER_PRICE  (#row,97)  EDIT '9999999.99'
print &APP3.GPSG_8B_SHARES_ACQ  (#row,113) EDIT '9999999.99'
print &APP3.GPSG_8B_EXER_DT  (#row,129) EDIT 'DD/MM/YYYY'
if #app3_cnt < 3
graphic  (#row,1,140) horz-line 6
end-if
 
End-If
Break

When = 4

If #app3_cnt < 6

  Add 1 to #row
print $Compp_RCB_Num (#row,2)
print $Comp_Name_App3       (#row,15)
  Let $FieldName  = 'GPSG_8B_PLAN_IND'
Let $FieldValue = &APP3.GPSG_8B_PLAN_IND
Do Read-Translate-Table

print $XlatShortName                            (#row,37)
print &APP3.GPSG_8B_GRANT_DT    (#row,49)   EDIT 'DD/MM/YYYY'
print &APP3.GPSG_8B_MKT_VAL     (#row,65)   EDIT '9999999.99'
print &APP3.GPSG_8B_EXER_VAL    (#row,81)   EDIT '9999999.99'
print &APP3.GPSG_8B_EXER_PRICE  (#row,97)   EDIT '9999999.99'
print &APP3.GPSG_8B_SHARES_ACQ  (#row,113)  EDIT '9999999.99'
print &APP3.GPSG_8B_EXER_DT     (#row,129)  EDIT 'DD/MM/YYYY'
if #app3_cnt < 6
graphic                                         (#row,1,140) horz-line 6
end-if
 
End-If
Break
End-Evaluate
End-Procedure


#include 'gpsgir06.sqc' ! Appendix1 & other benefits for tax year > 2013
#include 'gpsgirty.sqc'  ! Sets Start and End dates for a Company's Tax Year
#include 'readxlat.sqc'  ! Read-Translate-Table procedure
#include 'getcodta.sqc'  ! Get-Company-Data procedure
#include 'curdttim.sqc'  ! Get-Current-DateTime procedure
#include 'datetime.sqc'  ! Routines for date and time formatting
#include 'datemath.sqc'  ! Routines for date and time maths
#include 'number.sqc'    ! Routines to format numbers
#include 'reset.sqc'     ! Reset Printer
#include 'stdapi.sqc'    ! Routines to Update Run Status
#Include 'gpsgirrc.sqc'  ! Select-Parametrs procedure