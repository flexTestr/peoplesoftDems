!***********************************************************************
!  GPDESI10:  SI-Contributions                                         *
!***********************************************************************
!                                                                      *
!                                                                      *
!                                                                      *
! This software and related documentation are provided under a         *
! license agreement containing restrictions on use and                 *
! disclosure and are protected by intellectual property                *
! laws. Except as expressly permitted in your license agreement        *
! or allowed by law, you may not use, copy, reproduce,                 *
! translate, broadcast, modify, license, transmit, distribute,         *
! exhibit, perform, publish or display any part, in any form or        *

! by any means. Reverse engineering, disassembly, or                   *
! decompilation of this software, unless required by law for           *
! interoperability, is prohibited.                                     *
! The information contained herein is subject to change without        *
! notice and is not warranted to be error-free. If you find any        *
! errors, please report them to us in writing.                         *
!                                                                      *
!
! Copyright (C) 1988, 2014, Oracle and/or its affiliates.              *
! All Rights Reserved.                                                 *
!----------------------------------------------------------------------
!
!          $Date:  2014/10/20:09:40:49                                 !
!       $Release:  HR92                                                !
!      $Revision:  111                                                 !
!                                                                      *
!***********************************************************************
!
! jjj-890b10 20 Jul 2007; Changes for new MOD-ID
! JJJ-890B10 July 03rd : DEUEV changes for Glidezone, SFN allowance and KUG
!#define gpdeversionstamp '===FUNCTIONAL UPDATE STAMP: 20060922-1000 wdu06-890b7==='
!#define gpdeversionstamp '===FUNCTIONAL UPDATE STAMP: 20070202-1000 rh07-890b9==='
!#define gpdeversionstamp '===FUNCTIONAL UPDATE STAMP: 20070202-1000 GUl07-890B10==='
!#define gpdeversionstamp '===FUNCTIONAL UPDATE STAMP: 20070202-1000 RH07-890B10P2 qk07==='
!#define gpdeversionstamp '===FUNCTIONAL UPDATE STAMP: 20070806-0942 8.9 adjB11 ==='
!#define gpdeversionstamp '===FUNCTIONAL UPDATE STAMP: 20070919-0942 8.9 adjB11 ==='
!#define gpdeversionstamp '===FUNCTIONAL UPDATE STAMP: 20080305 8.9 jjjb13 ==='
!#define gpdeversionstamp '===FUNCTIONAL UPDATE STAMP: 20080616 8.9 adjb14 ==='
!#define gpdeversionstamp '===FUNCTIONAL UPDATE STAMP: 20080901 8.9 adjb15 ==='
!#define gpdeversionstamp '===FUNCTIONAL UPDATE STAMP: 20081120 8.9 adjb16 ==='
!#define gpdeversionstamp '===FUNCTIONAL UPDATE STAMP: 20090622 8.9 adjb17 ==='
!#define gpdeversionstamp '===FUNCTIONAL UPDATE STAMP: 20100317 8.9  adjupdC ==='
!#define gpdeversionstamp '===FUNCTIONAL UPDATE STAMP: 20100603 8.9  adjupdD ==='
!#define gpdeversionstamp '===FUNCTIONAL UPDATE STAMP: 20101123 9.0  byar2011UpdA ==='
!#define gpdeversionstamp '===FUNCTIONAL UPDATE STAMP: 20110519 byar11-90updE-12434166 ==='
!#define gpdeversionstamp '===FUNCTIONAL UPDATE STAMP: 20110628 byar11-90updE-11714103 ==='
!#define gpdeversionstamp '===FUNCTIONAL UPDATE STAMP: 20110922 byar11-90updF-12787300 ==='
#define gpdeversionstamp '===FUNCTIONAL UPDATE STAMP: 20111230 byar11-90updB-13515921 =='




!
! ---- JOB-CONTROL Information ------------------------------------------------
! In an OS390/MVS environment this report may create the following misc. files:
!      EBNA.DAT, IEBNA.HTM, EBNZ.DAT, IEBNZ.HTM
!
! and the following files of type PDF:
! SVABRECH, SVSUMME, SVNACHWS, SVUMLAGE, SVFREIWL, SVABREDR, SVSUMMDR, SVNACHDR
!
! -----------------------------------------------------------------------------
! Updates:
! wdu-qk04, 2004-06-25:  fixed EBNA Sum for BUK, added checkmark for Stoerfall
! wdu-qk04: language code is now taken from runcontrol
! wdu jw2005: added 890 file handling,
! wdu jw2005: added GPDE_SI_PV_CHILD handling like GPDE_SI_IS_KVDR
! wdu05b7: Flexi-checkbox-X changed from emplid-based to provider-based
! wdu05b7: removed optimizer _VW for now
! wdu05-891b1: codeline merge 2005-05-12 13:10 - changed euro-sign to euro text (platform issue)
! wdu05-881b8: SI total gross may not be always reset
! wdu05-881b8: get EURO char from global strings table
! wdu05-881b8: ATZ2004Lookup for ZBE/UB
! wdu05-890b2: codeline merge 881b8, removed debugstrings 'Xx'
! wdu05-890b2: added filenaming for OS390
! wdu05-881jw06: removed separate correction-functionality
! wdu05-881jw06: filename updates with a new numbering for the external files only
! wdu05-881jw06: Umlage 2 is now fixed to value '21'
! wdu06-881kug: added KUG functionality
! wdu06-881kug: fixed incorrect modid
! wdu06-881kug: fixed clerk info for DSKO
! wdu06-881b11: changed the logic for marking new version rows ('N'), ICE 1507444000
! wdu06-881b11 DIN-address rules: removed blank line in provider addressfield (SV-Nachweis only)
! wdu06-881b11 we no longer need a real currency conversion since 1/1/2006
! wdu06-881b11 RvMerge2005: checks if RV groups 2,4,6 are merged into 1,2,3
! wdu06-881b11 missing assignment of an emplid (clerk) is an error now
! wdu05-881b11 updated modid
! wdu06-881b11 added employee category for BUK reporting of insignificants
! wdu06-881b11 fixes for ATZStichtag, RvMerge2006 changed to 2005
! wdu890b7 platform date format fix ATZ-Date
! rh890b9 modify clerk info so that it takes what was provided on run control not oprid info
! GUl07-890B10 Marchclause with SI-Provider Change
! rh890b10P2 stoerfall printed on wrong page
! adj07-89B11-1680582000 : 06th Sep 07 Issues with report layout.
! adj07-89B11-1680048000 : 19th Sep 07 Issues with contribution Report
! jjj-89b13-1738246000 : Changes for DEUEV DSKO version 2.
! adj08-89b14-1773434000 : 16th Jun 08 Increased Contribution Rate for Nursing Care Insurance
! adj08-890b15-1792874000 : 1st Sep 08 Fix for page break
! adj08-890b15-1782934000 : added march clause condition
! adj08-890b16-1812613000 : Refund Insurance Insolvency
! adj08-890b16-1812618000 : Introduction SI contribution report previous year
! adj08-890b16-1822269000 : Changes for the Health Insurance Rates
! adj09-890b17-1867362000 : Print Refund Ins. Insolvency Percentage on Umlage Report
! adj09-890b17-1885292000 : Health Insurance Rates July 09
! adj09-890b17-1890181000 : EE with RI Insolvency missing from Umlage
! adj09-890b18-1916130000 : Issue with reporting Insolvency Refund Insurance
! adj09-890b19-1847951000 : Enable Multiple SI receivers
! adj10-890updc-1958450000: Issue with file numbers
! adj10-890updd-1974722000: Refusal of adjustment of statements of contribution paid
! adj10-890updd-1953895000: Missing retro rows
! byar11-90updA-2013489000: Addressed Several SI issues.
! byar11-90updA-2032427000: SIlimits - Tax update 2011
! byar11-90updE-12434166  : INFORMATION FOR DSKO DIGIT 412 has to be CHANGED PARTIALLY===
! byar11-90updE-11714103  : Addressed Issue with Company number change in SOCIAL INSURANCE STATEMENTS
! byar11-90updF-12787300  : QK 11: ISSUE FOR CASE OF REGION CHANGE ON GPDESI10
! byar11-90updE-13515921  : Changes in SI Contribution BW02, BW03, TAX Update 2012

#define CONFIRM_ERR_FREE 'N' ! jjj-89b13-1738246000

#include 'setenv.sqc' !set environment
begin-Program
  do Init-DateTime
  do Init-Number
  do Get-Current-DateTime
  do Init-Layout
  do Init-Report
  create-array name = Rfndgrp size = 10
  field = refundgrp:char
  
  
  do Process-Main
  do Stdapi-Term
end-Program
!***********************************************************************
begin-setup
#include 'setupdb.sqc'
create-array name = CurrencyData size = 20
field = Currcy1:char
field = Currcy2:number
field = Currcy3:number
declare-layout Abrechnung
  paper-size  = (19,11.69)
  orientation = LANDSCAPE
  line-height= 14
  max-columns = 188
  left-margin= .4
  bottom-margin=.15
  top-margin = 0.4
end-declare
declare-layout Abrechnung_Sum
  paper-size  = (19,11.69)
  orientation = LANDSCAPE
  line-height= 14
  max-columns = 188
  left-margin= .4
  bottom-margin=.15
  top-margin = 0.4
end-declare
declare-layout Abrechnung_Umlage
  paper-size  = (19,11.69)
  orientation = LANDSCAPE
  line-height= 14
  max-columns = 188
  left-margin= .4
  bottom-margin=.15
  top-margin = 0.4
end-declare
declare-layout Freiwillig
  paper-size  = (19,11.69)
  orientation = LANDSCAPE
  line-height= 14
  max-columns = 188
  left-margin= .4
  bottom-margin=.15
  top-margin = 0.4
end-declare
declare-layout Nachweis
  paper-size = (11.96,17)
  orientation = portrait
  max-columns = 125
  max-lines = 82
  line-height= 14
end-declare
declare-report Abrechnung
  layout = Abrechnung
end-declare
declare-report Abrechnung_Sum
  layout = Abrechnung_Sum
end-declare
declare-report Abrechnung_Umlage
  layout = Abrechnung_Umlage
end-declare
declare-report Freiwillig
  layout = Freiwillig
end-declare
declare-report Nachweis
  layout = Nachweis
end-declare
end-setup



!************************************************************************
begin-procedure Ask-Report-Parameters
! functional input parameters are no longer supported
!-- input $Ctl_PayEntity  'Pay Entity '
!-- input $Ctl_Curr_Pay_End_Dt 'Pay End date '
!-- input $GPDE_DV_RCVER_ID 'Receicer ID '
!-- input $Sort1  'Sort1 '
!-- input $Sort2  'Sort2 '
!-- input $Sort3  'Sort3 '
!-- input $CloseFlag 'Process Close Y/N'
!-- input $ResetFileNumber 'Reset File Number Y/N'
end-procedure




!************************************************************************
begin-procedure Get-Report-Parameters
BEGIN-SELECT
RCSI10.OPRID
RCSI10.RUN_CNTL_ID
RCSI10.LANGUAGE_CD
RCSI10.GPDE_AL_CPAY_ENDDT
RCSI10.PAY_ENTITY
RCSI10.GPDE_DV_RCVER_ID
RCSI10.GPDE_RC_YR_CLOSE
RCSI10.GPDE_RC_RESET1
RCSI10.GPDE_AL_OPRNAME
RCSI10.GPDE_AL_GENDER
RCSI10.GPDE_AL_CONTACT_NM
RCSI10.GPDE_AL_PHONE
RCSI10.GPDE_AL_FAX
RCSI10.GPDE_AL_EMAIL
!RCSI10.GPDE_RC_PRN_DUE25
   let $Ctl_OprUD = &RCSI10.OPRID
   let $Ctl_Run_Cntl = &RCSI10.RUN_CNTL_ID
   let $Ctl_Language = &RCSI10.LANGUAGE_CD
   let $Ctl_Curr_Pay_End_Dt1 = &RCSI10.GPDE_AL_CPAY_ENDDT
   do Get_End_Mnth($Ctl_Curr_Pay_End_Dt1,$Ctl_Curr_Pay_End_Dt)
   let $Ctl_PayEntity = &RCSI10.PAY_ENTITY
   let $GPDE_DV_RCVER_ID =  &RCSI10.GPDE_DV_RCVER_ID
   let $CloseFlag = &RCSI10.GPDE_RC_YR_CLOSE
   let $ResetFileNumber = &RCSI10.GPDE_RC_RESET1
! get clerk info
   let #SBA_emplid = &RCSI10.GPDE_AL_OPRNAME
   let $SBA_Sex =  &RCSI10.GPDE_AL_GENDER
   let $SBA_Name = &RCSI10.GPDE_AL_CONTACT_NM
   let $SBA_Phone = &RCSI10.GPDE_AL_PHONE
   let $SBA_Fax = &RCSI10.GPDE_AL_FAX
   let $SBA_Email = &RCSI10.GPDE_AL_EMAIL

FROM PS_GPDE_RC_SI10 RCSI10
WHERE RCSI10.OPRID = $prcs_oprid and
      RCSI10.RUN_CNTL_ID = $prcs_run_cntl_id
end-SELECT
!adj- populate single receiver.
!begin-select
!LOOP2a.GPDE_DV_RCVER_ID
! let $GPDE_DV_RCVER_ID =  &LOOP2a.GPDE_DV_RCVER_ID
!from PS_GPDE_RC_SI10RCV LOOP2a
!where LOOP2a.OPRID = $prcs_oprid
!AND LOOP2a.RUN_CNTL_ID = $prcs_run_cntl_id
!end-select

! wdu05-881jw06 Faelligkeit am 25. needs to be disabled
let $Maturity='N'
do Get_Receiver_Name

! nwdu-qk04: language code taken from runcontrol
!-- let $language_cd = $PRCS_LANGUAGE_CD
let $language_cd = $Ctl_Language

!show clerk info in logfile
show 'Clerk-Info1: ' $SBA_Emplid ', ' $SBA_Name ', '  $SBA_FirstName ', '  $SBA_Name_Prefix ', '  $SBA_Sex
show 'Clerk-Info2: ' $SBA_Emplid ', ' $SBA_Phone ', '  $SBA_Fax ', '  $SBA_Email


end-procedure




!************************************************************************
begin-procedure Get_Receiver_Name
let $Receiver_Name = ' '
let $Exit_Report = 'N'
begin-select DISTINCT
AP.GPDE_SI_PROV
  let $Receiver_Name = rtrim(&AP.GPDE_SI_PROV, ' ')
FROM PS_GPDE_SI_PROV AP
WHERE AP.GPDE_SI_PROV_ID = $GPDE_DV_RCVER_ID and
      AP.EFFDT = (select max(EFFDT) from PS_GPDE_SI_PROV AP1
         where AP1.GPDE_SI_PROV = AP.GPDE_SI_PROV and
         AP1.EFFDT <= $AsOfToday) and
      AP.GPDE_DV_RCVER_YN = 'Y'
end-select
if rtrim($Receiver_Name, ' ') = ''
  let $Receiver_Name = 'XXX'
end-if
end-procedure




!************************************************************************
begin-procedure Get-ReqParam
Begin-Select
RQ.PRCSINSTANCE
RQ.PRCSTYPE
RQ.PRCSNAME
RQ.RUNLOCATION
RQ.OPSYS
RQ.DBTYPE
RQ.DBNAME
RQ.OPRID
RQ.BEGINDTTM
RQ.ENDDTTM
RQ.RUNSTATUS
RQ.RUNCNTLID
RQ.OUTDESTTYPE
RQ.OUTDESTFORMAT
RQ.TIMEZONE
RQ.SERVERNAMERUN
! wdu jw2005 added 890 file handling
OD.PRCSOUTPUTDIR
OD.OUTDEST
FROM PSPRCSPARMS OD , PSPRCSRQST  RQ
WHERE OD.PRCSINSTANCE  = RQ.PRCSINSTANCE
AND   RQ.PRCSINSTANCE = #prcs_process_instance
End-Select
  let $RQ.OUTDESTTYPE = rtrim(&RQ.OUTDESTTYPE,' ')
  let $RQ.OUTDESTFORMAT = rtrim(&RQ.OUTDESTFORMAT,' ')
  let $Process_Inst  = to_char(&RQ.PRCSINSTANCE)
  let $BeginDate     = datetostr(&RQ.BEGINDTTM,{PTRPTDATE})
  let $BeginTime     = datetostr(&RQ.BEGINDTTM,{PTRPTTIME})
  let $BeginDateTime = $BeginDate || '     ' || $BeginTime
  let $EndDate       = datetostr(&RQ.ENDDTTM,{PTRPTDATE})
  let $EndTime       = datetostr(&RQ.ENDDTTM,{PTRPTTIME})
  let $EndDateTime   = $EndDate || '     ' || $EndTime
! wdu jw2005 added 890 file handling
  let $OUTDEST       = rtrim(&OD.OUTDEST,' ')
  let $OUTDESTTYPE   = rtrim(&RQ.OUTDESTTYPE,' ')

  move 'RUNLOCATION'  to $FieldName
  move &RQ.RUNLOCATION to $FieldValue
  do Read-Translate-Table
  let $RUNLOCATION = rtrim(ltrim($XlatlongName,' '),' ')
  move 'OPSYS'  to $FieldName
  move &RQ.OPSYS to $FieldValue
  do Read-Translate-Table
  let $OPSYS = rtrim(ltrim($XlatlongName,' '),' ')
  move 'DBTYPE'  to $FieldName
  move &RQ.DBTYPE to $FieldValue
  do Read-Translate-Table
  let $DBTYPE = rtrim(ltrim($XlatlongName,' '),' ')
  move 'RUNSTATUS'  to $FieldName
  move &RQ.RUNSTATUS to $FieldValue
  do Read-Translate-Table
  let $RUNSTATUS = rtrim(ltrim($XlatlongName,' '),' ')
  move 'OUTDESTTYPE'  to $FieldName
  move &RQ.OUTDESTTYPE to $FieldValue
  do Read-Translate-Table
  let $OUTDESTTYPE = rtrim(ltrim($XlatlongName,' '),' ')
  move 'OUTDESTFORMAT'  to $FieldName
  move &RQ.OUTDESTFORMAT to $FieldValue
  do Read-Translate-Table
  let $OUTDESTFORMAT = rtrim(ltrim($XlatlongName,' '),' ')
  evaluate $RQ.OUTDESTFORMAT
  when = '1'
    let $OUTDESTFORM = 'PDF'
    break
  when = '2'
    let $OUTDESTFORM = 'PDF'
    break
  when = '3'
    let $OUTDESTFORM = 'CSV'
    break
  when = '4'
    let $OUTDESTFORM = 'HP'
    break
  when = '5'
    let $OUTDESTFORM = 'HTM'
    break
  when = '6'
    let $OUTDESTFORM = 'LP'
    break
  when = '7'
    let $OUTDESTFORM = 'WKS'
    break
  when = '8'
    let $OUTDESTFORM = 'XLS'
    break
  when = '9'
    let $OUTDESTFORM = 'DOC'
    break
  when = '10'
    let $OUTDESTFORM = 'PS'
    break
  when = '11'
    let $OUTDESTFORM = 'RPT'
    break
  when = '12'
    let $OUTDESTFORM = 'RTF'
    break
  when = '13'
    let $OUTDESTFORM = 'SPF'
    break
  when = '14'
    let $OUTDESTFORM = 'TXT'
    break
  when = '15'
    let $OUTDESTFORM = 'PDF'
    break
  when = '16'
    let $OUTDESTFORM = 'PDF'
    break
  when-other
    let $OUTDESTFORM = 'PDF'
    break
  end-evaluate
end-procedure




!************************************************************************
begin-procedure Init-Report
   do Stdapi-Init
   do Get-ReqParam

   let $outputdir = $sqr-report

   do GetFileExtension($RQ.OUTDESTFORMAT, $FileExtension)
   do GetOutputDir($RUNLOCATION,$OUTDESTTYPE,$OUTDEST,$outputdir)

   #debug show 'outputdir: ' $outputdir
   #debug show 'fileextension: ' $FileExtension

   ! nwdu-qk04: language code taken from runcontrol in Get-Report-Parameters, set a default here
   let $language_cd = 'GER'

! wdu 04b4 remove after bundle 5
!--   if $prcs_process_instance = ''
!--      do Ask-Report-Parameters
!--   else
!--      do Get-Report-Parameters
!--   end-if

  ! wdu-04b4 changed for customer process:
  ! begin runcontrol data
  ! If no oprid or runcontrol was passed on the commandline, then ask for it.
  ! After that, fetch functional data from the runcontrol.
  ! The input of functional values is no longer supported.
  if $prcs_process_instance = ''
          input $PRCS_OPRID 'OPRID '
          input $PRCS_RUN_CNTL_ID 'RUNCONTROL '
          ! wdu05b6: put back override of $outputdir on customer request
          input $outputdir
          do Get-Report-Parameters
          ! always override language settings
          let $LANGUAGE_CD = 'GER'
          let $CURR_LANGUAGE_CD = 'GER'
   else
          do Get-Report-Parameters
   end-if
  ! end runcontrol data



   move 'GPDESI10' to $ReportID
   do Init_Report_Translation ($ReportID, $language_cd)
   do Append_Report_Translation ('GPDEGLOB')
   do Report-Translation

   let $ReportTitle = $TITLE1
   #define page-len 55
   let $semaphor = 'Y'




!------------------------------------------------------------------------
! Get the last day of the previous year taking Curr_pay_end_dt
if rtrim($Ctl_Curr_Pay_End_DT,' ') <> ''
   do Convert-to-DTU-Date($Ctl_Curr_Pay_End_DT,$DTU-Old)
   do dtu-add-months($DTU-Old,-12,$Dtu-New)
   do Convert-from-DTU-Date($Dtu-New,$Last_Year)
   do Format-DateTime($Last_Year,$Comp-Out,{DEFCMP},'','')
   let $yy = substr($Comp-Out,1,4)
   let $Date-In = $yy || '1231000000'
   do Format-DateTime($Date-In,$Last_Year,{DEFCMP},'','native')
   let $StichLastJahr = $yy
   let $StichJahr = '2002'
   do ConvertToComponents($Ctl_Curr_Pay_End_DT,$HD_yy,$HD_mm,$HD_dd)
end-if
do Get-Translate-Value
if rtrim($HD_yy,' ') <> ''
   let $BegMonthStr = $HD_yy || '0101000000'
   do Format-DateTime($BegMonthStr,$BegYearAct,{DEFCMP},'','native')
   do Format-DateTime($BegYearAct,$BegYearActCmp,{DEFCMP},'','')
   do Format-DateTime($Ctl_Curr_Pay_End_DT,$CtlPayEnd_DTCmp,{DEFCMP},'','')
else
   let $BegYearActCmp = ''
   let $CtlPayEnd_DTCmp = ''
end-if


   ! fixed date constant 1/1/2005 (!)
   do dtu-format-date(2005, 1, 1,$dtu_dateout_2005)


     ! wdu05-881b8: $ATZStichtag contains the begin date for the new legislative rules
     let $ATZSticht = '2004'  || '07' ||  '01'
     do Format-DateTime($ATZSticht, $ATZSticht1, {DEFCMP},'','native')
     do Format-DateTime($ATZSticht1, $ATZStichtag, {DEFCMP},'','')

     ! wdu05-881b8: $ZusStichtag contains the begin date for the Zusatzbeitrag (dental)
     let $ZusSticht = '2005'  || '07' ||  '01'
     do Format-DateTime($ZusSticht, $ZusSticht1, {DEFCMP},'','native')
     do Format-DateTime($ZusSticht1, $ZusStichtag, {DEFCMP},'','')


     ! wdu05-881b11: $RvMerge2005 indicates if RV groups 2,4,6 are merged into 1,2,3
     ! $RvMerge2005 depends on the year of the creation of the report $Ctl_Curr_Pay_End_DT
     if $HD_yy >= '2005'
        ! yes, all amounts for RV-Group 2 go to 1, 4 go to 3, 6 go to 5 in summation
        let $RvMerge2005 = 'Y'
     else
        ! no, we have separate sums for all groups
        let $RvMerge2005 = 'N'
     end-if
     ! --

     ! show 'zusatzstichtag1 ' $ZusSticht1
     ! show 'zusatzstichtag2-Stichtag ' $ZusStichtag
     ! show 'zusatzstichtag3 ' $Ctl_Curr_Pay_End_DT
     ! show 'zusatzstichtag-Bezugsmonat ' $CtlPayEnd_DTCmp

end-procedure



!***********************************************************************
begin-procedure Get-Translate-Value

  evaluate $HD_mm
    when = '01'
      let $HD_Month_Name = 'Januar'
      break
    when = '02'
      let $HD_Month_Name = 'Februar'
      break
    when = '03'
      let $HD_Month_Name = 'März'
      break
    when = '04'
      let $HD_Month_Name = 'April'
      break
    when = '05'
      let $HD_Month_Name = 'Mai'
      break
    when = '06'
      let $HD_Month_Name = 'Juni'
      break
    when = '07'
      let $HD_Month_Name = 'Juli'
      break
    when = '08'
      let $HD_Month_Name = 'August'
      break
    when = '09'
      let $HD_Month_Name = 'September'
      break
    when = '10'
      let $HD_Month_Name = 'Oktober'
      break
    when = '11'
      let $HD_Month_Name = 'November'
      break
    when = '12'
      let $HD_Month_Name = 'Dezember'
      break
    when-other
      let $HD_Month_Name = 'XXXXXXX'
      break
  end-evaluate
end-procedure
!************************************************************************
Begin-Procedure Report-Translation
  do Get_Field_Information ('GPDESI10', 'TITLE',        $TITLE,     #CW)
  do Get_Field_Information ('GPDESI10', 'HOUR',         $HOUR,      #CW)
  do Get_Field_Information ('GPDESI10', 'FACTOR',       $FACTOR,    #CW)
  do Get_Field_Information ('GPDESI10', 'PERCENT',      $PERCENT,   #CW)
  do Get_Field_Information ('GPDESI10', 'BASE',         $BASE,      #CW)
  do Get_Field_Information ('GPDESI10', 'AMOUNT',       $AMOUNT,    #CW)
  do Get_Field_Information ('GPDESI10', 'SUM',          $SUM,       #CW)
  do Get_Field_Information ('GPDESI10', 'YRSUM',        $YRSUM,     #CW)

! wdu05-881b8:  get EURO char from global strings table
do Get_Field_Information ('GPDEGLOB', 'EURO',        $EUROCHAR,     #CW)

! adj07-89B11-1680582000 : 06th Sep 07 Issues with report layout.
!do Get_Field_Information ('GPDEGLOB', 'PARA',        $PARACHAR,     #CW)

  let $AMOUNT_SPEC = 'Betragsangaben in'
end-Procedure
!************************************************************************
begin-procedure Init-Layout     !Defining columns for each report
!columns for fixed header report Beitragsabrechnung
   #define col0 1                !Firma...
   #define col1 20               !Firmendaten
   #define col2 80               !Beitragsabrechnung
   #define col3 105              !Curr_Pay_End_Dt...
   #define col4 120              !Beitragskonto
   #define col5 160              !Erstellungsdatum...
   #define col6 170
   #define colv0    1               !PersNr
   #define colv1   18 !15           !Name
   #define colv2   54 !47           !Beitragsgruppe
   #define colv2b  59               !Monat
   #define colv3   71               !SV-Tage
   #define colv4   13               !Soz.Vers.Pfl. Entgelt
   #define colv5   25               !Beitrag G
   #define colv5b  38               !Beitrag H
   #define colv5c  51               !Beitrag F
   #define colv6   64               !Beitrag P
   #define colv6b  63               !Beitrag P/2
   #define colv7   77               !Beitrag K
   #define colv7b  90               !BEitrag L
   #define colv7c  103              !Beitrag K_2
   #define colv7d  116              !Beitrag L_2
   #define colv8   129              !Beitrag A
   #define colv8b  142              !Beitrag A2
   #define colv9   155              !Beitrag Umlage 1
   #define colv9b  168              !Beitrag Umlage 2
   #define colv10  167              !Summe
   !columns for fixed header Report Freiwillige
   #define col0f 1                !Firma...
   #define col1f 20               !Firmendaten
   #define col1bf 70
   #define col2f 80               !Beitragsabrechnung
   #define col7f 34               !RVNR heading
   #define col3f 105              !Curr_Pay_End_Dt...
   #define col4f 120              !Beitragskonto
   #define col5f 160              !Erstellungsdatum...
   #define col6f 170
   #define colv0f 3                 !PersNr
   #define colv1f 17                !Name
   #define colv2bf 70               !Monat
   #define colv3f 90                !SV-Tage
   #define colv4f 105               !Soz.Vers.Pfl. Entgelt
   #define colv5f 120               !Beitrag G
   #define colv6f 135               !Beitrag K
   #define colv7f 150               !Beitrag M
   #define colv8f 160               !Beitrag P
   !columns for fixed header report Nachweis
   #define col0n 5                !Arbeitgeber...
   #define col1n 20               !Daten
   #define col2n 60               !Beitragsnr
   #define col3n 95               !Daten
   #define col4n 93               !Art des Beitragsnachweises
   !**columns for variable body
   #define colv0n 3               !Beitragsart
   #define colv1n 81              !Beitragsgruppe alphabetisch
   #define colv2n 90              !Beitragsgruppe numerisch
   #define colv3n 100             !Summen
end-procedure
!************************************************************************
begin-footing  3 for-reports = (Abrechnung,Abrechnung_Umlage,Freiwillig)
 alter-printer
    font= 4
    point-size =13

 print '*   = Keine Kinder im Sinne der PV'  (1,1)
 print '**  = KUG ausbezahlt'               (2,1)
 print '*** = Beitragspflichtiger SFN Zuschlag' (3,1)


 print 'Alle Werte in'  (3,164)
 alter-printer
    font= 4
    point-size =28
 if $Actual_Curruncy_save = 'DEM'
     let $Actual_Curruncy_save = 'DM'
 end-if
 if $Actual_Curruncy_save = 'EUR'
     let $Actual_Curruncy_save = $EUROCHAR
 end-if
print $Actual_Curruncy_save  (3,176)
 alter-printer
    font= 4
    point-size =13
end-footing






!************************************************************************
begin-heading  17 for-reports = (Abrechnung)
  let $AMOUNT_SPEC1 = $AMOUNT_SPEC || ' ' || $sav_CurrencyA
  let $HD_Title1K = 'Korrekturen Vorjahre'
  if $Is_KVdR <> 'Y'
     let $HD_Title1 = 'SV-Beitragsabrechnung ' ||
      ltrim(rtrim($HD_Month_Name,' '),' ') || ' ' || $HD_yy
  else
     let $HD_Title1 = 'SV-Beitragsabrechnung KVdR ' ||
      ltrim(rtrim($HD_Month_Name,' '),' ') || ' ' || $HD_yy
  end-if
!adj08-890b16 : Contr. previous year
    if #phase = 2
  !if $march = 'Y--gibts-nimmer'
     alter-printer
       font= 4
       point-size =28
     print $HD_Title1              (1,1) bold
     graphic (3,1,180) horz-line 10
     alter-printer
       font= 4
       point-size =20
     print $HD_Title1K            (5,1) bold
  else
     alter-printer
       font= 4
       point-size =28
     print $HD_Title1        (1,1) bold
     graphic (3,1,180) horz-line 10
  end-if
  alter-printer
  font= 4
  point-size =13
  let $HD_KrankenKasse = 'Krankenkasse : ' || ltrim(rtrim($hdr_abr_si_provider, ' '),' ')  ||
      ' ' || ltrim(rtrim($hdr_abr_kk_name, ' '),' ')
  if $PrintFormInsigBUK = 'N'
    print $HD_KrankenKasse (6,1)
  else
    print 'BUK  Bundesknappschaft' (6,1)
  end-if

  let $HD_KK_BetrNr = 'Kassenbetriebsnummer : ' || $hdr_abr_kk_nummer
  print $HD_KK_BetrNr                    (6,48)

 if $Is_KVdR <> 'Y'
  let $HD_BeirtKonto = 'Beitrags-Konto : ' || rtrim(ltrim($hdr_abr_beitragskonto,' '),' ')
  print $HD_BeirtKonto    (6,116)
 end-if

  let $HD_Zahlstelle = 'Zahlstelle : ' || rtrim(ltrim($hdr_abr_zahlstellen_nr,' '),' ')
  print $HD_Zahlstelle (7,116)
  print $RegionString                           (9,116)
  print 'Arbeitgeberangaben:' (6,147,44)
  let $HD_Firma = $hdr_abr_Payentity_name
  print $HD_Firma                               (7,147,44)
  let $HD_Strasse = $hdr_abr_Payentity_street
  print $HD_Strasse                              (8,147,44)
  let $HD_Ort = $hdr_abr_Payentity_zip_city
  print $HD_Ort                                 (10,147,44)
  let $HD_BetrNr = 'Betriebsnummer: ' || $hdr_abr_GPDE_DO_BTNR
  print $HD_BetrNr                      (11,147,36)
  print 'Seite :'               (1,147)
  print '['                     (1,155)
  if #page-count < 10
     print #page-count          (0,0) edit 9
  else
     print #page-count          (0,0) edit 99
  end-if
  print ']'                     (0,0)
  print 'Datum :'               (2,147)
  print $hdr_abr_header_date    (2,155)
  let $Bemerk = $Bezeichn || ' ' || $VersionsNr
  print $Bemerk (3,147,40)
  let #Date_Type = {DateType}
  if $ActEffDt <> ''
     do ConvertToComponents($ActEffDt,$yy11,$mm11,$dd11)
     evaluate #Date_Type
     when = 2
        let $hdr_abr_header_date1 = $yy11 || '{PTDateDelim}' || $mm11
        break
     when-other
        let $hdr_abr_header_date1 = $mm11 || '{PTDateDelim}' || $yy11
        break
     end-evaluate
   else
     let $hdr_abr_header_date1 = ' '
   end-if
  !Tax update 2011 : Health Ins Rates
   if #phase = 1 and $yy09 >= '2011'
     if $ActEffDt <> ''
        let $hdr_abr_header_date1 = '01/2011'
     end-if   
   else !adj08-890b16 : Health Ins Rates   
      if #phase = 1 and $yy09 >= '2009'
        if $ActEffDt <> ''
           let $hdr_abr_header_date1 = '01/2009'
           !adj09-89b18 : July Tax update
           if $HD_mm > '06' or $yy09 = '2010'
              let $hdr_abr_header_date1 = '07/2009'
           end-if
        end-if
      end-if
    end-if
   
  let $HD_BeitrSaetze = 'KV - Beitragssätze ' || $hdr_abr_header_date1
  let $HD_KV_Allg = 'allgemein: ' || $hdr_abr_per_kv_1000
  let $HD_KV_Erht = 'erhöht: ' || $hdr_abr_per_kv_2000
  let $HD_KV_Verm = 'vermindert: ' || $hdr_abr_per_kv_3000

! adj 1680048000 - Issue with Contribution Rates
  if rtrim($hdr_abr_kk_nummer,' ') = '98000006'
 let $HD_KV_Gering = 'geringfügig Besch.: ' || $hdr_abr_per_kv_6000
end-if


  let $HD_RV_Voller = 'RV voller Beitr.: ' ||  $hdr_abr_per_rv_0100
  let $HD_RV_Halber = 'RV halber Beitr.: ' ||  $hdr_abr_per_rv_0300
  let $HD_RV_Gering = 'RV geringf. Beschäft.: ' ||  $hdr_abr_per_rv_0500
  let $HD_AV_Voller = 'AV voller Beitr.: ' ||  $hdr_abr_per_av_0010
  let $HD_AV_Halber = 'AV halber Beitr.: ' ||  $hdr_abr_per_av_0020
  let $HD_PV        = 'Beitragssatz PV: ' || $hdr_abr_per_pv_0001
  let $HD_KVdR       = 'KVdR: ' || $hdr_abr_per_kvdr
  let $HD_PV_KVdR    = 'Beitragssatz PV KVdR       : ' || $hdr_abr_per_pv_kvdr1
  let $HD_PV_KVdR1_2 = 'Beitragssatz PV KVdR 1/2 : ' || $hdr_abr_per_pv_kvdr2

  ! wdu05-881b8: additional percentage for Zusatz insurance
  if ( $CtlPayEnd_DTCmp >= $ZusStichtag )
      let #ZusatzPct = 0.9
      do format-number(#ZusatzPct,$ZusatzPctText,'888.00')
      let $HD_KV_Zusatz =  'Zusatzbeitrag: ' || $ZusatzPctText
  end-if
!adj08-890b16 : Health Ins Rates
   if #phase = 1 and $yy09 >= '2009' !activate for 2010
      let #ZusatzPct = 0
      do format-number(#ZusatzPct,$ZusatzPctText,'888.00')
      let $HD_KV_Zusatz =  'Zusatzbeitrag: ' || $ZusatzPctText
   end-if

  !begin print percentage
  print $HD_BeitrSaetze (8,1)
  if $PrintFormInsigBUK = 'N'
     if $Is_KVdR <> 'Y'
      print $HD_KV_Allg  (8,25)
      print $HD_KV_Erht  (9,25)
      print $HD_KV_Verm  (10,25)
!adj 1680048000 - Issue with Contribution Rates
       if rtrim($hdr_abr_kk_nummer,' ') = '98000006'
         let $HD_KV_Gering = 'geringfügig Besch.: ' || $hdr_abr_per_kv_6000
         print $HD_KV_Gering  (9,1)
       end-if
     else! kvdr = y
      print $HD_KVdR  (8,25)
      print $HD_PV_KVdR  (8,48)
      print $HD_PV_KVdR1_2  (9,48)
     end-if
  else
! adj 1680048000 - Issue with Contribution Rates
    if rtrim($hdr_abr_kk_nummer,' ') = '98000006'
         let $HD_KV_Gering = 'geringfügig Besch.: ' || $hdr_abr_per_kv_6000
           print $HD_KV_Gering  (9,1)
    end-if
  end-if

  if $Is_KVdR <> 'Y'
     print $HD_RV_Voller  (8,48)
  end-if

  if $PrintFormInsigBUK = 'N'
    if $Is_KVdR <> 'Y'
     print $HD_RV_Halber  (9,48)
     print $HD_RV_Gering  (10,48)
    end-if
  else
     print $HD_RV_Gering  (9,48)
  end-if

  if $PrintFormInsigBUK = 'N'
    ! wdu06-881b11 reformatted expression for BUK change
    if $Is_KVdR <> 'Y'
         print $HD_AV_Voller  (8,80)
         print $HD_AV_Halber  (9,80)
         ! wdu05-881b8 added Zusatz insurance percentage
         print $HD_KV_Zusatz  (10,80)
         print $HD_PV  (11,80)
    end-if
  end-if

  graphic (13,1,180) box 5 0 12
  graphic (12,14,5) vert-line 2

  graphic (12,48,5) vert-line 2
  graphic (13,55,4) vert-line 2
  graphic (13,62,4) vert-line 2
  graphic (13,69,4) vert-line 2
  graphic (12,76,5) vert-line 2
  graphic (12,80,5) vert-line 2

  print 'SV-Schlüssel'          (13,58) bold
  print 'Gesamtbrutto'          (13,87) bold
  print 'Pers.-Nr./'              (16,2) bold
  print 'Rec. -Nr.'              (17,2) bold
  print 'Name,Vorname'          (17,15) bold
  print 'KV'                    (15,51)
  print 'RV'                    (15,57)
  print 'AV'                    (15,64)
  print 'PV'                    (15,71)
  print 'Tg/KV'                 (17,49)
  print 'Tg/RV'                 (17,56)
  print 'Tg/AV'                 (17,63)
  print 'Tg/PV'                 (17,70)

  ! JJJ-890B10-gzone
  print 'GZ'                    (17,77) bold

if $PrintFormInsigBUK = 'N'
 if $Is_KVdR <> 'Y'
  graphic (12,100,5) vert-line 2
  graphic (12,116,5) vert-line 2
  graphic (12,132,5) vert-line 2
  graphic (12,148,5) vert-line 2
  graphic (12,164,5) vert-line 2
  print 'KV-Brutto'         (15,91)
  print 'RV-Brutto'         (15,107)
  print 'KV/AN'             (15,125)
  print 'RV/AN'             (15,141)
  print 'AV/AN'             (15,157)
  print 'PV/AN'             (15,174)
  print 'AV-Brutto'         (17,91)
  print 'PV-Brutto'         (17,107)
  print 'KV/AG'             (17,125)
  print 'RV/AG'             (17,141)
  print 'AV/AG'             (17,157)
  print 'PV/AG'             (17,174)
 else
  graphic (12,100,5) vert-line 2
  graphic (12,140,5) vert-line 2   !132
  print 'KV-Brutto'         (15,91)
  print 'KV/AN'             (15,133)   !125
  print 'PV/AN'             (15,174)
  print 'PV-Brutto'         (17,91)
  print 'KV/AG'             (17,133)   !125
  print 'PV/AG'             (17,174)
 end-if
else
  graphic (12,100,5) vert-line 2
  graphic (12,113,5) vert-line 2
  graphic (12,126,5) vert-line 2
  graphic (12,139,5) vert-line 2
  graphic (12,152,5) vert-line 2
  graphic (12,165,5) vert-line 2
  print 'KV-Brutto'         (15,91)
  print 'RV-Brutto'         (15,104)
  print 'KV/AN'             (15,119)
  print 'RV/AN'             (15,132)
  print 'AV/AN'             (15,145)
  print 'PV/AN'             (15,158)
  print 'einheitliche'      (15,171)
  print 'Pauschsteuer'      (16,169)
  print 'AV-Brutto'         (17,91)
  print 'PV-Brutto'         (17,104)
  print 'KV/AG'             (17,119)
  print 'RV/AG'             (17,132)
  print 'AV/AG'             (17,145)
  print 'PV/AG'             (17,158)
end-if
end-heading
!***********************************************************************

begin-heading  14 for-reports = (Abrechnung_Sum)
  let $AMOUNT_SPEC1 = $AMOUNT_SPEC || ' ' || $sav_CurrencyA
  do Get-Header-Data-Abr
!adj08-890b16 : Contr. previous year
  if #phase = 2
  !if $march = 'Y--gibts-nimmer'
     let $HD_Title1K = 'Korrekturen Vorjahre'
  end-if
  if $Is_KVdR <> 'Y'
     let $HD_Title1 = 'SV-Beitragsabrechnung ' ||
      ltrim(rtrim($HD_Month_Name,' '),' ') || ' ' || $HD_yy
  else
     let $HD_Title1 = 'SV-Beitragsabrechnung KVdR ' ||
      ltrim(rtrim($HD_Month_Name,' '),' ') || ' ' || $HD_yy
  end-if
!adj08-890b16 : Contr. previous year
     if #phase = 2
    !if $march = 'Y--gibts-nimmer'
       alter-printer
         font= 4
         point-size =28
       print $HD_Title1              (1,1) bold
       graphic (3,1,180) horz-line 10
       alter-printer
         font= 4
         point-size =20
       print $HD_Title1K            (5,1) bold
    else
       alter-printer
         font= 4
         point-size =28
       print $HD_Title1        (1,1) bold
       graphic (3,1,180) horz-line 10
    end-if
   alter-printer
     font= 4
     point-size =13
   let $HD_KrankenKasse = 'Krankenkasse : ' || ltrim(rtrim($hdr_abr_si_provider, ' '),' ')  ||
      ' ' || ltrim(rtrim($hdr_abr_kk_name, ' '),' ')
   if $PrintFormInsigBUK = 'N'
      print $HD_KrankenKasse (6,1)
   else
      print 'Krankenkasse: BUK  Bundesknappschaft' (6,1)
   end-if
   let $HD_KK_BetrNr = 'Kassenbetriebsnummer : ' || $hdr_abr_kk_nummer
   print $HD_KK_BetrNr                    (6,48)
   print $RegionString                           (5,48)
  if $Is_KVdR <> 'Y'
   let $HD_BeirtKonto = 'Beitrags-Konto : ' || rtrim(ltrim($hdr_abr_beitragskonto,' '),' ')
   print $HD_BeirtKonto    (6,116)
  end-if
   let $HD_Zahlstelle = 'Zahlstelle : ' || rtrim(ltrim($hdr_abr_zahlstellen_nr,' '),' ')
   print $HD_Zahlstelle (7,116)
   print 'Arbeitgeberangaben:' (6,147,44)
   let $HD_Firma = $hdr_abr_Payentity_name
   print $HD_Firma                               (7,147,44)
   let $HD_Strasse = $hdr_abr_Payentity_street
   print $HD_Strasse                              (8,147,44)
   let $HD_Ort = $hdr_abr_Payentity_zip_city
   print $HD_Ort                                 (10,147,44)
   let $HD_BetrNr = 'Betriebsnummer: ' || $hdr_abr_GPDE_DO_BTNR
   print $HD_BetrNr                      (11,147,36)
   print 'Seite :'               (1,132)
   print '['                     (1,140)
   if #page-count < 10
      print #page-count          (0,0) edit 9
   else
      print #page-count          (0,0) edit 99
   end-if
   print ']'                     (0,0)
   print 'Datum :'               (2,132)
   print $hdr_abr_header_date    (2,140)
   let $Bemerk = $Bezeichn || ' ' || $VersionsNr
   print $Bemerk (3,132)
   let #Date_Type = {DateType}
   if $ActEffDt <> ''
      do ConvertToComponents($ActEffDt,$yy11,$mm11,$dd11)
      evaluate #Date_Type
      when = 2
        let $hdr_abr_header_date1 = $yy11 || '{PTDateDelim}' || $mm11
        break
      when-other
        let $hdr_abr_header_date1 = $mm11 || '{PTDateDelim}' || $yy11
        break
      end-evaluate
   else
      let $hdr_abr_header_date1 = ' '
   end-if
 !Tax update 2011 : Health Ins Rates
   if #phase = 1 and $yy09 >= '2011'
     if $ActEffDt <> ''
        let $hdr_abr_header_date1 = '01/2011'
     end-if
   else !adj08-890b16 : Health Ins Rates 
       if #phase = 1 and $yy09 >= '2009'
          if $ActEffDt <> ''
             let $hdr_abr_header_date1 = '01/2009'
             !adj09-89b18 : July Tax update
             if $HD_mm > '06' or $yy09 = '2010' !Print header for 2010
                let $hdr_abr_header_date1 = '07/2009'
             end-if
          end-if
        end-if
   end-if

   let $HD_BeitrSaetze = 'KV - Beitragssätze ' || $hdr_abr_header_date1
   let $HD_KV_Allg = 'allgemein: ' || $hdr_abr_per_kv_1000
   let $HD_KV_Erht = 'erhöht: ' || $hdr_abr_per_kv_2000
   let $HD_KV_Verm = 'vermindert: ' || $hdr_abr_per_kv_3000
   let $HD_KV_Gering = 'geringfügig Besch.: ' || $hdr_abr_per_kv_6000
   let $HD_RV_Voller = 'RV voller Beitr.: ' ||  $hdr_abr_per_rv_0100
   let $HD_RV_Halber = 'RV halber Beitr.: ' ||  $hdr_abr_per_rv_0300
   let $HD_RV_Gering = 'RV geringf. Beschäft.: ' ||  $hdr_abr_per_rv_0500
   let $HD_AV_Voller = 'AV voller Beitr.: ' ||  $hdr_abr_per_av_0010
   let $HD_AV_Halber = 'AV halber Beitr.: ' ||  $hdr_abr_per_av_0020
   let $HD_PV = 'Beitragssatz PV: ' || $hdr_abr_per_pv_0001
   let $HD_Umlage1 = 'Umlage 1: ' || $hdr_abr_per_uv1
   let $HD_Umlage2 = 'Umlage 2: ' || $hdr_abr_per_uv2
   let $HD_KVdR       = 'KVdR: ' || $hdr_abr_per_kvdr
   let $HD_PV_KVdR    = 'Beitragssatz PV KVdR       : ' || $hdr_abr_per_pv_kvdr1
   let $HD_PV_KVdR1_2 = 'Beitragssatz PV KVdR 1/2 : ' || $hdr_abr_per_pv_kvdr2

   ! wdu05-881b8: additional percentage for Zusatz insurance
   if ( $CtlPayEnd_DTCmp >= $ZusStichtag )
      let #ZusatzPct = 0.9
      do format-number(#ZusatzPct,$ZusatzPctText,'888.00')
      let $HD_KV_Zusatz =  'Zusatzbeitrag: ' || $ZusatzPctText
   end-if
!adj08-890b16 : Health Ins Rates
   if #phase = 1 and $yy09 >= '2009'
      let #ZusatzPct = 0
      do format-number(#ZusatzPct,$ZusatzPctText,'888.00')
      let $HD_KV_Zusatz =  'Zusatzbeitrag: ' || $ZusatzPctText
   end-if
   !begin print percentage
   print $HD_BeitrSaetze (8,1)

  if $Is_KVdR <> 'Y'
!adj08: Print Contribution rates only for 98000006
    if rtrim($hdr_abr_kk_nummer,' ') <> '98000006'
        print $HD_KV_Allg  (8,25)
        print $HD_KV_Erht  (9,25)
        print $HD_KV_Verm  (10,25)
    end-if
! adj 1680048000 - Issue with Contribution Rates
    if rtrim($hdr_abr_kk_nummer,' ') = '98000006'
         let $HD_KV_Gering = 'geringfügig Besch.: ' || $hdr_abr_per_kv_6000
!adj08-890b16 : Health Ins Rates
            print $HD_KV_Gering  (9,1)
    end-if

   print $HD_RV_Voller  (8,48)
   print $HD_RV_Halber  (9,48)
   print $HD_RV_Gering  (10,48)
   print $HD_AV_Voller  (8,80)
   print $HD_AV_Halber  (9,80)
   print $HD_PV  (11,80)
   print $HD_Umlage1 (9,116)
   print $HD_Umlage2 (10,116)
  else
   print $HD_KVdR  (8,25)
   print $HD_PV_KVdR  (8,48)
   print $HD_PV_KVdR1_2  (9,48)
  end-if
     ! wdu05-881b8 added Zusatz insurance percentage
     print $HD_KV_Zusatz  (10,80)

   graphic (13,1,150) box 2 0 12
   graphic (12,56,2) vert-line 2
   graphic (12,70,2) vert-line 2
   graphic (12,90,2) vert-line 2
   graphic (12,110,2) vert-line 2
   graphic (12,130,2) vert-line 2
   print 'Beitragsart'  (14,2)   bold
   print 'Gruppe'       (14,60)  bold
   print 'Brutto '      (14,83)  bold
   print 'Gesamt'       (14,102) bold
   print 'AG-Anteil'    (14,120) bold
   print 'AN-Anteil'    (14,141) bold
end-heading
!************************************************************************




begin-heading  15 for-reports = (Abrechnung_Umlage)
  do Get-Header-Data-Abr

  let $HD_Title1 = 'Umlageliste / ' ||
      ltrim(rtrim($HD_Month_Name,' '),' ') || ' ' || $HD_yy
  let $HD_Title1K = 'Korrekturen Vorjahre'
!adj08-890b16 : Contr. previous year
  if #phase = 2
!  if $march = 'Y--gibts-nimmer'
     alter-printer
       font= 4
       point-size =28
     print $HD_Title1              (1,1) bold
     graphic (3,1,180) horz-line 10
     alter-printer
       font= 4
       point-size =20
     print $HD_Title1K            (5,1) bold
  else
     alter-printer
       font= 4
       point-size =28
     print $HD_Title1        (1,1) bold
     graphic (3,1,180) horz-line 10
  end-if
  alter-printer
    font= 4
    point-size =13
  let $HD_KrankenKasse = 'Krankenkasse : ' || ltrim(rtrim($hdr_abr_si_provider, ' '),' ')  ||
      ' ' || ltrim(rtrim($hdr_abr_kk_name, ' '),' ')
  print $HD_KrankenKasse (6,1)
  let $HD_KK_BetrNr = 'Kassenbetriebsnummer : ' || $hdr_abr_kk_nummer
  print $HD_KK_BetrNr                    (6,48)
  print $RegionString                           (5,48)
  let $HD_BeirtKonto = 'Beitrags-Konto : ' || rtrim(ltrim($hdr_abr_beitragskonto,' '),' ')
  print $HD_BeirtKonto    (6,116)
  let $HD_Zahlstelle = 'Zahlstelle : ' || rtrim(ltrim($hdr_abr_zahlstellen_nr,' '),' ')
  print $HD_Zahlstelle (7,116)
  print 'Arbeitgeberangaben:' (6,147,44)
  let $HD_Firma = $hdr_abr_Payentity_name
  print $HD_Firma                               (7,147,44)
  let $HD_Strasse = $hdr_abr_Payentity_street
  print $HD_Strasse                              (8,147,44)
  let $HD_Ort = $hdr_abr_Payentity_zip_city
  print $HD_Ort                                 (10,147,44)
  let $HD_BetrNr = 'Betriebsnummer: ' || $hdr_abr_GPDE_DO_BTNR
  print $HD_BetrNr                      (11,147,36)
  print 'Seite :'               (1,132)
  print '['                     (1,140)
  if #page-count < 10
     print #page-count          (0,0) edit 9
  else
     print #page-count          (0,0) edit 99
  end-if
  print ']'                     (0,0)
  print 'Datum :'               (2,132)
  print $hdr_abr_header_date    (2,140)
  let $Bemerk = $Bezeichn || ' ' || $VersionsNr
  print $Bemerk (3,132)
  let #Date_Type = {DateType}
  if $ActEffDt_UV <> ''
         do ConvertToComponents($ActEffDt_UV,$yy11,$mm11,$dd11)
         evaluate #Date_Type
         when = 2
            let $hdr_abr_header_date1 = $yy11 || '{PTDateDelim}' || $mm11
            break
         when-other
            let $hdr_abr_header_date1 = $mm11 || '{PTDateDelim}' || $yy11
            break
         end-evaluate
   else
         let $hdr_abr_header_date1 = ' '
   end-if
  let $HD_BeitrSaetze = 'Beitragssätze ' || $hdr_abr_header_date1
  let $HD_Umlage1 = 'Umlage 1: ' || $hdr_abr_per_uv1
  let $HD_Umlage2 = 'Umlage 2: ' || $hdr_abr_per_uv2
  !begin print percentage
  print $HD_BeitrSaetze (8,1)
  print $HD_Umlage1 (8,25)
  print $HD_Umlage2 (8,48)
!adj08-890b17 : Print Refund Ins. Insolvency Percentage on Umlage Report.
!adj09:Increased RI Percentage
!SI Limits and Rates Jan 2011
 
 EVALUATE $yy09 
 WHEN = '2009' 
      let  $Refund = '0.10'   
      BREAK 
 WHEN = '2010' 
      let  $Refund = '0.41'   
      BREAK 
 WHEN = '2011' 
     let  $Refund = '0.00'   
     BREAK 
 WHEN = '2012' 
     let  $Refund = '0.04'    
     BREAK 
 WHEN >= '2013' 
     let  $Refund = '0.15'    
     BREAK
 WHEN-OTHER 
     let  $Refund = '0.00' 
 END-EVALUATE 
 
  print 'Insolvenz :' (8,73)
  print $Refund (8,82)
  graphic (13,1,180) box 3 0 12
  graphic (12,14,3) vert-line 2
  !graphic (12,39,3) vert-line 2
  graphic (12,48,3) vert-line 2
  graphic (12,59,3) vert-line 2 !kv
  graphic (13,65,2) vert-line 2
  graphic (13,71,2) vert-line 2
  graphic (13,77,2) vert-line 2 !pv
  graphic (12,83,3) vert-line 2  !u1 =1+2
  graphic (12,96,3) vert-line 2
  graphic (12,111,3) vert-line 2
  graphic (12,125,3) vert-line 2
  graphic (12,139,3) vert-line 2
  graphic (12,153,3) vert-line 2
  graphic (12,167,3) vert-line 2
  print 'SV-Schlüssel'        (13,65) bold
  print '1 = U1 + U2'         (13,84) bold
  print 'Entgelt'             (13,103) bold
  print 'Beitrag'             (13,117) bold
  print 'Entgelt'             (13,131) bold
  print 'Beitrag'             (13,145) bold
  print 'Entgelt'             (13,158) bold
  print 'Beitrag'             (13,172) bold
  ! adj89b16: Refund Ins Insolvency
  print 'Pers.-Nr./'            (14,2) bold
  print 'Rec. -Nr.'           (15,2) bold
  print 'Name,Vorname'        (15,15) bold
!adj09:incr col name
  !print 'Korrektur'           (15,40) bold
  print 'Korrektur'           (15,49) bold
  print 'KV'                  (15,60) bold
  print 'RV'                  (15,66) bold
  print 'AV'                  (15,72) bold
  print 'PV'                  (15,78) bold
  print '2 = U2'              (15,86) bold
  print 'U1'             (15,105) bold
  print 'U1'             (15,119) bold
  print 'U2'             (15,132) bold
  print 'U2'             (15,147) bold
  print 'Insolvenz'      (15,157) bold
  print 'Insolvenz'      (15,171) bold

end-heading
!************************************************************************
begin-heading  13 for-reports = (Freiwillig)
  do Get-Header-Data-Abr
  let $HD_Title1 = 'Liste freiwillige KV/PV / ' ||
  ltrim(rtrim($HD_Month_Name,' '),' ') || ' ' || $HD_yy
  let $HD_Title1K = 'Korrekturen Vorjahre'
!adj08-890b16 : Contr. previous year
   if #phase = 2
  !  if $march = 'Y--gibts-nimmer'
     alter-printer
       font= 4
       point-size =28
     print $HD_Title1              (1,1) bold
     graphic (3,1,180) horz-line 10
     alter-printer
       font= 4
       point-size =20
     print $HD_Title1K            (5,1) bold
  else
     alter-printer
       font= 4
       point-size =28
     print $HD_Title1        (1,1) bold
     graphic (3,1,180) horz-line 10
  end-if
  alter-printer
    font= 4
    point-size =13
!ChangeFor2004Bundle2
!/ was wrong
!/  let $HD_KrankenKasse = 'Krankenkasse : ' || ltrim(rtrim($SI_Provider, ' '),' ')  ||
!/      ' ' || ltrim(rtrim($KK_Name, ' '),' ')
  let $HD_KrankenKasse = 'Krankenkasse : ' || ltrim(rtrim($hdr_abr_si_provider, ' '),' ')  ||
      ' ' || ltrim(rtrim($hdr_abr_kk_name, ' '),' ')
  print $HD_KrankenKasse (6,1)

!ChangeFor2004Bundle2
!/ was wrong
!/  let $HD_KK_BetrNr = 'Kassenbetriebsnummer : ' || $KK_Nummer
  let $HD_KK_BetrNr = 'Kassenbetriebsnummer : ' || $hdr_abr_kk_nummer

  print $HD_KK_BetrNr                    (6,48)
  print $RegionString                           (5,48)

!ChangeFor2004Bundle2
!/  let $HD_BeirtKonto = 'Beitrags-Konto : ' || rtrim(ltrim($Beitragskonto,' '),' ')
  let $HD_BeirtKonto = 'Beitrags-Konto : ' || rtrim(ltrim($hdr_abr_beitragskonto,' '),' ')
  print $HD_BeirtKonto    (6,116)

!ChangeFor2004Bundle2
!/  let $HD_Zahlstelle = 'Zahlstelle : ' || rtrim(ltrim($Zahlstellen_nr,' '),' ')
  let $HD_Zahlstelle = 'Zahlstelle : ' || rtrim(ltrim($hdr_abr_zahlstellen_nr,' '),' ')

  print $HD_Zahlstelle (7,116)
  print 'Arbeitgeberangaben:' (6,147,44)
  let $HD_Firma = $hdr_abr_Payentity_name
  print $HD_Firma                               (7,147,44)
  let $HD_Strasse = $hdr_abr_Payentity_street
  print $HD_Strasse                              (8,147,44)
  let $HD_Ort = $hdr_abr_Payentity_zip_city
  print $HD_Ort                                 (10,147,44)
  let $HD_BetrNr = 'Betriebsnummer: ' || $GPDE_DO_BTNR
  print $HD_BetrNr                      (11,147,36)
  print 'Seite :'               (1,132)
  print '['                     (1,140)
  if #page-count < 10
     print #page-count          (0,0) edit 9
  else
     print #page-count          (0,0) edit 99
  end-if
  print ']'                     (0,0)
  print 'Datum :'               (2,132)
  print $hdr_abr_header_date    (2,140)
  let $Bemerk = $Bezeichn || ' ' || $VersionsNr
  print $Bemerk (3,132)
  graphic (12,1,180) box 2 0 12
  graphic (11,14,2) vert-line 2
  graphic (11,60,2) vert-line 2
  graphic (11,80,2) vert-line 2
  graphic (11,100,2) vert-line 2
  graphic (11,120,2) vert-line 2
  graphic (11,140,2) vert-line 2
  graphic (11,160,2) vert-line 2
  print 'Pers.-Nr./'          (12,2)   bold
  print 'Rec. -Nr.'           (13,2)   bold
  print 'Name,Vorname'        (13,15)  bold
  print 'Korrektur'           (13,61)  bold
  print 'SV-Entgelt'          (13,90)  bold
  print 'Gesamt KV'           (13,109) bold
  print 'KV/AG'               (13,133) bold
  print 'Gesamt PV'           (13,149) bold
  print 'PV/AG'               (13,174) bold
end-heading
!**************************************************
begin-heading 1 for-reports=(Nachweis)
end-heading
!**************************************************
begin-procedure Get_Type_Options
let $Name_Type       = ''
let $Addr_Type       = ''
let $Phone_Type      = ''
let $Email_Type      = ''
let $BirthName_Type  = ''
begin-select distinct
INST.NAME_TYPE
INST.ADDRESS_TYPE
INST.PHONE_TYPE
INST.E_ADDR_TYPE
INST.GPDE_BIRTH_NM_TYPE
   let $Name_Type      = &INST.NAME_TYPE
   let $Addr_Type      = &INST.ADDRESS_TYPE
   let $Phone_Type     = &INST.PHONE_TYPE
   let $Email_Type     = &INST.E_ADDR_TYPE
   let $BirthName_Type = &INST.GPDE_BIRTH_NM_TYPE
from PS_GPDE_AL_INSTALL INST
end-select
end-procedure
!*************************************************
begin-procedure CheckArchitektKasse
let $PrintArchitect = 'Y'

begin-select
PV.GPDE_AL_PROV_TYPE
PV.GPDE_SI_PROV
  if LTRIM(RTRIM(&PV.GPDE_AL_PROV_TYPE,' '),' ') = '08'
    let $PrintArchitect = 'N'
  end-if
from PS_GPDE_SI_PROV PV
where PV.GPDE_SI_PROV = $ActualProv
and PV.EFFDT = (SELECT MAX(EFFDT) FROM PS_GPDE_SI_PROV PV1
    WHERE PV1.GPDE_SI_PROV = PV.GPDE_SI_PROV and
              PV1.EFFDT <= $Ctl_Curr_Pay_End_Dt)
end-select
end-procedure
!*************************************************




begin-procedure GetProviderNextFileNumber
!
! we store the finalized number only!
! we only increase after update, (not really required, if we get next number from here)
!
! there is only one file per payentity-provider because KVDR is handled separately !
!

!if #FileNumber >= 0
!    ! this is not the first call of this routine
!    ! just increment and return when not in finalize mode
!    let #FileNumber = #FileNumber +1
!    goto prv_non_final_jmp
!end-if

let #FileNumber = 0
let $EarlierFinalDiskExists = 'N'
begin-select
FN.PAY_ENTITY
FN.GPDE_DV_RCVER_ID
FN.GPDE_RC_FILE_NBR
FN.GPDE_SI_IS_KVDR
   let #FileNumber = &FN.GPDE_RC_FILE_NBR
   let $EarlierFinalDiskExists = 'Y'
from PS_GPDE_RC_SI10_1 FN
where FN.PAY_ENTITY = $Ctl_PayEntity and
      FN.GPDE_DV_RCVER_ID = $GPDE_DV_RCVER_ID
      AND FN.GPDE_SI_IS_KVDR = $Is_KVdR
end-select

    ! we always use last finalized + 1
!adj10-increment file number during final run.
!   let #FileNumber = #FileNumber + 1

    if $ResetFileNumber = 'Y'
       let #FileNumber = 1      
    end-if

    if #FileNumber = 0
       let #FileNumber = 1
!during the first run, there is no row in the record and for final run file number is not incremented, insert a row in the record.
begin-sql
insert into PS_GPDE_RC_SI10_1(PAY_ENTITY,GPDE_DV_RCVER_ID,GPDE_SI_IS_KVDR,GPDE_RC_FILE_NBR )
values ($Ctl_PayEntity,$GPDE_DV_RCVER_ID,$Is_KVdR,#FileNumber)
end-sql
    end-if

    if #FileNumber > 999
       let #FileNumber = 1
    end-if
prv_non_final_jmp:
  move #FileNumber to $FileNumber 0999
  let $FileNumber = rtrim($FileNumber,' ')

  #debug show 'now using FileNumber=' $FileNumber  ' KVDR=' $Is_KVdR
end-procedure
!*************************************************




begin-procedure UpdateProviderFileNumber
! we want to store the number after finalize, so the next run works
! with the next number

if $CloseFlag = 'Y'
    ! we update only on close='Y'
    move #FileNumber to $FileNumberTmp 0999    


    ! check for existing row
    if $EarlierFinalDiskExists = 'Y'
begin-sql
update PS_GPDE_RC_SI10_1
set GPDE_RC_FILE_NBR = #FileNumber  + 1  !adj10- increment at final run
where PAY_ENTITY = $Ctl_PayEntity
and GPDE_DV_RCVER_ID = $GPDE_DV_RCVER_ID
and GPDE_SI_IS_KVDR = $Is_KVdR
end-sql
   else
    ! no row existed, write one
begin-sql
insert into PS_GPDE_RC_SI10_1(PAY_ENTITY,GPDE_DV_RCVER_ID,GPDE_SI_IS_KVDR,GPDE_RC_FILE_NBR )
values ($Ctl_PayEntity,$GPDE_DV_RCVER_ID,$Is_KVdR,#FileNumber)
end-sql
end-if
 #debug show 'Update ProviderFileNumber: '  $FileNumberTmp ' KVDR=' $Is_KVdR ' Close=' $CloseFlag ' ExistRow=' $EarlierFinalDiskExists
end-if

end-procedure
!*************************************************





begin-procedure GetDakotaFileNumber
! wdu05-881jw06: the filenumber is systemwide in the future (separate for KVDR)
! the filenumber is now managed thru a dummy system company and provider
!

!if #DakotaNumber >= 0
!    ! this is not the first call of this routine
!    ! just increment and return when not in finalize mode
!    let #DakotaNumber = #DakotaNumber +1
!    goto dak_non_final_jmp
!end-if

! return last used (finalized) number +1 here
    let #DakotaNumber = 0
    let $DakotaExistRow = 'N'
begin-select
FNDA.PAY_ENTITY
FNDA.GPDE_DV_RCVER_ID
FNDA.GPDE_RC_FILE_NBR
       let #DakotaNumber = &FNDA.GPDE_RC_FILE_NBR
       let $DakotaExistRow = 'Y'
from PS_GPDE_RC_SI10_1 FNDA
where FNDA.PAY_ENTITY = 'SYSBN'
  and FNDA.GPDE_DV_RCVER_ID = 'SYSBN'
  and GPDE_SI_IS_KVDR = $Is_KVdR
end-select
! return latest finalized number + 1
    let #DakotaNumber = #DakotaNumber + 1

!    if $CloseFlag = 'Y'
!       let #DakotaNumber = #DakotaNumber + 1
!    end-if

!    if $ResetFileNumber = 'Y'
!       let #DakotaNumber = 1
!    end-if

    if #DakotaNumber = 0
       let #DakotaNumber = 1
    end-if
! wdu05-881jw06: restart when number range overflows
    if #DakotaNumber > 999
       let #DakotaNumber = 1
    end-if

dak_non_final_jmp:
  move #DakotaNumber to $DakotaNumber 0999
  let $DakotaNumber = rtrim($DakotaNumber,' ')

end-procedure
!*************************************************



begin-procedure UpdateDakotaFileNumber
! wdu05-881jw06: the filenumber is systemwide in the future
! the filenumber is now managed thru a dummy system company and provider and KVDR
!
if $CloseFlag = 'Y'
   ! only update when the report was final
        move #DakotaNumber to $DakotaTmp 0999

   if $DakotaExistRow = 'Y'
begin-sql
update PS_GPDE_RC_SI10_1
set GPDE_RC_FILE_NBR = #DakotaNumber
where PAY_ENTITY = 'SYSBN'
  and GPDE_DV_RCVER_ID = 'SYSBN'
  and GPDE_SI_IS_KVDR = $Is_KVdR
end-sql
else
begin-sql
insert into PS_GPDE_RC_SI10_1(PAY_ENTITY,GPDE_DV_RCVER_ID,GPDE_SI_IS_KVDR,GPDE_RC_FILE_NBR )
values ('SYSBN','SYSBN',$Is_KVdR,#DakotaNumber)
end-sql
   end-if
end-if

! counting is done also when we do not finalize, otherwise we get duplicate filenames
let #DakotaNumber = #DakotaNumber + 1
end-procedure
!*************************************************




begin-procedure Open-File
  do GetProviderNextFileNumber
  do GetDakotaFileNumber
  let #RecordCounter = 0
end-procedure
!************************************************




begin-procedure CheckForPrint
! param_in: &SIA.GPDE_SI_PROV_MAND   currently selected provider from PrepDeleteRows
!
! checks if the passed provider is the provider from the runcontrol
! or a provider that depends on the specified provider.
!
let $ExistsOne = 'N'
begin-select distinct
PROVM.GPDE_SI_PROV
   let $ProvMandTmp = rtrim(&PROVM.GPDE_SI_PROV,' ')
   let $ExistsOne = 'Y'
from PS_GPDE_SI_PROV PROVM
WHERE PROVM.GPDE_SI_PROV = &SIA.GPDE_SI_PROV_MAND
! compare receiver-id with receiver-id from runcontrol
AND (PROVM.GPDE_DV_RCVER_ID = $GPDE_DV_RCVER_ID
OR (PROVM.GPDE_SI_PROV_ID = PROVM.GPDE_SI_PROV
AND PROVM.GPDE_SI_PROV = $GPDE_DV_RCVER_ID and
PROVM.GPDE_DV_RCVER_YN = 'Y' ))  and
PROVM.EFFDT = (SELECT MAX(EFFDT) FROM PS_GPDE_SI_PROV PROVM1
          WHERE PROVM1.GPDE_SI_PROV = PROVM.GPDE_SI_PROV AND
                PROVM1.EFFDT <= $Ctl_Curr_Pay_End_Dt)
end-select
!
! if the current provider was not the runcontrol-provider or
! dependent on it, then the data are not relevant and can be deleted.
!
if $ExistsOne = 'N'
begin-sql
delete from PS_GPDE_RP_SI10A
where GPDE_SI_PROV_MAND = &SIA.GPDE_SI_PROV_MAND
end-sql
end-if
end-procedure
!************************************************




begin-procedure PrepDeleteRows
! discard all data which are not related to the provider on the runcontrol
! or its dependents.
!**************
IF #RecCnt > 1
!for 1st recv data is picked from  PS_GPDE_RP_SI10A, when there are more recv, the data is lost in PrepDeleteRows,
!therefore PS_GPDE_RP_SI10A needs to be re-populated.
begin-sql
delete from PS_GPDE_RP_SI10A
end-sql

begin-sql
insert into PS_GPDE_RP_SI10A select * from PS_GPDE_RP_SI10A1
end-sql
END-IF
!**************
! if a provider is not the runcontrol-provider or dependent on it, then the data are not relevant and can be deleted.
begin-select distinct
SIA.GPDE_SI_PROV_MAND
   do CheckForPrint
from PS_GPDE_RP_SI10A SIA
end-select
end-procedure
!************************************************
begin-procedure PrepDeleteRows_A
!The PS_GPDE_RP_SI10A should have information for all the receivers on the run control page.
begin-select distinct
SIA_A.GPDE_SI_PROV_MAND
   do CheckForPrint_A
from PS_GPDE_RP_SI10A SIA_A
end-select
end-procedure


begin-procedure CheckForPrint_A
! param_in: &SIA_A.GPDE_SI_PROV_MAND   currently selected provider from PrepDeleteRows
!
!SQL is modified to retain the data of all the receivers which are available run control page.
!
let $ExistsOne = 'N'
begin-select distinct
PROVM_A.GPDE_SI_PROV
   let $ProvMandTmp = rtrim(&PROVM_A.GPDE_SI_PROV,' ')
   let $ExistsOne = 'Y'

from PS_GPDE_SI_PROV PROVM_A
WHERE PROVM_A.GPDE_SI_PROV = &SIA_A.GPDE_SI_PROV_MAND
! compare receiver-id with receiver-id from runcontrol
!adj - keeping all recv data from run control page
AND (PROVM_A.GPDE_DV_RCVER_ID IN (select GPDE_DV_RCVER_ID from PS_GPDE_RC_SI10RCV LOOP2a2
                              where LOOP2a2.OPRID = $prcs_oprid
                              AND LOOP2a2.RUN_CNTL_ID = $prcs_run_cntl_id)

OR (PROVM_A.GPDE_SI_PROV_ID = PROVM_A.GPDE_SI_PROV
AND PROVM_A.GPDE_SI_PROV = $GPDE_DV_RCVER_ID
and PROVM_A.GPDE_DV_RCVER_YN = 'Y' ))  and
PROVM_A.EFFDT = (SELECT MAX(EFFDT) FROM PS_GPDE_SI_PROV PROVM1_A
          WHERE PROVM1_A.GPDE_SI_PROV = PROVM_A.GPDE_SI_PROV AND
                PROVM1_A.EFFDT <= $Ctl_Curr_Pay_End_Dt)
end-select
!
! if the current provider was not the runcontrol-provider or
! dependent on it, then the data are not relevant and can be deleted.
!
if $ExistsOne = 'N'
! show 'recv not on run control page,,,,, deleting &SIA.GPDE_SI_PROV_MAND == ' &SIA.GPDE_SI_PROV_MAND
begin-sql
delete from PS_GPDE_RP_SI10A
where GPDE_SI_PROV_MAND = &SIA_A.GPDE_SI_PROV_MAND
end-sql
end-if
end-procedure



begin-procedure Get_VersionNr
begin-select
VERS.GPDE_VERSION_NR
VERS.NAME

! jjj-89B11-1674660000: 20th Jul 07 Changes for MODID.
VERS.GPDE_DV_PRODID
VERS.GPDE_DV_MODID


from PS_GPDE_VERSION VERS
end-select
let $VersionsNr = rtrim(&VERS.GPDE_VERSION_NR,' ')
let $Bezeichn   = rtrim(&VERS.NAME, ' ')

! jjj-89B11-1674660000: 20th Jul 07 Changes for MODID.
let $PRODID = rtrim(&VERS.GPDE_DV_PRODID, ' ')
let $MODID = rtrim(&VERS.GPDE_DV_MODID, ' ')

end-procedure
!************************************************





begin-procedure Process-Main
show {gpdeversionstamp}
!
! set filenumbers = -1 to indicate the
! first call to GetProviderNextFileNumber and GetDakotaFileNumber
    let #DakotaNumber = -1
    let #FileNumber = -1

if rtrim($Ctl_PayEntity, ' ') = ''
  goto nodata
end-if

! wdu06-kug retrieve clerk personal info via OPRID
    let $SBA_Oprid = $prcs_oprid

! rh07-89B09 = obsolete as clerk information is passed via run control record
!    do GetClerkInfo

    ! wdu05-881jw06: new logic for Betriebsnummer
    ! Betriebsnummer of PayEntity only depends on the payentity on the Runcontrol
    ! we want it from GPDE_AL_PE_LOC where it is marked in GPDE_AL_PE_LOC.GPDE_SI_REP_BTNR
    !
    do SetPayEntityBetriebsnummer
    if $PayentBtnr = ' '
        goto nodata
    end-if


    do Get_VersionNr
    do Get_Type_Options


    ! load current ('A') into PS_GPDE_RP_SI10
    !      'A' means: calculated in the month entered on the runcontrol (aktuelle Daten)
    !      (RP01a.GPDE_AL_CPAY_ENDDT = $Ctl_Curr_Pay_End_Dt)
    !      This includes all _new_ results from _previous_ months(!)
    do Get-Data
    ! not quite true: load retro data for each emplid
    !         retro is a misnomer here.
    !         better:  load previous version rows into PS_GPDE_RP_SI10 as 'R'
    !         (new interpretation for 'R': old row which needs to be REMOVED (cancelled/stornoed)
    !          or "Ruecknahme alter Wert")
    !  so:
    !         insert storno rows only for CAL_IDs where we had a retro out of the
    !         current calculation.
    !
    do Select_Data_Distinct

    ! mark rows for delta processing
    !
    ! all rows from the current calculation set 'A' will become 'N' if the
    ! PRD_END_DT was before the CURR_PRD_END_DT (which means they were in fact retros)
    !
    ! wdu06-881b11 removed old call:    do Initial_OldNew_Row
    do MarkNewVersionRows

    ! ---------------------------------------------------------------------------------
    ! now we have the following row types in GPDE_RP_SI10
    ! ---------------------------------------------------------------------------------
    ! ( current calculation means: calculated out of the month in the title/runcontrol)
    !   'A'     current period only (no old version exists for this anyway)
    !   'N'     new version of retro periods out of the current calculation
    !   'R'     old version of retro periods out of the current calculation
    !           (out of a previous calculation)
    ! ---------------------------------------------------------------------------------


    ! delete SI10A, SI10B
    ! create a list of all impacted providers in table PS_GPDE_RP_SI10B (from PS_GPDE_RP_SI10)
    do Prepare-Print-Data

    ! wdu05b7: moved 'Prepare_Fill_Result_Data' and 'Prepare_Fill_Result_Data' up here for structure
    !
    ! Schema:
    ! loop over all providers in SI10B,
    !               -- call 'do Fill_Result_Data' which loops over all emplids in PS_GPDE_RP_SI10 and
    !                       --  collect amounts in variables only if they match the current provider from SI10B
    !                           so this is a provider-filter
    !                       -- call 'do InsertResultData' to store values to PS_GPDE_RP_SI10A
    !
    !
    ! finally we get rows like in RP_SI10, but with data for one provider only
    ! what about the duplicate keys? using #Countr as AUX-key
    do Prepare_Fill_Result_Data
    ! voluntary
    do Prepare_Result_Data_Freiw


if rtrim($GPDE_DV_RCVER_ID,' ') <> ''
    ! if a receiver was specified on runcontrol, then discard all data which are not
    ! related to the provider on the runcontrol or its dependents.
 !   do PrepDeleteRows
 end-if
 do Get-PayEntity-Address
!********************************
!adj10: prepare a copy of PS_GPDE_RP_SI10A
begin-sql
delete from PS_GPDE_RP_SI10A1
end-sql

begin-sql
insert into PS_GPDE_RP_SI10A1 select * from PS_GPDE_RP_SI10A
end-sql
!********************************

Let #RecCnt = 0
begin-select
LOOP2a1.GPDE_DV_RCVER_ID
 let $GPDE_DV_RCVER_ID =  &LOOP2a1.GPDE_DV_RCVER_ID

  Let #RecCnt = #RecCnt + 1

 if rtrim($GPDE_DV_RCVER_ID,' ') <> ''
    ! if a receiver was specified on runcontrol, then discard all data which are not
    ! related to the provider on the runcontrol or its dependents.
!Adj: delete rows for all other providers that are not on Run Control page.
    do PrepDeleteRows

 end-if
! prepare and print data if provider type is 'ProvCIs'
 do getProviderType($provider_type, $GPDE_DV_RCVER_ID)

    let $provider_type = ltrim(rtrim($provider_type, ' '), ' ')
 if $provider_type = '08'
    let $Is_KVdR = 'N'    
    let $CONFIRM_EMAIL = 'J'    
    do Print_data_BVBEI
 end-if


! Vorbereitung bis hier,
! freiwillige sind in CHAR01 gekennzeichnet
! Rows gekennzeichnet mit 'N'eue Version, 'R'etro-Monat  'A'ktueller Monat
!    besser formuliert: 'R' = Ruecknahme alter Wert (CAL_RUN_ID= alte CAL_RUN_ID)
!
! GPDE_RP_SI10A
! #######################################
!  1.) No KVdR reports
! #######################################
    show '---------------- Ausdruck (kein KVdR) ---------------'

    let $Is_KVdR = 'N'
    if rtrim($GPDE_DV_RCVER_ID,' ') <> ''
       do Open-File
    end-if
    let $CONFIRM_EMAIL = 'J'
    do CX_SetFilenamesNonKVDR


 let #FirstOpen = 0
 let $ActEffDt = ''
 let $Korr = 'N'
 let $MinusNull = '-0' || $SDecimal || '00'
 let $PlusNull = '0' || $SDecimal || '00'

 !*** keine Maerz-Klausel
 let $EffDateTemp = $Ctl_Curr_Pay_End_DT
 alter-printer
   font = 4
   point-size = 13
 use-report Abrechnung
 let $march = 'N'
 let $sav_Currency = ' '
 let $mode = 'AN'
!
 !show 'file before print  '
 let $reportdir = $reportdir1n

 new-report $reportdir

 use-report Abrechnung_Sum
 let $reportdir = $reportdir2n
 new-report $reportdir

 use-report Nachweis
 let $reportdir = $reportdir3n
 new-report $reportdir


 use-report Abrechnung_Umlage
 let $reportdir = $reportdir4n
 new-report $reportdir


 use-report Freiwillig
 let $reportdir = $reportdir5n
 new-report $reportdir
 use-report Abrechnung
 do Process-Main1


! #######################################
!  2.)  KVdR reports
! #######################################
    show '---------------- Ausdruck (KVdR) ---------------'
    let $Is_KVdR = 'Y'
    if rtrim($GPDE_DV_RCVER_ID,' ') <> ''
        do Open-File
    end-if
    let $CONFIRM_EMAIL = 'J'
    do CX_SetFilenamesKVDR

 let #FirstOpen = 0
 let $ActEffDt = ''
 let $Korr = 'N'
 let $MinusNull = '-0' || $SDecimal || '00'
 let $PlusNull = '0' || $SDecimal || '00'

 !*** keine Maerz-Klausel
 let $EffDateTemp = $Ctl_Curr_Pay_End_DT
 alter-printer
   font = 4
   point-size = 13
 use-report Abrechnung
 let $march = 'N'
 let $sav_Currency = ' '
 let $mode = 'AN'

 let $reportdir = $reportdir1k

 new-report $reportdir

 use-report Abrechnung_Sum
 let $reportdir = $reportdir2k
 new-report $reportdir

 use-report Nachweis
 let $reportdir = $reportdir3k
 new-report $reportdir
 use-report Abrechnung

 do Process-Main1
    show '---------------- Ausdruck Ende ---------------'
   ! LET  #FirstOpen = 0
from PS_GPDE_RC_SI10RCV LOOP2a1
where LOOP2a1.OPRID = $prcs_oprid
AND LOOP2a1.RUN_CNTL_ID = $prcs_run_cntl_id
order by  LOOP2a1.GPDE_DV_RCVER_ID
end-select


 #debug show 'The process below is run to generate correct PDF files when there are no or more than one receiver.'

if rtrim($GPDE_DV_RCVER_ID,' ') = ''  OR  #RecCnt > 1

 let $GPDE_DV_RCVER_ID = ''
!************************when there is no receiver ******************
!adj10: The data in driver record PS_GPDE_RP_SI10A is lost in process of generating EBNA files
begin-sql
delete from PS_GPDE_RP_SI10A
end-sql

begin-sql
insert into PS_GPDE_RP_SI10A select * from PS_GPDE_RP_SI10A1
end-sql
!********************************
    !delete when there are receivers
    if  #RecCnt > 1
         do PrepDeleteRows_A
    end-if

! GPDE_RP_SI10A
! #######################################
!  1.) No KVdR reports
! #######################################
    show '---------------- Ausdruck (kein KVdR) ---------------'

    let $Is_KVdR = 'N'
    if rtrim($GPDE_DV_RCVER_ID,' ') <> ''
       do Open-File
    end-if
    do CX_SetFilenamesNonKVDR


 let #FirstOpen = 0
 let $ActEffDt = ''
 let $Korr = 'N'
 let $MinusNull = '-0' || $SDecimal || '00'
 let $PlusNull = '0' || $SDecimal || '00'

 !*** keine Maerz-Klausel
 let $EffDateTemp = $Ctl_Curr_Pay_End_DT
 alter-printer
   font = 4
   point-size = 13
 use-report Abrechnung
 let $march = 'N'
 let $sav_Currency = ' '
 let $mode = 'AN'
!
 !show 'file before print  '
 let $reportdir = $reportdir1n

 new-report $reportdir

 use-report Abrechnung_Sum
 let $reportdir = $reportdir2n
 new-report $reportdir

 use-report Nachweis
 let $reportdir = $reportdir3n
 new-report $reportdir


 use-report Abrechnung_Umlage
 let $reportdir = $reportdir4n
 new-report $reportdir


 use-report Freiwillig
 let $reportdir = $reportdir5n
 new-report $reportdir
 use-report Abrechnung

 do Process-Main1


! #######################################
!  2.)  KVdR reports
! #######################################
    show '---------------- Ausdruck (KVdR) ---------------'
    let $Is_KVdR = 'Y'
    if rtrim($GPDE_DV_RCVER_ID,' ') <> ''
        do Open-File
    end-if
    do CX_SetFilenamesKVDR

 let #FirstOpen = 0
 let $ActEffDt = ''
 let $Korr = 'N'
 let $MinusNull = '-0' || $SDecimal || '00'
 let $PlusNull = '0' || $SDecimal || '00'

 !*** keine Maerz-Klausel
 let $EffDateTemp = $Ctl_Curr_Pay_End_DT

 alter-printer
   font = 4
   point-size = 13
 use-report Abrechnung
 let $march = 'N'
 let $sav_Currency = ' '
 let $mode = 'AN'

 let $reportdir = $reportdir1k

 new-report $reportdir

 use-report Abrechnung_Sum
 let $reportdir = $reportdir2k
 new-report $reportdir

 use-report Nachweis
 let $reportdir = $reportdir3k
 new-report $reportdir
 use-report Abrechnung

 do Process-Main1
    show '---------------- Ausdruck Ende ---------------'
end-if

!*******************************
nodata:
do Print_Info_User
end-procedure
!************************************************





begin-procedure Process-Main1
 let #SV_SUM_St    = 0
 let $WasPrintedData = 'N'
 let $WasPrint1 = 'N'
 let #currLine = 0
 let $PrintedUml = 'N'
 let $PrintF = 'N'
 let $condition_abr = ' AND (SI.GPDE_SI_STATUS_KV <> ''5'') '
 let #page-count = 1
 let $Emplid = ''
 let $SI_Provider = ''
 let $GPDE_DO_BTNR = ''
 let #sv_sum_KV_Brutto = 0
 let #sv_sum_AV_Brutto = 0
 let #sv_sum_RV_Brutto = 0
 let #sv_sum_PV_Brutto = 0
 let #sv_sum_KV_AN = 0
 let #sv_sum_KV_AG = 0
 let #sv_sum_RV_AN = 0
 let #sv_sum_RV_AG = 0
 let #sv_sum_AV_AN = 0
 let #sv_sum_AV_AG = 0
 let #sv_sum_PV_AN = 0
 let #sv_sum_PV_AG = 0
 let $NotPrinted = 'N'
 let $GPDE_DO_BTNR = ''
 let $GPDE_DO_BTNR_Old = ''
 let $GPDE_SI_PROV_MAND = ''
 let $GPDE_SI_PROV_MAND_Old = ''
 let $GPDE_SI_REGION = ''
 let $GPDE_TX_MINER = ''
 let $GPDE_SI_REGION_Old = ''
 let $GPDE_TX_MINER_Old = ''

! parameter preparation for phase 1
!
 !let $march = 'N'       ! wdu05-881b8 : added and removed again, no change

! wdu05-881jw06 disabled this marchclause select, because now printing is done
! without separate correction sheets.
     let $march_crit = ' '
     let $march_crit2 = ' '
     let $march_critF = ' '
  Let #phase = 1
  do ConvertToComponents($BegYearAct,$yy09,$mm09,$dd09)
!adj09:tax10   if $yy09 = '2009'
   if $yy09 >= '2009'
   !adj10-1953895000: handle retro rows here
    ! pages from 2009 to be reported on same page
    let $BegYearAct_1 = '01-JAN-2009'
    let $march_crit = ' and (PT.PRD_END_DT >= ' || '''' || $BegYearAct_1 || '''' || ')'
!orig code
!    let $march_crit = ' and PT.PRD_END_DT >= ' || '''' || $BegYearAct || '''' ||
!    ' and PT.PRD_END_DT <= ' || '''' || $Ctl_Curr_Pay_End_DT || ''''
    let $march_crit2 = ' '
    let $march_critF = ' and FLX.PRD_END_DT >= ' || '''' || $BegYearAct || '''' ||
    ' and FLX.PRD_END_DT <= ' || '''' || $Ctl_Curr_Pay_End_DT || ''''
   end-if
! --
! wdu05-881jw06:  need to order by GPDE_RP_MARCH_CLS before slices
! when we do the printing in one page, then the MC needs to come last for each period
 let $order1 = 'ORDER BY PBD.CURRENCY_CD DESC,PT.GPDE_SI_PROV_MAND,PBD.EMPLID,PBD.EMPL_RCD,'||
              'PT.PRD_END_DT DESC,PT.GPDE_RP_MARCH_CLS,PT.SLICE_END_DT,PT.GPDE_AL_CPAY_ENDDT'
 let $order1F = 'ORDER BY FLX.PRD_END_DT DESC,FLX.SLICE_END_DT,FLX.GPDE_AL_CPAY_ENDDT'
 let #zaehler = 0
 let $CritCurr = ' '



! PHASE 1:
! main printing loop over providers (+currency)
!    - for current year ($march='N'), PRD_END_DT > yearbegin
!    - calls Print-Beitragsabrechnung for both Regions (Ost/West)
!
begin-select
S10A.GPDE_SI_PROV_MAND
PD1.CURRENCY_CD
   let $ActProvMand = &S10A.GPDE_SI_PROV_MAND
   let $ActCurr = &PD1.CURRENCY_CD

   let $CritCurr = 'and PBD.CURRENCY_CD = ' || '''' || $ActCurr || ''''
   let $RegionAct = '1'
   let $RegionString = 'Region: Ost'
   let $RegionCritAbr = ' and (SI.GPDE_SIC_REGION = ' || '''1''' || ' or ' ||
                        'SI.GPDE_SIH_REGION = ' || '''1''' || ' or ' ||
                        'SI.GPDE_SIP_REGION = ' || '''1''' || ' or ' ||
                        'SI.GPDE_SIU_REGION = ' || '''1''' || ' ) '
  let #zaehler = 0   
   do Print-Beitragsabrechnung   
   !-------------------------------------------------------------
   !Handle the scenario where the March Clause Region is EAST But original Region is West
    
   let $march_crit = ' and (PT.GPDE_RP_MARCH_CLS = 1 ) '||  'and (' || 'PT.PRD_END_DT = ' || '''' || $Ctl_Curr_Pay_End_Dt || '''' || ')'
   let $RegionCritAbr = ' and (SI.GPDE_SIC_REGION = ' || '''2''' || ' or ' ||
                                    'SI.GPDE_SIH_REGION = ' || '''2''' || ' or ' ||
                                    'SI.GPDE_SIP_REGION = ' || '''2''' || ' or ' ||
                                    'SI.GPDE_SIU_REGION = ' || '''2''' || ' ) '
    do Print-Beitragsabrechnung      
    let $march_crit = ' and (PT.PRD_END_DT >= ' || '''' || $BegYearAct_1 || '''' || ')'      
    !-------------------------------------------------------------  
   !here data is summed up. 
   do After-Select
   let $RegionAct = '2'
   let $RegionString = 'Region: West'
   let $RegionCritAbr = ' and (SI.GPDE_SIC_REGION = ' || '''2''' || ' or ' ||
                        'SI.GPDE_SIH_REGION = ' || '''2''' || ' or ' ||
                        'SI.GPDE_SIP_REGION = ' || '''2''' || ' or ' ||
                        'SI.GPDE_SIU_REGION = ' || '''2''' || ' ) '                         
   let #zaehler = 0
   do Print-Beitragsabrechnung
   !-------------------------------------------------------------
   !Handle the scenario where the March Clause Region is WEST But original Region is East
     
   let $march_crit = ' and (PT.GPDE_RP_MARCH_CLS = 1 ) '||  'and (' || 'PT.PRD_END_DT = ' || '''' || $Ctl_Curr_Pay_End_Dt || '''' || ')'
   let $RegionCritAbr = ' and (SI.GPDE_SIC_REGION = ' || '''1''' || ' or ' ||
                                 'SI.GPDE_SIH_REGION = ' || '''1''' || ' or ' ||
                                 'SI.GPDE_SIP_REGION = ' || '''1''' || ' or ' ||
                                 'SI.GPDE_SIU_REGION = ' || '''1''' || ' ) '
   do Print-Beitragsabrechnung     
   let $march_crit = ' and (PT.PRD_END_DT >= ' || '''' || $BegYearAct_1 || '''' || ')'
   !-------------------------------------------------------------
   !Here data is summed up.  
   do After-Select   
FROM PS_GPDE_RP_SI10A S10A
    ,PS_GPDE_RP_0001 PD1
WHERE S10A.EMPLID        = PD1.EMPLID and
   S10A.EMPL_RCD    = PD1.EMPL_RCD and
   S10A.PAY_ENTITY  =  PD1.PAY_ENTITY and
   S10A.GPDE_SI_IS_KVDR = $Is_KVdR
group by S10A.GPDE_SI_PROV_MAND ,PD1.CURRENCY_CD
order by S10A.GPDE_SI_PROV_MAND,PD1.CURRENCY_CD
end-select
!adj08-890b16: Contr. previous year
! parameter preparation for phase 2
!adj09:here we print pages from previous year separately for year GT 2009
! Starting from year 2009, all the retro pages upto 2008 are printed under "Korrekturen Vorjahre" after the current pages.
 if $yy09 >= '2009'
    #ifdef ORACLE
      let $Database = 'Oracle'
      let $BegYearAct_DT = '01-JAN-2009'
    #endif
    #ifdef MICROSOFT
      let $Database = 'Microsoft SQL Server'
      let $BegYearAct_DT = '2009-01-01'
    #endif
let $march_crit = ' and (PT.PRD_END_DT < ' || '''' || $BegYearAct_DT || '''' || ')'
let $march_critF = ' and (FLX.PRD_END_DT < ' || '''' || $BegYearAct || '''' || ')'
let $march = 'Y'
let $Korr = 'Y'
let $order1 = 'ORDER BY PT.GPDE_SI_PROV_MAND,PBD.EMPLID,PBD.EMPL_RCD,'||
              'PT.PRD_END_DT DESC,PT.SLICE_END_DT,PT.GPDE_AL_CPAY_ENDDT'
let $order1F = 'ORDER BY FLX.PRD_END_DT DESC,FLX.SLICE_END_DT,FLX.GPDE_AL_CPAY_ENDDT'
let $EffDateTemp = $Last_Year
let #CountTemp = 0
let #zaehler = 0
! PHASE 2:
! main printing loop over providers (+currency)
!    - for previous years ($march='Y'), PRD_END_DT < yearbegin
!    - also for Marchclause (from current year)
!    - calls Print-Beitragsabrechnung for both Regions (Ost/West)
!
 let #phase = 2
begin-select
S10A1.GPDE_SI_PROV_MAND
   let $ActProvMand = &S10A1.GPDE_SI_PROV_MAND
   let $CritCurr = ' '
   let $RegionAct = '1'
   let $RegionString = 'Region: Ost'
   let $RegionCritAbr = ' and (SI.GPDE_SIC_REGION = ' || '''1''' || ' or ' ||
                        'SI.GPDE_SIH_REGION = ' || '''1''' || ' or ' ||
                        'SI.GPDE_SIP_REGION = ' || '''1''' || ' or ' ||
                        'SI.GPDE_SIU_REGION = ' || '''1''' || ' ) '
   let #zaehler = 0
   do Print-Beitragsabrechnung
   do After-Select
   let $RegionAct = '2'
   let $RegionString = 'Region: West'
   let $RegionCritAbr = ' and (SI.GPDE_SIC_REGION = ' || '''2''' || ' or ' ||
                        'SI.GPDE_SIH_REGION = ' || '''2''' || ' or ' ||
                        'SI.GPDE_SIP_REGION = ' || '''2''' || ' or ' ||
                        'SI.GPDE_SIU_REGION = ' || '''2''' || ' ) '
  let #zaehler = 0 
  do Print-Beitragsabrechnung
  do After-Select
FROM PS_GPDE_RP_SI10A S10A1
    ,PS_GPDE_RP_0001 PD11
WHERE S10A1.EMPLID        = PD11.EMPLID and
   S10A1.EMPL_RCD    = PD11.EMPL_RCD and
   S10A1.PAY_ENTITY  =  PD11.PAY_ENTITY and
   S10A1.GPDE_SI_IS_KVDR = $Is_KVdR
group by S10A1.GPDE_SI_PROV_MAND 
end-select
 END-IF ! YEAR GREATER THAN 2009
let $EffDateTemp = $Ctl_Curr_Pay_End_DT
if #FirstOpen >= 1 and rtrim($GPDE_DV_RCVER_ID,' ') <> ''
   do Print_End_Record
end-if
if rtrim($GPDE_DV_RCVER_ID,' ') <> ''
   if #FirstOpen = 0
      display 'Keine Datensätze zu melden...'
      display 'Lösche Dateien ' noline
      display $FileNm
      display $FileNm1

      if $provider_type <> '08'
          close 10
          let #success0 = delete($FileNm)
          let #success1 = delete($FileNm1)
      end-if
   else
        if $provider_type <> '08'
            close 10
      !wdu-qk04: control messages
          display '(Datensätze geschrieben)'
          display 'Dateien '
          display $FileNm
          display $FileNm1
        end-if
   end-if
end-if
end-procedure Process-Main1








!***************************************************
begin-procedure Print-Beitragsabrechnung
!
! Param_in: $ActProvMand    current provider
!
let #SV_St        = 0
!let #SV_SUM_St    = 0
!let #zaehler = 0
let #print_flag = 0
begin-SELECT
PBD.PAY_ENTITY
PBD.SETID_DEPT
PBD.LOCATION
PBD.CURRENCY_CD
PBD.EMPLID              () on-break level=1 print = never after = Get-Data-Flexi
PBD.EMPL_RCD
PBD.CUR_RT_TYPE
PBD.GPDE_ASOF_DT_EX_RT
PERN.NAME
PT.GPDE_SI_PROV_MAND
SI.GPDE_DV_SV_CODE
SI.GPDE_DV_SV_CODE_M
SI.GPDE_SIC_REGION
SI.GPDE_SIH_REGION
SI.GPDE_SIP_REGION
SI.GPDE_SIU_REGION
SI.GPDE_SI_MINER
SI.GPDE_SI_STATUS_KV
SI.GPDE_SI_STATUS_PV
! wdu06-881b11 added employee category for BUK reporting of insignificants
SI.GPDE_DV_EMPL_CAT
PT.GPDE_RP_MARCH_CLS            ! <==== needs to be from rp_si10A (PT)  not si10
PT.SLICE_END_DT           &PT.SLICE_END_DT
PT.PRD_END_DT
PT.GPDE_RP_SIGRSS_AMT     &PT.GPDE_RP_SIGRSS_AMT
PT.GPDE_RP_HICNTB_AMT     &PT.GPDE_RP_HICNTB_AMT
PT.GPDE_RP_HICTBM_AMT     &PT.GPDE_RP_HICTBM_AMT
PT.GPDE_RP_CICNTB_AMT     &PT.GPDE_RP_CICNTB_AMT
PT.GPDE_RP_CICTBM_AMT     &PT.GPDE_RP_CICTBM_AMT
PT.GPDE_RP_PICNTB_AMT     &PT.GPDE_RP_PICNTB_AMT
PT.GPDE_RP_PICTBM_AMT     &PT.GPDE_RP_PICTBM_AMT
PT.GPDE_RP_UICNTB_AMT     &PT.GPDE_RP_UICNTB_AMT
PT.GPDE_RP_UICTBM_AMT     &PT.GPDE_RP_UICTBM_AMT
PT.GPDE_RP_OAPGRS_AMT     &PT.GPDE_RP_OAPGRS_AMT
PT.GPDE_RP_OAPPEN_AMT     &PT.GPDE_RP_OAPPEN_AMT
PT.GPDE_RP_OAPGRS_MC      &PT.GPDE_RP_OAPGRS_MC
PT.GPDE_RP_OAPPEN_MC      &PT.GPDE_RP_OAPPEN_MC
PT.GPDE_RP_RIGRSS_AMT     &PT.GPDE_RP_RIGRSS_AMT
PT.GPDE_RP_U1CNTB_AMT     &PT.GPDE_RP_U1CNTB_AMT
PT.GPDE_RP_U2CNTB_AMT     &PT.GPDE_RP_U2CNTB_AMT
PT.GPDE_RI_PCT1           &PT.GPDE_RI_PCT1
PT.GPDE_RI_PCT2           &PT.GPDE_RI_PCT2
PT.GPDE_RP_RIGRSM_AMT     &PT.GPDE_RP_RIGRSM_AMT
PT.GPDE_RP_U1CTBM_AMT     &PT.GPDE_RP_U1CTBM_AMT
PT.GPDE_RP_U2CTBM_AMT     &PT.GPDE_RP_U2CTBM_AMT
PT.GPDE_RI_PCT1_MC        &PT.GPDE_RI_PCT1_MC
PT.GPDE_RI_PCT2_MC        &PT.GPDE_RI_PCT2_MC
PT.GPDE_AL_CPAY_ENDDT     &PT.GPDE_AL_CPAY_ENDDT
PT.GPDE_RP_SIDAYS         &PT.GPDE_RP_SIDAYS
PT.GPDE_RP_AVDAYS         &PT.GPDE_RP_AVDAYS
PT.GPDE_RP_KVDAYS         &PT.GPDE_RP_KVDAYS
PT.GPDE_RP_PVDAYS         &PT.GPDE_RP_PVDAYS
PT.GPDE_RP_AVDAYS_BON     &PT.GPDE_RP_AVDAYS_BON
PT.GPDE_RP_KVDAYS_BON     &PT.GPDE_RP_KVDAYS_BON
PT.GPDE_RP_PVDAYS_BON     &PT.GPDE_RP_PVDAYS_BON
PT.GPDE_RP_RVDAYS_BON     &PT.GPDE_RP_RVDAYS_BON
PT.GPDE_RP_AVGRS_ANLZ     &PT.GPDE_RP_AVGRS_ANLZ
PT.GPDE_RP_AVGRS_BON      &PT.GPDE_RP_AVGRS_BON
PT.GPDE_RP_AVGRS_MC       &PT.GPDE_RP_AVGRS_MC
PT.GPDE_RP_KVGRS_ANLZ     &PT.GPDE_RP_KVGRS_ANLZ
PT.GPDE_RP_KVGRS_BON      &PT.GPDE_RP_KVGRS_BON
PT.GPDE_RP_KVGRS_MC       &PT.GPDE_RP_KVGRS_MC
PT.GPDE_RP_PVGRS_ANLZ     &PT.GPDE_RP_PVGRS_ANLZ
PT.GPDE_RP_PVGRS_BON      &PT.GPDE_RP_PVGRS_BON
PT.GPDE_RP_PVGRS_MC       &PT.GPDE_RP_PVGRS_MC
PT.GPDE_RP_RVGRS_ANLZ     &PT.GPDE_RP_RVGRS_ANLZ
PT.GPDE_RP_RVGRS_BON      &PT.GPDE_RP_RVGRS_BON
PT.GPDE_RP_RVGRS_MC       &PT.GPDE_RP_RVGRS_MC
PT.GPDE_RP_AVLFD_AG       &PT.GPDE_RP_AVLFD_AG
PT.GPDE_RP_AVLFD_AN       &PT.GPDE_RP_AVLFD_AN
PT.GPDE_RP_KVLFD_AG       &PT.GPDE_RP_KVLFD_AG
PT.GPDE_RP_KVLFD_AN       &PT.GPDE_RP_KVLFD_AN
PT.GPDE_RP_PVLFD_AG       &PT.GPDE_RP_PVLFD_AG
PT.GPDE_RP_PVLFD_AN       &PT.GPDE_RP_PVLFD_AN
PT.GPDE_RP_RVLFD_AG       &PT.GPDE_RP_RVLFD_AG
PT.GPDE_RP_RVLFD_AN       &PT.GPDE_RP_RVLFD_AN
PT.GPDE_RP_KVBON_AG       &PT.GPDE_RP_KVBON_AG
PT.GPDE_RP_KVBON_AN       &PT.GPDE_RP_KVBON_AN
PT.GPDE_RP_AVBON_AG       &PT.GPDE_RP_AVBON_AG
PT.GPDE_RP_AVBON_AN       &PT.GPDE_RP_AVBON_AN
PT.GPDE_RP_PVBON_AG       &PT.GPDE_RP_PVBON_AG
PT.GPDE_RP_PVBON_AN       &PT.GPDE_RP_PVBON_AN
PT.GPDE_RP_RVBON_AG       &PT.GPDE_RP_RVBON_AG
PT.GPDE_RP_RVBON_AN       &PT.GPDE_RP_RVBON_AN
PT.GPDE_RP_AVAG_MC        &PT.GPDE_RP_AVAG_MC
PT.GPDE_RP_AVAN_MC        &PT.GPDE_RP_AVAN_MC
PT.GPDE_RP_KVAG_MC        &PT.GPDE_RP_KVAG_MC
PT.GPDE_RP_KVAN_MC        &PT.GPDE_RP_KVAN_MC
PT.GPDE_RP_PVAG_MC        &PT.GPDE_RP_PVAG_MC
PT.GPDE_RP_PVAN_MC        &PT.GPDE_RP_PVAN_MC
PT.GPDE_RP_RVAG_MC        &PT.GPDE_RP_RVAG_MC
PT.GPDE_RP_RVAN_MC        &PT.GPDE_RP_RVAN_MC
PT.GPDE_RP_SIGRUNLM_A     &PT.GPDE_RP_SIGRUNLM_A
PT.GPDE_RP_SIGRUNLM_B     &PT.GPDE_RP_SIGRUNLM_B
PT.GPDE_RC_PRT_SIGN       &PT.GPDE_RC_PRT_SIGN
PT.GPDE_RP_CHAR01         &PT.GPDE_RP_CHAR01
PT.GPDE_RP_CHAR02         &PT.GPDE_RP_CHAR02
SI.GPDE_RP_MAR_MON        &SI.GPDE_RP_MAR_MON
PT.GPDE_RP_HIVOL_AMT      &PT.GPDE_RP_HIVOL_AMT
PT.GPDE_RP_CIVOL_AMT      &PT.GPDE_RP_CIVOL_AMT
PT.GPDE_RP_HIVLER_AMT     &PT.GPDE_RP_HIVLER_AMT
PT.GPDE_RP_CIVLER_AMT     &PT.GPDE_RP_CIVLER_AMT
PT.GPDE_RP_AZGRS_BON      &PT.GPDE_RP_AZGRS_BON
PT.GPDE_RP_OAPPEN_ANL     &PT.GPDE_RP_OAPPEN_ANL
PT.GPDE_RP_OAPPEN_BON     &PT.GPDE_RP_OAPPEN_BON
PT.GPDE_RP_AZGRS_ANLZ     &PT.GPDE_RP_AZGRS_ANLZ
PT.GPDE_RP_AVDAYS_MC      &PT.GPDE_RP_AVDAYS_MC
PT.GPDE_RP_KVDAYS_MC      &PT.GPDE_RP_KVDAYS_MC
PT.GPDE_RP_PVDAYS_MC      &PT.GPDE_RP_PVDAYS_MC
PT.GPDE_RP_RVDAYS_MC      &PT.GPDE_RP_RVDAYS_MC
PT.GPDE_TX_MJ_LUMP        &PT.GPDE_TX_MJ_LUMP
PT.GPDE_AZ_RP_S03_31      &PT.GPDE_AZ_RP_S03_31
PT.GPDE_AZ_RP_S03_41      &PT.GPDE_AZ_RP_S03_41
PT.GPDE_SI_PV_CHILD
  ! wdu06-881kug
PT.GPDE_RP_KUG_KVCTB      &PT.GPDE_RP_KUG_KVCTB
PT.GPDE_RP_KUG_PVCTB      &PT.GPDE_RP_KUG_PVCTB
PT.GPDE_RP_KUG_RVCTB      &PT.GPDE_RP_KUG_RVCTB
PT.GPDE_RP_KUG_KVGRS      &PT.GPDE_RP_KUG_KVGRS
PT.GPDE_RP_KUG_PVGRS      &PT.GPDE_RP_KUG_PVGRS
PT.GPDE_RP_KUG_RVGRS      &PT.GPDE_RP_KUG_RVGRS
! JJJ-890B10-kug
PT.GPDE_KU_KUGAMT         &PT.GPDE_KU_KUGAMT
PT.GPDE_KU_KUGKKAMT       &PT.GPDE_KU_KUGKKAMT
! JJJ-890B10-gz
PT.GPDE_RP_RV_GZ_FLG
! JJJ-890B10-sfn
PT.GPDE_RP_SFN_SI_ABL
!adj08-890b16: RI insolvency
PT.GPDE_RP_GRSS_INSOL
PT.GPDE_RP_UML_INSOLV
!adj09-890b19: RI MC insolvency
PT.GPDE_RP_GRS_INS_MC
PT.GPDE_RP_UML_INS_MC

  let $GZFlag = &PT.GPDE_RP_RV_GZ_FLG
  let #PT.GPDE_RP_SFN_SI_ABL = &PT.GPDE_RP_SFN_SI_ABL
  let #PT.GPDE_RP_GRSS_INSOL = &PT.GPDE_RP_GRSS_INSOL
  let #PT.GPDE_RP_UML_INSOLV = &PT.GPDE_RP_UML_INSOLV
  let #PT.GPDE_RP_GRS_INS_MC = &PT.GPDE_RP_GRS_INS_MC
  let #PT.GPDE_RP_UML_INS_MC = &PT.GPDE_RP_UML_INS_MC
  ! check if needed for reset_point
  let $PT.GPDE_SI_PV_CHILD = &PT.GPDE_SI_PV_CHILD
  let $ActCurr = &PBD.CURRENCY_CD
  let $GPDE_SI_PROV_MAND = &PT.GPDE_SI_PROV_MAND
  let $ActualProv_Temp = &PT.GPDE_SI_PROV_MAND
  do Format-DateTime(&PT.PRD_END_DT,$PT.PRD_END_DTCmp,{DEFCMP},'','')
  ! wdu05-881b8: populate just to be sure
  let $Emplid = &PBD.EMPLID

  ! wdu06-881b11 added employee category for BUK reporting of insignificants
  if ( &SI.GPDE_DV_EMPL_CAT = '109' or &SI.GPDE_DV_EMPL_CAT = '110'
     or &SI.GPDE_SI_STATUS_KV = '6' )
     let $PrintFormInsigBUK = 'Y'
  else
     let $PrintFormInsigBUK = 'N'
  end-if
  ! show 'Debug Print Beitragsabrechnung ==============================='
  ! show '1> ' $PT.PRD_END_DTCmp ' ' $EMPLID ' '  $March '/' $Vorj

! ++  ! trying to explain:
! ++  ! $March='Y': work on previous year data / data that 'belong' to the old year (e.g. marchclause)
! ++  ! $March='N': ignore previous year data
! ++  !
! ++  if $March = 'N'
! ++     let $Vorj = 'N'
! ++     let $MarchCL = 'N'
! ++  else
! ++      if (&PT.GPDE_RP_KVGRS_MC <> 0 or &PT.GPDE_RP_AVGRS_MC <> 0 or
! ++          &PT.GPDE_RP_RVGRS_MC <> 0 or &PT.GPDE_RP_PVGRS_MC <> 0 or
! ++          &PT.GPDE_RP_KVAN_MC  <> 0 or &PT.GPDE_RP_KVAG_MC  <> 0 or
! ++          &PT.GPDE_RP_RVAN_MC  <> 0 or &PT.GPDE_RP_RVAG_MC  <> 0 or
! ++          &PT.GPDE_RP_AVAN_MC  <> 0 or &PT.GPDE_RP_AVAG_MC  <> 0 or
! ++          &PT.GPDE_RP_PVAN_MC  <> 0 or &PT.GPDE_RP_PVAG_MC  <> 0
! ++          or &PT.GPDE_RP_RIGRSM_AMT <> 0 or &PT.GPDE_RP_U1CTBM_AMT <> 0
! ++          or &PT.GPDE_RP_U2CTBM_AMT <> 0 or &PT.GPDE_RP_OAPGRS_MC <> 0
! ++          or &PT.GPDE_RP_OAPPEN_MC <> 0)
! ++          and (&PT.GPDE_RP_MARCH_CLS = 1)
! ++          !
! ++          ! if we are here, then the current row actually has a marchclause amount
! ++          ! (but not necessarily only marchclause!)
! ++          ! ================= wrong approach: marchlause always separate =============
! ++          let $Vorj = 'N'
! ++          let $MarchCL = 'Y'
! ++      else
! ++          let $Vorj = 'Y'
! ++          let $MarchCL = 'N'
! ++      end-if
! ++  end-if

! wdu05-881jw06 new logic for marchclause
! default: regular payment current year
      let $MarchCL = 'N'
      let $Vorj = 'N'
      let $march='N'            !override on a per row basis now (wdu05-881jw06)
! marchclause flag and payment
!adj08-890B15 added &PTC.GPDE_RP_SIGRUNLM_B
!adj08-890b16: Contr. previous year
!adj09:TU10
!   if $yy09 < '2009'
   if $yy09 <= '2008'
      if (&PT.GPDE_RP_KVGRS_MC <> 0 or &PT.GPDE_RP_AVGRS_MC <> 0 or
          &PT.GPDE_RP_RVGRS_MC <> 0 or &PT.GPDE_RP_PVGRS_MC <> 0 or
          &PT.GPDE_RP_KVAN_MC  <> 0 or &PT.GPDE_RP_KVAG_MC  <> 0 or
          &PT.GPDE_RP_RVAN_MC  <> 0 or &PT.GPDE_RP_RVAG_MC  <> 0 or
          &PT.GPDE_RP_AVAN_MC  <> 0 or &PT.GPDE_RP_AVAG_MC  <> 0 or
          &PT.GPDE_RP_PVAN_MC  <> 0 or &PT.GPDE_RP_PVAG_MC  <> 0
          or &PT.GPDE_RP_RIGRSM_AMT <> 0 or &PT.GPDE_RP_U1CTBM_AMT <> 0
          or &PT.GPDE_RP_U2CTBM_AMT <> 0 or &PT.GPDE_RP_OAPGRS_MC <> 0
          or &PT.GPDE_RP_OAPPEN_MC <> 0 or &PT.GPDE_RP_SIGRUNLM_B <> 0  )
          and (&PT.GPDE_RP_MARCH_CLS = 1 and #phase = 1 )
          let $MarchCL = 'Y'
          let $Vorj = 'N'           ! Vorj='Y' ==> normal case now
          let $march='Y'            !override on a per row basis now (wdu05-881jw06)
!      else
!          let $MarchCL = 'N'
!          let $Vorj = 'N'   ! 'Y'
      end-if
   else
   !march clause for Refund insurance Insolvency should be reported on the same page
      if (&PT.GPDE_RP_KVGRS_MC <> 0 or &PT.GPDE_RP_AVGRS_MC <> 0 or
          &PT.GPDE_RP_RVGRS_MC <> 0 or &PT.GPDE_RP_PVGRS_MC <> 0 or
          &PT.GPDE_RP_KVAN_MC  <> 0 or &PT.GPDE_RP_KVAG_MC  <> 0 or
          &PT.GPDE_RP_RVAN_MC  <> 0 or &PT.GPDE_RP_RVAG_MC  <> 0 or
          &PT.GPDE_RP_AVAN_MC  <> 0 or &PT.GPDE_RP_AVAG_MC  <> 0 or
          &PT.GPDE_RP_PVAN_MC  <> 0 or &PT.GPDE_RP_PVAG_MC  <> 0
          or &PT.GPDE_RP_RIGRSM_AMT <> 0 or &PT.GPDE_RP_U1CTBM_AMT <> 0
          or &PT.GPDE_RP_U2CTBM_AMT <> 0 or &PT.GPDE_RP_OAPGRS_MC <> 0
          or &PT.GPDE_RP_OAPPEN_MC <> 0 or &PT.GPDE_RP_SIGRUNLM_B <> 0
          or &PT.GPDE_RP_GRS_INS_MC <> 0 or &PT.GPDE_RP_UML_INS_MC <> 0 ) !adj09: RI Tu
          and (&PT.GPDE_RP_MARCH_CLS = 1 and #phase = 1 )
!adj08-890b16 print march clause only during the 2nd phase in 2009
          let $MarchCL = 'Y'
          let $Vorj = 'N'           ! Vorj='Y' ==> normal case now
          let $march='Y'            !override on a per row basis now (wdu05-881jw06)
      end-if
!Previous year march clause rows are handled in phase 2 under Korr pages
      if (&PT.GPDE_RP_KVGRS_MC <> 0 or &PT.GPDE_RP_AVGRS_MC <> 0 or
          &PT.GPDE_RP_RVGRS_MC <> 0 or &PT.GPDE_RP_PVGRS_MC <> 0 or
          &PT.GPDE_RP_KVAN_MC  <> 0 or &PT.GPDE_RP_KVAG_MC  <> 0 or
          &PT.GPDE_RP_RVAN_MC  <> 0 or &PT.GPDE_RP_RVAG_MC  <> 0 or
          &PT.GPDE_RP_AVAN_MC  <> 0 or &PT.GPDE_RP_AVAG_MC  <> 0 or
          &PT.GPDE_RP_PVAN_MC  <> 0 or &PT.GPDE_RP_PVAG_MC  <> 0
          or &PT.GPDE_RP_RIGRSM_AMT <> 0 or &PT.GPDE_RP_U1CTBM_AMT <> 0
          or &PT.GPDE_RP_U2CTBM_AMT <> 0 or &PT.GPDE_RP_OAPGRS_MC <> 0
          or &PT.GPDE_RP_OAPPEN_MC <> 0 or &PT.GPDE_RP_SIGRUNLM_B <> 0
          or &PT.GPDE_RP_GRS_INS_MC = 0 or &PT.GPDE_RP_UML_INS_MC = 0 ) !adj09: RI Tu
          and (&PT.GPDE_RP_MARCH_CLS = 1 and #phase = 2 )
          !starting from
          let $MarchCL = 'Y'
          let $Vorj = 'N'           ! Vorj='Y' ==> normal case now
          let $march='Y'            !override on a per row basis now (wdu05-881jw06)
       end-if
   end-if
!!!!!!!!!!!!
! show '2> ' $PT.PRD_END_DTCmp ' ' $EMPLID ' '  $March '/' $Vorj ' MarchCL '$MarchCL
  if $MarchCL = 'N'
     let $GPDE_DV_SV_CODE = &SI.GPDE_DV_SV_CODE
     let $PRD_END_DT = rtrim(&PT.PRD_END_DT,' ')
  else
     let $GPDE_DV_SV_CODE = &SI.GPDE_DV_SV_CODE_M
     let $PRD_END_DT = rtrim(&SI.GPDE_RP_MAR_MON,' ')
  end-if
  !-------------------------------------------------
  let $SI_GPDE_SIC_REGION = &SI.GPDE_SIC_REGION
  let $SI_GPDE_SIH_REGION = &SI.GPDE_SIH_REGION
  let $SI_GPDE_SIP_REGION = &SI.GPDE_SIP_REGION
  let $SI_GPDE_SIU_REGION = &SI.GPDE_SIU_REGION
        
  !----get Region for MCL if March cluase is true for Phase 1----
  if $MarchCL = 'Y' and #Phase = 1
     do getMarchCLInfo($EMPLID, $GPDE_SI_PROV_MAND, $PRD_END_DT, $mc_SICregion, $mc_SIHRegion,$mc_SIPRegion,$mc_SIURegion)    
     let $SI_GPDE_SIC_REGION = $mc_SICregion
     let $SI_GPDE_SIH_REGION = $mc_SIHRegion
     let $SI_GPDE_SIP_REGION = $mc_SIPRegion
     let $SI_GPDE_SIU_REGION = $mc_SIURegion        
     if $mc_SICregion = $RegionAct OR $mc_SIHRegion=$RegionAct OR $mc_SIPRegion=$RegionAct OR $mc_SIURegion=$RegionAct   
        let #print_flag = 1
     else
        let #print_flag = 0
     end-if
  else
     let #print_flag = 1
  end-if
  !--------------------------------------------------------------------------------------------------
  
  do GetBeitragsKontoNummer($GPDE_SI_PROV_MAND, &PBD.PAY_ENTITY, $Ctl_Curr_Pay_End_Dt, $GPDE_DO_BTNR)
  !
  ! Betriebsnummer of PayEntity only depends on the payentity on the Runcontrol
  ! we want it from GPDE_AL_PE_LOC where it is marked in GPDE_AL_PE_LOC.GPDE_SI_REP_BTNR
  ! see: Process-Main
  !
  let $hdr_abr_si_provider  = $GPDE_SI_PROV_MAND
  ! wdu06-881kug taking back the jw-change, individual BTNR again
  ! -- ! wdu05-881jw06
  ! -- !let $hdr_abr_GPDE_DO_BTNR = $GPDE_DO_BTNR
  ! -- let $hdr_abr_GPDE_DO_BTNR = $PayentBtnr
  let $hdr_abr_GPDE_DO_BTNR = $GPDE_DO_BTNR
  !-- (end wdu06-881kug)

  let $GPDE_SI_REGION = &SI.GPDE_SIC_REGION
  let $GPDE_TX_MINER = &SI.GPDE_SI_MINER
  let $GPDE_SI_REGION_save = $GPDE_SI_REGION
  let $GPDE_TX_MINER_save = $GPDE_TX_MINER
  let $GPDE_SI_PROV_MAND_save = $GPDE_SI_PROV_MAND
  let $ActualProv_save = $ActualProv_Temp
  let $NotPrinted = 'Y'
  if #print_flag = 1
   !wdu05b7: extensive modularisation to CX_ procedures
   do CX_VarAssignAmounts_BeitAbr          ! put monetary stuff in variables
   do CX_BlankTheNonRegion_BeitAbr         ! blank out values from non-applicable regions (RK)

   ! wdu06-881b11 we no longer need a real currency conversion since 1/1/2006
   do CX_NoCurrencyConversion_BeitAbr        ! convert currencies if required (2001)
   do CX_VarAssignUnits_BeitAbr            ! put nonmonetary stuff in variables (DAYs)
   do CX_SvAmountDistribution_BeitAbr      ! distribute amounts to contrib-group-sums
   ! --------printing---------
   do CX_CondPrintUmlage_BeitAbr           ! print Umlage if applicable
   do CX_CondPrintEmplAbr_BeitAbr          ! print EE-Data-Abr (Abrechnung) if applicable (if provider requested($Sgn))
   do CX_CondPrintVolAbr_BeitAbr           ! print EE-SVF-Data (Abrechnung) if freiw. KV
   ! -------------------------
  end-if

  let $GPDE_SI_PROV_MAND_Old = $GPDE_SI_PROV_MAND
  let $GPDE_DO_BTNR_Old = $GPDE_DO_BTNR
  let $GPDE_SI_REGION_Old = $GPDE_SI_REGION
  let $GPDE_TX_MINER_Old = $GPDE_TX_MINER
  let $ActualProv_Old = $ActualProv_Temp
  let $Actual_Curruncy_Old = $Actual_Curruncy
  
FROM PS_NAMES PERN
    ,PS_GPDE_RP_SI10A PT
    ,PS_GPDE_RP_0001 PBD
    ,PS_GPDE_RP_SI01 SI
WHERE PERN.EMPLID         = PT.EMPLID
AND   PBD.EMPLID        = PT.EMPLID
AND   PBD.CAL_RUN_ID    = PT.CAL_RUN_ID
AND   PBD.EMPL_RCD      = PT.EMPL_RCD
AND   PBD.GP_PAYGROUP   = PT.GP_PAYGROUP
AND   PBD.CAL_ID        = PT.CAL_ID
AND   PBD.RSLT_SEG_NUM  = PT.RSLT_SEG_NUM
AND   PT.SLICE_END_DT = SI.SLICE_END_DT
AND   PBD.EMPLID = SI.EMPLID
AND   PBD.CAL_RUN_ID = SI.CAL_RUN_ID
AND   PBD.EMPL_RCD = SI.EMPL_RCD
AND   PBD.GP_PAYGROUP = SI.GP_PAYGROUP
AND   PBD.CAL_ID      = SI.CAL_ID
AND   PBD.RSLT_SEG_NUM = SI.RSLT_SEG_NUM
AND   PBD.SEG_END_DT = SI.SEG_END_DT
! jjj
AND PERN.NAME_TYPE = (select NMTVW.NAME_TYPE from PS_GPDE_NMTYPE1_VW NMTVW where NMTVW.EMPLID = PERN.EMPLID AND NMTVW.EFFDT
                                = ( select MAX(NMTVW2.EFFDT) from  PS_GPDE_NMTYPE1_VW NMTVW2
                                       where NMTVW2.EMPLID = NMTVW.EMPLID
                                       AND NMTVW2.EFFDT <= $Ctl_Curr_Pay_End_Dt) )   ! jjj
AND PERN.EFFDT =(select max(PERN1.EFFDT)
                 from PS_NAMES PERN1
                 WHERE PERN1.EMPLID = PERN.EMPLID
                 AND PERN1.NAME_TYPE = PERN.NAME_TYPE ! jjj
                 AND PERN1.EFFDT <= $Ctl_Curr_Pay_End_Dt)
! jjj
AND   PBD.PAY_ENTITY  =  $Ctl_PayEntity
! parameters from parent procedure (the current provider ...)
and   PT.GPDE_SI_PROV_MAND = $ActProvMand
and   PT.GPDE_SI_IS_KVDR = $Is_KVdR
[$CritCurr]
[$RegionCritAbr]
[$march_crit]
[$condition_abr]
[$order1]
end-select
end-procedure
!******************************************************************

begin-procedure getMarchCLInfo($Emplid,$SIProvider, $MAR_MON,:$mc_SICregion, :$mc_SIHRegion, :$mc_SIPRegion, :$mc_SIURegion)

begin-select distinct
SI.GPDE_DV_SV_CODE
SI.GPDE_DV_SV_CODE_M
SI.GPDE_SIC_REGION    &SI.GPDE_SIC_REGION
SI.GPDE_SIH_REGION    &SI.GPDE_SIH_REGION
SI.GPDE_SIP_REGION    &SI.GPDE_SIP_REGION
SI.GPDE_SIU_REGION    &SI.GPDE_SIU_REGION 
   
    let $mc_SICregion    = &SI.GPDE_SIC_REGION
    let $mc_SIHRegion = &SI.GPDE_SIH_REGION
    let $mc_SIPRegion = &SI.GPDE_SIP_REGION
    let $mc_SIURegion = &SI.GPDE_SIU_REGION   
    
FROM  PS_GPDE_RP_SI01 SI
WHERE SI.EMPLID  = $Emplid
AND SI.PRD_END_DT = $MAR_MON
AND (GPDE_SI_PROV_KV=$SIProvider OR GPDE_SI_PROV_PV=$SIProvider OR GPDE_SI_PROV_RV=$SIProvider OR GPDE_SI_PROV_AV=$SIProvider)

end-select
end-procedure
!******************************************************************

begin-procedure After-Select
let $wsPr = 'N'
if #zaehler <> 0
  let $GPDE_SI_REGION_save = $GPDE_SI_REGION
  let $GPDE_TX_MINER_save = $GPDE_TX_MINER
  let $GPDE_SI_PROV_MAND_save = $GPDE_SI_PROV_MAND
  let $hdr_abr_si_provider  = $GPDE_SI_PROV_MAND

  if $PrintedUml = 'Y' and $Is_KVdR <> 'Y'
     use-report Abrechnung_Umlage
     do Print-Sums-Umlage
  end-if
  use-report abrechnung
  do Get-Header-Data-Abr
  do Print-Sums-Abr
  new-page
  let $wsPr = 'Y'
  let $ActualProv = $ActualProv_Temp
  do CheckArchitektKasse
  if ($PrintArchitect = 'Y') and ($PT.GPDE_RP_CHAR02 <> 'N' or ($PrintedUml = 'Y' and $Is_KVdR <> 'Y'))
     let #FirstOpen = #FirstOpen + 1
    if #FirstOpen = 1 and rtrim($GPDE_DV_RCVER_ID,' ') <> ''
       ! save the #file_number for this provider (when we make a final print)
       do UpdateProviderFileNumber
       do UpdateDakotaFileNumber
    end-if
    if #KV-AG_Freiw_Sum <> 0 and #sv_KV_Freiw_Sum > #KV-AG_Freiw_Sum
        let #KV-AN_Freiw_Sum = #sv_KV_Freiw_Sum - #KV-AG_Freiw_Sum
    end-if
    if #PV-AG_Freiw_Sum <> 0 and #sv_PV_Freiw_Sum > #PV-AG_Freiw_Sum
       let #PV-AN_Freiw_Sum = #sv_PV_Freiw_Sum - #PV-AG_Freiw_Sum
    end-if
    use-report Nachweis
   if $Is_KVdR <> 'Y'
    do Print-Numbers-Nachweis
   else
    do Print-Numbers-Nachweis_KVdR
   end-if
    new-page
    if #FirstOpen = 1 and rtrim($GPDE_DV_RCVER_ID,' ') <> ''
       do Print_Start_Record
       ! wdu05-881jw06 new record DSKO needs to be written
       do WriteDSKO
    end-if
    if rtrim($GPDE_DV_RCVER_ID,' ') <> ''
       do Get-Header-Data-Abr
       do Print_Main_Record
    end-if
    do Init-Sum-Vars-Nachweis
    use-report Abrechnung_Sum
    let #page-count = 1
    do Print_Abrechnung_Sum
    new-page
    if $PrintF = 'Y'  and $Is_KVdR <> 'Y'
       use-report Freiwillig
       do Print-SVF-Sums
       let #page-count = 1
    end-if
 end-if
 if $PrintedUml = 'Y'  and $Is_KVdR <> 'Y'
     use-report Abrechnung_Umlage
     new-page
     let $PrintedUml = 'N'
 end-if
 use-report abrechnung
 !new-page
 do InitialVar2
end-if
let #SV_Sum_St = 0
end-procedure
!******************************************************************




begin-procedure Get-Data-Flexi
if $Is_KVdR <> 'Y'
begin-select distinct
FLX.SLICE_END_DT
FLX.PRD_END_DT
FLX.GPDE_AL_CPAY_ENDDT
FLX.GPDE_DV_SV_CODE
FLX.GPDE_FL_RP_1S1AG   &FLX.GPDE_FL_RP_1S1AG      !Kv
FLX.GPDE_FL_RP_1S1AN   &FLX.GPDE_FL_RP_1S1AN
FLX.GPDE_FL_RP_1S1B    &FLX.GPDE_FL_RP_1S1B
FLX.GPDE_FL_RP_1S2AG   &FLX.GPDE_FL_RP_1S2AG      !Pv
FLX.GPDE_FL_RP_1S2AN   &FLX.GPDE_FL_RP_1S2AN
FLX.GPDE_FL_RP_1S2B    &FLX.GPDE_FL_RP_1S2B
FLX.GPDE_FL_RP_1S3AG   &FLX.GPDE_FL_RP_1S3AG      !Rv
FLX.GPDE_FL_RP_1S3AN   &FLX.GPDE_FL_RP_1S3AN
FLX.GPDE_FL_RP_1S3B    &FLX.GPDE_FL_RP_1S3B
FLX.GPDE_FL_RP_1S4AG   &FLX.GPDE_FL_RP_1S4AG      !Av
FLX.GPDE_FL_RP_1S4AN   &FLX.GPDE_FL_RP_1S4AN
FLX.GPDE_FL_RP_1S4B    &FLX.GPDE_FL_RP_1S4B
FLX.GPDE_FL_RP_2S1AG   &FLX.GPDE_FL_RP_2S1AG
FLX.GPDE_FL_RP_2S1AN   &FLX.GPDE_FL_RP_2S1AN
FLX.GPDE_FL_RP_2S1B    &FLX.GPDE_FL_RP_2S1B
FLX.GPDE_FL_RP_2S2AG   &FLX.GPDE_FL_RP_2S2AG
FLX.GPDE_FL_RP_2S2AN   &FLX.GPDE_FL_RP_2S2AN
FLX.GPDE_FL_RP_2S2B    &FLX.GPDE_FL_RP_2S2B
FLX.GPDE_FL_RP_2S3AG   &FLX.GPDE_FL_RP_2S3AG
FLX.GPDE_FL_RP_2S3AN   &FLX.GPDE_FL_RP_2S3AN
FLX.GPDE_FL_RP_2S3B    &FLX.GPDE_FL_RP_2S3B
FLX.GPDE_FL_RP_2S4AG   &FLX.GPDE_FL_RP_2S4AG
FLX.GPDE_FL_RP_2S4AN   &FLX.GPDE_FL_RP_2S4AN
FLX.GPDE_FL_RP_2S4B    &FLX.GPDE_FL_RP_2S4B
PBDF.CURRENCY_CD

! RH07-890B10P2 (debug) for flexi
!SIF.CAL_RUN_ID         &SIF.CAL_RUN_ID
!SIF.CAL_ID             &SIF.CAL_ID
!     let $calrunid = &SIF.CAL_RUN_ID
!     let $calid = &SIF.CAL_ID
! RH07-890B10P2 (debug) for flexi ende


     let $SV_CodeF = &FLX.GPDE_DV_SV_CODE
     let $KV_CodeF = substr($SV_CodeF,1,1)
     let $AV_CodeF = substr($SV_CodeF,3,1)
     let $RV_CodeF = substr($SV_CodeF,2,1)
     let $PV_CodeF = substr($SV_CodeF,4,1)


   ! RH07-890B10P2 print SV code (debug) for flexi

!  show 'SVCODE=' $SV_CodeF
!  show 'EMPLID =' $Emplid
!     show 'CalRunId =' $calrunid
!     show 'CAL_ID=' $calid



     do Format-DateTime(&FLX.PRD_END_DT, $FLX.PRD_END_DT, {DEFCMP},'','')
     do Format-DateTime(&FLX.GPDE_AL_CPAY_ENDDT, $FLX.GPDE_AL_CPAY_ENDDT, {DEFCMP},'','')
     do Format-DateTime($Ctl_Curr_Pay_End_Dt, $Ctl_Curr_Cmp, {DEFCMP},'','')
     if $FLX.PRD_END_DT < $Ctl_Curr_Cmp  and $FLX.GPDE_AL_CPAY_ENDDT < $Ctl_Curr_Cmp
        ! we are in a retro row
        if $RegionAct = '1'
           let #FLX.GPDE_FL_RP_S1AG =  -1 * &FLX.GPDE_FL_RP_1S1AG
           let #FLX.GPDE_FL_RP_S1AN =  -1 * &FLX.GPDE_FL_RP_1S1AN
           let #FLX.GPDE_FL_RP_S1B  =  -1 * &FLX.GPDE_FL_RP_1S1B
           let #FLX.GPDE_FL_RP_S2AG =  -1 * &FLX.GPDE_FL_RP_1S2AG
           let #FLX.GPDE_FL_RP_S2AN =  -1 * &FLX.GPDE_FL_RP_1S2AN
           let #FLX.GPDE_FL_RP_S2B  =  -1 * &FLX.GPDE_FL_RP_1S2B
           let #FLX.GPDE_FL_RP_S3AG =  -1 * &FLX.GPDE_FL_RP_1S3AG
           let #FLX.GPDE_FL_RP_S3AN =  -1 * &FLX.GPDE_FL_RP_1S3AN
           let #FLX.GPDE_FL_RP_S3B  =  -1 * &FLX.GPDE_FL_RP_1S3B
           let #FLX.GPDE_FL_RP_S4AG =  -1 * &FLX.GPDE_FL_RP_1S4AG
           let #FLX.GPDE_FL_RP_S4AN =  -1 * &FLX.GPDE_FL_RP_1S4AN
           let #FLX.GPDE_FL_RP_S4B  =  -1 * &FLX.GPDE_FL_RP_1S4B
        else
           let #FLX.GPDE_FL_RP_S1AG =  -1 * &FLX.GPDE_FL_RP_2S1AG
           let #FLX.GPDE_FL_RP_S1AN =  -1 * &FLX.GPDE_FL_RP_2S1AN
           let #FLX.GPDE_FL_RP_S1B  =  -1 * &FLX.GPDE_FL_RP_2S1B
           let #FLX.GPDE_FL_RP_S2AG =  -1 * &FLX.GPDE_FL_RP_2S2AG
           let #FLX.GPDE_FL_RP_S2AN =  -1 * &FLX.GPDE_FL_RP_2S2AN
           let #FLX.GPDE_FL_RP_S2B  =  -1 * &FLX.GPDE_FL_RP_2S2B
           let #FLX.GPDE_FL_RP_S3AG =  -1 * &FLX.GPDE_FL_RP_2S3AG
           let #FLX.GPDE_FL_RP_S3AN =  -1 * &FLX.GPDE_FL_RP_2S3AN
           let #FLX.GPDE_FL_RP_S3B  =  -1 * &FLX.GPDE_FL_RP_2S3B
           let #FLX.GPDE_FL_RP_S4AG =  -1 * &FLX.GPDE_FL_RP_2S4AG
           let #FLX.GPDE_FL_RP_S4AN =  -1 * &FLX.GPDE_FL_RP_2S4AN
           let #FLX.GPDE_FL_RP_S4B  =  -1 * &FLX.GPDE_FL_RP_2S4B
        end-if
        let $RetroSign = 'R'
    else
        if $RegionAct = '1'
           let #FLX.GPDE_FL_RP_S1AG =  &FLX.GPDE_FL_RP_1S1AG
           let #FLX.GPDE_FL_RP_S1AN =  &FLX.GPDE_FL_RP_1S1AN
           let #FLX.GPDE_FL_RP_S1B  =  &FLX.GPDE_FL_RP_1S1B
           let #FLX.GPDE_FL_RP_S2AG =  &FLX.GPDE_FL_RP_1S2AG
           let #FLX.GPDE_FL_RP_S2AN =  &FLX.GPDE_FL_RP_1S2AN
           let #FLX.GPDE_FL_RP_S2B  =  &FLX.GPDE_FL_RP_1S2B
           let #FLX.GPDE_FL_RP_S3AG =  &FLX.GPDE_FL_RP_1S3AG
           let #FLX.GPDE_FL_RP_S3AN =  &FLX.GPDE_FL_RP_1S3AN
           let #FLX.GPDE_FL_RP_S3B  =  &FLX.GPDE_FL_RP_1S3B
           let #FLX.GPDE_FL_RP_S4AG =  &FLX.GPDE_FL_RP_1S4AG
           let #FLX.GPDE_FL_RP_S4AN =  &FLX.GPDE_FL_RP_1S4AN
           let #FLX.GPDE_FL_RP_S4B  =  &FLX.GPDE_FL_RP_1S4B
        else
           let #FLX.GPDE_FL_RP_S1AG =  &FLX.GPDE_FL_RP_2S1AG
           let #FLX.GPDE_FL_RP_S1AN =  &FLX.GPDE_FL_RP_2S1AN
           let #FLX.GPDE_FL_RP_S1B  =  &FLX.GPDE_FL_RP_2S1B
           let #FLX.GPDE_FL_RP_S2AG =  &FLX.GPDE_FL_RP_2S2AG
           let #FLX.GPDE_FL_RP_S2AN =  &FLX.GPDE_FL_RP_2S2AN
           let #FLX.GPDE_FL_RP_S2B  =  &FLX.GPDE_FL_RP_2S2B
           let #FLX.GPDE_FL_RP_S3AG =  &FLX.GPDE_FL_RP_2S3AG
           let #FLX.GPDE_FL_RP_S3AN =  &FLX.GPDE_FL_RP_2S3AN
           let #FLX.GPDE_FL_RP_S3B  =  &FLX.GPDE_FL_RP_2S3B
           let #FLX.GPDE_FL_RP_S4AG =  &FLX.GPDE_FL_RP_2S4AG
           let #FLX.GPDE_FL_RP_S4AN =  &FLX.GPDE_FL_RP_2S4AN
           let #FLX.GPDE_FL_RP_S4B  =  &FLX.GPDE_FL_RP_2S4B
        end-if
        if $FLX.PRD_END_DT < $Ctl_Curr_Cmp  and $FLX.GPDE_AL_CPAY_ENDDT = $Ctl_Curr_CmpT
           let $RetroSign = 'N'
        else
           let $RetroSign = 'A'
        end-if
     end-if
     do Print-EE-Data-Abr-Flexi
from PS_GPDE_RP_FL01 FLX, PS_GPDE_RP_SI10A SIF,PS_GPDE_RP_0001 PBDF,
     PS_GPDE_RP_SI01 SI01F
where FLX.EMPLID = SIF.EMPLID and
   FLX.CAL_RUN_ID = SIF.CAL_RUN_ID and
   FLX.EMPL_RCD = SIF.EMPL_RCD  and
   FLX.GP_PAYGROUP = SIF.GP_PAYGROUP and
   FLX.CAL_ID      = SIF.CAL_ID and
   FLX.RSLT_SEG_NUM = SIF.RSLT_SEG_NUM and
   FLX.SLICE_END_DT = SIF.SLICE_END_DT and
   FLX.PAY_ENTITY  =  $Ctl_PayEntity and
   FLX.EMPLID = $Emplid and
   FLX.EMPL_RCD = #EmplRcd and
   PBDF.CURRENCY_CD = $ActCurr and
   PBDF.EMPLID        = FLX.EMPLID and
   PBDF.CAL_RUN_ID    = FLX.CAL_RUN_ID and
   PBDF.EMPL_RCD      = FLX.EMPL_RCD and
   PBDF.GP_PAYGROUP   = FLX.GP_PAYGROUP and
   PBDF.CAL_ID        = FLX.CAL_ID and
   PBDF.RSLT_SEG_NUM  = FLX.RSLT_SEG_NUM and
   PBDF.EMPLID = SI01F.EMPLID and
   PBDF.CAL_RUN_ID = SI01F.CAL_RUN_ID and
   PBDF.EMPL_RCD = SI01F.EMPL_RCD and
   PBDF.GP_PAYGROUP = SI01F.GP_PAYGROUP and
   PBDF.CAL_ID      = SI01F.CAL_ID and
   PBDF.RSLT_SEG_NUM = SI01F.RSLT_SEG_NUM and
   PBDF.SEG_END_DT = SI01F.SEG_END_DT and
   SI01F.GPDE_SI_PROV_MAND = $ActProvMand and
   SIF.GPDE_SI_IS_KVDR = $Is_KVdR
[$march_critF]
[$order1F]
end-select
end-if
end-procedure





!*************************************************
begin-procedure Print-EE-Data-Abr-Flexi
!wdu-qk04: added Stoerfall-Flag -- N is default
#debug show 'added Stoerfall-Flag -- N is default'

!RH07-890B10P2 qk07: if Stoerfall then allways report abrechnung must be used to print
use-report abrechnung
let $StoerFall = 'N'

if #FLX.GPDE_FL_RP_S1AG = 0 and #FLX.GPDE_FL_RP_S1AN=0 and #FLX.GPDE_FL_RP_S1B=0 and
   #FLX.GPDE_FL_RP_S2AG = 0 and #FLX.GPDE_FL_RP_S2AN = 0 and #FLX.GPDE_FL_RP_S2B = 0 and
   #FLX.GPDE_FL_RP_S3AG = 0 and #FLX.GPDE_FL_RP_S3AN = 0 and #FLX.GPDE_FL_RP_S3B = 0 and
   #FLX.GPDE_FL_RP_S4AG = 0 and #FLX.GPDE_FL_RP_S4AN = 0 and #FLX.GPDE_FL_RP_S4B = 0
   goto NoPrintFlexi
end-if

!wdu-qk04: added Stoerfall-Flag -- we have Stoerfall when here.'
#debug show 'added Stoerfall-Flag -- we have Stoerfall when here.'
let $StoerFall = 'Y'

! wdu05b7: flag for: a Stoerfall happened within the list for this *provider*
let $StoerfallKK ='Y'

if #current-line = 18
   let #current-line = 17
end-if
let #mm = 5 + #current-line
if #mm > 55
 new-page
end-if
let #currLineV = -16 + #current-line
let #currLineN = -15 + #current-line

if #currLineV <= 0
let #currLineV = 1
let #currLineN = 2
end-if
graphic (#currLineN,1,180) box 3 2
display '#currLineV'
display #currLineV
graphic (#currLineV,14,3) vert-line 1

! JJJ-890B10-gz adjusted width
graphic (#currLineV,48,3) vert-line 1
graphic (#currLineV,55,3) vert-line 1
graphic (#currLineV,62,3) vert-line 1
graphic (#currLineV,69,3) vert-line 1
graphic (#currLineV,76,3) vert-line 1
graphic (#currLineV,80,3) vert-line 1



graphic (#currLineV,100,3) vert-line 1
if $PrintFormInsigBUK = 'N'
   graphic (#currLineV,116,3) vert-line 1
   graphic (#currLineV,132,3) vert-line 1
   graphic (#currLineV,148,3) vert-line 1
   graphic (#currLineV,164,3) vert-line 1
else
   graphic (#currLineV,113,3) vert-line 1
   graphic (#currLineV,126,3) vert-line 1
   graphic (#currLineV,139,3) vert-line 1
   graphic (#currLineV,152,3) vert-line 1
   graphic (#currLineV,165,3) vert-line 1
end-if
do Format-Number(#FLX.GPDE_FL_RP_S1AG,$FLX.GPDE_FL_RP_S1AG,'B999,999.99')
do Format-Number(#FLX.GPDE_FL_RP_S1AN,$FLX.GPDE_FL_RP_S1AN,'B999,999.99')
do Format-Number(#FLX.GPDE_FL_RP_S1B,$FLX.GPDE_FL_RP_S1B,'B999,999.99')
do Format-Number(#FLX.GPDE_FL_RP_S2AG,$FLX.GPDE_FL_RP_S2AG,'B999,999.99')
do Format-Number(#FLX.GPDE_FL_RP_S2AN,$FLX.GPDE_FL_RP_S2AN,'B999,999.99')
do Format-Number(#FLX.GPDE_FL_RP_S2B,$FLX.GPDE_FL_RP_S2B,'B999,999.99')
do Format-Number(#FLX.GPDE_FL_RP_S3AG,$FLX.GPDE_FL_RP_S3AG,'B999,999.99')
do Format-Number(#FLX.GPDE_FL_RP_S3AN,$FLX.GPDE_FL_RP_S3AN,'B999,999.99')
do Format-Number(#FLX.GPDE_FL_RP_S3B,$FLX.GPDE_FL_RP_S3B,'B999,999.99')
do Format-Number(#FLX.GPDE_FL_RP_S4AG,$FLX.GPDE_FL_RP_S4AG,'B999,999.99')
do Format-Number(#FLX.GPDE_FL_RP_S4AN,$FLX.GPDE_FL_RP_S4AN,'B999,999.99')
do Format-Number(#FLX.GPDE_FL_RP_S4B,$FLX.GPDE_FL_RP_S4B,'B999,999.99')
let #TempCol = 1 + #currLineV
alter-printer
   font = 4
   point-size = 10.5
let $EmplidT = rtrim($Emplid,' ') || '/'
do Format-Number(#EmplRcd,$EmplRcd,'8888')
print $EmplidT (#TempCol,2)
alter-printer
   font = 4
   point-size = 13
print $EmplRcd (+1,2)
print $ee_name (#TempCol,15,37)
alter-printer
   font = 3
   point-size = 16
let #TempCol = 1 + #TempCol
alter-printer
   font = 4
   point-size = 13
if $RetroSign = 'R'
   let #Date_Type1 = {DateType}
   do ConvertToComponents(&FLX.PRD_END_DT,$yy1a,$mm1a,$dd1a)
   evaluate #Date_Type1
   when = 2
      let $RetroDate = $yy1a || '{PTDateDelim}' || $mm1a
      break
   when-other
      let $RetroDate = $mm1a || '{PTDateDelim}' || $yy1a
      break
   end-evaluate
   let $RetroStr = $RetroDate || ' ' || 'alt'
   print $RetroStr (#TempCol,30)
end-if
if  $RetroSign = 'N'
   let #Date_Type1 = {DateType}
   do ConvertToComponents(&FLX.PRD_END_DT,$yy1a,$mm1a,$dd1a)
   evaluate #Date_Type1
   when = 2
       let $RetroDate = $yy1a || '{PTDateDelim}' || $mm1a
       break
   when-other
       let $RetroDate = $mm1a || '{PTDateDelim}' || $yy1a
       break
   end-evaluate
   let $RetroStr = $RetroDate || ' ' || 'neu'
   print $RetroStr (#TempCol,30)
end-if
alter-printer
   font = 3
   point-size = 16
print $KV_CodeF (#TempCol,48)  edit 99999
print $RV_CodeF (#TempCol,55)  edit 99999
print $AV_CodeF (#TempCol,62)  edit 99999
print $PV_CodeF (#TempCol,69)  edit 99999
print $GZFlag   (#TempCol,76)  edit 999
let $GZFlag = ''                         ! JJJ-890B10P2 qk07




print $FLX.GPDE_FL_RP_S1B  (#TempCol,80)
if $PrintFormInsigBUK = 'N'
   print $FLX.GPDE_FL_RP_S3B  (#TempCol,100)
   print $FLX.GPDE_FL_RP_S1AN    (#TempCol,116)
   print $FLX.GPDE_FL_RP_S3AN    (#TempCol,132)
   print $FLX.GPDE_FL_RP_S4AN    (#TempCol,148)
   print $FLX.GPDE_FL_RP_S2AN    (#TempCol,164)
else
   print $FLX.GPDE_FL_RP_S3B  (#TempCol,97)
   print $FLX.GPDE_FL_RP_S1AN    (#TempCol,110)
   print $FLX.GPDE_FL_RP_S3AN    (#TempCol,123)
   print $FLX.GPDE_FL_RP_S4AN    (#TempCol,136)
   print $FLX.GPDE_FL_RP_S2AN    (#TempCol,149)
end-if
let #TempCol = 1 + #TempCol
print $FLX.GPDE_FL_RP_S4B  (#TempCol,80)
if $PrintFormInsigBUK = 'N'
   print $FLX.GPDE_FL_RP_S2B  (#TempCol,100)
   print $FLX.GPDE_FL_RP_S1AG    (#TempCol,116)
   print $FLX.GPDE_FL_RP_S3AG    (#TempCol,132)
   print $FLX.GPDE_FL_RP_S4AG    (#TempCol,148)
   print $FLX.GPDE_FL_RP_S2AG    (#TempCol,164)
else
   print $FLX.GPDE_FL_RP_S2B  (#TempCol,97)
   print $FLX.GPDE_FL_RP_S1AG    (#TempCol,110)
   print $FLX.GPDE_FL_RP_S3AG    (#TempCol,123)
   print $FLX.GPDE_FL_RP_S4AG    (#TempCol,136)
   print $FLX.GPDE_FL_RP_S2AG    (#TempCol,149)
end-if
alter-printer
   font = 4
   point-size = 13
print 'Störfall' (#TempCol,15,37)
let #KV-Brutto_Sum = #KV-Brutto_Sum + #FLX.GPDE_FL_RP_S1B
let #AV-Brutto_Sum = #AV-Brutto_Sum + #FLX.GPDE_FL_RP_S4B
let #RV-Brutto_Sum = #RV-Brutto_Sum + #FLX.GPDE_FL_RP_S3B
let #PV-Brutto_Sum = #PV-Brutto_Sum + #FLX.GPDE_FL_RP_S2B
let #KV-AN_Sum = #KV-AN_Sum + #FLX.GPDE_FL_RP_S1AN
let #KV-AG_Sum = #KV-AG_Sum + #FLX.GPDE_FL_RP_S1AG
let #RV-AN_Sum = #RV-AN_Sum + #FLX.GPDE_FL_RP_S3AN
let #RV-AG_Sum = #RV-AG_Sum + #FLX.GPDE_FL_RP_S3AG
let #AV-AN_Sum = #AV-AN_Sum + #FLX.GPDE_FL_RP_S4AN
let #AV-AG_Sum = #AV-AG_Sum + #FLX.GPDE_FL_RP_S4AG
let #PV-AN_Sum = #PV-AN_Sum + #FLX.GPDE_FL_RP_S2AN
let #PV-AG_Sum = #PV-AG_Sum + #FLX.GPDE_FL_RP_S2AG
evaluate $KV_CodeF
when = '1'
   let #sv_sum_1000 = #sv_sum_1000 +  #FLX.GPDE_FL_RP_S1AG + #FLX.GPDE_FL_RP_S1AN
   let #Brutto_1000_Sum = #Brutto_1000_Sum + #FLX.GPDE_FL_RP_S1B
   let #KV-AG_1000_Sum = #KV-AG_1000_Sum + #FLX.GPDE_FL_RP_S1AG
   let #KV-AN_1000_Sum = #KV-AN_1000_Sum + #FLX.GPDE_FL_RP_S1AN
   break
when = '2'
   let #sv_sum_2000  = #sv_sum_2000 + #FLX.GPDE_FL_RP_S1AG + #FLX.GPDE_FL_RP_S1AN
   let #Brutto_2000_Sum = #Brutto_2000_Sum + #FLX.GPDE_FL_RP_S1B
   let #KV-AG_2000_Sum = #KV-AG_2000_Sum + #FLX.GPDE_FL_RP_S1AG
   let #KV-AN_2000_Sum = #KV-AN_2000_Sum + #FLX.GPDE_FL_RP_S1AN
   break
when = '3'
   let #sv_sum_3000 = #sv_sum_3000 +  #FLX.GPDE_FL_RP_S1AG + #FLX.GPDE_FL_RP_S1AN
   let #Brutto_3000_Sum = #Brutto_3000_Sum + #FLX.GPDE_FL_RP_S1B
   let #KV-AG_3000_Sum = #KV-AG_3000_Sum + #FLX.GPDE_FL_RP_S1AG
   let #KV-AN_3000_Sum = #KV-AN_3000_Sum + #FLX.GPDE_FL_RP_S1AN
   break
when = '6'
   let #sv_sum_6000 = #sv_sum_6000 +  #FLX.GPDE_FL_RP_S1AG + #FLX.GPDE_FL_RP_S1AN
   let #Brutto_6000_Sum = #Brutto_6000_Sum + #FLX.GPDE_FL_RP_S1B
   let #KV-AG_6000_Sum = #KV-AG_6000_Sum + #FLX.GPDE_FL_RP_S1AG
   let #KV-AN_6000_Sum = #KV-AN_6000_Sum + #FLX.GPDE_FL_RP_S1AN
   break
end-evaluate
let #sv_sum_0001 = #sv_sum_0001 + #FLX.GPDE_FL_RP_S2AG + #FLX.GPDE_FL_RP_S2AN
let #Brutto_0001_Sum = #Brutto_0001_Sum + #FLX.GPDE_FL_RP_S2B
let #PV-AG_0001_Sum = #PV-AG_0001_Sum + #FLX.GPDE_FL_RP_S2AG
let #PV-AN_0001_Sum = #PV-AN_0001_Sum + #FLX.GPDE_FL_RP_S2AN
evaluate $RV_CodeF
  when = '1'
        let #sv_sum_0100 =  #sv_sum_0100 + #FLX.GPDE_FL_RP_S3AG + #FLX.GPDE_FL_RP_S3AN
        let #Brutto_0100_Sum = #Brutto_0100_Sum + #FLX.GPDE_FL_RP_S3B
        let #RV-AG_0100_Sum = #RV-AG_0100_Sum + #FLX.GPDE_FL_RP_S3AG
        let #RV-AN_0100_Sum = #RV-AN_0100_Sum + #FLX.GPDE_FL_RP_S3AN
        break
  when = '2'
        let #sv_sum_0200 =  #sv_sum_0200 + #FLX.GPDE_FL_RP_S3AG + #FLX.GPDE_FL_RP_S3AN
        let #Brutto_0200_Sum = #Brutto_0200_Sum + #FLX.GPDE_FL_RP_S3B
        let #RV-AG_0200_Sum = #RV-AG_0200_Sum + #FLX.GPDE_FL_RP_S3AG
        let #RV-AN_0200_Sum = #RV-AN_0200_Sum + #FLX.GPDE_FL_RP_S3AN
        break
  when = '3'
        let #sv_sum_0300 =  #sv_sum_0300 + #FLX.GPDE_FL_RP_S3AG + #FLX.GPDE_FL_RP_S3AN
        let #Brutto_0300_Sum = #Brutto_0300_Sum + #FLX.GPDE_FL_RP_S3B
        let #RV-AG_0300_Sum = #RV-AG_0300_Sum + #FLX.GPDE_FL_RP_S3AG
        let #RV-AN_0300_Sum = #RV-AN_0300_Sum + #FLX.GPDE_FL_RP_S3AN
        break
  when = '4'
        let #sv_sum_0400 =  #sv_sum_0400 + #FLX.GPDE_FL_RP_S3AG + #FLX.GPDE_FL_RP_S3AN
        let #Brutto_0400_Sum = #Brutto_0400_Sum + #FLX.GPDE_FL_RP_S3B
        let #RV-AG_0400_Sum = #RV-AG_0400_Sum + #FLX.GPDE_FL_RP_S3AG
        let #RV-AN_0400_Sum = #RV-AN_0400_Sum + #FLX.GPDE_FL_RP_S3AN
        break
  when = '5'
        let #sv_sum_0500 =  #sv_sum_0500 + #FLX.GPDE_FL_RP_S3AG + #FLX.GPDE_FL_RP_S3AN
        let #Brutto_0500_Sum = #Brutto_0500_Sum + #FLX.GPDE_FL_RP_S3B
        let #RV-AG_0500_Sum = #RV-AG_0500_Sum + #FLX.GPDE_FL_RP_S3AG
        let #RV-AN_0500_Sum = #RV-AN_0500_Sum + #FLX.GPDE_FL_RP_S3AN
        break
  when = '6'
        let #sv_sum_0600 =  #sv_sum_0600 + #FLX.GPDE_FL_RP_S3AG + #FLX.GPDE_FL_RP_S3AN
        let #Brutto_0600_Sum = #Brutto_0600_Sum + #FLX.GPDE_FL_RP_S3B
        let #RV-AG_0600_Sum = #RV-AG_0600_Sum + #FLX.GPDE_FL_RP_S3AG
        let #RV-AN_0600_Sum = #RV-AN_0600_Sum + #FLX.GPDE_FL_RP_S3AN
        break
  when-other
        break
  end-evaluate
  evaluate $AV_CodeF
     when = '1'
        let #sv_sum_0010 =  #sv_sum_0010 + #FLX.GPDE_FL_RP_S4AG + #FLX.GPDE_FL_RP_S4AN
        let #Brutto_0010_Sum = #Brutto_0010_Sum + #FLX.GPDE_FL_RP_S4B
        let #AV-AG_0010_Sum = #AV-AG_0010_Sum + #FLX.GPDE_FL_RP_S4AG
        let #AV-AN_0010_Sum = #AV-AN_0010_Sum + #FLX.GPDE_FL_RP_S4AN
        break
     when = '2'
        let #sv_sum_0020 =  #sv_sum_0020 + #FLX.GPDE_FL_RP_S4AG + #FLX.GPDE_FL_RP_S4AN
        let #Brutto_0020_Sum = #Brutto_0020_Sum + #FLX.GPDE_FL_RP_S4B
        let #AV-AG_0020_Sum = #AV-AG_0020_Sum + #FLX.GPDE_FL_RP_S4AG
        let #AV-AN_0020_Sum = #AV-AN_0020_Sum + #FLX.GPDE_FL_RP_S4AN
        break
  end-evaluate
NoPrintFlexi:
end-procedure
!******************************************************************
begin-procedure Print_Info_User
!Display, if Reqired input on Run Control failed
if $Nodata = 'Y'
   display '-----------------------------------------------------'
   display 'No Output file for the folowing input:'
   display '   Pay Entity: ' noline
   display $Ctl_PayEntity
   display '   Current Pay End Date: ' noline
   display $Ctl_Curr_Pay_End_Dt
   display '-----------------------------------------------------'
end-if
end-procedure





!*************************************************
begin-procedure Print-EE-Data-Abr
!
! print a single item for Beitragsabrechnung, called from Print-Beitragsabrechnung
!
! wdu05-881b8: we could check the numbers first here, to avoid all-zero-prints, but watch AZ at the end
! first we need to make sure there is something to print, then swith status and print.
!

! ----- first format all numbers then check if at least one is nonzero
    do Format-Number(#PT.GPDE_RP_KVDAYS,$PT.GPDE_RP_KVDAYS,'99999')
    do Format-Number(#PT.GPDE_RP_SIDAYS,$PT.GPDE_RP_SIDAYS,'99999')
    do Format-Number(#PT.GPDE_RP_AVDAYS,$PT.GPDE_RP_AVDAYS,'99999')
    do Format-Number(#PT.GPDE_RP_PVDAYS,$PT.GPDE_RP_PVDAYS,'99999')
    do Format-Number(#PT.GPDE_RP_KVDAYS_MC,$PT.GPDE_RP_KVDAYS_MC,'99999')
    do Format-Number(#PT.GPDE_RP_RVDAYS_MC,$PT.GPDE_RP_RVDAYS_MC,'99999')
    do Format-Number(#PT.GPDE_RP_AVDAYS_MC,$PT.GPDE_RP_AVDAYS_MC,'99999')
    do Format-Number(#PT.GPDE_RP_PVDAYS_MC,$PT.GPDE_RP_PVDAYS_MC,'99999')
    do Format-Number(#PT.GPDE_RP_KVDAYS_BON,$PT.GPDE_RP_KVDAYS_BON,'99999')
    do Format-Number(#PT.GPDE_RP_RVDAYS_BON,$PT.GPDE_RP_RVDAYS_BON,'99999')
    do Format-Number(#PT.GPDE_RP_AVDAYS_BON,$PT.GPDE_RP_AVDAYS_BON,'99999')
    do Format-Number(#PT.GPDE_RP_PVDAYS_BON,$PT.GPDE_RP_PVDAYS_BON,'99999')

    do Format-Number(#PT.GPDE_RP_AVGRS_ANLZ,$PT.GPDE_RP_AVGRS_ANLZ,'B99,999,999.99')
    do Format-Number(#PT.GPDE_RP_AVGRS_BON,$PT.GPDE_RP_AVGRS_BON,'B99,999,999.99')
    do Format-Number(#PT.GPDE_RP_AVGRS_MC,$PT.GPDE_RP_AVGRS_MC,'B99,999,999.99')
    do Format-Number(#PT.GPDE_RP_KVGRS_ANLZ,$PT.GPDE_RP_KVGRS_ANLZ,'B99,999,999.99')
    do Format-Number(#PT.GPDE_RP_KVGRS_BON,$PT.GPDE_RP_KVGRS_BON,'B99,999,999.99')
    do Format-Number(#PT.GPDE_RP_KVGRS_MC,$PT.GPDE_RP_KVGRS_MC,'B99,999,999.99')
    do Format-Number(#PT.GPDE_RP_PVGRS_BON,$PT.GPDE_RP_PVGRS_BON,'B999,999.99')
    do Format-Number(#PT.GPDE_RP_RVGRS_ANLZ,$PT.GPDE_RP_RVGRS_ANLZ,'B999,999.99')
    do Format-Number(#PT.GPDE_RP_RVGRS_BON,$PT.GPDE_RP_RVGRS_BON,'B999,999.99')
    do Format-Number(#PT.GPDE_RP_RVGRS_MC,$PT.GPDE_RP_RVGRS_MC,'B999,999.99')
    do Format-Number(#PT.GPDE_RP_AVLFD_AG,$PT.GPDE_RP_AVLFD_AG,'B999,999.99')
    do Format-Number(#PT.GPDE_RP_AVLFD_AN,$PT.GPDE_RP_AVLFD_AN,'B999,999.99')
    do Format-Number(#PT.GPDE_RP_KVLFD_AG,$PT.GPDE_RP_KVLFD_AG,'B999,999.99')
    do Format-Number(#PT.GPDE_RP_KVLFD_AN,$PT.GPDE_RP_KVLFD_AN,'B999,999.99')
    do Format-Number(#PT.GPDE_RP_PVLFD_AG,$PT.GPDE_RP_PVLFD_AG,'B999,999.99')
    do Format-Number(#PT.GPDE_RP_PVLFD_AN,$PT.GPDE_RP_PVLFD_AN,'B999,999.99')
    do Format-Number(#PT.GPDE_RP_RVLFD_AG,$PT.GPDE_RP_RVLFD_AG,'B999,999.99')
    do Format-Number(#PT.GPDE_RP_RVLFD_AN,$PT.GPDE_RP_RVLFD_AN,'B999,999.99')
    do Format-Number(#PT.GPDE_RP_KVBON_AG,$PT.GPDE_RP_KVBON_AG,'B999,999.99')
    do Format-Number(#PT.GPDE_RP_KVBON_AN,$PT.GPDE_RP_KVBON_AN,'B999,999.99')
    do Format-Number(#PT.GPDE_RP_AVBON_AG,$PT.GPDE_RP_AVBON_AG,'B999,999.99')
    do Format-Number(#PT.GPDE_RP_AVBON_AN,$PT.GPDE_RP_AVBON_AN,'B999,999.99')
    do Format-Number(#PT.GPDE_RP_PVBON_AG,$PT.GPDE_RP_PVBON_AG,'B999,999.99')
    do Format-Number(#PT.GPDE_RP_PVBON_AN,$PT.GPDE_RP_PVBON_AN,'B999,999.99')
    do Format-Number(#PT.GPDE_RP_RVBON_AG,$PT.GPDE_RP_RVBON_AG,'B999,999.99')
    do Format-Number(#PT.GPDE_RP_RVBON_AN,$PT.GPDE_RP_RVBON_AN,'B999,999.99')
    do Format-Number(#PT.GPDE_RP_AVAG_MC,$PT.GPDE_RP_AVAG_MC,'B999,999.99')
    do Format-Number(#PT.GPDE_RP_AVAN_MC,$PT.GPDE_RP_AVAN_MC,'B999,999.99')
    do Format-Number(#PT.GPDE_RP_KVAG_MC,$PT.GPDE_RP_KVAG_MC,'B999,999.99')
    do Format-Number(#PT.GPDE_RP_KVAN_MC,$PT.GPDE_RP_KVAN_MC,'B999,999.99')
    do Format-Number(#PT.GPDE_RP_KVAN_MC,$PT.GPDE_RP_KVAN_MC,'B999,999.99')
    do Format-Number(#PT.GPDE_RP_PVAG_MC,$PT.GPDE_RP_PVAG_MC,'B999,999.99')
    do Format-Number(#PT.GPDE_RP_PVAN_MC,$PT.GPDE_RP_PVAN_MC,'B999,999.99')
    do Format-Number(#PT.GPDE_RP_RVAG_MC,$PT.GPDE_RP_RVAG_MC,'B999,999.99')
    do Format-Number(#PT.GPDE_RP_RVAN_MC,$PT.GPDE_RP_RVAN_MC,'B999,999.99')
    do Format-Number(#PT.GPDE_RP_SIGRUNLM_A,$PT.GPDE_RP_SIGRUNLM_A,'B99,999,999.99')
    do Format-Number(#PT.GPDE_RP_SIGRUNLM_B,$PT.GPDE_RP_SIGRUNLM_B,'B99,999,999.99')
    do Format-Number(#SV_St,$SV_St,'B999,999.99')
    do Format-Number(#PT.GPDE_RP_SFN_SI_ABL,$PT.GPDE_RP_SFN_SI_ABL,'B999,999.99') ! JJJ-890B10-sfn

    if $Is_KVdR = 'Y'
      do Format-Number(#PT.GPDE_RP_PVGRS_ANLZ,$PT.GPDE_RP_PVGRS_ANLZ,'B99,999,999.99')
      do Format-Number(#PT.GPDE_RP_PVGRS_MC,$PT.GPDE_RP_PVGRS_MC,'B99,999,999.99')
    else
      do Format-Number(#PT.GPDE_RP_PVGRS_ANLZ,$PT.GPDE_RP_PVGRS_ANLZ,'B999,999.99')
      do Format-Number(#PT.GPDE_RP_PVGRS_MC,$PT.GPDE_RP_PVGRS_MC,'B999,999.99')
    end-if

    !
    ! convert values to spaces if they are zero
    ! and check for a nonzero value
    do CheckMinusNull_A

! ----- wdu05-881b8 decide if printing makes sense (at least one nonzero value)
        ! sinngemaess: if ( &S10A.GPDE_RP_MARCH_CLS = 0 )
        ! wenn GPDE_RP_MARCH_CLS = 1 und $marchcl ='N'
        ! if we have a marchlause (only) row, we do not print it for current period
        ! because all fields will be blank
if ($march = 'N' and  &PT.GPDE_RP_MARCH_CLS = 1 )
         ! was wrong: if ($march = 'N' and #GPDE_RP_MARCH_CLS = 1)
         ! wdu05-881b8 take GPDE_RP_MARCH_CLS from GPDE_RP_SI10A
         goto NoPrintEeData
    end-if


    ! wdu05-881b8 moved status change to here (from CX_CondPrintEmplAbr_BeitAbr)
    let $WasPrintedData = 'Y'      ! seems to be not used (any more)
    let #zaehler = #zaehler + 1    ! when not 0 then sums/totals are finally printed

! ----- now paint the graphic lines
    if #current-line = 18
       let #current-line = 17
    end-if
    let #mm = 5 + #current-line
    if #mm > 55
     new-page
    end-if
    let #currLineV = -16 + #current-line
    let #currLineN = -15 + #current-line
    graphic (#currLineN,1,180) box 3 2
    ! JJJ-890B10-gz adjusted width
    graphic (#currLineV,14,3) vert-line 1
    graphic (#currLineV,48,3) vert-line 1
    graphic (#currLineV,55,3) vert-line 1
    graphic (#currLineV,62,3) vert-line 1
    graphic (#currLineV,69,3) vert-line 1
    graphic (#currLineV,76,3) vert-line 1
    graphic (#currLineV,80,3) vert-line 1
    graphic (#currLineV,100,3) vert-line 1

    ! BUK ?
    if $PrintFormInsigBUK = 'N'
     if $Is_KVdR <> 'Y'
      graphic (#currLineV,116,3) vert-line 1
      graphic (#currLineV,132,3) vert-line 1
      graphic (#currLineV,148,3) vert-line 1
      graphic (#currLineV,164,3) vert-line 1
     else
      graphic (#currLineV,140,3) vert-line 1
     end-if
    else
      graphic (#currLineV,113,3) vert-line 1
      graphic (#currLineV,126,3) vert-line 1
      graphic (#currLineV,139,3) vert-line 1
      graphic (#currLineV,152,3) vert-line 1
      graphic (#currLineV,165,3) vert-line 1
    end-if


!
! mark PV values with a star when the PV_CHILD is not there
! (and the effdt is after 1/1/2005)
!
if ( $PT.GPDE_SI_PV_CHILD <> 'Y' )
  do Convert-to-DTU-Date(&PT.SLICE_END_DT,$DTU_Slice)

  if ( $DTU_Slice >= $dtu_dateout_2005 )
     if ( #PT.GPDE_RP_PVLFD_AN <> 0 )
         let $PT.GPDE_RP_PVLFD_AN =  $PT.GPDE_RP_PVLFD_AN || '*'
         ! use this to decide if footnote needs to be printed
         let #ChildRemarkCount=#ChildRemarkCount+1
     end-if
  end-if
end-if


let #TempCol = 1 + #currLineV
! Line 1 in Box
alter-printer
   font = 4
   point-size = 10.5
let $EmplidT = rtrim($Emplid,' ') || '/'
do Format-Number(#EmplRcd,$EmplRcd,'8888')
print $EmplidT (#TempCol,2)

alter-printer
   font = 4
   point-size = 13
print $EmplRcd (+1,2)
print $ee_name (#TempCol,15,37)

alter-printer
   font = 3
   point-size = 16
if $MarchCL = 'Y' and $Vorj = 'N'
  print $PT.GPDE_RP_SIGRUNLM_B (#TempCol,80)
else
  print $PT.GPDE_RP_SIGRUNLM_A (#TempCol,80)
end-if
! Line 2 in Box
let #TempCol = 1 + #TempCol
alter-printer
   font = 4
   point-size = 13
if $RetroSign = 'R'
   let #Date_Type1 = {DateType}
   do ConvertToComponents($PRD_END_DT,$yy1a,$mm1a,$dd1a)
   evaluate #Date_Type1
   when = 2
      let $RetroDate = $yy1a || '{PTDateDelim}' || $mm1a
      break
   when-other
      let $RetroDate = $mm1a || '{PTDateDelim}' || $yy1a
      break
   end-evaluate

   let $RetroStr = $RetroDate || ' ' || 'alt'
   print $RetroStr (#TempCol,30)
end-if
if  $RetroSign = 'N'
   let #Date_Type1 = {DateType}
   do ConvertToComponents($PRD_END_DT,$yy1a,$mm1a,$dd1a)
   evaluate #Date_Type1
   when = 2
       let $RetroDate = $yy1a || '{PTDateDelim}' || $mm1a
       break
   when-other
       let $RetroDate = $mm1a || '{PTDateDelim}' || $yy1a
       break
   end-evaluate

   let $RetroStr = $RetroDate || ' ' || 'neu'
   print $RetroStr (#TempCol,30)
end-if
alter-printer
   font = 3
   point-size = 16
print $KV_Code (#TempCol,48)  edit 99999
print $RV_Code (#TempCol,55)  edit 99999
print $AV_Code (#TempCol,62)  edit 99999
print $PV_Code (#TempCol,69)  edit 99999
print $GZFlag   (#TempCol,76)  edit 999
let $GZFlag = ''                         ! JJJ-890B10P2 qk07

! JJJ-890B10-sfn
let #sfncol = #TempCol - 1
if #PT.GPDE_RP_SFN_SI_ABL <> 0
    let $PT.GPDE_RP_SFN_SI_ABL = $PT.GPDE_RP_SFN_SI_ABL || '***'
    print $PT.GPDE_RP_SFN_SI_ABL    (#sfncol, 97)
end-if


if $march = 'N' or $Vorj = 'Y'
   print $PT.GPDE_RP_KVGRS_ANLZ  (#TempCol,80)
  if $PrintFormInsigBUK = 'N'
    if $Is_KVdR <> 'Y'
     print $PT.GPDE_RP_RVGRS_ANLZ  (#TempCol,100)
     print $PT.GPDE_RP_KVLFD_AN    (#TempCol,116)
     print $PT.GPDE_RP_RVLFD_AN    (#TempCol,132)
     print $PT.GPDE_RP_AVLFD_AN    (#TempCol,148)
     print $PT.GPDE_RP_PVLFD_AN    (#TempCol,164)
    else
     print $PT.GPDE_RP_KVLFD_AN    (#TempCol,124)
     print $PT.GPDE_RP_PVLFD_AN    (#TempCol,164)
    end-if
  else
     print $PT.GPDE_RP_RVGRS_ANLZ  (#TempCol,97)
     print $PT.GPDE_RP_KVLFD_AN    (#TempCol,110)
     print $PT.GPDE_RP_RVLFD_AN    (#TempCol,123)
     print $PT.GPDE_RP_AVLFD_AN    (#TempCol,136)
     print $PT.GPDE_RP_PVLFD_AN    (#TempCol,149)
     print $SV_St    (#TempCol,165)
  end-if
else
  print $PT.GPDE_RP_KVGRS_MC  (#TempCol,80)
 if $PrintFormInsigBUK = 'N'
  if $Is_KVdR <> 'Y'
   print $PT.GPDE_RP_RVGRS_MC  (#TempCol,100)
   print $PT.GPDE_RP_KVAN_MC    (#TempCol,116)
   print $PT.GPDE_RP_RVAN_MC    (#TempCol,132)
   print $PT.GPDE_RP_AVAN_MC    (#TempCol,148)
   print $PT.GPDE_RP_PVAN_MC    (#TempCol,164)
  else
   print $PT.GPDE_RP_KVAN_MC    (#TempCol,124)
   print $PT.GPDE_RP_PVAN_MC    (#TempCol,164)
  end-if
 else
   print $PT.GPDE_RP_RVGRS_MC  (#TempCol,97)
   print $PT.GPDE_RP_KVAN_MC    (#TempCol,110)
   print $PT.GPDE_RP_RVAN_MC    (#TempCol,123)
   print $PT.GPDE_RP_AVAN_MC    (#TempCol,136)
   print $PT.GPDE_RP_PVAN_MC    (#TempCol,149)
   print $SV_St    (#TempCol,165)
 end-if
end-if
let #TempCol = 1 + #TempCol
if $MarchCL = 'Y' and $Vorj = 'N'
   print $PT.GPDE_RP_KVDAYS_MC    (#TempCol,48)
   print $PT.GPDE_RP_RVDAYS_MC    (#TempCol,55)
   print $PT.GPDE_RP_AVDAYS_MC    (#TempCol,62)
   print $PT.GPDE_RP_PVDAYS_MC    (#TempCol,69)
   print $GZFlag   (#TempCol,76)  edit 999
   let $GZFlag = ''                         ! JJJ-890B10P2 qk07
else
   print $PT.GPDE_RP_KVDAYS    (#TempCol,48)
   print $PT.GPDE_RP_SIDAYS    (#TempCol,55)
   print $PT.GPDE_RP_AVDAYS    (#TempCol,62)
   print $PT.GPDE_RP_PVDAYS    (#TempCol,69)
   print $GZFlag   (#TempCol,76)  edit 999
   let $GZFlag = ''                         ! JJJ-890B10P2 qk07
end-if

if $MarchCL = 'Y' and $Vorj = 'N'
   if $Is_KVdR <> 'Y'
      print $PT.GPDE_RP_AVGRS_MC  (#TempCol,80)
   else
      print $PT.GPDE_RP_PVGRS_MC  (#TempCol,80)
   end-if

   if $PrintFormInsigBUK = 'N'
     if $Is_KVdR <> 'Y'
      print $PT.GPDE_RP_PVGRS_MC  (#TempCol,100)
      print $PT.GPDE_RP_KVAG_MC    (#TempCol,116)
      print $PT.GPDE_RP_RVAG_MC    (#TempCol,132)
      print $PT.GPDE_RP_AVAG_MC    (#TempCol,148)
      print $PT.GPDE_RP_PVAG_MC    (#TempCol,164)
     else
      print $PT.GPDE_RP_KVAG_MC    (#TempCol,124)
      print $PT.GPDE_RP_PVAG_MC    (#TempCol,164)
     end-if
   else
      print $PT.GPDE_RP_PVGRS_MC  (#TempCol,97)
      print $PT.GPDE_RP_KVAG_MC    (#TempCol,110)
      print $PT.GPDE_RP_RVAG_MC    (#TempCol,123)
      print $PT.GPDE_RP_AVAG_MC    (#TempCol,136)
      print $PT.GPDE_RP_PVAG_MC    (#TempCol,149)
   end-if
else
   if $Is_KVdR <> 'Y'
      print $PT.GPDE_RP_AVGRS_ANLZ  (#TempCol,80)
   else
      print $PT.GPDE_RP_PVGRS_ANLZ  (#TempCol,80)
   end-if

   if $PrintFormInsigBUK = 'N'
     if $Is_KVdR <> 'Y'
      print $PT.GPDE_RP_PVGRS_ANLZ  (#TempCol,100)
      print $PT.GPDE_RP_KVLFD_AG    (#TempCol,116)
      print $PT.GPDE_RP_RVLFD_AG    (#TempCol,132)
      print $PT.GPDE_RP_AVLFD_AG    (#TempCol,148)
      print $PT.GPDE_RP_PVLFD_AG    (#TempCol,164)
     else
      print $PT.GPDE_RP_KVLFD_AG    (#TempCol,124)
      print $PT.GPDE_RP_PVLFD_AG    (#TempCol,164)
     end-if
   else
      print $PT.GPDE_RP_PVGRS_ANLZ  (#TempCol,97)
      print $PT.GPDE_RP_KVLFD_AG    (#TempCol,110)
      print $PT.GPDE_RP_RVLFD_AG    (#TempCol,123)
      print $PT.GPDE_RP_AVLFD_AG    (#TempCol,136)
      print $PT.GPDE_RP_PVLFD_AG    (#TempCol,149)
   end-if
end-if
alter-printer
   font = 4
   point-size = 13
if $MarchCL = 'Y' and $Vorj = 'N'
        let $MarzKlStr = 'Märzklausel'
        print $MarzKlStr (#TempCol,25)
end-if
if $MarchCL = 'Y' and $Vorj = 'N'
   let #KV-Brutto_Sum = #KV-Brutto_Sum + #PT.GPDE_RP_KVGRS_MC
   let #AV-Brutto_Sum = #AV-Brutto_Sum + #PT.GPDE_RP_AVGRS_MC
   let #RV-Brutto_Sum = #RV-Brutto_Sum + #PT.GPDE_RP_RVGRS_MC
   let #PV-Brutto_Sum = #PV-Brutto_Sum + #PT.GPDE_RP_PVGRS_MC
   let #KV-AN_Sum = #KV-AN_Sum + #PT.GPDE_RP_KVAN_MC
   let #KV-AG_Sum = #KV-AG_Sum + #PT.GPDE_RP_KVAG_MC
   let #RV-AN_Sum = #RV-AN_Sum + #PT.GPDE_RP_RVAN_MC
   let #RV-AG_Sum = #RV-AG_Sum + #PT.GPDE_RP_RVAG_MC
   let #AV-AN_Sum = #AV-AN_Sum + #PT.GPDE_RP_AVAN_MC
   let #AV-AG_Sum = #AV-AG_Sum + #PT.GPDE_RP_AVAG_MC
   let #PV-AN_Sum = #PV-AN_Sum + #PT.GPDE_RP_PVAN_MC
   let #PV-AG_Sum = #PV-AG_Sum + #PT.GPDE_RP_PVAG_MC
else
   let #KV-Brutto_Sum = #KV-Brutto_Sum + #PT.GPDE_RP_KVGRS_ANLZ
   let #AV-Brutto_Sum = #AV-Brutto_Sum + #PT.GPDE_RP_AVGRS_ANLZ
   let #RV-Brutto_Sum = #RV-Brutto_Sum + #PT.GPDE_RP_RVGRS_ANLZ
   let #PV-Brutto_Sum = #PV-Brutto_Sum + #PT.GPDE_RP_PVGRS_ANLZ
   let #KV-AN_Sum = #KV-AN_Sum + #PT.GPDE_RP_KVLFD_AN
   let #KV-AG_Sum = #KV-AG_Sum + #PT.GPDE_RP_KVLFD_AG
   let #RV-AN_Sum = #RV-AN_Sum + #PT.GPDE_RP_RVLFD_AN
   let #RV-AG_Sum = #RV-AG_Sum + #PT.GPDE_RP_RVLFD_AG
   let #AV-AN_Sum = #AV-AN_Sum + #PT.GPDE_RP_AVLFD_AN
   let #AV-AG_Sum = #AV-AG_Sum + #PT.GPDE_RP_AVLFD_AG
   let #PV-AN_Sum = #PV-AN_Sum + #PT.GPDE_RP_PVLFD_AN
   let #PV-AG_Sum = #PV-AG_Sum + #PT.GPDE_RP_PVLFD_AG
end-if
if rtrim($hdr_abr_kk_nummer,' ') = '98000006'
   let #SV_Sum_St = #SV_Sum_St + #SV_St
end-if

! we still could have AZ data to print(?)
NoPrintEeData:

if $Is_KVdR <> 'Y'
do ATZ2004Lookup        ! wdu05-881b8: check AZ begin once per emplid (if any AZ)
do Print_ATZ
do Print_ATZ_KG
do Print_EinmalBezuegeAbr
do Print_EinmBezAtz
do Print_EinmBezAtzMc
do Print_KUG
end-if
end-procedure
!*************************************************************************************





begin-procedure  Print_EinmBezAtz
if #PT.GPDE_RP_AZGRS_BON <> 0 or
   #PT.GPDE_RP_OAPPEN_BON <> 0
     let #mm = 5 + #current-line
     if #mm > 55
        new-page
     end-if
     let #currLineV = -17 + #current-line
     let #currLineN = -16 + #current-line
     graphic (#currLineN,1,180) box 3 2
     graphic (#currLineV,14,3) vert-line 1
     graphic (#currLineV,48,3) vert-line 1
     graphic (#currLineV,55,3) vert-line 1
     graphic (#currLineV,62,3) vert-line 1
     graphic (#currLineV,69,3) vert-line 1
     graphic (#currLineV,76,3) vert-line 1
     graphic (#currLineV,80,3) vert-line 1
     graphic (#currLineV,100,3) vert-line 1
     if $PrintFormInsigBUK = 'N'
        graphic (#currLineV,116,3) vert-line 1
        graphic (#currLineV,132,3) vert-line 1
        graphic (#currLineV,148,3) vert-line 1
        graphic (#currLineV,164,3) vert-line 1
     else
        graphic (#currLineV,113,3) vert-line 1
        graphic (#currLineV,126,3) vert-line 1
        graphic (#currLineV,139,3) vert-line 1
        graphic (#currLineV,152,3) vert-line 1
        graphic (#currLineV,165,3) vert-line 1
     end-if
         let #TempCol = 1 + #currLineV
         alter-printer
       font = 3
       point-size = 16
         let #TempCol = 1 + #TempCol
         do Format-Number(#PT.GPDE_RP_AZGRS_BON,$SV_Gross_ATZ,'B999,999.99')
       if $PrintFormInsigBUK = 'N'
          print $SV_Gross_ATZ                 (#TempCol,100)
       else
          print $SV_Gross_ATZ                 (#TempCol,97)
       end-if
       alter-printer
       font = 4
       point-size = 13
         if $march = 'N' or $Vorj = 'Y'
           if $Vorj = 'Y'
             print $UBTEXT_EGAVJ     (#TempCol,25)
           else
             print $UBTEXT_EGA    (#TempCol,25)
           end-if
         else
            print $UBTEXT_EGA    (#TempCol,25)
         end-if
         let #TempCol = 1 + #TempCol
         alter-printer
       font = 3
       point-size = 16
         let #Amount2 = #PT.GPDE_RP_OAPPEN_BON
         do Format-Number(#Amount2,$number,'B999,999.99')
       if $PrintFormInsigBUK = 'N'
         print $number (#TempCol,132)
       else
         print $number (#TempCol,126)
       end-if
     alter-printer
       font = 4
       point-size = 13
     if $march = 'Y' and $Vorj = 'N'
        let $MarzKlStr = 'Märzklausel'
        print $MarzKlStr (#TempCol,25)
     end-if
     let #RV-AG_Sum = #RV-AG_Sum + #Amount2
     let #RV-Brutto_Sum = #RV-Brutto_Sum + #PT.GPDE_RP_AZGRS_BON
 end-if
end-procedure
!*************************************************************************************
begin-procedure  Print_EinmBezAtzMc
if #PT.GPDE_RP_OAPPEN_MC <> 0 or
   #PT.GPDE_RP_OAPGRS_MC <> 0
    if $Vorj = 'N' and $march = 'N'
         goto NoPr1
    end-if
     let #mm = 5 + #current-line
     if #mm > 55
        new-page
     end-if
     let #currLineV = -17 + #current-line
     let #currLineN = -16 + #current-line
     graphic (#currLineN,1,180) box 3 2
     graphic (#currLineV,14,3) vert-line 1
     graphic (#currLineV,48,3) vert-line 1
     graphic (#currLineV,55,3) vert-line 1
     graphic (#currLineV,62,3) vert-line 1
     graphic (#currLineV,69,3) vert-line 1
     graphic (#currLineV,76,3) vert-line 1
     graphic (#currLineV,80,3) vert-line 1
     graphic (#currLineV,100,3) vert-line 1
     if $PrintFormInsigBUK = 'N'
        graphic (#currLineV,116,3) vert-line 1
        graphic (#currLineV,132,3) vert-line 1
        graphic (#currLineV,148,3) vert-line 1
        graphic (#currLineV,164,3) vert-line 1
     else
        graphic (#currLineV,113,3) vert-line 1
        graphic (#currLineV,126,3) vert-line 1
        graphic (#currLineV,139,3) vert-line 1
        graphic (#currLineV,152,3) vert-line 1
        graphic (#currLineV,165,3) vert-line 1
     end-if
         let #TempCol = 1 + #currLineV
         alter-printer
       font = 3
       point-size = 16
         let #TempCol = 1 + #TempCol
         do Format-Number(#PT.GPDE_RP_OAPGRS_MC,$SV_Gross_ATZ,'B999,999.99')
     if $PrintFormInsigBUK = 'N'
        print $SV_Gross_ATZ                 (#TempCol,100)
     else
        print $SV_Gross_ATZ                 (#TempCol,97)
     end-if
         alter-printer
       font = 4
       point-size = 13
         if $march = 'N' or $Vorj = 'Y'
           if $Vorj = 'Y'
             print $UBTEXT_EGA    (#TempCol,25)
           else
             print $UBTEXT_EGA    (#TempCol,25)
           end-if
         else
            print $UBTEXT_EGA    (#TempCol,25)
         end-if
       let #TempCol = 1 + #TempCol
         alter-printer
       font = 3
       point-size = 16
         let #Amount2 = #PT.GPDE_RP_OAPPEN_MC
         do Format-Number(#Amount2,$number,'B999,999.99')
       if $PrintFormInsigBUK = 'N'
         print $number (#TempCol,132)
       else
         print $number (#TempCol,126)
       end-if
     alter-printer
       font = 4
       point-size = 13
     if $march = 'Y' and $Vorj = 'N'
        let $MarzKlStr = 'Märzklausel'
        print $MarzKlStr (#TempCol,25)
     end-if
     let #RV-AG_Sum = #RV-AG_Sum + #Amount2
     let #RV-Brutto_Sum = #RV-Brutto_Sum + #PT.GPDE_RP_OAPGRS_MC
 end-if
NoPr1:
end-procedure
!*************************************************************************************





begin-procedure Print_EinmalBezuegeAbr

  if #PT.GPDE_RP_AVGRS_BON  <> 0 or #PT.GPDE_RP_KVGRS_BON  <> 0 or
     #PT.GPDE_RP_PVGRS_BON  <> 0 or #PT.GPDE_RP_RVGRS_BON  <> 0 or
     #PT.GPDE_RP_KVBON_AG   <> 0 or #PT.GPDE_RP_KVBON_AN   <> 0 or
     #PT.GPDE_RP_AVBON_AG   <> 0 or #PT.GPDE_RP_AVBON_AN   <> 0 or
     #PT.GPDE_RP_PVBON_AG   <> 0 or #PT.GPDE_RP_PVBON_AN   <> 0 or
     #PT.GPDE_RP_RVBON_AG   <> 0 or #PT.GPDE_RP_RVBON_AN   <> 0 or
     #PT.GPDE_RP_SIGRUNLM_B <> 0
     ! if any bonus contributions exist ...
     if  #SI.GPDE_RP_MARCH_CLS <> 0 and
         #PT.GPDE_RP_AVGRS_BON  = 0 and #PT.GPDE_RP_KVGRS_BON  = 0 and
         #PT.GPDE_RP_PVGRS_BON  = 0 and #PT.GPDE_RP_RVGRS_BON  = 0 and
         #PT.GPDE_RP_KVBON_AG   = 0 and #PT.GPDE_RP_KVBON_AN   = 0 and
         #PT.GPDE_RP_AVBON_AG   = 0 and #PT.GPDE_RP_AVBON_AN   = 0 and
         #PT.GPDE_RP_PVBON_AG   = 0 and #PT.GPDE_RP_PVBON_AN   = 0 and
         #PT.GPDE_RP_RVBON_AG   = 0 and #PT.GPDE_RP_RVBON_AN   = 0
         ! if we have marchlause and there is no other bonus, then dont print
         goto NoPr
     end-if

     ! if we are here, then we have some bonus (aside from possible marchclause)
     let #mm = 5 + #current-line
     if #mm > 55
        new-page
     end-if
     let #currLineV = -17 + #current-line
     let #currLineN = -16 + #current-line
     graphic (#currLineN,1,180) box 3 2
     graphic (#currLineV,14,3) vert-line 1
     graphic (#currLineV,48,3) vert-line 1
     graphic (#currLineV,55,3) vert-line 1
     graphic (#currLineV,62,3) vert-line 1
     graphic (#currLineV,69,3) vert-line 1
     graphic (#currLineV,76,3) vert-line 1
     graphic (#currLineV,80,3) vert-line 1
     graphic (#currLineV,100,3) vert-line 1
     if $PrintFormInsigBUK = 'N'
        graphic (#currLineV,116,3) vert-line 1
        graphic (#currLineV,132,3) vert-line 1
        graphic (#currLineV,148,3) vert-line 1
        graphic (#currLineV,164,3) vert-line 1
     else
        graphic (#currLineV,113,3) vert-line 1
        graphic (#currLineV,126,3) vert-line 1
        graphic (#currLineV,139,3) vert-line 1
        graphic (#currLineV,152,3) vert-line 1
        graphic (#currLineV,165,3) vert-line 1
     end-if

         let #TempCol = 1 + #currLineV
         alter-printer
           font = 3
           point-size = 16
     if $march = 'N' or $Vorj = 'Y'
         if #SI.GPDE_RP_MARCH_CLS = 0
            print $PT.GPDE_RP_SIGRUNLM_B (#TempCol,80)
         end-if
     else
         print $PT.GPDE_RP_SIGRUNLM_B (#TempCol,80)
     end-if
         let #TempCol = 1 + #TempCol

         ! debug
         if $PT.GPDE_RP_KVGRS_BON = ' '
            print 'no-gross' (#TempCol,80)
         end-if
         print $PT.GPDE_RP_KVGRS_BON (#TempCol,80)
     if $PrintFormInsigBUK = 'N'
         print $PT.GPDE_RP_RVGRS_BON (#TempCol,100)
         print $PT.GPDE_RP_KVBON_AN (#TempCol,116)
         print $PT.GPDE_RP_RVBON_AN (#TempCol,132)
         print $PT.GPDE_RP_AVBON_AN (#TempCol,148)
         print $PT.GPDE_RP_PVBON_AN (#TempCol,164)
     else
         print $PT.GPDE_RP_RVGRS_BON (#TempCol,97)
         print $PT.GPDE_RP_KVBON_AN (#TempCol,110)
         print $PT.GPDE_RP_RVBON_AN (#TempCol,123)
         print $PT.GPDE_RP_AVBON_AN (#TempCol,136)
         print $PT.GPDE_RP_PVBON_AN (#TempCol,149)
     end-if
       alter-printer
       font = 4
       point-size = 13

         if $march = 'N' or $Vorj = 'Y'
            if $Vorj = 'Y'
               print 'Einmalbez. Vorjahr'   (#TempCol,25)
            else
               print 'Einmalbezüge'   (#TempCol,25)
            end-if
         else
            print 'Einmalbezüge'   (#TempCol,25)
         end-if
         let #TempCol = 1 + #TempCol
         alter-printer
       font = 3
       point-size = 16
         print $PT.GPDE_RP_KVDAYS_BON (#TempCol,48)
         print $PT.GPDE_RP_RVDAYS_BON (#TempCol,55)
         print $PT.GPDE_RP_AVDAYS_BON (#TempCol,62)
         print $PT.GPDE_RP_PVDAYS_BON (#TempCol,69)
         print $GZFlag   (#TempCol,76)  edit 999
         let $GZFlag = ''                         ! JJJ-890B10P2 qk07
         print $PT.GPDE_RP_AVGRS_BON (#TempCol,80)
      if $PrintFormInsigBUK = 'N'
         print $PT.GPDE_RP_PVGRS_BON (#TempCol,100)
         print $PT.GPDE_RP_KVBON_AG (#TempCol,116)
         print $PT.GPDE_RP_RVBON_AG (#TempCol,132)
         print $PT.GPDE_RP_AVBON_AG (#TempCol,148)
         print $PT.GPDE_RP_PVBON_AG (#TempCol,164)
      else
         print $PT.GPDE_RP_PVGRS_BON (#TempCol,97)
         print $PT.GPDE_RP_KVBON_AG (#TempCol,110)
         print $PT.GPDE_RP_RVBON_AG (#TempCol,123)
         print $PT.GPDE_RP_AVBON_AG (#TempCol,136)
         print $PT.GPDE_RP_PVBON_AG (#TempCol,149)
      end-if
     alter-printer
       font = 4
       point-size = 13
     if $MarchCL = 'Y' and $Vorj = 'N'
        let $MarzKlStr = 'Märzklausel'
        print $MarzKlStr (#TempCol,25)
     end-if
       let #KV-Brutto_Sum = #KV-Brutto_Sum + #PT.GPDE_RP_KVGRS_BON
       let #AV-Brutto_Sum = #AV-Brutto_Sum + #PT.GPDE_RP_AVGRS_BON
       let #RV-Brutto_Sum = #RV-Brutto_Sum + #PT.GPDE_RP_RVGRS_BON
       let #PV-Brutto_Sum = #PV-Brutto_Sum + #PT.GPDE_RP_PVGRS_BON
       let #KV-AN_Sum = #KV-AN_Sum + #PT.GPDE_RP_KVBON_AN
       let #KV-AG_Sum = #KV-AG_Sum + #PT.GPDE_RP_KVBON_AG
       let #RV-AN_Sum = #RV-AN_Sum + #PT.GPDE_RP_RVBON_AN
       let #RV-AG_Sum = #RV-AG_Sum + #PT.GPDE_RP_RVBON_AG
       let #AV-AN_Sum = #AV-AN_Sum + #PT.GPDE_RP_AVBON_AN
       let #AV-AG_Sum = #AV-AG_Sum + #PT.GPDE_RP_AVBON_AG
       let #PV-AN_Sum = #PV-AN_Sum + #PT.GPDE_RP_PVBON_AN
       let #PV-AG_Sum = #PV-AG_Sum + #PT.GPDE_RP_PVBON_AG
  end-if
  NoPr:
end-procedure
!*************************************************************************************




begin-procedure Print_ATZ
 if #PT.GPDE_RP_AZGRS_ANLZ <> 0 or #PT.GPDE_RP_OAPPEN_ANL <> 0
    if $Vorj = 'N' and $march = 'Y'
         goto NoPr2
    end-if
     let #mm = 5 + #current-line
     if #mm > 55
        new-page
     end-if
     let #currLineV = -17 + #current-line
     let #currLineN = -16 + #current-line
     graphic (#currLineN,1,180) box 3 2
     graphic (#currLineV,14,3) vert-line 1
     graphic (#currLineV,48,3) vert-line 1
     graphic (#currLineV,55,3) vert-line 1
     graphic (#currLineV,62,3) vert-line 1
     graphic (#currLineV,69,3) vert-line 1
     graphic (#currLineV,76,3) vert-line 1
     graphic (#currLineV,80,3) vert-line 1
     graphic (#currLineV,100,3) vert-line 1
     if $PrintFormInsigBUK = 'N'
        graphic (#currLineV,116,3) vert-line 1
        graphic (#currLineV,132,3) vert-line 1
        graphic (#currLineV,148,3) vert-line 1
        graphic (#currLineV,164,3) vert-line 1
     else
        graphic (#currLineV,113,3) vert-line 1
        graphic (#currLineV,126,3) vert-line 1
        graphic (#currLineV,139,3) vert-line 1
        graphic (#currLineV,152,3) vert-line 1
        graphic (#currLineV,165,3) vert-line 1
     end-if
         let #TempCol = 1 + #currLineV
         alter-printer
       font = 3
       point-size = 16
         let #TempCol = 1 + #TempCol
         do Format-Number(#PT.GPDE_RP_AZGRS_ANLZ,$SV_Gross_ATZ,'B999,999.99')
      if $PrintFormInsigBUK = 'N'
         print $SV_Gross_ATZ                 (#TempCol,100)
      else
         print $SV_Gross_ATZ                 (#TempCol,97)
      end-if
      alter-printer
       font = 4
       point-size = 13
         if $march = 'N' or $Vorj = 'Y'
           if $Vorj = 'Y'
             print $UBTEXT_VJ  (#TempCol,25)
           else
             print $UBTEXT   (#TempCol,25)
           end-if
         else
            print $UBTEXT   (#TempCol,25)
         end-if

         let #TempCol = 1 + #TempCol
         alter-printer
       font = 3
       point-size = 16
         let #Amount2 = #PT.GPDE_RP_OAPPEN_ANL
         do Format-Number(#Amount2,$number,'B999,999.99')
       if $PrintFormInsigBUK = 'N'
          print $number (#TempCol,132)
       else
          print $number (#TempCol,126)
       end-if
       alter-printer
       font = 4
       point-size = 13
     if $march = 'Y' and $Vorj = 'N'
        let $MarzKlStr = 'Märzklausel'
        print $MarzKlStr (#TempCol,25)
     end-if
     let #RV-AG_Sum = #RV-AG_Sum + #Amount2
     let #RV-Brutto_Sum = #RV-Brutto_Sum + #PT.GPDE_RP_AZGRS_ANLZ
 end-if
NoPr2:
end-procedure
!*************************************************************************************
begin-procedure Print_ATZ_KG
 if #PT.GPDE_AZ_RP_S03_31 <> 0 or #PT.GPDE_AZ_RP_S03_41 <> 0
    if $Vorj = 'N' and $march = 'Y'
         goto NoPr2KG
    end-if
     let #mm = 5 + #current-line
     if #mm > 55
        new-page
     end-if
     let #currLineV = -17 + #current-line
     let #currLineN = -16 + #current-line
     graphic (#currLineN,1,180) box 3 2
     graphic (#currLineV,14,3) vert-line 1
     graphic (#currLineV,48,3) vert-line 1
     graphic (#currLineV,55,3) vert-line 1
     graphic (#currLineV,62,3) vert-line 1
     graphic (#currLineV,69,3) vert-line 1
     graphic (#currLineV,76,3) vert-line 1
     graphic (#currLineV,80,3) vert-line 1
     graphic (#currLineV,100,3) vert-line 1
     if $PrintFormInsigBUK = 'N'
        graphic (#currLineV,116,3) vert-line 1
        graphic (#currLineV,132,3) vert-line 1
        graphic (#currLineV,148,3) vert-line 1
        graphic (#currLineV,164,3) vert-line 1
     else
        graphic (#currLineV,113,3) vert-line 1
        graphic (#currLineV,126,3) vert-line 1
        graphic (#currLineV,139,3) vert-line 1
        graphic (#currLineV,152,3) vert-line 1
        graphic (#currLineV,165,3) vert-line 1
     end-if
         let #TempCol = 1 + #currLineV
         alter-printer
       font = 3
       point-size = 16
         let #TempCol = 1 + #TempCol
        !wd: S03_41 gegen S03_31 getauscht
         do Format-Number(#PT.GPDE_AZ_RP_S03_31,$SV_Gross_ATZ,'B999,999.99')

      if $PrintFormInsigBUK = 'N'
         print $SV_Gross_ATZ                 (#TempCol,100)
      else
         print $SV_Gross_ATZ                 (#TempCol,97)
      end-if
       alter-printer
       font = 4
       point-size = 13
         if $march = 'N' or $Vorj = 'Y'
           if $Vorj = 'Y'
             print $UBTEXT_KGVJ   (#TempCol,25)
           else
             print $UBTEXT_KG   (#TempCol,25)
           end-if
         else
            print $UBTEXT_KG   (#TempCol,25)
         end-if
         let #TempCol = 1 + #TempCol
         alter-printer
       font = 3
       point-size = 16
        !wd: S03_31 gegen S03_41 getauscht
         let #Amount2 = #PT.GPDE_AZ_RP_S03_41
         do Format-Number(#Amount2,$number,'B999,999.99')

       if $PrintFormInsigBUK = 'N'
          print $number (#TempCol,132)
       else
          print $number (#TempCol,126)
       end-if
       alter-printer
       font = 4
       point-size = 13
     if $march = 'Y' and $Vorj = 'N'
        let $MarzKlStr = 'Märzklausel'
        print $MarzKlStr (#TempCol,25)
     end-if
     let #RV-AG_Sum = #RV-AG_Sum + #Amount2
        !wd: S03_41 gegen S03_31 getauscht(?)
     let #RV-Brutto_Sum = #RV-Brutto_Sum + #PT.GPDE_AZ_RP_S03_31
 end-if
NoPr2KG:
end-procedure
!*************************************************************************************




begin-procedure CheckMinusNull_A
! convert numbers with a value of zero to blanks

   if rtrim(ltrim($SV_St, ' '), ' ') = $MinusNull  or
      rtrim(ltrim($SV_St, ' '), ' ') = $PlusNull
      let $SV_St = ' '
   end-if
   if rtrim(ltrim($PT.GPDE_RP_AVGRS_ANLZ, ' '), ' ') = $MinusNull  or
      rtrim(ltrim($PT.GPDE_RP_AVGRS_ANLZ, ' '), ' ') = $PlusNull
      let $PT.GPDE_RP_AVGRS_ANLZ = ' '
   end-if
   if rtrim(ltrim($PT.GPDE_RP_AVGRS_BON, ' '), ' ') = $MinusNull or
      rtrim(ltrim($PT.GPDE_RP_AVGRS_BON, ' '), ' ') = $PlusNull
      let $PT.GPDE_RP_AVGRS_BON = ' '
   end-if
   if rtrim(ltrim($PT.GPDE_RP_AVGRS_MC, ' '), ' ') = $MinusNull or
      rtrim(ltrim($PT.GPDE_RP_AVGRS_MC, ' '), ' ') = $PlusNull
      let $PT.GPDE_RP_AVGRS_MC = ' '
   end-if
   if rtrim(ltrim($PT.GPDE_RP_KVGRS_ANLZ, ' '), ' ') = $MinusNull or
      rtrim(ltrim($PT.GPDE_RP_KVGRS_ANLZ, ' '), ' ') = $PlusNull
      let $PT.GPDE_RP_KVGRS_ANLZ = ' '
   end-if
   if rtrim(ltrim($PT.GPDE_RP_KVGRS_BON, ' '), ' ') = $MinusNull or
      rtrim(ltrim($PT.GPDE_RP_KVGRS_BON, ' '), ' ') = $PlusNull
      let $PT.GPDE_RP_KVGRS_BON = ' '
   end-if
   if rtrim(ltrim($PT.GPDE_RP_KVGRS_MC, ' '), ' ') = $MinusNull or
      rtrim(ltrim($PT.GPDE_RP_KVGRS_MC, ' '), ' ') = $PlusNull
      let $PT.GPDE_RP_KVGRS_MC = ' '
   end-if
   if rtrim(ltrim($PT.GPDE_RP_PVGRS_ANLZ, ' '), ' ') = $MinusNull or
      rtrim(ltrim($PT.GPDE_RP_PVGRS_ANLZ, ' '), ' ') = $PlusNull
      let $PT.GPDE_RP_PVGRS_ANLZ = ' '
   end-if
   if rtrim(ltrim($PT.GPDE_RP_PVGRS_BON, ' '), ' ') = $MinusNull or
      rtrim(ltrim($PT.GPDE_RP_PVGRS_BON, ' '), ' ') = $PlusNull
      let $PT.GPDE_RP_PVGRS_BON = ' '
   end-if
   if rtrim(ltrim($PT.GPDE_RP_PVGRS_MC, ' '), ' ') = $MinusNull or
      rtrim(ltrim($PT.GPDE_RP_PVGRS_MC, ' '), ' ') = $PlusNull
      let $PT.GPDE_RP_PVGRS_MC = ' '
   end-if
   if rtrim(ltrim($PT.GPDE_RP_RVGRS_ANLZ, ' '), ' ') = $MinusNull or
      rtrim(ltrim($PT.GPDE_RP_RVGRS_ANLZ, ' '), ' ') = $PlusNull
      let $PT.GPDE_RP_RVGRS_ANLZ = ' '
   end-if
   if rtrim(ltrim($PT.GPDE_RP_RVGRS_BON, ' '), ' ') = $MinusNull or
      rtrim(ltrim($PT.GPDE_RP_RVGRS_BON, ' '), ' ') = $PlusNull
      let $PT.GPDE_RP_RVGRS_BON = ' '
   end-if
   if rtrim(ltrim($PT.GPDE_RP_RVGRS_MC, ' '), ' ') = $MinusNull or
      rtrim(ltrim($PT.GPDE_RP_RVGRS_MC, ' '), ' ') = $PlusNull
      let $PT.GPDE_RP_RVGRS_MC = ' '
   end-if
   if rtrim(ltrim($PT.GPDE_RP_AVLFD_AG, ' '), ' ') = $MinusNull or
      rtrim(ltrim($PT.GPDE_RP_AVLFD_AG, ' '), ' ') = $PlusNull
      let $PT.GPDE_RP_AVLFD_AG = ' '
   end-if
   if rtrim(ltrim($PT.GPDE_RP_AVLFD_AN, ' '), ' ') = $MinusNull or
      rtrim(ltrim($PT.GPDE_RP_AVLFD_AN, ' '), ' ') = $PlusNull
      let $PT.GPDE_RP_AVLFD_AN = ' '
   end-if
   if rtrim(ltrim($PT.GPDE_RP_KVLFD_AG, ' '), ' ') = $MinusNull or
      rtrim(ltrim($PT.GPDE_RP_KVLFD_AG, ' '), ' ') = $PlusNull
      let $PT.GPDE_RP_KVLFD_AG = ' '
   end-if
   if rtrim(ltrim($PT.GPDE_RP_KVLFD_AN, ' '), ' ') = $MinusNull or
      rtrim(ltrim($PT.GPDE_RP_KVLFD_AN, ' '), ' ') = $PlusNull
      let $PT.GPDE_RP_KVLFD_AN = ' '
   end-if
   if rtrim(ltrim($PT.GPDE_RP_PVLFD_AG, ' '), ' ') = $MinusNull or
      rtrim(ltrim($PT.GPDE_RP_PVLFD_AG, ' '), ' ') = $PlusNull
      let $PT.GPDE_RP_PVLFD_AG = ' '
   end-if
   if rtrim(ltrim($PT.GPDE_RP_PVLFD_AN, ' '), ' ') = $MinusNull or
      rtrim(ltrim($PT.GPDE_RP_PVLFD_AN, ' '), ' ') = $PlusNull
      let $PT.GPDE_RP_PVLFD_AN = ' '
   end-if
   if rtrim(ltrim($PT.GPDE_RP_RVLFD_AG, ' '), ' ') = $MinusNull or
      rtrim(ltrim($PT.GPDE_RP_RVLFD_AG, ' '), ' ') = $PlusNull
      let $PT.GPDE_RP_RVLFD_AG = ' '
   end-if
   if rtrim(ltrim($PT.GPDE_RP_RVLFD_AN, ' '), ' ') = $MinusNull or
      rtrim(ltrim($PT.GPDE_RP_RVLFD_AN, ' '), ' ') = $PlusNull
      let $PT.GPDE_RP_RVLFD_AN = ' '
   end-if
   if rtrim(ltrim($PT.GPDE_RP_KVBON_AG, ' '), ' ') = $MinusNull or
      rtrim(ltrim($PT.GPDE_RP_KVBON_AG, ' '), ' ') = $PlusNull
      let $PT.GPDE_RP_KVBON_AG = ' '
   end-if
   if rtrim(ltrim($PT.GPDE_RP_KVBON_AN, ' '), ' ') = $MinusNull or
      rtrim(ltrim($PT.GPDE_RP_KVBON_AN, ' '), ' ') = $PlusNull
      let $PT.GPDE_RP_KVBON_AN = ' '
   end-if
   if rtrim(ltrim($PT.GPDE_RP_AVBON_AG, ' '), ' ') = $MinusNull or
      rtrim(ltrim($PT.GPDE_RP_AVBON_AG, ' '), ' ') = $PlusNull
      let $PT.GPDE_RP_AVBON_AG = ' '
   end-if
   if rtrim(ltrim($PT.GPDE_RP_AVBON_AN, ' '), ' ') = $MinusNull or
      rtrim(ltrim($PT.GPDE_RP_AVBON_AN, ' '), ' ') = $PlusNull
      let $PT.GPDE_RP_AVBON_AN = ' '
   end-if
   if rtrim(ltrim($PT.GPDE_RP_PVBON_AG, ' '), ' ') = $MinusNull or
      rtrim(ltrim($PT.GPDE_RP_PVBON_AG, ' '), ' ') = $PlusNull
      let $PT.GPDE_RP_PVBON_AG = ' '
   end-if
   if rtrim(ltrim($PT.GPDE_RP_PVBON_AN, ' '), ' ') = $MinusNull or
      rtrim(ltrim($PT.GPDE_RP_PVBON_AN, ' '), ' ') = $PlusNull
      let $PT.GPDE_RP_PVBON_AN = ' '
   end-if
   if rtrim(ltrim($PT.GPDE_RP_RVBON_AG, ' '), ' ') = $MinusNull or
      rtrim(ltrim($PT.GPDE_RP_RVBON_AG, ' '), ' ') = $PlusNull
      let $PT.GPDE_RP_RVBON_AG = ' '
   end-if
   if rtrim(ltrim($PT.GPDE_RP_RVBON_AN, ' '), ' ') = $MinusNull or
      rtrim(ltrim($PT.GPDE_RP_RVBON_AN, ' '), ' ') = $PlusNull
      let $PT.GPDE_RP_RVBON_AN = ' '
   end-if
   if rtrim(ltrim($PT.GPDE_RP_AVAG_MC, ' '), ' ') = $MinusNull or
      rtrim(ltrim($PT.GPDE_RP_AVAG_MC, ' '), ' ') = $PlusNull
      let $PT.GPDE_RP_AVAG_MC = ' '
   end-if
   if rtrim(ltrim($PT.GPDE_RP_AVAN_MC, ' '), ' ') = $MinusNull or
      rtrim(ltrim($PT.GPDE_RP_AVAN_MC, ' '), ' ') = $PlusNull
      let $PT.GPDE_RP_AVAN_MC = ' '
   end-if
   if rtrim(ltrim($PT.GPDE_RP_KVAG_MC, ' '), ' ') = $MinusNull or
      rtrim(ltrim($PT.GPDE_RP_KVAG_MC, ' '), ' ') = $PlusNull
      let $PT.GPDE_RP_KVAG_MC = ' '
   end-if
   if rtrim(ltrim($PT.GPDE_RP_KVAN_MC, ' '), ' ') = $MinusNull or
      rtrim(ltrim($PT.GPDE_RP_KVAN_MC, ' '), ' ') = $PlusNull
      let $PT.GPDE_RP_KVAN_MC = ' '
   end-if
   if rtrim(ltrim($PT.GPDE_RP_PVAG_MC, ' '), ' ') = $MinusNull or
      rtrim(ltrim($PT.GPDE_RP_PVAG_MC, ' '), ' ') = $PlusNull
      let $PT.GPDE_RP_PVAG_MC = ' '
   end-if
   if rtrim(ltrim($PT.GPDE_RP_PVAN_MC, ' '), ' ') = $MinusNull or
      rtrim(ltrim($PT.GPDE_RP_PVAN_MC, ' '), ' ') = $PlusNull
      let $PT.GPDE_RP_PVAN_MC = ' '
   end-if
   if rtrim(ltrim($PT.GPDE_RP_RVAG_MC, ' '), ' ') = $MinusNull or
      rtrim(ltrim($PT.GPDE_RP_RVAG_MC, ' '), ' ') = $PlusNull
      let $PT.GPDE_RP_RVAG_MC = ' '
   end-if
   if rtrim(ltrim($PT.GPDE_RP_RVAN_MC, ' '), ' ') = $MinusNull or
      rtrim(ltrim($PT.GPDE_RP_RVAN_MC, ' '), ' ') = $PlusNull
      let $PT.GPDE_RP_RVAN_MC = ' '
   end-if
   if rtrim(ltrim($PT.GPDE_RP_SIGRUNLM_A, ' '), ' ') = $MinusNull or
      rtrim(ltrim($PT.GPDE_RP_SIGRUNLM_A, ' '), ' ') = $PlusNull
      let $PT.GPDE_RP_SIGRUNLM_A = ' '
   end-if
   if rtrim(ltrim($PT.GPDE_RP_SIGRUNLM_B, ' '), ' ') = $MinusNull or
      rtrim(ltrim($PT.GPDE_RP_SIGRUNLM_B, ' '), ' ') = $PlusNull
      let $PT.GPDE_RP_SIGRUNLM_B = ' '
   end-if
 end-procedure
!*************************************************************************************




begin-procedure CheckMinusNull_KUG
! wdu06-881kug new procedure
! convert numbers with a value of zero to blanks
   if rtrim(ltrim($PT.GPDE_RP_KUG_KVCTB, ' '), ' ') = $MinusNull  or
      rtrim(ltrim($PT.GPDE_RP_KUG_KVCTB, ' '), ' ') = $PlusNull
      let $PT.GPDE_RP_KUG_KVCTB = ' '
   end-if
   if rtrim(ltrim($PT.GPDE_RP_KUG_PVCTB, ' '), ' ') = $MinusNull  or
      rtrim(ltrim($PT.GPDE_RP_KUG_PVCTB, ' '), ' ') = $PlusNull
      let $PT.GPDE_RP_KUG_PVCTB = ' '
   end-if
   if rtrim(ltrim($PT.GPDE_RP_KUG_RVCTB, ' '), ' ') = $MinusNull  or
      rtrim(ltrim($PT.GPDE_RP_KUG_RVCTB, ' '), ' ') = $PlusNull
      let $PT.GPDE_RP_KUG_RVCTB = ' '
   end-if

   if rtrim(ltrim($PT.GPDE_RP_KUG_KVGRS, ' '), ' ') = $MinusNull  or
      rtrim(ltrim($PT.GPDE_RP_KUG_KVGRS, ' '), ' ') = $PlusNull
      let $PT.GPDE_RP_KUG_KVGRS = ' '
   end-if
   if rtrim(ltrim($PT.GPDE_RP_KUG_PVGRS, ' '), ' ') = $MinusNull  or
      rtrim(ltrim($PT.GPDE_RP_KUG_PVGRS, ' '), ' ') = $PlusNull
      let $PT.GPDE_RP_KUG_PVGRS = ' '
   end-if
   if rtrim(ltrim($PT.GPDE_RP_KUG_RVGRS, ' '), ' ') = $MinusNull  or
      rtrim(ltrim($PT.GPDE_RP_KUG_RVGRS, ' '), ' ') = $PlusNull
      let $PT.GPDE_RP_KUG_RVGRS = ' '
   end-if
end-procedure




begin-procedure Print-Sums-Abr
if #current-line = 18
   let #current-line = 17
end-if
let #mm = 6 + #current-line
!adj08-890b15-page break
if #mm > 50
  let $GPDE_SI_REGION_save = $GPDE_SI_REGION_Old
  let $GPDE_TX_MINER_save = $GPDE_TX_MINER_Old
  let $GPDE_SI_PROV_MAND_save = $GPDE_SI_PROV_MAND_Old
  let $hdr_abr_si_provider  = $GPDE_SI_PROV_MAND_Old
  let $Actual_Curruncy_save = $Actual_Curruncy_Old
     if $Actual_Curruncy_save = 'DEM'
        let $Actual_Curruncy_save = 'DM'
     end-if
     if $Actual_Curruncy_save = 'EUR'
        let $Actual_Curruncy_save = $EUROCHAR
     end-if
 new-page
end-if
let #currLineV = -16 + #current-line
let #currLineN = -15 + #current-line
graphic (#currLineN,48,133) box 5 14
graphic (#currLineV,80,5) vert-line 1
graphic (#currLineV,100,5) vert-line 1
if $PrintFormInsigBUK = 'N'
 if $Is_KVdR <> 'Y'
  graphic (#currLineV,116,5) vert-line 1
  graphic (#currLineV,132,5) vert-line 1
  graphic (#currLineV,148,5) vert-line 1
  graphic (#currLineV,164,5) vert-line 1
 else
  graphic (#currLineV,140,5) vert-line 1
 end-if
else
  graphic (#currLineV,113,5) vert-line 1
  graphic (#currLineV,126,5) vert-line 1
  graphic (#currLineV,139,5) vert-line 1
  graphic (#currLineV,152,5) vert-line 1
  graphic (#currLineV,165,5) vert-line 1
end-if
do Format-Number(#KV-Brutto_Sum,$KV-Brutto_Sum,'999,999,999.99')
do Format-Number(#AV-Brutto_Sum,$AV-Brutto_Sum,'999,999,999.99')
do Format-Number(#RV-Brutto_Sum,$RV-Brutto_Sum,',999,999.99')

if $Is_KVdR = 'Y'
  do Format-Number(#PV-Brutto_Sum,$PV-Brutto_Sum,'999,999,999.99')
else
  do Format-Number(#PV-Brutto_Sum,$PV-Brutto_Sum,',999,999.99')
end-if
do Format-Number(#KV-AN_Sum,$KV-AN_Sum,',999,999.99')
do Format-Number(#KV-AG_Sum,$KV-AG_Sum,',999,999.99')
do Format-Number(#RV-AN_Sum,$RV-AN_Sum,',999,999.99')
do Format-Number(#RV-AG_Sum,$RV-AG_Sum,',999,999.99')
do Format-Number(#AV-AN_Sum,$AV-AN_Sum,',999,999.99')
do Format-Number(#AV-AG_Sum,$AV-AG_Sum,',999,999.99')
do Format-Number(#PV-AN_Sum,$PV-AN_Sum,',999,999.99')
do Format-Number(#PV-AG_Sum,$PV-AG_Sum,',999,999.99')
do Format-Number(#SV_Sum_St,$SV_Sum_St,',999,999.99')
do CheckMinusNull_B
let #TempCol = 1 + #currLineV
alter-printer
   font = 4
   point-size = 12
print 'KV-Brutto'  (#TempCol,81) bold
if $PrintFormInsigBUK = 'N'
  if $Is_KVdR <> 'Y'
   print 'RV-Brutto'  (#TempCol,101) bold
   print 'KV/AN'  (#TempCol,117) bold
   print 'RV/AN'  (#TempCol,133) bold
   print 'AV/AN'  (#TempCol,149) bold
   print 'PV/AN'  (#TempCol,165) bold
  else
   print 'KV/AN'  (#TempCol,125) bold
   print 'PV/AN'  (#TempCol,165) bold
  end-if
else
   print 'RV-Brutto'  (#TempCol,101) bold
   print 'KV/AN'  (#TempCol,114) bold
   print 'RV/AN'  (#TempCol,127) bold
   print 'AV/AN'  (#TempCol,140) bold
   print 'PV/AN'  (#TempCol,153) bold
   print 'einheitl. Pauschst.'  (#TempCol,166) bold
end-if
alter-printer
   font = 3
   point-size = 16
let #TempCol = 1 + #TempCol
print $KV-Brutto_Sum (#TempCol,80)   bold
if $PrintFormInsigBUK = 'N'
  if $Is_KVdR <> 'Y'
   print $RV-Brutto_Sum (#TempCol,100)  bold
   print $KV-AN_Sum (#TempCol,116)      bold
   print $RV-AN_Sum (#TempCol,132)      bold
   print $AV-AN_Sum (#TempCol,148)      bold
   print $PV-AN_Sum (#TempCol,164)      bold
  else
   print $KV-AN_Sum (#TempCol,124)      bold
   print $PV-AN_Sum (#TempCol,164)      bold
  end-if
else
   print $RV-Brutto_Sum (#TempCol,97)  bold
   print $KV-AN_Sum (#TempCol,110)      bold
   print $RV-AN_Sum (#TempCol,123)      bold
   print $AV-AN_Sum (#TempCol,136)      bold
   print $PV-AN_Sum (#TempCol,149)      bold
   print $SV_Sum_St    (#TempCol,165)
end-if
let #TempCol = 1 + #TempCol
alter-printer
   font = 4
   point-size = 13
print 'Summe'  (#TempCol,49)         bold
let #TempCol = 1 + #TempCol
if $Is_KVdR <> 'Y'
   print 'AV-Brutto'  (#TempCol,81) bold
else
   print 'PV-Brutto'  (#TempCol,81) bold
end-if

if $PrintFormInsigBUK = 'N'
  if $Is_KVdR <> 'Y'
   print 'PV-Brutto'  (#TempCol,101) bold
   print 'KV/AG'  (#TempCol,117) bold
   print 'RV/AG'  (#TempCol,133) bold
   print 'AV/AG'  (#TempCol,149) bold
   print 'PV/AG'  (#TempCol,165) bold
  else
   print 'KV/AG'  (#TempCol,125) bold
   print 'PV/AG'  (#TempCol,165) bold
  end-if
else
   print 'PV-Brutto'  (#TempCol,101) bold
   print 'KV/AG'  (#TempCol,114) bold
   print 'RV/AG'  (#TempCol,127) bold
   print 'AV/AG'  (#TempCol,140) bold
   print 'PV/AG'  (#TempCol,153) bold
end-if
alter-printer
   font = 3
   point-size = 16
let #TempCol = 1 + #TempCol
if $Is_KVdR <> 'Y'
   print $AV-Brutto_Sum (#TempCol,80)   bold
else
   print $PV-Brutto_Sum (#TempCol,80)   bold
end-if

if $PrintFormInsigBUK = 'N'
  if $Is_KVdR <> 'Y'
   print $PV-Brutto_Sum (#TempCol,100)  bold
   print $KV-AG_Sum (#TempCol,116)      bold
   print $RV-AG_Sum (#TempCol,132)      bold
   print $AV-AG_Sum (#TempCol,148)      bold
   print $PV-AG_Sum (#TempCol,164)      bold
  else
   print $KV-AG_Sum (#TempCol,124)      bold
   print $PV-AG_Sum (#TempCol,164)      bold
  end-if
else
   print $PV-Brutto_Sum (#TempCol,97)  bold
   print $KV-AG_Sum (#TempCol,110)      bold
   print $RV-AG_Sum (#TempCol,123)      bold
   print $AV-AG_Sum (#TempCol,136)      bold
   print $PV-AG_Sum (#TempCol,149)      bold
end-if
let #KV-Brutto_Sum = 0
let #AV-Brutto_Sum = 0
let #RV-Brutto_Sum = 0
let #PV-Brutto_Sum = 0
let #KV-AN_Sum = 0
let #KV-AG_Sum = 0
let #RV-AN_Sum = 0
let #RV-AG_Sum = 0
let #AV-AN_Sum = 0
let #AV-AG_Sum = 0
let #PV-AN_Sum = 0
let #PV-AG_Sum = 0
alter-printer
   font = 4
   point-size = 13
end-procedure
!*************************************************************************************
begin-procedure CheckMinusNull_B

   if rtrim(ltrim($KV-Brutto_Sum, ' '), ' ') = $MinusNull
      let $KV-Brutto_Sum = '          ' || $PlusNull
   end-if
   if rtrim(ltrim($AV-Brutto_Sum, ' '), ' ') = $MinusNull
      let $AV-Brutto_Sum = '          ' || $PlusNull
   end-if
   if rtrim(ltrim($RV-Brutto_Sum, ' '), ' ') = $MinusNull
      let $RV-Brutto_Sum = '       ' || $PlusNull
   end-if
   if rtrim(ltrim($PV-Brutto_Sum, ' '), ' ') = $MinusNull
     if $Is_KVdR = 'Y'
      let $PV-Brutto_Sum = '          ' || $PlusNull
     else
      let $PV-Brutto_Sum = '       ' || $PlusNull
     end-if
   end-if
   if rtrim(ltrim($KV-AN_Sum, ' '), ' ') = $MinusNull
      let $KV-AN_Sum = '       ' || $PlusNull
   end-if
   if rtrim(ltrim($KV-AG_Sum, ' '), ' ') = $MinusNull
      let $KV-AG_Sum = '       ' || $PlusNull
   end-if
   if rtrim(ltrim($RV-AN_Sum, ' '), ' ') = $MinusNull
      let $RV-AN_Sum = '       ' || $PlusNull
   end-if
   if rtrim(ltrim($RV-AG_Sum, ' '), ' ') = $MinusNull
      let $RV-AG_Sum = '       ' || $PlusNull
   end-if
   if rtrim(ltrim($AV-AN_Sum, ' '), ' ') = $MinusNull
      let $AV-AN_Sum = '       ' || $PlusNull
   end-if
   if rtrim(ltrim($AV-AG_Sum, ' '), ' ') = $MinusNull
      let $AV-AG_Sum = '       ' || $PlusNull
   end-if
   if rtrim(ltrim($PV-AN_Sum, ' '), ' ') = $MinusNull
      let $PV-AN_Sum = '       ' || $PlusNull
   end-if
   if rtrim(ltrim($PV-AG_Sum, ' '), ' ') = $MinusNull
      let $PV-AG_Sum = '       ' || $PlusNull
   end-if
 end-procedure
!*******************************************************************************************




begin-procedure Print_Abrechnung_Sum

  if $PrintFormInsigBUK = 'N'
    if $Is_KVdR <> 'Y'
     let #sum_sv_Amount = #sv_sum_1000  + #sv_sum_2000 + #sv_sum_3000 +
      #sv_sum_6000 + #sv_KV_Freiw_Sum + #sv_sum_0100 + #sv_sum_0300 +
      #sv_sum_0500 + #sv_sum_0200 + #sv_sum_0400 + #sv_sum_0600 +
      #sv_sum_0010 + #sv_sum_0020 + #sv_sum_0001 + #sv_PV_Freiw_Sum +
      #sv_sum_U1 + #sv_sum_U2 + #UML_INSOLV_Sum_1
!adj08-890b16 RI insolvency-added contr. insolvency
    else
      let #sum_sv_Amount = #sv_sum_kvdr + #sv_sum_pv_kvdr1
    end-if
  else
    let #sum_sv_Amount = #sv_sum_6000 + #sv_KV_Freiw_Sum + #sv_sum_0100 +
      #sv_sum_0500 + #sv_sum_0200 + #sv_sum_0600 +
      #sv_PV_Freiw_Sum + #sv_sum_U1 + #sv_sum_U2 + #SV_Sum_St + #UML_INSOLV_Sum_1
  end-if
  if $PrintFormInsigBUK = 'N'
     if $Is_KVdR <> 'Y'
        let #sum_AG_Amount = #KV-AG_1000_Sum + #KV-AG_2000_Sum + #KV-AG_3000_Sum +
         #KV-AG_6000_Sum + #KV-AG_Freiw_Sum + #RV-AG_0200_Sum + #RV-AG_0400_Sum +
         #RV-AG_0600_Sum + #RV-AG_0100_Sum + #RV-AG_0300_Sum + #RV-AG_0500_Sum +
         #AV-AG_0010_Sum + #AV-AG_0020_Sum + #PV-AG_0001_Sum + #PV-AG_Freiw_Sum +
         #AG_U1_Sum + #AG_U2_Sum + #UML_INSOLV_Sum_1
     else
        let #sum_AG_Amount = #KV-AG_kvdr_Sum + #PV-AG_kvdr_Sum

     end-if
  else
     let #sum_AG_Amount = #KV-AG_6000_Sum + #KV-AG_Freiw_Sum + #RV-AG_0200_Sum +
         #RV-AG_0600_Sum + #RV-AG_0100_Sum + #RV-AG_0500_Sum +
         #PV-AG_Freiw_Sum + #AG_U1_Sum + #AG_U2_Sum + #UML_INSOLV_Sum_1
  end-if
  let #RV-AN_0200_Sum = #sv_sum_0200 - #RV-AG_0200_Sum
  let #RV-AN_0400_Sum = #sv_sum_0400 - #RV-AG_0400_Sum
  let #RV-AN_0600_Sum = #sv_sum_0600 - #RV-AG_0600_Sum
  let #RV-AN_0100_Sum = #sv_sum_0100 - #RV-AG_0100_Sum
  let #RV-AN_0300_Sum = #sv_sum_0300 - #RV-AG_0300_Sum
  let #RV-AN_0500_Sum = #sv_sum_0500 - #RV-AG_0500_Sum
  if $PrintFormInsigBUK = 'N'
    if $Is_KVdR <> 'Y'
       let #sum_AN_Amount = #KV-AN_1000_Sum + #KV-AN_2000_Sum + #KV-AN_3000_Sum +
         #KV-AN_6000_Sum + #KV-AN_Freiw_Sum + #RV-AN_0200_Sum + #RV-AN_0400_Sum +
         #RV-AN_0600_Sum + #RV-AN_0100_Sum + #RV-AN_0300_Sum + #RV-AN_0500_Sum +
         #AV-AN_0010_Sum + #AV-AN_0020_Sum + #PV-AN_0001_Sum + #PV-AN_Freiw_Sum +
         #AN_U1_Sum + #AN_U2_Sum
    else
       let #sum_AN_Amount = #KV-AN_kvdr_Sum + #PV-AN_kvdr_Sum

    end-if
  else
     let #sum_AN_Amount = #KV-AN_6000_Sum + #KV-AN_Freiw_Sum + #RV-AN_0200_Sum +
         #RV-AN_0600_Sum + #RV-AN_0100_Sum + #RV-AN_0500_Sum +
         #PV-AN_Freiw_Sum + #AN_U1_Sum + #AN_U2_Sum
  end-if
  do Format-Number(#sum_sv_Amount,$sum_sv_Amount,'999,999,999.99')
  do Format-Number(#sum_AG_Amount,$sum_AG_Amount,'999,999,999.99')
  do Format-Number(#sum_AN_Amount,$sum_AN_Amount,'999,999,999.99')
  do Format-Number(#sv_sum_1000,$sv_sum_1000,'999,999,999.99')
  do Format-Number(#sv_sum_2000,$sv_sum_2000,'999,999,999.99')
  do Format-Number(#sv_sum_3000,$sv_sum_3000,'999,999,999.99')
  do Format-Number(#sv_sum_6000,$sv_sum_6000,'999,999,999.99')
  do Format-Number(#sv_KV_Freiw_Sum,$sv_KV_Freiw_Sum,'999,999,999.99')
  do Format-Number(#sv_sum_0100,$sv_sum_0100,'999,999,999.99')
  do Format-Number(#sv_sum_0300,$sv_sum_0300,'999,999,999.99')
  do Format-Number(#sv_sum_0500,$sv_sum_0500,'999,999,999.99')
  do Format-Number(#sv_sum_0200,$sv_sum_0200,'999,999,999.99')
  do Format-Number(#sv_sum_0400,$sv_sum_0400,'999,999,999.99')
  do Format-Number(#sv_sum_0600,$sv_sum_0600,'999,999,999.99')
  do Format-Number(#sv_sum_0010,$sv_sum_0010,'999,999,999.99')
  do Format-Number(#sv_sum_0020,$sv_sum_0020,'999,999,999.99')
  do Format-Number(#sv_sum_0001,$sv_sum_0001,'999,999,999.99')
  do Format-Number(#sv_PV_Freiw_Sum,$sv_PV_Freiw_Sum,'999,999,999.99')
  do Format-Number(#sv_sum_u1,$sv_sum_u1,'999,999,999.99')
  do Format-Number(#sv_sum_u2,$sv_sum_u2,'999,999,999.99')
  do Format-Number(#Brutto_1000_Sum,$Brutto_1000_Sum,'999,999,999.99')
  do Format-Number(#Brutto_2000_Sum,$Brutto_2000_Sum,'999,999,999.99')
  do Format-Number(#Brutto_3000_Sum,$Brutto_3000_Sum,'999,999,999.99')
  do Format-Number(#Brutto_6000_Sum,$Brutto_6000_Sum,'999,999,999.99')
  do Format-Number(#Brutto_KV_Freiw_Sum,$Brutto_KV_Freiw_Sum,'999,999,999.99')
  do Format-Number(#Brutto_0100_Sum,$Brutto_0100_Sum,'999,999,999.99')
  do Format-Number(#Brutto_0300_Sum,$Brutto_0300_Sum,'999,999,999.99')
  do Format-Number(#Brutto_0500_Sum,$Brutto_0500_Sum,'999,999,999.99')
  do Format-Number(#Brutto_0200_Sum,$Brutto_0200_Sum,'999,999,999.99')
  do Format-Number(#Brutto_0400_Sum,$Brutto_0400_Sum,'999,999,999.99')
  do Format-Number(#Brutto_0600_Sum,$Brutto_0600_Sum,'999,999,999.99')
  do Format-Number(#Brutto_0010_Sum,$Brutto_0010_Sum,'999,999,999.99')
  do Format-Number(#Brutto_0020_Sum,$Brutto_0020_Sum,'999,999,999.99')
  do Format-Number(#Brutto_0001_Sum,$Brutto_0001_Sum,'999,999,999.99')
  do Format-Number(#Brutto_PV_Freiw_Sum,$Brutto_PV_Freiw_Sum,'999,999,999.99')
  do Format-Number(#Brutto_U1_Sum,$Brutto_U1_Sum,'999,999,999.99')
  do Format-Number(#Brutto_U2_Sum,$Brutto_U2_Sum,'999,999,999.99')
  do Format-Number(#Brutto_Sum,$Brutto_Sum,'999,999,999.99')
  do Format-Number(#KV-AG_1000_Sum,$KV-AG_1000_Sum,'999,999,999.99')
  do Format-Number(#KV-AG_2000_Sum,$KV-AG_2000_Sum,'999,999,999.99')
  do Format-Number(#KV-AG_3000_Sum,$KV-AG_3000_Sum,'999,999,999.99')
  do Format-Number(#KV-AG_6000_Sum,$KV-AG_6000_Sum,'999,999,999.99')
  do Format-Number(#KV-AG_Freiw_Sum,$KV-AG_Freiw_Sum,'999,999,999.99')
  do Format-Number(#KV-AN_1000_Sum,$KV-AN_1000_Sum,'999,999,999.99')
  do Format-Number(#KV-AN_2000_Sum,$KV-AN_2000_Sum,'999,999,999.99')
  do Format-Number(#KV-AN_3000_Sum,$KV-AN_3000_Sum,'999,999,999.99')
  do Format-Number(#KV-AN_6000_Sum,$KV-AN_6000_Sum,'999,999,999.99')
  do Format-Number(#KV-AN_Freiw_Sum,$KV-AN_Freiw_Sum,'999,999,999.99')
  do Format-Number(#RV-AG_0100_Sum,$RV-AG_0100_Sum,'999,999,999.99')
  do Format-Number(#RV-AG_0300_Sum,$RV-AG_0300_Sum,'999,999,999.99')
  do Format-Number(#RV-AG_0500_Sum,$RV-AG_0500_Sum,'999,999,999.99')
  do Format-Number(#RV-AN_0100_Sum,$RV-AN_0100_Sum,'999,999,999.99')
  do Format-Number(#RV-AN_0300_Sum,$RV-AN_0300_Sum,'999,999,999.99')
  do Format-Number(#RV-AN_0500_Sum,$RV-AN_0500_Sum,'999,999,999.99')
  do Format-Number(#RV-AG_0200_Sum,$RV-AG_0200_Sum,'999,999,999.99')
  do Format-Number(#RV-AG_0400_Sum,$RV-AG_0400_Sum,'999,999,999.99')
  do Format-Number(#RV-AG_0600_Sum,$RV-AG_0600_Sum,'999,999,999.99')
  do Format-Number(#RV-AN_0200_Sum,$RV-AN_0200_Sum,'999,999,999.99')
  do Format-Number(#RV-AN_0400_Sum,$RV-AN_0400_Sum,'999,999,999.99')
  do Format-Number(#RV-AN_0600_Sum,$RV-AN_0600_Sum,'999,999,999.99')
  do Format-Number(#AV-AG_0010_Sum,$AV-AG_0010_Sum,'999,999,999.99')
  do Format-Number(#AV-AG_0020_Sum,$AV-AG_0020_Sum,'999,999,999.99')
  do Format-Number(#AV-AN_0010_Sum,$AV-AN_0010_Sum,'999,999,999.99')
  do Format-Number(#AV-AN_0020_Sum,$AV-AN_0020_Sum,'999,999,999.99')
  do Format-Number(#PV-AG_0001_Sum,$PV-AG_0001_Sum,'999,999,999.99')
  do Format-Number(#PV-AG_Freiw_Sum,$PV-AG_Freiw_Sum,'999,999,999.99')
  do Format-Number(#PV-AN_0001_Sum,$PV-AN_0001_Sum,'999,999,999.99')
  do Format-Number(#PV-AN_Freiw_Sum,$PV-AN_Freiw_Sum,'999,999,999.99')
  do Format-Number(#AG_U1_Sum,$AG_U1_Sum,'999,999,999.99')
  do Format-Number(#AG_U2_Sum,$AG_U2_Sum,'999,999,999.99')
  do Format-Number(#AN_U1_Sum,$AN_U1_Sum,'999,999,999.99')
  do Format-Number(#AN_U2_Sum,$AN_U2_Sum,'999,999,999.99')
  do Format-Number(#SV_Sum_St,$SV_Sum_St,'999,999,999.99')
  do Format-Number(#sv_sum_kvdr,$sv_sum_kvdr,'B99,999,999.99')
  do Format-Number(#sv_sum_pv_kvdr1,$sv_sum_pv_kvdr1,'999,999,999.99')
  do Format-Number(#KV-AG_kvdr_Sum,$KV-AG_kvdr_Sum,'999,999,999.99')
  do Format-Number(#KV-AN_kvdr_Sum,$KV-AN_kvdr_Sum,'999,999,999.99')
  do Format-Number(#PV-AN_kvdr_Sum,$PV-AN_kvdr_Sum,'999,999,999.99')
  do Format-Number(#PV-AG_kvdr_Sum,$PV-AG_kvdr_Sum,'999,999,999.99')
  do Format-Number(#Brutto_kvdr_Sum,$Brutto_kvdr_Sum,'999,999,999.99')
  do Format-Number(#Brutto_kvdr1_Sum,$Brutto_kvdr1_Sum,'999,999,999.99')
  do Format-Number(#UML_INSOLV_Sum_1,$UML_INSOLV_0050,'999,999,999.99')
  do Format-Number(#GRSS_INSOL_Sum_1,$GRSS_INSOL_0050,'999,999,999.99')
  do CheckMinusNull_C

  alter-printer
     font = 4
     point-size = 13
if $PrintFormInsigBUK = 'N'
 if $Is_KVdR <> 'Y'
  graphic (2,1,150) box 5 1
  graphic (1,56,5) vert-line 2
  graphic (1,70,5) vert-line 2
  graphic (1,90,5) vert-line 2
  graphic (1,110,5) vert-line 2
  graphic (1,130,5) vert-line 2
  graphic (2,1,150) horz-line 2
  graphic (3,1,150) horz-line 2
  graphic (4,1,150) horz-line 2
  graphic (5,1,150) horz-line 2
  print 'Krankenversicherung allgemeiner Beitrag'    (2,2)
  print 'Krankenversicherung erhöhter Beitrag'       (3,2)
  print 'Krankenversicherung ermäßigter Beitrag'    (4,2)
  print 'Krankenversicherung ger. Beitrag'           (5,2)
  print 'Krankenversicherung freiwilliger Beitrag'   (6,2)
  graphic (9,1,150) box 3 2
  graphic (8,56,3) vert-line 1
  graphic (8,70,3) vert-line 1
  graphic (8,90,3) vert-line 1
  graphic (8,110,3) vert-line 1
  graphic (8,130,3) vert-line 1
  graphic (9,1,150) horz-line 2
  graphic (10,1,150) horz-line 2
  print 'Renterversicherung Arbeiter'    (9,2)
  print 'Renterversicherung Arbeiter/Rentner'       (10,2)
  print 'Renterversicherung Arbeiter/Gering'    (11,2)
  graphic (14,1,150) box 3 2
  graphic (13,56,3) vert-line 3
  graphic (13,70,3) vert-line 3
  graphic (13,90,3) vert-line 3
  graphic (13,110,3) vert-line 3
  graphic (13,130,3) vert-line 3
  graphic (14,1,150) horz-line 2
  graphic (15,1,150) horz-line 2
  print 'Renterversicherung Angestellte'    (14,2)
  print 'Renterversicherung Angestellter/Rentner'       (15,2)
  print 'Renterversicherung Angestellter/Gering'    (16,2)
  graphic (19,1,150) box 2 2
  graphic (18,56,2) vert-line 2
  graphic (18,70,2) vert-line 2
  graphic (18,90,2) vert-line 2
  graphic (18,110,2) vert-line 2
  graphic (18,130,2) vert-line 2
  graphic (19,1,150) horz-line 2
  print 'Arbeitslosenversicherung'    (19,2)
  print 'Arbeitslosenversicherung'       (20,2)
!adj08-890b16 : Refund Insurance Insolvency.
  graphic (23,1,150) box 1 1
  graphic (22,56,1) vert-line 1
  graphic (22,70,1) vert-line 1
  graphic (22,90,1) vert-line 1
  graphic (22,110,1) vert-line 1
  graphic (22,130,1) vert-line 1
  print 'Insolvenzgeldumlage'    (23,2)
  graphic (26,1,150) box 2 2
  graphic (25,56,2) vert-line 2
  graphic (25,70,2) vert-line 2
  graphic (25,90,2) vert-line 2
  graphic (25,110,2) vert-line 2
  graphic (25,130,2) vert-line 2
  graphic (26,1,150) horz-line 1
  print 'Pflegeversicherung'    (26,2)
  print 'Pflegeversicherung freiwilliger Beitrag'       (27,2)
  graphic (30,1,150) box 2 2
  graphic (29,56,2) vert-line 2
  graphic (29,70,2) vert-line 2
  graphic (29,90,2) vert-line 2
  graphic (29,110,2) vert-line 2
  graphic (29,130,2) vert-line 2
  graphic (30,1,150) horz-line 2
  print 'Umlage Satz 1'    (30,2)
  print 'Umlage Satz 2'       (31,2)
  graphic (34,1,150) box 2 14
  graphic (33,90,2) vert-line 2
  graphic (33,110,2) vert-line 2
  graphic (33,130,2) vert-line 2
  print 'Summe'    (35,2) bold
  print '1000'                  (2,60)
  print '2000'                  (3,60)
  print '3000'                  (4,60)
  print '6000'                  (5,60)
  print '    '                  (6,60)
  print '0100'                  (09,60)
  print '0300'                  (10,60)
  print '0500'                  (11,60)
  print '0200'                  (14,60)
  print '0400'                  (15,60)
  print '0600'                  (16,60)
  print '0010'                  (19,60)
  print '0020'                  (20,60)
  print '0050'                  (23,60)
  print '0001'                  (26,60)
  print '    '                  (27,60)
  print 'U1'                  (30,61)
  print 'U2'                  (31,61)
 else
  graphic (2,1,150) box 6 2
  graphic (1,56,6) vert-line 2
  graphic (1,70,6) vert-line 2
  graphic (1,90,6) vert-line 2
  graphic (1,110,6) vert-line 2
  graphic (1,130,6) vert-line 2
  graphic (2,1,150) horz-line 2
  graphic (3,1,150) horz-line 2
  graphic (4,1,150) horz-line 2
  graphic (5,1,150) horz-line 2
  graphic (6,1,150) horz-line 2
  print 'Krankenversicherung allgemeiner Beitrag'    (2,2)
  print 'Krankenversicherung erhöhter Beitrag'       (3,2)
  print 'Krankenversicherung ermäßigter Beitrag'     (4,2)
  print 'Krankenversicherung ger. Beitrag'           (5,2)
  print 'Krankenversicherung freiwilliger Beitrag'   (6,2)
  print 'Krankenversicherung KVdR'   (7,2)
  graphic (10,1,150) box 3 2
  graphic (9,56,3) vert-line 2
  graphic (9,70,3) vert-line 2
  graphic (9,90,3) vert-line 2
  graphic (9,110,3) vert-line 2
  graphic (9,130,3) vert-line 2
  graphic (10,1,150) horz-line 2
  graphic (11,1,150) horz-line 2
  print 'Renterversicherung Arbeiter'    (10,2)
  print 'Renterversicherung Arbeiter/Rentner'       (11,2)
  print 'Renterversicherung Arbeiter/Gering'    (12,2)
  graphic (15,1,150) box 3 2
  graphic (14,56,3) vert-line 2
  graphic (14,70,3) vert-line 2
  graphic (14,90,3) vert-line 2
  graphic (14,110,3) vert-line 2
  graphic (14,130,3) vert-line 2
  graphic (15,1,150) horz-line 2
  graphic (16,1,150) horz-line 2
  print 'Renterversicherung Angestellte'    (15,2)
  print 'Renterversicherung Angestellter/Rentner'       (16,2)
  print 'Renterversicherung Angestellter/Gering'    (17,2)
  graphic (20,1,150) box 2 2
  graphic (19,56,2) vert-line 2
  graphic (19,70,2) vert-line 2
  graphic (19,90,2) vert-line 2
  graphic (19,110,2) vert-line 2
  graphic (19,130,2) vert-line 2
  graphic (20,1,150) horz-line 2
  print 'Arbeitslosenversicherung'    (20,2)
  print 'Arbeitslosenversicherung'       (21,2)
  graphic (24,1,150) box 2 2
  graphic (23,56,2) vert-line 2
  graphic (23,70,2) vert-line 2
  graphic (23,90,2) vert-line 2
  graphic (23,110,2) vert-line 2
  graphic (23,130,2) vert-line 2
  graphic (24,1,150) horz-line 2
  print 'Pflegeversicherung'    (24,2)
  print 'Pflegeversicherung freiwilliger Beitrag'       (25,2)
  graphic (28,1,150) box 1 1
  graphic (27,56,1) vert-line 2
  graphic (27,70,1) vert-line 2
  graphic (27,90,1) vert-line 2
  graphic (27,110,1) vert-line 2
  graphic (27,130,1) vert-line 2
  graphic (28,1,150) horz-line 2
  print 'Pflegeversicherung KVdR'    (28,2)
  graphic (31,1,150) box 2 14
  graphic (30,90,2) vert-line 2
  graphic (30,110,2) vert-line 2
  graphic (30,130,2) vert-line 2
  print 'Summe'    (32,2) bold
  print '1000'                  (2,60)
  print '2000'                  (3,60)
  print '3000'                  (4,60)
  print '6000'                  (5,60)
  print '    '                  (6,60)
  print '0100'                  (10,60)
  print '0300'                  (11,60)
  print '0500'                  (12,60)
  print '0200'                  (15,60)
  print '0400'                  (16,60)
  print '0600'                  (17,60)
  print '0010'                  (20,60)
  print '0020'                  (21,60)
  print '0001'                  (24,60)
  print '    '                  (25,60)
 end-if
 else
  graphic (2,1,150) box 2 2
  graphic (1,56,2) vert-line 2
  graphic (1,70,2) vert-line 2
  graphic (1,90,2) vert-line 2
  graphic (1,110,2) vert-line 2
  graphic (1,130,2) vert-line 2
  graphic (2,1,150) horz-line 2
  print 'Krankenversicherung ger. Beitrag'           (2,2)
  print 'Krankenversicherung freiwilliger Beitrag'   (3,2)
  graphic (6,1,150) box 2 2
  graphic (5,56,2) vert-line 2
  graphic (5,70,2) vert-line 2
  graphic (5,90,2) vert-line 2
  graphic (5,110,2) vert-line 2
  graphic (5,130,2) vert-line 2
  graphic (6,1,150) horz-line 2
  print 'Renterversicherung Arbeiter'    (6,2)
  print 'Renterversicherung Arbeiter/Gering'    (7,2)
  graphic (10,1,150) box 2 2
  graphic (9,56,2) vert-line 2
  graphic (9,70,2) vert-line 2
  graphic (9,90,2) vert-line 2
  graphic (9,110,2) vert-line 2
  graphic (9,130,2) vert-line 2
  graphic (10,1,150) horz-line 2
  print 'Renterversicherung Angestellte'    (10,2)
  print 'Renterversicherung Angestellter/Gering'    (11,2)
  graphic (14,1,150) box 1 2
  graphic (13,56,1) vert-line 2
  graphic (13,70,1) vert-line 2
  graphic (13,90,1) vert-line 2
  graphic (13,110,1) vert-line 2
  graphic (13,130,1) vert-line 2
  print 'Pflegeversicherung freiwilliger Beitrag'       (14,2)
!adj08-890b16 : Refund Insurance Insolvency.
  graphic (17,1,150) box 1 2
  graphic (16,56,1) vert-line 2
  graphic (16,70,1) vert-line 2
  graphic (16,90,1) vert-line 2
  graphic (16,110,1) vert-line 2
  graphic (16,130,1) vert-line 2
  print 'Insolvenzgeldumlage'       (17,2)
  graphic (20,1,150) box 2 2
  graphic (19,56,2) vert-line 2
  graphic (19,70,2) vert-line 2
  graphic (19,90,2) vert-line 2
  graphic (19,110,2) vert-line 2
  graphic (19,130,2) vert-line 2
  graphic (20,1,150) horz-line 2
  print 'Umlage Satz 1'    (20,2)
  print 'Umlage Satz 2'    (21,2)
  graphic (24,1,150) box 1 2
  graphic (23,56,1) vert-line 2
  graphic (23,70,1) vert-line 2
  graphic (23,90,1) vert-line 2
  graphic (23,110,1) vert-line 2
  graphic (23,130,1) vert-line 2
  print 'einheitliche Pauschsteuer'       (24,2)
  graphic (27,1,150) box 2 14
  graphic (26,90,2) vert-line 2
  graphic (26,110,2) vert-line 2
  graphic (26,130,2) vert-line 2
  print 'Summe'    (28,2) bold
  print '6000'                  (2,60)
  print '    '                  (3,60)
  print '0100'                  (6,60)
  print '0500'                  (7,60)
  print '0200'                  (10,60)
  print '0600'                  (11,60)
  print '    '                  (14,60)
  print '0050'                  (17,61)
  print 'U1'                  (20,61)
  print 'U2'                  (21,61)
  print 'St'                  (24,61)
end-if
   alter-printer
    font= 4
    point-size =13
 print 'Alle Werte in'  (43,164)
 alter-printer
    font= 4
    point-size =28
 print $Actual_Curruncy_save  (43,176)
 alter-printer
 font = 3
 point-size = 16
if $PrintFormInsigBUK = 'N'
 if $Is_KVdR <> 'Y'
  print $Brutto_1000_Sum (2,70)
  print $Brutto_2000_Sum (3,70)
  print $Brutto_3000_Sum (4,70)
  print $Brutto_6000_Sum (5,70)
  print $Brutto_KV_Freiw_Sum (6,70)
  print $Brutto_0100_Sum (9,70)
  print $Brutto_0300_Sum (10,70)
  print $Brutto_0500_Sum (11,70)
  print $Brutto_0200_Sum (14,70)
  print $Brutto_0400_Sum (15,70)
  print $Brutto_0600_Sum (16,70)
  print $Brutto_0010_Sum (19,70)
  print $Brutto_0020_Sum (20,70)
!adj08-890b16: RI insolvency
  print $GRSS_INSOL_0050 (23,70)
  print $Brutto_0001_Sum (26,70)
  print $Brutto_PV_Freiw_Sum (27,70)
  print $Brutto_U1_Sum (30,70)
  print $Brutto_U2_Sum (31,70)
  print $sv_sum_1000 (2,90)
  print $sv_sum_2000 (3,90)
  print $sv_sum_3000 (4,90)
  print $sv_sum_6000 (5,90)
  print $sv_KV_Freiw_Sum (6,90)
  print $sv_sum_0100 (9,90)
  print $sv_sum_0300 (10,90)
  print $sv_sum_0500 (11,90)
  print $sv_sum_0200 (14,90)
  print $sv_sum_0400 (15,90)
  print $sv_sum_0600 (16,90)
  print $sv_sum_0010 (19,90)
  print $sv_sum_0020 (20,90)
  print $UML_INSOLV_0050 (23,90)
  print $sv_sum_0001 (26,90)
  print $sv_PV_Freiw_Sum (27,90)
  print $sv_sum_u1 (30,90)
  print $sv_sum_u2 (31,90)
  print $KV-AG_1000_Sum (2,110)
  print $KV-AG_2000_Sum (3,110)
  print $KV-AG_3000_Sum (4,110)
  print $KV-AG_6000_Sum (5,110)
  print $KV-AG_Freiw_Sum (6,110)
  print $RV-AG_0100_Sum (9,110)
  print $RV-AG_0300_Sum (10,110)
  print $RV-AG_0500_Sum (11,110)
  print $RV-AG_0200_Sum (14,110)
  print $RV-AG_0400_Sum (15,110)
  print $RV-AG_0600_Sum (16,110)
  print $AV-AG_0010_Sum (19,110)
  print $AV-AG_0020_Sum (20,110)
  print $UML_INSOLV_0050 (23,110)
  print $PV-AG_0001_Sum (26,110)
  print $PV-AG_Freiw_Sum (27,110)
  print $AG_U1_Sum (30,110)
  print $AG_U2_Sum (31,110)
  print $KV-AN_1000_Sum (2,131)
  print $KV-AN_2000_Sum (3,131)
  print $KV-AN_3000_Sum (4,131)
  print $KV-AN_6000_Sum (5,131)
  print $KV-AN_Freiw_Sum (6,131)
  print $RV-AN_0100_Sum (9,131)
  print $RV-AN_0300_Sum (10,131)
  print $RV-AN_0500_Sum (11,131)
  print $RV-AN_0200_Sum (14,131)
  print $RV-AN_0400_Sum (15,131)
  print $RV-AN_0600_Sum (16,131)
  print $AV-AN_0010_Sum (19,131)
  print $AV-AN_0020_Sum (20,131)
!  print $UML_INSOLV_0050 (23,130)
  print $PV-AN_0001_Sum (26,131)
  print $PV-AN_Freiw_Sum (27,131)
  print $AN_U1_Sum (30,131)
  print $AN_U2_Sum (31,131)
  print $sum_sv_Amount (35,90) BOLD
  print $sum_AG_Amount (35,110) BOLD
  print $sum_AN_Amount (35,131) BOLD
 else
  print $Brutto_kvdr_Sum      (7,70)
  print $Brutto_kvdr1_Sum (28,70)

  print $sv_sum_kvdr (7,90)
  print $sv_sum_pv_kvdr1 (28,90)

  print $KV-AG_kvdr_Sum (7,110)
  print $PV-AG_kvdr_Sum (28,110)

  print $KV-AN_kvdr_Sum (7,131)
  print $PV-AN_kvdr_Sum (28,131)

  print $sum_sv_Amount (32,90) BOLD
  print $sum_AG_Amount (32,110) BOLD
  print $sum_AN_Amount (32,131) BOLD
 end-if
else
  print $Brutto_6000_Sum (2,70)
  print $Brutto_KV_Freiw_Sum (3,70)
  print $Brutto_0100_Sum (6,70)
  print $Brutto_0500_Sum (7,70)
  print $Brutto_0200_Sum (10,70)
  print $Brutto_0600_Sum (11,70)
  print $Brutto_PV_Freiw_Sum (14,70)
!adj08-890b16 : RI insolvency
  print $GRSS_INSOL_0050 (17,70)
  print $Brutto_U1_Sum (20,70)
  print $Brutto_U2_Sum (21,70)
  print $sv_sum_6000 (2,90)
  print $sv_KV_Freiw_Sum (3,90)
  print $sv_sum_0100 (6,90)
  print $sv_sum_0500 (7,90)
  print $sv_sum_0200 (10,90)
  print $sv_sum_0600 (11,90)
  print $sv_PV_Freiw_Sum (14,90)
  print $UML_INSOLV_0050 (17,90)
  print $sv_sum_u1 (20,90)
  print $sv_sum_u2 (21,90)
  print $SV_Sum_St (24,90)
  print $KV-AG_6000_Sum (2,110)
  print $KV-AG_Freiw_Sum (3,110)
  print $RV-AG_0100_Sum (6,110)
  print $RV-AG_0500_Sum (7,110)
  print $RV-AG_0200_Sum (10,110)
  print $RV-AG_0600_Sum (11,110)
  print $PV-AG_Freiw_Sum (14,110)
  print $UML_INSOLV_0050 (17,110)
  print $AG_U1_Sum (20,110)
  print $AG_U2_Sum (21,110)
  print $KV-AN_6000_Sum (2,131)
  print $KV-AN_Freiw_Sum (5,131)
  print $RV-AN_0100_Sum (6,131)
  print $RV-AN_0500_Sum (7,131)
  print $RV-AN_0200_Sum (10,131)
  print $RV-AN_0600_Sum (11,131)
  print $PV-AN_Freiw_Sum (14,131)
  print $AN_U1_Sum (20,131)
  print $AN_U2_Sum (21,131)
  print $sum_sv_Amount (28,90) BOLD
  print $sum_AG_Amount (28,110) BOLD
  print $sum_AN_Amount (28,131) BOLD
end-if
  alter-printer
    font= 4
    point-size =13
  let #sv_sum_1000  = 0
  let #sv_sum_2000  = 0
  let #sv_sum_3000  = 0
  let #sv_sum_6000  = 0
  let #sv_KV_Freiw_Sum = 0
  let #sv_sum_0100 = 0
  let #sv_sum_0300 = 0
  let #sv_sum_0500 = 0
  let #sv_sum_0200 = 0
  let #sv_sum_0400 = 0
  let #sv_sum_0600 = 0
  let #sv_sum_0010 = 0
  let #sv_sum_0020 = 0
  let #sv_sum_0001 = 0
  let #sv_PV_Freiw_Sum = 0
  let #sv_sum_U1  =  0
  let #sv_sum_U2  =  0
  ! wdu05b7: flag for: a Stoerfall happened within the list for this provider
  let $StoerfallKK ='N'
  let #Brutto_1000_Sum =  0
  let #Brutto_2000_Sum =  0
  let #Brutto_3000_Sum =  0
  let #Brutto_6000_Sum =  0
  let #Brutto_KV_Freiw_Sum =  0
  let #Brutto_0100_Sum =  0
  let #Brutto_0300_Sum =  0
  let #Brutto_0500_Sum =  0
  let #Brutto_0200_Sum =  0
  let #Brutto_0400_Sum =  0
  let #Brutto_0600_Sum =  0
  let #Brutto_0010_Sum =  0
  let #Brutto_0020_Sum =  0
  let #Brutto_0001_Sum =  0
  let #Brutto_PV_Freiw_Sum =  0
  let #Brutto_U1_Sum =  0
  let #Brutto_U2_Sum =  0
  let #Brutto_Sum =  0
  let #KV-AG_1000_Sum  = 0
  let #KV-AG_2000_Sum  = 0
  let #KV-AG_3000_Sum  = 0
  let #KV-AG_6000_Sum  = 0
  let #KV-AG_Freiw_Sum  = 0
  let #KV-AN_1000_Sum  = 0
  let #KV-AN_2000_Sum  = 0
  let #KV-AN_3000_Sum  = 0
  let #KV-AN_6000_Sum  = 0
  let #KV-AN_Freiw_Sum  = 0
  let #RV-AG_0200_Sum  = 0
  let #RV-AG_0400_Sum  = 0
  let #RV-AG_0600_Sum  = 0
  let #RV-AN_0200_Sum  = 0
  let #RV-AN_0400_Sum  = 0
  let #RV-AN_0600_Sum  = 0
  let #RV-AG_0100_Sum  = 0
  let #RV-AG_0300_Sum  = 0
  let #RV-AG_0500_Sum  = 0
  let #RV-AN_0100_Sum  = 0
  let #RV-AN_0300_Sum  = 0
  let #RV-AN_0500_Sum  = 0
  let #AV-AG_0010_Sum  = 0
  let #AV-AG_0020_Sum  = 0
  let #AV-AN_0010_Sum  = 0
  let #AV-AN_0020_Sum  = 0
  let #PV-AG_0001_Sum  = 0
  let #PV-AG_Freiw_Sum  = 0
  let #PV-AN_0001_Sum  = 0
  let #PV-AN_Freiw_Sum  = 0
  let #AG_U1_Sum  = 0
  let #AG_U2_Sum  = 0
  let #AN_U1_Sum  = 0
  let #AN_U2_Sum  = 0
  let #sum_sv_Amount = 0
  let #sum_AG_Amount = 0
  let #sum_AN_Amount = 0

  let #sv_sum_pv_kvdr1  = 0
  let #sv_sum_kvdr      = 0
  let #Brutto_kvdr1_Sum = 0
  let #Brutto_kvdr_Sum  = 0
  let #PV-AG_kvdr_Sum = 0
  let #PV-AN_kvdr_Sum = 0
  let #KV-AG_kvdr_Sum = 0
  let #KV-AN_kvdr_Sum = 0
  let #UML_INSOLV_Sum_1 = 0
  let #GRSS_INSOL_Sum_1 = 0

end-procedure
!*************************************************************************************
begin-procedure CheckMinusNull_C

   if rtrim(ltrim($SV_Sum_St, ' '), ' ') = $MinusNull or
      rtrim(ltrim($SV_Sum_St, ' '), ' ') = $PlusNull
      let $SV_Sum_St = ' '
   end-if
   if rtrim(ltrim($sum_sv_Amount, ' '), ' ') = $MinusNull
      let $sum_sv_Amount = '          ' || $PlusNull
   end-if
   if rtrim(ltrim($sum_AG_Amount, ' '), ' ') = $MinusNull
      let $sum_AG_Amount = '          ' || $PlusNull
   end-if
   if rtrim(ltrim($sum_AN_Amount, ' '), ' ') = $MinusNull
      let $sum_AN_Amount = '          ' || $PlusNull
   end-if
   if rtrim(ltrim($sv_sum_1000, ' '), ' ') = $MinusNull or
      rtrim(ltrim($sv_sum_1000, ' '), ' ') = $PlusNull
      let $sv_sum_1000 = ' '
   end-if
   if rtrim(ltrim($sv_sum_2000, ' '), ' ') = $MinusNull or
      rtrim(ltrim($sv_sum_2000, ' '), ' ') = $PlusNull
      let $sv_sum_2000 = ' '
   end-if
   if rtrim(ltrim($sv_sum_3000, ' '), ' ') = $MinusNull or
      rtrim(ltrim($sv_sum_3000, ' '), ' ') = $PlusNull
      let $sv_sum_3000 = ' '
   end-if
   if rtrim(ltrim($sv_sum_6000, ' '), ' ') = $MinusNull or
      rtrim(ltrim($sv_sum_6000, ' '), ' ') = $PlusNull
      let $sv_sum_6000 = ' '
   end-if
   if rtrim(ltrim($sv_KV_Freiw_Sum, ' '), ' ') = $MinusNull or
      rtrim(ltrim($sv_KV_Freiw_Sum, ' '), ' ') = $PlusNull
      let $sv_KV_Freiw_Sum = ' '
   end-if
   if rtrim(ltrim($sv_sum_0100, ' '), ' ') = $MinusNull or
      rtrim(ltrim($sv_sum_0100, ' '), ' ') = $PlusNull
      let $sv_sum_0100 = ' '
   end-if
   if rtrim(ltrim($sv_sum_0300, ' '), ' ') = $MinusNull or
      rtrim(ltrim($sv_sum_0300, ' '), ' ') = $PlusNull
      let $sv_sum_0300 = ' '
   end-if
   if rtrim(ltrim($sv_sum_0500, ' '), ' ') = $MinusNull or
      rtrim(ltrim($sv_sum_0500, ' '), ' ') = $PlusNull
      let $sv_sum_0500 = ' '
   end-if
   if rtrim(ltrim($sv_sum_0200, ' '), ' ') = $MinusNull or
      rtrim(ltrim($sv_sum_0200, ' '), ' ') = $PlusNull
      let $sv_sum_0200 = ' '
   end-if
   if rtrim(ltrim($sv_sum_0400, ' '), ' ') = $MinusNull or
      rtrim(ltrim($sv_sum_0400, ' '), ' ') = $PlusNull
      let $sv_sum_0400 = ' '
   end-if
   if rtrim(ltrim($sv_sum_0600, ' '), ' ') = $MinusNull or
      rtrim(ltrim($sv_sum_0600, ' '), ' ') = $PlusNull
      let $sv_sum_0600 = ' '
   end-if
   if rtrim(ltrim($sv_sum_0010, ' '), ' ') = $MinusNull or
      rtrim(ltrim($sv_sum_0010, ' '), ' ') = $PlusNull
      let $sv_sum_0010 = ' '
   end-if
   if rtrim(ltrim($sv_sum_0020, ' '), ' ') = $MinusNull or
      rtrim(ltrim($sv_sum_0020, ' '), ' ') = $PlusNull
      let $sv_sum_0020 = ' '
   end-if
   if rtrim(ltrim($sv_sum_0001, ' '), ' ') = $MinusNull or
      rtrim(ltrim($sv_sum_0001, ' '), ' ') = $PlusNull
      let $sv_sum_0001 = ' '
   end-if
   if rtrim(ltrim($sv_PV_Freiw_Sum, ' '), ' ') = $MinusNull or
      rtrim(ltrim($sv_PV_Freiw_Sum, ' '), ' ') = $PlusNull
      let $sv_PV_Freiw_Sum = ' '
   end-if
   if rtrim(ltrim($sv_sum_u1, ' '), ' ') = $MinusNull or
      rtrim(ltrim($sv_sum_u1, ' '), ' ') = $PlusNull
      let $sv_sum_u1 = ' '
   end-if
   if rtrim(ltrim($sv_sum_u2, ' '), ' ') = $MinusNull or
      rtrim(ltrim($sv_sum_u2, ' '), ' ') = $PlusNull
      let $sv_sum_u2 = ' '
   end-if
   if rtrim(ltrim($Brutto_1000_Sum, ' '), ' ') = $MinusNull or
      rtrim(ltrim($Brutto_1000_Sum, ' '), ' ') = $PlusNull
      let $Brutto_1000_Sum = ' '
   end-if
   if rtrim(ltrim($Brutto_2000_Sum, ' '), ' ') = $MinusNull or
      rtrim(ltrim($Brutto_2000_Sum, ' '), ' ') = $PlusNull
      let $Brutto_2000_Sum = ' '
   end-if
   if rtrim(ltrim($Brutto_3000_Sum, ' '), ' ') = $MinusNull or
      rtrim(ltrim($Brutto_3000_Sum, ' '), ' ') = $PlusNull
      let $Brutto_3000_Sum = ' '
   end-if
   if rtrim(ltrim($Brutto_6000_Sum, ' '), ' ') = $MinusNull or
      rtrim(ltrim($Brutto_6000_Sum, ' '), ' ') = $PlusNull
      let $Brutto_6000_Sum = ' '
   end-if
   if rtrim(ltrim($Brutto_KV_Freiw_Sum, ' '), ' ') = $MinusNull or
      rtrim(ltrim($Brutto_KV_Freiw_Sum, ' '), ' ') = $PlusNull
      let $Brutto_KV_Freiw_Sum = ' '
   end-if
   if rtrim(ltrim($Brutto_0100_Sum, ' '), ' ') = $MinusNull or
      rtrim(ltrim($Brutto_0100_Sum, ' '), ' ') = $PlusNull
      let $Brutto_0100_Sum = ' '
   end-if
   if rtrim(ltrim($Brutto_0300_Sum, ' '), ' ') = $MinusNull or
      rtrim(ltrim($Brutto_0300_Sum, ' '), ' ') = $PlusNull
      let $Brutto_0300_Sum = ' '
   end-if
   if rtrim(ltrim($Brutto_0500_Sum, ' '), ' ') = $MinusNull or
      rtrim(ltrim($Brutto_0500_Sum, ' '), ' ') = $PlusNull
      let $Brutto_0500_Sum = ' '
   end-if
   if rtrim(ltrim($Brutto_0200_Sum, ' '), ' ') = $MinusNull or
      rtrim(ltrim($Brutto_0200_Sum, ' '), ' ') = $PlusNull
      let $Brutto_0200_Sum = ' '
   end-if
   if rtrim(ltrim($Brutto_0400_Sum, ' '), ' ') = $MinusNull or
      rtrim(ltrim($Brutto_0400_Sum, ' '), ' ') = $PlusNull
      let $Brutto_0400_Sum = ' '
   end-if
   if rtrim(ltrim($Brutto_0600_Sum, ' '), ' ') = $MinusNull or
      rtrim(ltrim($Brutto_0600_Sum, ' '), ' ') = $PlusNull
      let $Brutto_0600_Sum = ' '
   end-if
   if rtrim(ltrim($Brutto_0010_Sum, ' '), ' ') = $MinusNull or
      rtrim(ltrim($Brutto_0010_Sum, ' '), ' ') = $PlusNull
      let $Brutto_0010_Sum = ' '
   end-if
   if rtrim(ltrim($Brutto_0020_Sum, ' '), ' ') = $MinusNull or
      rtrim(ltrim($Brutto_0020_Sum, ' '), ' ') = $PlusNull
      let $Brutto_0020_Sum = ' '
   end-if
   if rtrim(ltrim($Brutto_0001_Sum, ' '), ' ') = $MinusNull or
      rtrim(ltrim($Brutto_0001_Sum, ' '), ' ') = $PlusNull
      let $Brutto_0001_Sum = ' '
   end-if
   if rtrim(ltrim($Brutto_PV_Freiw_Sum, ' '), ' ') = $MinusNull or
      rtrim(ltrim($Brutto_PV_Freiw_Sum, ' '), ' ') = $PlusNull
      let $Brutto_PV_Freiw_Sum = ' '
   end-if
   if rtrim(ltrim($Brutto_U1_Sum, ' '), ' ') = $MinusNull or
      rtrim(ltrim($Brutto_U1_Sum, ' '), ' ') = $PlusNull
      let $Brutto_U1_Sum = ' '
   end-if
   if rtrim(ltrim($Brutto_U2_Sum, ' '), ' ') = $MinusNull or
      rtrim(ltrim($Brutto_U2_Sum, ' '), ' ') = $PlusNull
      let $Brutto_U2_Sum = ' '
   end-if
   if rtrim(ltrim($Brutto_Sum, ' '), ' ') = $MinusNull or
      rtrim(ltrim($Brutto_Sum, ' '), ' ') = $PlusNull
      let $Brutto_Sum = ' '
   end-if
   if rtrim(ltrim($KV-AG_1000_Sum, ' '), ' ') = $MinusNull or
      rtrim(ltrim($KV-AG_1000_Sum, ' '), ' ') = $PlusNull
      let $KV-AG_1000_Sum = ' '
   end-if
   if rtrim(ltrim($KV-AG_2000_Sum, ' '), ' ') = $MinusNull or
      rtrim(ltrim($KV-AG_2000_Sum, ' '), ' ') = $PlusNull
      let $KV-AG_2000_Sum = ' '
   end-if
   if rtrim(ltrim($KV-AG_3000_Sum, ' '), ' ') = $MinusNull or
      rtrim(ltrim($KV-AG_3000_Sum, ' '), ' ') = $PlusNull
      let $KV-AG_3000_Sum = ' '
   end-if
   if rtrim(ltrim($KV-AG_6000_Sum, ' '), ' ') = $MinusNull or
      rtrim(ltrim($KV-AG_6000_Sum, ' '), ' ') = $PlusNull
      let $KV-AG_6000_Sum = ' '
   end-if
   if rtrim(ltrim($KV-AG_Freiw_Sum, ' '), ' ') = $MinusNull or
      rtrim(ltrim($KV-AG_Freiw_Sum, ' '), ' ') = $PlusNull
      let $KV-AG_Freiw_Sum = ' '
   end-if
   if rtrim(ltrim($KV-AN_1000_Sum, ' '), ' ') = $MinusNull or
      rtrim(ltrim($KV-AN_1000_Sum, ' '), ' ') = $PlusNull
      let $KV-AN_1000_Sum = ' '
   end-if
   if rtrim(ltrim($KV-AN_2000_Sum, ' '), ' ') = $MinusNull or
      rtrim(ltrim($KV-AN_2000_Sum, ' '), ' ') = $PlusNull
      let $KV-AN_2000_Sum = ' '
   end-if
   if rtrim(ltrim($KV-AN_3000_Sum, ' '), ' ') = $MinusNull or
      rtrim(ltrim($KV-AN_3000_Sum, ' '), ' ') = $PlusNull
      let $KV-AN_3000_Sum = ' '
   end-if
   if rtrim(ltrim($KV-AN_6000_Sum, ' '), ' ') = $MinusNull or
      rtrim(ltrim($KV-AN_6000_Sum, ' '), ' ') = $PlusNull
      let $KV-AN_6000_Sum = ' '
   end-if
   if rtrim(ltrim($KV-AN_Freiw_Sum, ' '), ' ') = $MinusNull or
      rtrim(ltrim($KV-AN_Freiw_Sum, ' '), ' ') = $PlusNull
      let $KV-AN_Freiw_Sum = ' '
   end-if
   if rtrim(ltrim($RV-AG_0100_Sum, ' '), ' ') = $MinusNull or
      rtrim(ltrim($RV-AG_0100_Sum, ' '), ' ') = $PlusNull
      let $RV-AG_0100_Sum = ' '
   end-if
   if rtrim(ltrim($RV-AG_0300_Sum, ' '), ' ') = $MinusNull or
      rtrim(ltrim($RV-AG_0300_Sum, ' '), ' ') = $PlusNull
      let $RV-AG_0300_Sum = ' '
   end-if
   if rtrim(ltrim($RV-AG_0500_Sum, ' '), ' ') = $MinusNull or
      rtrim(ltrim($RV-AG_0500_Sum, ' '), ' ') = $PlusNull
      let $RV-AG_0500_Sum = ' '
   end-if
   if rtrim(ltrim($RV-AN_0100_Sum, ' '), ' ') = $MinusNull or
      rtrim(ltrim($RV-AN_0100_Sum, ' '), ' ') = $PlusNull
      let $RV-AN_0100_Sum = ' '
   end-if
   if rtrim(ltrim($RV-AN_0300_Sum, ' '), ' ') = $MinusNull or
      rtrim(ltrim($RV-AN_0300_Sum, ' '), ' ') = $PlusNull
      let $RV-AN_0300_Sum = ' '
   end-if
   if rtrim(ltrim($RV-AN_0500_Sum, ' '), ' ') = $MinusNull or
      rtrim(ltrim($RV-AN_0500_Sum, ' '), ' ') = $PlusNull
      let $RV-AN_0500_Sum = ' '
   end-if
   if rtrim(ltrim($RV-AG_0200_Sum, ' '), ' ') = $MinusNull or
      rtrim(ltrim($RV-AG_0200_Sum, ' '), ' ') = $PlusNull
      let $RV-AG_0200_Sum = ' '
   end-if
   if rtrim(ltrim($RV-AG_0400_Sum, ' '), ' ') = $MinusNull or
      rtrim(ltrim($RV-AG_0400_Sum, ' '), ' ') = $PlusNull
      let $RV-AG_0400_Sum = ' '
   end-if
   if rtrim(ltrim($RV-AG_0600_Sum, ' '), ' ') = $MinusNull or
      rtrim(ltrim($RV-AG_0600_Sum, ' '), ' ') = $PlusNull
      let $RV-AG_0600_Sum = ' '
   end-if
   if rtrim(ltrim($RV-AN_0200_Sum, ' '), ' ') = $MinusNull or
      rtrim(ltrim($RV-AN_0200_Sum, ' '), ' ') = $PlusNull
      let $RV-AN_0200_Sum = ' '
   end-if
   if rtrim(ltrim($RV-AN_0400_Sum, ' '), ' ') = $MinusNull or
      rtrim(ltrim($RV-AN_0400_Sum, ' '), ' ') = $PlusNull
      let $RV-AN_0400_Sum = ' '
   end-if
   if rtrim(ltrim($RV-AN_0600_Sum, ' '), ' ') = $MinusNull or
      rtrim(ltrim($RV-AN_0600_Sum, ' '), ' ') = $PlusNull
      let $RV-AN_0600_Sum = ' '
   end-if
   if rtrim(ltrim($AV-AG_0010_Sum, ' '), ' ') = $MinusNull or
      rtrim(ltrim($AV-AG_0010_Sum, ' '), ' ') = $PlusNull
      let $AV-AG_0010_Sum = ' '
   end-if
   if rtrim(ltrim($AV-AG_0020_Sum, ' '), ' ') = $MinusNull or
      rtrim(ltrim($AV-AG_0020_Sum, ' '), ' ') = $PlusNull
      let $AV-AG_0020_Sum = ' '
   end-if
   if rtrim(ltrim($AV-AN_0010_Sum, ' '), ' ') = $MinusNull or
      rtrim(ltrim($AV-AN_0010_Sum, ' '), ' ') = $PlusNull
      let $AV-AN_0010_Sum = ' '
   end-if
   if rtrim(ltrim($AV-AN_0020_Sum, ' '), ' ') = $MinusNull or
      rtrim(ltrim($AV-AN_0020_Sum, ' '), ' ') = $PlusNull
      let $AV-AN_0020_Sum = ' '
   end-if
   if rtrim(ltrim($PV-AG_0001_Sum, ' '), ' ') = $MinusNull or
      rtrim(ltrim($PV-AG_0001_Sum, ' '), ' ') = $PlusNull
      let $PV-AG_0001_Sum = ' '
   end-if
   if rtrim(ltrim($PV-AG_Freiw_Sum, ' '), ' ') = $MinusNull or
      rtrim(ltrim($PV-AG_Freiw_Sum, ' '), ' ') = $PlusNull
      let $PV-AG_Freiw_Sum = ' '
   end-if
   if rtrim(ltrim($PV-AN_0001_Sum, ' '), ' ') = $MinusNull or
      rtrim(ltrim($PV-AN_0001_Sum, ' '), ' ') = $PlusNull
      let $PV-AN_0001_Sum = ' '
   end-if
   if rtrim(ltrim($PV-AN_Freiw_Sum, ' '), ' ') = $MinusNull or
      rtrim(ltrim($PV-AN_Freiw_Sum, ' '), ' ') = $PlusNull
      let $PV-AN_Freiw_Sum = ' '
   end-if
   if rtrim(ltrim($AG_U1_Sum, ' '), ' ') = $MinusNull or
      rtrim(ltrim($AG_U1_Sum, ' '), ' ') = $PlusNull
      let $AG_U1_Sum = ' '
   end-if
   if rtrim(ltrim($AG_U2_Sum, ' '), ' ') = $MinusNull or
      rtrim(ltrim($AG_U2_Sum, ' '), ' ') = $PlusNull
      let $AG_U2_Sum = ' '
   end-if
   if rtrim(ltrim($AN_U1_Sum, ' '), ' ') = $MinusNull or
      rtrim(ltrim($AN_U1_Sum, ' '), ' ') = $PlusNull
      let $AN_U1_Sum = ' '
   end-if
   if rtrim(ltrim($AN_U2_Sum, ' '), ' ') = $MinusNull or
      rtrim(ltrim($AN_U2_Sum, ' '), ' ') = $PlusNull
      let $AN_U2_Sum = ' '
   end-if

  if rtrim(ltrim($KV-AG_kvdr_Sum, ' '), ' ') = $MinusNull or
      rtrim(ltrim($KV-AG_kvdr_Sum, ' '), ' ') = $PlusNull
      let $KV-AG_kvdr_Sum = ' '
  end-if
  if rtrim(ltrim($KV-AN_kvdr_Sum, ' '), ' ') = $MinusNull or
      rtrim(ltrim($KV-AN_kvdr_Sum, ' '), ' ') = $PlusNull
      let $KV-AN_kvdr_Sum = ' '
  end-if
  if rtrim(ltrim($PV-AG_kvdr_Sum, ' '), ' ') = $MinusNull or
      rtrim(ltrim($PV-AG_kvdr_Sum, ' '), ' ') = $PlusNull
      let $PV-AG_kvdr_Sum = ' '
  end-if
  if rtrim(ltrim($PV-AN_kvdr_Sum, ' '), ' ') = $MinusNull or
      rtrim(ltrim($PV-AN_kvdr_Sum, ' '), ' ') = $PlusNull
      let $PV-AN_kvdr_Sum = ' '
  end-if
  if rtrim(ltrim($Brutto_kvdr_Sum, ' '), ' ') = $MinusNull or
      rtrim(ltrim($Brutto_kvdr_Sum, ' '), ' ') = $PlusNull
      let $Brutto_kvdr_Sum = ' '
  end-if
  if rtrim(ltrim($Brutto_kvdr1_Sum, ' '), ' ') = $MinusNull or
      rtrim(ltrim($Brutto_kvdr1_Sum, ' '), ' ') = $PlusNull
      let $Brutto_kvdr1_Sum = ' '
  end-if

  if rtrim(ltrim($sv_sum_pv_kvdr, ' '), ' ') = $MinusNull or
      rtrim(ltrim($sv_sum_pv_kvdr, ' '), ' ') = $PlusNull
      let $sv_sum_pv_kvdr = ' '
  end-if
  if rtrim(ltrim($sv_sum_pv_kvdr1, ' '), ' ') = $MinusNull or
      rtrim(ltrim($sv_sum_pv_kvdr1, ' '), ' ') = $PlusNull
      let $sv_sum_pv_kvdr1 = ' '
  end-if

!adj08-890b16: RI insolvency
   if rtrim(ltrim($UML_INSOLV_0050 , ' '), ' ') = $MinusNull  or
      rtrim(ltrim($UML_INSOLV_0050 , ' '), ' ') = $PlusNull
      let $UML_INSOLV_0050  = ' '
   end-if
   if rtrim(ltrim($GRSS_INSOL_0050, ' '), ' ') = $MinusNull  or
      rtrim(ltrim($GRSS_INSOL_0050, ' '), ' ') = $PlusNull
      let $GRSS_INSOL_0050 = ' '
   end-if

 end-procedure
!********************************************************************************
begin-procedure InitialVar2
  let #sv_sum_1000  = 0
  let #sv_sum_2000  = 0
  let #sv_sum_3000  = 0
  let #sv_sum_6000  = 0
  let #sv_KV_Freiw_Sum = 0
  let #sv_sum_0100 = 0
  let #sv_sum_0300 = 0
  let #sv_sum_0500 = 0
  let #sv_sum_0200 = 0
  let #sv_sum_0400 = 0
  let #sv_sum_0600 = 0
  let #sv_sum_0010 = 0
  let #sv_sum_0020 = 0
  let #sv_sum_0001 = 0
  ! wdu05b7: flag for: a Stoerfall happened within the list for this provider
  let $StoerfallKK ='N'
  let #sv_PV_Freiw_Sum = 0
  let #sv_sum_U1  =  0
  let #sv_sum_U2  =  0
  let #Brutto_1000_Sum =  0
  let #Brutto_2000_Sum =  0
  let #Brutto_3000_Sum =  0
  let #Brutto_6000_Sum =  0
  let #Brutto_KV_Freiw_Sum =  0
  let #Brutto_0100_Sum =  0
  let #Brutto_0300_Sum =  0
  let #Brutto_0500_Sum =  0
  let #Brutto_0200_Sum =  0
  let #Brutto_0400_Sum =  0
  let #Brutto_0600_Sum =  0
  let #Brutto_0010_Sum =  0
  let #Brutto_0020_Sum =  0
  let #Brutto_0001_Sum =  0
  let #Brutto_PV_Freiw_Sum =  0
  let #Brutto_U1_Sum =  0
  let #Brutto_U2_Sum =  0
  let #Brutto_Sum =  0
  let #KV-AG_1000_Sum  = 0
  let #KV-AG_2000_Sum  = 0
  let #KV-AG_3000_Sum  = 0
  let #KV-AG_6000_Sum  = 0
  let #KV-AG_Freiw_Sum  = 0
  let #KV-AN_1000_Sum  = 0
  let #KV-AN_2000_Sum  = 0
  let #KV-AN_3000_Sum  = 0
  let #KV-AN_6000_Sum  = 0
  let #KV-AN_Freiw_Sum  = 0
  let #RV-AG_0200_Sum  = 0
  let #RV-AG_0400_Sum  = 0
  let #RV-AG_0600_Sum  = 0
  let #RV-AN_0200_Sum  = 0
  let #RV-AN_0400_Sum  = 0
  let #RV-AN_0600_Sum  = 0
  let #RV-AG_0100_Sum  = 0
  let #RV-AG_0300_Sum  = 0
  let #RV-AG_0500_Sum  = 0
  let #RV-AN_0100_Sum  = 0
  let #RV-AN_0300_Sum  = 0
  let #RV-AN_0500_Sum  = 0
  let #AV-AG_0010_Sum  = 0
  let #AV-AG_0020_Sum  = 0
  let #AV-AN_0010_Sum  = 0
  let #AV-AN_0020_Sum  = 0
  let #PV-AG_0001_Sum  = 0
  let #PV-AG_Freiw_Sum  = 0
  let #PV-AN_0001_Sum  = 0
  let #PV-AN_Freiw_Sum  = 0
  let #AG_U1_Sum  = 0
  let #AG_U2_Sum  = 0
  let #AN_U1_Sum  = 0
  let #AN_U2_Sum  = 0
  let #sum_sv_Amount = 0
  let #sum_AG_Amount = 0
  let #sum_AN_Amount = 0
end-procedure
!********************************************************************************
begin-procedure Print-EE-Data-Umlage
let #mm = 4 + #current-line
if #mm > 55
 new-page
end-if
let #currLineV = -15 + #current-line
let #currLineN = -14 + #current-line
  graphic (#currLineN,1,180) box 2 2
  graphic (#currLineV,14,2) vert-line 1
!adj09: extend name col
graphic (#currLineV,48,2) vert-line 1
  graphic (#currLineV,59,2) vert-line 1
  graphic (#currLineV,65,2) vert-line 1
  graphic (#currLineV,71,2) vert-line 1
  graphic (#currLineV,77,2) vert-line 1
  graphic (#currLineV,83,2) vert-line 1
  graphic (#currLineV,96,2) vert-line 1
  graphic (#currLineV,111,2) vert-line 1
  graphic (#currLineV,125,2) vert-line 1
  graphic (#currLineV,139,2) vert-line 1
  graphic (#currLineV,153,2) vert-line 1
  graphic (#currLineV,167,2) vert-line 1
do Format-Number(#PT.GPDE_RP_KVDAYS,$PT.GPDE_RP_KVDAYS,'99999')
do Format-Number(#PT.GPDE_RP_SIDAYS,$PT.GPDE_RP_SIDAYS,'99999')
do Format-Number(#PT.GPDE_RP_AVDAYS,$PT.GPDE_RP_AVDAYS,'99999')
do Format-Number(#PT.GPDE_RP_PVDAYS,$PT.GPDE_RP_PVDAYS,'99999')
do Format-Number(#PT.GPDE_RP_KVDAYS_MC,$PT.GPDE_RP_KVDAYS_MC,'99999')
do Format-Number(#PT.GPDE_RP_RVDAYS_MC,$PT.GPDE_RP_RVDAYS_MC,'99999')
do Format-Number(#PT.GPDE_RP_AVDAYS_MC,$PT.GPDE_RP_AVDAYS_MC,'99999')
do Format-Number(#PT.GPDE_RP_PVDAYS_MC,$PT.GPDE_RP_PVDAYS_MC,'99999')
do Format-Number(#SV_U1,$SV_U1,'B999,999,999.99')
do Format-Number(#SV_U2,$SV_U2,'B999,999,999.99')
do Format-Number(#SV_U_Gross,$SV_U_Gross,'B999,999,999.99')
!adj08-890b16 RI insolvency
do Format-Number(#PT.GPDE_RP_UML_INSOLV,$UML_INSOLV,',B999,999,999.99')
do Format-Number(#PT.GPDE_RP_GRSS_INSOL,$GRSS_INSOL,',B999,999,999.99')
do Format-Number(#PT.GPDE_RP_GRS_INS_MC,$GRSS_INSOL_MC,',B999,999,999.99')
do Format-Number(#PT.GPDE_RP_UML_INS_MC,$GRSS_UML_MC,',B999,999,999.99')

alter-printer
   font = 4
   point-size = 10.5
let $EmplidT = rtrim($Emplid,' ') || '/'
do Format-Number(#EmplRcd,$EmplRcd,'8888')
print $EmplidT (+1,2)
alter-printer
   font = 4
   point-size = 13
print $ee_name (,15,37)
print $EmplRcd (+1,2)
if $MarchCL = 'Y' and $Vorj = 'N'
   let $MarzKlStr = 'Märzklausel'
   print $MarzKlStr (,25)
end-if
if $RetroSign = 'R'
   let #Date_Type1 = {DateType}
   do ConvertToComponents($PRD_END_DT,$yy1a,$mm1a,$dd1a)
   evaluate #Date_Type1
   when = 2
      let $RetroDate = $yy1a || '{PTDateDelim}' || $mm1a
      break
   when-other
      let $RetroDate = $mm1a || '{PTDateDelim}' || $yy1a
      break
   end-evaluate

   let $RetroStr = $RetroDate || ' ' || 'alt'
   print $RetroStr (,49)
end-if
if  $RetroSign = 'N'
      let #Date_Type1 = {DateType}
      do ConvertToComponents($PRD_END_DT,$yy1a,$mm1a,$dd1a)
      evaluate #Date_Type1
      when = 2
         let $RetroDate = $yy1a || '{PTDateDelim}' || $mm1a
         break
      when-other
         let $RetroDate = $mm1a || '{PTDateDelim}' || $yy1a
         break
      end-evaluate
      let $RetroStr = $RetroDate || ' ' || 'neu'
      print $RetroStr (,49)
end-if
alter-printer
   font = 3
   point-size = 16
print $KV_Code (,55)  edit 99999
print $RV_Code (,62)  edit 99999
print $AV_Code (,67)  edit 99999
print $PV_Code (,73)  edit 99999
let #merk = 4
if #SV_U1 <> 0 and #SV_U2 <> 0
   let #merk = 0
end-if
if #SV_U1 <> 0 and #SV_U2 = 0
   let #merk = 1
end-if
if #SV_U1 = 0 and #SV_U2 <> 0
   let #merk = 2
end-if
!adj09:Eliminate key for march row
if #SV_U1 = 0 and #SV_U2 = 0
   let #merk = 3 ! print nothing
end-if
if #merk = 0 or #merk = 1
   print '1'  (,87)
!else
!   print '2'  (,87)
end-if
if #merk = 2
   print '2'  (,87)
end-if
if #SV_U1 <> 0
  print $SV_U_Gross (,90)
  print $SV_U1 (,104)
  let #SV_U_Gross1_Sum = #SV_U_Gross1_Sum + #SV_U_Gross
  let #SV_U1_Sum = #SV_U1_Sum + #SV_U1
end-if
if #SV_U2 <> 0
  print $SV_U_Gross (,118)
  print $SV_U2 (,132)
  let #SV_U_Gross2_Sum = #SV_U_Gross2_Sum + #SV_U_Gross
  let #SV_U2_Sum = #SV_U2_Sum + #SV_U2
end-if
!adj09-890b19: RI MC insolvency
!for years before 2009, march clause values to be picked from else part.
if $MarchCL = 'Y' and $Vorj = 'N' and #phase = 1
  print $GRSS_INSOL_MC (,145)
  let #GRSS_INSOL_Sum =  #GRSS_INSOL_Sum + #PT.GPDE_RP_GRS_INS_MC
  print $GRSS_UML_MC (,159)
  let #UML_INSOLV_Sum =  #UML_INSOLV_Sum + #PT.GPDE_RP_UML_INS_MC
else
!adj08-890b16 RI insolvency - umlage
  if #PT.GPDE_RP_GRSS_INSOL <> 0
  print $GRSS_INSOL (,145)
  let #GRSS_INSOL_Sum = #GRSS_INSOL_Sum + #PT.GPDE_RP_GRSS_INSOL
  end-if
  if #PT.GPDE_RP_UML_INSOLV <> 0
  print $UML_INSOLV (,159)
  let #UML_INSOLV_Sum = #UML_INSOLV_Sum + #PT.GPDE_RP_UML_INSOLV
  end-if
end-if ! RI TU

let #PT.GPDE_RP_UML_INSOLV = 0
let #PT.GPDE_RP_GRSS_INSOL = 0
let #PT.GPDE_RP_UML_INS_MC = 0
let #PT.GPDE_RP_GRS_INS_MC = 0

let $PrintedUml = 'Y'
alter-printer
   font = 4
   point-size = 13
end-procedure
!********************************************************************************
begin-procedure Print-Sums-Umlage
use-report Abrechnung_Umlage
let #mm = 4 + #current-line
if #mm > 55
 new-page
end-if
let #currLineV = -14 + #current-line
let #currLineN = -13 + #current-line
!adj  graphic (#currLineN,39,142) box 2 14
graphic (#currLineN,48,133) box 2 14
  graphic (#currLineV,96,2) vert-line 1
  graphic (#currLineV,111,2) vert-line 1
  graphic (#currLineV,125,2) vert-line 1
  graphic (#currLineV,139,2) vert-line 1
  graphic (#currLineV,153,2) vert-line 1
  graphic (#currLineV,167,2) vert-line 1
alter-printer
   font = 3
   point-size = 16
do Format-Number(#SV_U_Gross1_Sum,$SV_U_Gross1_Sum,',999,999,999.99')
do Format-Number(#SV_U1_Sum,$SV_U1_Sum,',999,999,999.99')
do Format-Number(#SV_U_Gross2_Sum,$SV_U_Gross2_Sum,',999,999,999.99')
do Format-Number(#SV_U2_Sum,$SV_U2_Sum,',999,999,999.99')
do Format-Number(#UML_INSOLV_Sum,$UML_INSOLV_Sum,',999,999,999.99')
do Format-Number(#GRSS_INSOL_Sum,$GRSS_INSOL_Sum,',999,999,999.99')

if rtrim(ltrim($SV_U_Gross1_Sum, ' '), ' ') = $MinusNull
   let $SV_U_Gross1_Sum = '           ' || $PlusNull
end-if
if rtrim(ltrim($SV_U_Gross2_Sum, ' '), ' ') = $MinusNull
   let $SV_U_Gross2_Sum = '           ' || $PlusNull
end-if
if rtrim(ltrim($SV_U1_Sum, ' '), ' ') = $MinusNull
   let $SV_U1_Sum = '           ' || $PlusNull
end-if
if rtrim(ltrim($SV_U2_Sum, ' '), ' ') = $MinusNull
   let $SV_U2_Sum = '           ' || $PlusNull
end-if
!adj89b16 : RI insolvency
  position (+2,1)
  print $SV_U_Gross1_Sum (,90) bold
  print $SV_U1_Sum (,104)       bold
  print $SV_U_Gross2_Sum (,118) bold
  print $SV_U2_Sum (,132) bold
 if #GRSS_INSOL_Sum <> 0
  print $GRSS_INSOL_Sum (,146) bold
  let #GRSS_INSOL_Sum_1 = #GRSS_INSOL_Sum
 end-if
 if #UML_INSOLV_Sum <> 0
  print $UML_INSOLV_Sum (,160) bold
  let #UML_INSOLV_Sum_1 = #UML_INSOLV_Sum
 end-if
  alter-printer
   font = 4
   point-size = 13
!adj  print ' Summe'       (,39) bold
  print 'Summe'       (,49) bold
alter-printer
   font = 4
   point-size = 13
let #SV_U_Gross1_Sum = 0
let #SV_U1_Sum = 0
let #SV_U_Gross2_Sum = 0
let #SV_U2_Sum = 0
let #UML_INSOLV_Sum = 0
let #GRSS_INSOL_Sum = 0

end-procedure
!****************************************************************************
begin-procedure Print-SVF-Data
let #mm = 4 + #current-line
if #mm > 55
 new-page
end-if
let #currLineV = -13 + #current-line
let #currLineN = -12 + #current-line
  graphic (#currLineN,1,180) box 2 2
  graphic (#currLineV,14,2) vert-line 1
  graphic (#currLineV,60,2) vert-line 1
  graphic (#currLineV,80,2) vert-line 1
  graphic (#currLineV,100,2) vert-line 1
  graphic (#currLineV,120,2) vert-line 1
  graphic (#currLineV,140,2) vert-line 1
  graphic (#currLineV,160,2) vert-line 1
do Format-Number(#SV_FKV,$SV_FKV,'B999,999,999.99')
do Format-Number(#SV_FPV,$SV_FPV,'B999,999,999.99')
do Format-Number(#SV_Hivler ,$SV_Hivler,'B999,999,999.99')
do Format-Number(#SV_Civler ,$SV_Civler,'B999,999,999.99')
do Format-Number(#PT1.GPDE_RP_SIGRSS_AMT ,$PT1.GPDE_RP_SIGRSS_AMT,'B999,999,999.99')
alter-printer
   font = 4
   point-size = 10.5
let $EmplidT = rtrim($Emplid,' ') || '/'
do Format-Number(#EmplRcd,$EmplRcd,'8888')
print $EmplidT (+1,2)
alter-printer
   font = 4
   point-size = 13
print $EmplRcd (+1,2)
print $ee_name (,15)
if $RetroSign = 'R'
   let #Date_Type1 = {DateType}
   do ConvertToComponents($PRD_END_DT,$yy1a,$mm1a,$dd1a)
   evaluate #Date_Type1
   when = 2
      let $RetroDate = $yy1a || '{PTDateDelim}' || $mm1a
      break
   when-other
      let $RetroDate = $mm1a || '{PTDateDelim}' || $yy1a
      break
   end-evaluate

   let $RetroStr = $RetroDate || ' ' || 'alt'
   print $RetroStr (,61)
end-if
if  $RetroSign = 'N'
      let #Date_Type1 = {DateType}
      do ConvertToComponents($PRD_END_DT,$yy1a,$mm1a,$dd1a)
      evaluate #Date_Type1
      when = 2
         let $RetroDate = $yy1a || '{PTDateDelim}' || $mm1a
         break
      when-other
         let $RetroDate = $mm1a || '{PTDateDelim}' || $yy1a
         break
      end-evaluate

      let $RetroStr = $RetroDate || ' ' || 'neu'
      print $RetroStr (,61)
end-if
alter-printer
   font = 3
   point-size = 16
print $PT1.GPDE_RP_SIGRSS_AMT (,79)
if #SV_FKV <> 0
  print $SV_FKV (,99)
  print $SV_Hivler (,119)
end-if
if #SV_FPV <> 0
  print $SV_FPV (,139)
  print $SV_Civler (,160)
end-if
alter-printer
   font = 4
   point-size = 13
end-procedure
!**************************************************
begin-procedure Print-SVF-Sums
let #mm = 4 + #current-line
if #mm > 55
 new-page
end-if
let #currLineV = -12 + #current-line
let #currLineN = -11 + #current-line
  graphic (#currLineN,80,101) box 2 14
  graphic (#currLineV,100,2) vert-line 1
  graphic (#currLineV,120,2) vert-line 1
  graphic (#currLineV,140,2) vert-line 1
  graphic (#currLineV,160,2) vert-line 1
  alter-printer
   font = 4
   point-size = 13
  print 'Summe'       (+2,81) bold
do Format-Number(#sum_fkv,$sum_fkv,',999,999,999.99')
do Format-Number(#sum_fpv,$sum_fpv,',999,999,999.99')
do Format-Number(#sum_Hivler,$sum_Hivler,',999,999,999.99')
do Format-Number(#sum_Civler,$sum_Civler,',999,999,999.99')


if rtrim(ltrim($sum_fkv, ' '), ' ') = $MinusNull
   let $sum_fkv = '           ' || $PlusNull
end-if
if rtrim(ltrim($sum_fpv, ' '), ' ') = $MinusNull
   let $sum_fpv = '           ' || $PlusNull
end-if
if rtrim(ltrim($sum_Hivler, ' '), ' ') = $MinusNull
   let $sum_Hivler = '           ' || $PlusNull
end-if
if rtrim(ltrim($sum_Civler, ' '), ' ') = $MinusNull
   let $sum_Civler = '           ' || $PlusNull
end-if

alter-printer
   font = 3
   point-size = 16
print $sum_fkv            (,99) bold
print $sum_Hivler            (,119) bold
print $sum_fpv            (,139) bold
print $sum_Civler            (,160) bold
let #sum_fkv = 0
let #sum_fpv = 0
let #sum_Hivler = 0
let #sum_Civler = 0
let $PrintF = 'N'
let #sv_PV_Freiw_Sum = 0
let #sv_KV_Freiw_Sum = 0
let #KV-AG_Freiw_Sum = 0
let #KV-AN_Freiw_Sum = 0
let #PV-AG_Freiw_Sum = 0
let #PV-AN_Freiw_Sum = 0
let #Brutto_KV_Freiw_Sum = 0
let #Brutto_PV_Freiw_Sum = 0
new-page
end-procedure
!**********************************************************************************
begin-procedure Get-Header-Data-Abr
   do Get-Provider-Data($EffDateTemp,$GPDE_SI_PROV_MAND_save,
      $hdr_abr_kk_name,$hdr_abr_kk_nummer,$hdr_abr_kk_street,
          $hdr_abr_kk_zipcity,$hdr_abr_health_rate_east,$hdr_abr_health_rate_west,
      $hdr_abr_beitragskonto,$hdr_abr_zahlstellen_nr,$Ctl_PayEntity)
   do Get-SI_PRV_ACCT_DEU($GPDE_SI_PROV_MAND_save, $EffDateTemp, $Ctl_PayEntity,
      $hdr_abr_beitragskonto, $hdr_abr_zahlstellen_nr)
   do Get-Payentity-Data($Ctl_PayEntity, $EffDateTemp, $hdr_abr_Payentity_name,
      $hdr_abr_Payentity_street,$hdr_abr_Payentity_street2,$hdr_abr_Payentity_street3,
      $hdr_PoBox,$hdr_abr_Payentity_zip_city,$Nation,$Post,$Cit)
   do Get-Print-Date($EffDateTemp, $hdr_abr_curr_pay_end_dt)
   do Format-DateTime($AsOfToday, $hdr_abr_header_date, {DEFDATE}, '', '')
   do Get-KV-Rates($GPDE_SI_REGION_save,$hdr_abr_kk_nummer, $EffDateTemp,$hdr_abr_per_kv_1000,
      $hdr_abr_per_kv_2000,$hdr_abr_per_kv_3000,$hdr_abr_per_kv_6000,$hdr_abr_per_kvdr,$ActEffDt,
      #per_kv_1000,#per_kv_2000,#per_kv_3000,#per_kv_6000,#per_kvdr)
   do Get-RV-AV-PV-Rates($EffDateTemp, $GPDE_SI_REGION_save,
      $GPDE_TX_MINER_save,$hdr_abr_per_pv_0001,$hdr_abr_per_rv_0100,
          $hdr_abr_per_rv_0200,$hdr_abr_per_rv_0300,$hdr_abr_per_rv_0400,
      $hdr_abr_per_rv_0500,$hdr_abr_per_rv_0600,$hdr_abr_per_av_0010,
          $hdr_abr_per_av_0020,$hdr_abr_per_pv_kvdr1,$hdr_abr_per_pv_kvdr2)
   ! wdu05-881jw06 next 3 lines _very_ questionable
   !let $ActEffDt_UV = $EffDateTemp
   !do format-number(#PT.GPDE_RI_PCT1,$hdr_abr_per_uv1,'B888.00')
   !do format-number(#PT.GPDE_RI_PCT2,$hdr_abr_per_uv2,'B888.00')

   ! wdu05-881jw06+ Umlage rates depend on provider only, read for report effdt, show actual effdt
   do Get-UV-Rates($EffDateTemp, $RegionAct,
      $hdr_abr_kk_nummer,$hdr_abr_per_uv1,$hdr_abr_per_uv2,$ActEffDt_UV)
   !
end-procedure
!**************************************************************************************
begin-procedure Get-Provider-Data($curr_pay_end_dt, $si_provider,:$KK_Name,:$KK_Nummer,
                :$KK_Street,:$KK_ZipCity,:$Health_Rate_East,:$Health_Rate_West,
                :$Beitragskonto,:$Zahlstellen_nr,$Payentity)
   let $KK_Name          = ' '
   let $KK_Nummer        = ' '
   let $KK_Street        = ' '
   let $KK_ZipCity       = ' '
   let $Health_Rate_East = ' '
   let $Health_Rate_West = ' '
   let $Beitragskonto    = ' '
   let $Zahlstellen_nr   = ' '
begin-SELECT
PTD.DESCR
PTD.GPDE_SI_PROV_ID
PTD1.ADDRESS1
PTD1.POSTAL
PTD1.CITY
  let $KK_Name          = &PTD.DESCR
  let $KK_Nummer        = &PTD.GPDE_SI_PROV_ID
  let $KK_Street        = rtrim(&PTD1.ADDRESS1,' ')
  let $KK_ZipCity       = rtrim(&PTD1.POSTAL,' ') || ' ' || rtrim(&PTD1.CITY,' ')
  do Get-SI_PRV_ACCT_DEU($si_Provider, $curr_pay_end_dt, $Payentity,
                $Beitragskonto, $Zahlstellen_nr)
  let $_si_provider_id = rtrim($KK_Nummer,' ')
FROM PS_GPDE_SI_PROV PTD,PS_GPDE_SI_PRV_ADR PTD1
WHERE PTD.GPDE_SI_PROV = $si_provider
AND   PTD1.GPDE_SI_PROV = PTD.GPDE_SI_PROV
AND   PTD.EFFDT = (SELECT MAX(EFFDT)
                   FROM PS_GPDE_SI_PROV PTD1
                   WHERE PTD1.GPDE_SI_PROV = PTD.GPDE_SI_PROV
                   AND PTD1.EFFDT <= $curr_pay_end_dt)
AND   PTD1.EFFDT = (SELECT MAX(EFFDT)
                   FROM PS_GPDE_SI_PRV_ADR PTD2
                   WHERE PTD2.GPDE_SI_PROV = PTD1.GPDE_SI_PROV
                   AND PTD2.EFFDT <= $curr_pay_end_dt)
end-SELECT
end-procedure
!**************************************************************************************
begin-procedure Get-SI_PRV_ACCT_DEU($SI_Provider, $Ctl_Curr_Pay_End_Dt, $Ctl_Payentity,
                :$Beitragskonto, :$Zahlstellen_nr)
let $Beitragskonto  = ' '
let $Zahlstellen_nr = ' '
begin-SELECT
PTV.GPDE_SI_CUST_ACTV
PTV.GPDE_SI_CUST_PENS
  let $Beitragskonto = &PTV.GPDE_SI_CUST_ACTV
  let $Zahlstellen_nr = &PTV.GPDE_SI_CUST_PENS
FROM PS_GPDE_AL_PE_SID PTV
WHERE PTV.GPDE_SI_PROV = $SI_Provider
AND   PTV.PAY_ENTITY = $Ctl_Payentity
AND   PTV.EFFDT = (SELECT MAX(EFFDT)
                   FROM PS_GPDE_AL_PE_SID PTV1
                   WHERE PTV1.GPDE_SI_PROV = PTV.GPDE_SI_PROV
                   AND PTV1.EFFDT <= $Ctl_Curr_Pay_End_Dt
                   AND PTV1.PAY_ENTITY = PTV.PAY_ENTITY)
end-SELECT
end-procedure Get-SI_PRV_ACCT_DEU
!************************************************************************************
begin-procedure Get-PayEntity-Data($payentity, $curr_pay_end_dt, :$PayentityName,
                :$PayentityStreet,:$PayentityStreet2,:$PayentityStreet2,:$PoBox,
                :$PayentityZipCity,:$Nation,:$Post,:$Cit)
let $PayentityName    = ' '
let $PayentityStreet  = ' '
let $PayentityStreet2 = ' '
let $PayentityStreet3 = ' '
let $PoBox = ' '
let $PayentityZipCity = ' '
let $Nation = ' '
let $Post = ' '
let $Cit = ' '

begin-SELECT
CP.DESCR
CT.ADDRESS1
CT.ADDRESS2
CT.ADDRESS3
CT.ADDRESS4
CT.CITY
CT.POSTAL
CT.COUNTRY
  let $PayentityName = rtrim(&CP.DESCR,' ')
  let $PayentityStreet = rtrim(&CT.ADDRESS1,' ')
  let $PayentityStreet2 = rtrim(&CT.ADDRESS2,' ')
  let $PayentityStreet3 = rtrim(&CT.ADDRESS3,' ')
  let $PoBox = rtrim(&CT.ADDRESS4,' ')
  let $Nation = rtrim(&CT.COUNTRY,' ')
  let $Post = rtrim(&CT.POSTAL,' ')
  let $Cit = rtrim(&CT.CITY,' ')
  let $PayentityZipCity = rtrim(&CT.POSTAL,' ') || ' ' || rtrim(&CT.CITY,' ')
FROM  PS_GP_PYENT CP, PS_GP_PYENT_DTL CT
WHERE CP.PAY_ENTITY = CT.PAY_ENTITY
AND   CP.PAY_ENTITY = $payentity
AND   CT.EFFDT = (SELECT MAX(EFFDT)
                  FROM   PS_GP_PYENT_DTL CT1
                  WHERE  CT1.PAY_ENTITY = CT.PAY_ENTITY
                  AND  CT1.EFFDT  <= $curr_pay_end_dt)
end-SELECT
end-procedure
!**********************************************************************************
begin-procedure Get_Refund_Gr($Ctl_PayEntity,$curr_pay_end_dt)
let $rfnd_gr1 = ''
let $rfnd_gr2 = ''
let #Row_Num = 0

begin-select distinct
RFGR.GPDE_SI_RFND_TYP
RFGR.GPDE_SI_RFND_GRP

  let $rfnd_typ = rtrim(&RFGR.GPDE_SI_RFND_TYP, ' ')
  let $rfnd_gr  = rtrim(&RFGR.GPDE_SI_RFND_GRP, ' ')

  evaluate $rfnd_typ
          when = '1'           
           put $rfnd_gr into Rfndgrp(#Row_Num)           
           let $rfnd_gr1 = $rfnd_gr           
           
           break
          when = '2'
           let $rfnd_gr2 = $rfnd_gr
               break
          when-other
      break
  end-evaluate
  
  Add 1 to #Row_Num
  
from PS_GPDE_AL_PE_RFGR RFGR
where RFGR.PAY_ENTITY = $Ctl_PayEntity
AND RFGR.GPDE_SI_RFND_TYP = '1'
AND RFGR.EFFDT = (SELECT MAX(EFFDT) FROM PS_GPDE_AL_PE_RFGR RFGR1
                 WHERE RFGR1.PAY_ENTITY = RFGR.PAY_ENTITY
                 AND RFGR1.EFFDT <= $curr_pay_end_dt
                 AND RFGR1.GPDE_SI_RFND_TYP = RFGR.GPDE_SI_RFND_TYP)
order by RFGR.GPDE_SI_RFND_GRP
end-select


end-procedure
!******************************************************************************
begin-procedure Ceck_Refund_YN($Ctl_PayEntity,$curr_pay_end_dt,:$Rfnd_YN)
let $Rfnd_YN = 'Y'
begin-select distinct
RFND_YN.GPDE_SI_RFND_YN
   let $Rfnd_YN = rtrim(&RFND_YN.GPDE_SI_RFND_YN, ' ')
from PS_GPDE_AL_PE_RFND RFND_YN
where RFND_YN.PAY_ENTITY =  $Ctl_PayEntity
AND RFND_YN.EFFDT = (SELECT MAX(EFFDT) FROM PS_GPDE_AL_PE_RFND RFND_YN1
                 WHERE RFND_YN1.PAY_ENTITY = RFND_YN.PAY_ENTITY
                 AND RFND_YN1.EFFDT <= $curr_pay_end_dt)
end-select
end-procedure
!******************************************************************************
begin-procedure Get-UV-Rates($curr_pay_end_dt, $GPDE_SI_REGION,
                $si_provider,:$hdr_abr_per_uv1,:$hdr_abr_per_uv2,:$ActEffDt_UV)
let $hdr_abr_per_uv1 = ''
let $hdr_abr_per_uv2 = ''
let $ActEffDt_UV = ''

! wdu05-881jw06 refund insurance is now mandatory for all!
! do Ceck_Refund_YN($_Ctl_PayEntity,$curr_pay_end_dt,$Rfnd_YN)
! ++   if $Rfnd_YN = 'N'
! ++    goto No_Refund
! ++   end-if
let $Rfnd_YN = 'Y'

let #i=0
let #Refnd_flag = 0
let #cnt = 0   

!wdu05-881jw06 override refund 2 for all
do Get_Refund_Gr($_Ctl_PayEntity,$curr_pay_end_dt)
let $rfnd_gr2='21'



BEGIN-SELECT distinct
KVU.GPDE_SI_PCT
KVU.GPDE_SI_RFND_TYP
KVU.GPDE_SI_RFND_GRP
KVU.GPDE_SI_REGION
KVU.EFFDT
   let $ActEffDt_UV = &KVU.EFFDT
   let $rfnd_type = rtrim(&KVU.GPDE_SI_RFND_TYP, ' ')
   let $rfnd_gr   = rtrim(&KVU.GPDE_SI_RFND_GRP, ' ')
      
   let #i = 0   
   let #Refnd_flag = 0   
  
   evaluate $rfnd_type
   when = '1'
      
      let #cnt = #cnt + 1
      While #i <= 6
               
            Get $refundgrp From Rfndgrp(#i)
            
            let $rfnd_gr1 = $refundgrp          
            
            if $rfnd_gr1 = ''
              break
            end-if
            if $rfnd_gr = $rfnd_gr1 and #Refnd_flag = 0
               if #cnt > 1 !SI prov with more than one Refund group                
                 !check for siprov and si provid.
                 !match the refund groups and assign the refund group val to $hdr_abr_per_uv1
                 do check_siprov($si_provider,$curr_pay_end_dt, $rfnd_gr, #Found)
                 if #Found = 1
                    do format-number(&KVU.GPDE_SI_PCT,$hdr_abr_per_uv1,'888.00')
                    let #Refnd_flag = 1
                    break
                 end-if
               else
                  do format-number(&KVU.GPDE_SI_PCT,$hdr_abr_per_uv1,'888.00')
                  let #Refnd_flag = 1
                  break
               end-if
               
           end-if
            
        Add 1 to #i
        
      End-While
      break
   when = '2'
          if $rfnd_gr = $rfnd_gr2
             do format-number(&KVU.GPDE_SI_PCT,$hdr_abr_per_uv2,'888.00')
          end-if
      break
   when-other
      break
   end-evaluate
   
   
FROM PS_GPDE_SI_RFND_RT KVU
WHERE KVU.GPDE_SI_PROV_ID = $si_provider
AND (KVU.GPDE_SI_REGION = $GPDE_SI_REGION or KVU.GPDE_SI_REGION = '0')
AND KVU.GPDE_SI_RFND_TYP IN ('1','2')
AND KVU.EFFDT = (SELECT MAX(EFFDT) FROM PS_GPDE_SI_RFND_RT KVU2
                 WHERE KVU2.GPDE_SI_PROV_ID = KVU.GPDE_SI_PROV_ID
                 AND KVU2.GPDE_SI_REGION = KVU.GPDE_SI_REGION
                 AND KVU2.EFFDT <= $curr_pay_end_dt
                 AND KVU2.GPDE_SI_RFND_TYP = KVU.GPDE_SI_RFND_TYP)
order by KVU.GPDE_SI_RFND_GRP

END-SELECT

Clear-Array Name=Rfndgrp

No_Refund:
end-procedure

begin-procedure check_siprov($si_provider,$curr_pay_end_dt, $rfnd_gr, :#Found)

let #Found = 0

BEGIN-SELECT distinct 
RFGR.GPDE_SI_RFND_PRV
RFGR.GPDE_SI_RFND_TYP
RFGR.GPDE_SI_RFND_GRP
SIPROV.GPDE_SI_PROV 

             let $rfgr_siprov = &RFGR.GPDE_SI_RFND_PRV
             let $siprov = &SIPROV.GPDE_SI_PROV
             if $rfgr_siprov = $siprov
                let #Found = 1
             end-if 
             
from PS_GPDE_AL_PE_RFGR RFGR, PS_GPDE_SI_PROV SIPROV
where RFGR.GPDE_SI_RFND_TYP = '1' 
AND RFGR.gpde_si_rfnd_grp = $rfnd_gr
AND SIPROV.GPDE_SI_PROV = RFGR.GPDE_SI_RFND_PRV 
AND SIPROV.GPDE_SI_PROV_ID = $si_provider
AND RFGR.EFFDT = (SELECT MAX(EFFDT) FROM PS_GPDE_AL_PE_RFGR RFGR1
                 WHERE RFGR1.PAY_ENTITY = RFGR.PAY_ENTITY
                 AND RFGR1.EFFDT <= $curr_pay_end_dt
                 AND RFGR1.GPDE_SI_RFND_TYP = RFGR.GPDE_SI_RFND_TYP)                 
   
end-select
end-procedure
!******************************************************************************
begin-procedure Get-KV-Rates($GPDE_SI_REGION,$si_provider,$curr_pay_end_dt,:$per_kv_1000,
                :$per_kv_2000,:$per_kv_3000,:$per_kv_6000,:$per_kvdr,:$ActEffDt,
                :#per_kv_1000,:#per_kv_2000,:#per_kv_3000,:#per_kv_6000,:#per_kvdr)
   let $per_kv_1000 = ' '
   let $per_kv_2000 = ' '
   let $per_kv_3000 = ' '
   let $per_kv_6000 = ' '
   let $per_kvdr    = ' '
   let $ActEffDt = ''
   let #per_kv_1000 = 0
   let #per_kv_2000 = 0
   let #per_kv_3000 = 0
   let #per_kv_6000 = 0
   let #per_kvdr    = 0
BEGIN-SELECT distinct
KVR.GPDE_SI_RATE_CD
KVR.GPDE_SI_PCT
KVR.GPDE_SI_REGION
KVR.EFFDT

   let $rate_cd = rtrim(&KVR.GPDE_SI_RATE_CD, ' ')
   let $ActEffDt = &KVR.EFFDT

   evaluate $rate_cd
   when = '1'
      do format-number(&KVR.GPDE_SI_PCT,$per_kv_1000,'888.00')
      let #per_kv_1000 = &KVR.GPDE_SI_PCT
      break
   when = '2'
          do format-number(&KVR.GPDE_SI_PCT,$per_kv_2000,'888.00')
          let #per_kv_2000 = &KVR.GPDE_SI_PCT
      break
   when = '3'
          do format-number(&KVR.GPDE_SI_PCT,$per_kv_3000,'888.00')
          let #per_kv_3000 = &KVR.GPDE_SI_PCT
      break
   when = '6'
          do format-number(&KVR.GPDE_SI_PCT,$per_kv_6000,'888.00')
          let #per_kv_6000 = &KVR.GPDE_SI_PCT
      break
   when = '10'
          do format-number(&KVR.GPDE_SI_PCT,$per_kvdr,'888.00')
          let #per_kvdr = &KVR.GPDE_SI_PCT
          break
   end-evaluate
!byar-900UpdA : Health Ins Rates
    if #_phase = 1 and $_yy09 >= '2011'
      let $per_kv_1000 = '15.50'
      let $per_kv_2000 = '00.00'
      let $per_kv_3000 = '14.90'
      let $per_kv_6000 = '13.00'
      let $per_kvdr    = '15.50'
    else
       !adj08-890b16 : Health Ins Rates
       if #_phase = 1 and $_yy09 >= '2009'
          let $per_kv_1000 = '15.50'
          let $per_kv_2000 = '00.00'
          let $per_kv_3000 = '14.90'
          let $per_kv_6000 = '13.00'
          let $per_kvdr    = '15.50'
          !adj09-89b18 : July Tax update
          if $_HD_mm > '06' or $_yy09 = '2010'
             let $per_kv_1000 = '14.90'
             let $per_kv_2000 = '00.00'
             let $per_kv_3000 = '14.30'
             let $per_kv_6000 = '13.00'
             let $per_kvdr    = '14.90'
          end-if
        end-if    
    end-if
    

FROM PS_GPDE_SI_HLTH_RT KVR
WHERE KVR.GPDE_SI_PROV_ID = $si_provider
AND KVR.GPDE_SI_RATE_CD IN ('1','2','3','6','10')
! adj08-89b14-1773434000 : 16th Jun 08 Increased Contribution Rate for Nursing Care Insurance
AND (KVR.GPDE_SI_REGION = '0' or KVR.GPDE_SI_REGION = $GPDE_SI_REGION )
AND KVR.EFFDT = (SELECT MAX(EFFDT) FROM PS_GPDE_SI_HLTH_RT KVR2
                 WHERE KVR2.GPDE_SI_PROV_ID = KVR.GPDE_SI_PROV_ID
                 AND KVR2.GPDE_SI_REGION = KVR.GPDE_SI_REGION
                 AND KVR2.EFFDT <= $curr_pay_end_dt
                 AND KVR2.GPDE_SI_RATE_CD = KVR.GPDE_SI_RATE_CD)
END-SELECT
end-procedure
!******************************************************************************
begin-procedure Get-RV-AV-PV-Rates($curr_pay_end_dt, $GPDE_SI_REGION, $GPDE_TX_MINER,:$per_pv_0001,
                :$per_rv_0100,:$per_rv_0200,:$per_rv_0300,:$per_rv_0400,:$per_rv_0500,:$per_rv_0600,
                :$per_av_0010,:$per_av_0020,:$per_pv_kvdr1,:$per_pv_kvdr2)
   let $per_pv_0001  = ' '
   let $per_rv_0100  = ' '
   let $per_rv_0200  = ' '
   let $per_rv_0300  = ' '
   let $per_rv_0400  = ' '
   let $per_rv_0500  = ' '
   let $per_rv_0600  = ' '
   let $per_av_0010  = ' '
   let $per_av_0020  = ' '
   let $per_pv_kvdr1 = ' '
   let $per_pv_kvdr2 = ' '
BEGIN-SELECT
RATE.GPDE_SI_TYPE
RATE.GPDE_SI_RATE_CD
RATE.GPDE_SI_PCT
   let $RATE.GPDE_SI_TYPE = rtrim(&RATE.GPDE_SI_TYPE,' ')
   let $RATE.GPDE_SI_RATE_CD = rtrim(&RATE.GPDE_SI_RATE_CD, ' ')
   evaluate $RATE.GPDE_SI_TYPE
   when = '02'
      evaluate $RATE.GPDE_SI_RATE_CD
      when = '1'
                 do format-number(&RATE.GPDE_SI_PCT,$per_pv_0001,'888.00')
         break
      when = '5'
                 do format-number(&RATE.GPDE_SI_PCT,$per_pv_kvdr1,'888.00')
         break
      when = '6'
                 do format-number(&RATE.GPDE_SI_PCT,$per_pv_kvdr2,'888.00')
         break
      end-evaluate
   when = '03'
      evaluate $RATE.GPDE_SI_RATE_CD
      when = '1'
                 do format-number(&RATE.GPDE_SI_PCT,$per_rv_0100,'888.00')
         break
      when = '2'
         do format-number(&RATE.GPDE_SI_PCT,$per_rv_0200,'888.00')
         break
      when = '3'
         do format-number(&RATE.GPDE_SI_PCT,$per_rv_0300,'888.00')
         break
      when = '4'
         do format-number(&RATE.GPDE_SI_PCT,$per_rv_0400,'888.00')
         break
      when = '5'
         do format-number(&RATE.GPDE_SI_PCT,$per_rv_0500,'888.00')
         break
      when = '6'
         do format-number(&RATE.GPDE_SI_PCT,$per_rv_0600,'888.00')
         break
      end-evaluate

      break
   when = '04'
      evaluate $RATE.GPDE_SI_RATE_CD
      when = '1'
                 do format-number(&RATE.GPDE_SI_PCT,$per_av_0010,'888.00')
         break
      when = '2'
         do format-number(&RATE.GPDE_SI_PCT,$per_av_0020,'888.00')
         break
      end-evaluate
      break
   end-evaluate
FROM PS_GPDE_SI_RATES RATE
! adj08-89b14-1773434000 : 16th Jun 08 Increased Contribution Rate for Nursing Care Insurance
WHERE RATE.GPDE_SI_REGION = '0'
AND (RATE.GPDE_SI_MINER = $GPDE_TX_MINER OR RATE.GPDE_SI_MINER = 'G')
AND RATE.EFFDT = (SELECT MAX(EFFDT) FROM PS_GPDE_SI_RATES RATE2
                  WHERE RATE2.GPDE_SI_REGION = RATE.GPDE_SI_REGION
                  AND   RATE2.GPDE_SI_MINER = RATE.GPDE_SI_MINER
                  AND RATE2.EFFDT <= $curr_pay_end_dt)
END-SELECT
end-procedure
!****************************************************************




begin-procedure GetBeitragsKontoNummer($si_provider, $payentity, $pay_end_dt, :$AccountNumberLocal)
!
! get customer number by PayEntity and SI_Provider  ('AOK/WEST')
!
let $AccountNumberLocal = ''
Begin-select
A.GPDE_SI_CUST_ACTV
        let $AccountNumberLocal = &A.GPDE_SI_CUST_ACTV
FROM PS_GPDE_AL_PE_SID A
WHERE A.GPDE_SI_PROV = $si_provider
AND     A.EFFDT = (SELECT MAX(EFFDT) FROM PS_GPDE_AL_PE_SID A1
                        WHERE A1.GPDE_SI_PROV = A.GPDE_SI_PROV
                        AND A1.PAY_ENTITY = A.PAY_ENTITY
                        AND A1.EFFDT <= $pay_end_dt)
AND A.PAY_ENTITY = $payentity
End-select

if rtrim($AccountNumberLocal, ' ') = ''
   let $AccountNumberLocal = 'XXX'
end-if
end-procedure
!****************************************************************



begin-procedure SetPayEntityBetriebsnummer
! wdu05-881jw06:   set Betriebsnummer for current PayEntity (Betriebsnummer des Erstellers)
!
! we are currently reporting per payentity, so the numbers are the same for:
! Betriebsnummer des Erstellers
! Betriebsnummer des Arbeitgebers
!
let $PayentBtnr = ' '
Begin-select
PEL1.GPDE_SI_BTNR
        let $PayentBtnr = &PEL1.GPDE_SI_BTNR
FROM PS_GPDE_AL_PE_LOC PEL1
WHERE  PEL1.EFFDT = (SELECT MAX(EFFDT) FROM PS_GPDE_AL_PE_LOC PEL2
                        WHERE PEL2.SETID = PEL1.SETID
                        AND PEL2.PAY_ENTITY = PEL1.PAY_ENTITY
                        AND PEL2.LOCATION = PEL1.LOCATION
                        AND PEL2.EFFDT <= $Ctl_Curr_Pay_End_Dt)
AND PEL1.GPDE_SI_REP_BTNR='Y'
AND PEL1.PAY_ENTITY = $Ctl_PayEntity
End-select

if rtrim($PayentBtnr, ' ') = ''
    let $messg='Fehler: Fuer die Firma ' || $payentity || ' wurde keine Betriebsnummer als Meldebetriebsnummer markiert.'
    display $messg
end-if
! show 'Betriebsnummer:' $PayentBtnr
end-procedure
!****************************************************************



begin-procedure Get-Print-Date ($datein,:$print_date)
   do Convert-To-DTU-Date ($datein, $dtu_dt)
   let $print_date = substr($dtu_dt,6,2) || '/' || substr($dtu_dt,1,4)
end-procedure
!************************************************************************
begin-procedure Get_Umlage_sums
      let #tempc = 0
      while #tempc < #CurrCy

           get $Act_C from CurrencyData(#tempc) Currcy1
           if $Act_C = $sav_Currency
              get #SV_U1 from CurrencyData(#tempc) Currcy2
              get #SV_U2 from CurrencyData(#tempc) Currcy3
              break
           else
              let #SV_U1 = 0
              let #SV_U2 = 0
           end-if
           let #tempc = #tempc + 1

      end-while
end-procedure
!****************************************************************
begin-procedure GetTaxNumber
let $TaxNumber = ' '
begin-select
tud.GPDE_TX_NUMBER
    let $TaxNumber = rtrim(&tud.GPDE_TX_NUMBER, ' ')
from PS_GPDE_AL_PAY_ENT comn , PS_GPDE_TX_UNIT tud
where comn.PAY_ENTITY = $Ctl_PayEntity and
    comn.EFF_STATUS     = 'A' and
      tud.EFF_STATUS         = 'A' and
      comn.GPDE_TX_UNIT   = tud.GPDE_TX_UNIT and
      comn.EFFDT          = (SELECT MAX(comn1.EFFDT)
                              FROM PS_GPDE_AL_PAY_ENT comn1
                              WHERE comn1.PAY_ENTITY = comn.PAY_ENTITY
                              AND   comn1.EFFDT <=  $Ctl_Curr_Pay_End_Dt) and
      tud.EFFDT           = (SELECT MAX(tud1.EFFDT)
                              FROM PS_GPDE_TX_UNIT tud1
                              WHERE tud1.GPDE_TX_UNIT = tud.GPDE_TX_UNIT
                              AND   tud1.EFFDT <=  $Ctl_Curr_Pay_End_Dt)
end-select
end-procedure
!***********************************************************************







begin-procedure Header-Nachweis
   do Get-Provider-Data($EffDateTemp, $GPDE_SI_PROV_MAND_save,$KK_Name,$KK_Nummer,$KK_Street,$KK_ZipCity,
      $Health_Rate_East,$Health_Rate_West,$Beitragskonto,$Zahlstellen_nr,$Ctl_PayEntity)

   if ((rtrim($Beitragskonto, ' ') = '') and (rtrim($Zahlstellen_nr, ' ') = ''))
      do Get-SI_PRV_ACCT_DEU($GPDE_SI_PROV_MAND_save,$EffDateTemp,$Ctl_PayEntity,
      $Beitragskonto, $Zahlstellen_nr)
   end-if
   do GetTaxNumber
   alter-printer
   font = 4
   point-size = 13
   graphic (3,{col0n},100)  box 3 8    !Arbeitgeber
   if $PrintFormInsigBUK = 'N'
    graphic (2,{col2n},3) vert-line 8   !Betriebs-/Firmennummer
   else
      graphic (2,50,3) vert-line 8   !Betriebs-/Firmennummer
      graphic (2,80,3) vert-line 8   !Steuernummer
   end-if
   graphic (12,{col0n},1)  vert-line 14    !Adresse
   graphic (12,{col0n},2)  horz-line 14    !Adresse
   graphic (12,44,2)  horz-line 14    !Adresse
   graphic (12,46,1)  vert-line 14    !Adresse
   graphic (21,{col0n},1)  vert-line 14    !Adresse
   graphic (22,{col0n},2)  horz-line 14    !Adresse
   graphic (22,44,2)  horz-line 14    !Adresse
   graphic (21,46,1)  vert-line 14    !Adresse
   graphic (8,73,3)   box 1 14    !von - Tag  9
   graphic (8,76,3)   box 1 14    !von - Tag
   graphic (8,83,3)  box 1 14    !von - Monat
   graphic (8,86,3)  box 1 14    !von - Monat
   graphic (8,93,3)  box 1 14    !von - Jahr
   graphic (8,96,3)  box 1 14    !von - Jahr
   graphic (8,99,3)  box 1 14    !von - Jahr
   graphic (8,102,3)  box 1 14    !von - Jahr
   graphic (10,73,3)  box 1 14    !bis - Tag  12
   graphic (10,76,3)  box 1 14    !bis - Tag
   graphic (10,83,3)  box 1 14    !bis - Monat
   graphic (10,86,3)  box 1 14    !bis - Monat
   graphic (10,93,3)  box 1 14    !bis - Jahr
   graphic (10,96,3)  box 1 14    !bis - Jahr
   graphic (10,99,3)  box 1 14    !bis - Jahr
   graphic (10,102,3) box 1 14    !bis - Jahr
   graphic (12,86,3) box 1 14     !Rechtkreis Ost
   graphic (12,102,3) box 1 14    !Rechtkreis West
   graphic (14,102,3) box 1 14    !Fälligkeit
   graphic (16,102,3)  box 1 14   !Dauer       15
   graphic (19,102,3)  box 1 14   !Dauer - bisher

  if $PrintFormInsigBUK = 'N'
   graphic (23,102,3)  box 1 14   !Kurzarbeiter
   graphic (26,102,3)  box 1 14   !Korrektur-Beitragsn..
  end-if
  if $PrintFormInsigBUK = 'N'
   graphic (28,{col0n},100)  box 38 8    !Beitragsnachweis
   graphic (33,{col0n},100)  horz-line 8    !1
   graphic (35,{col0n},100)  horz-line 8    !2
   graphic (37,{col0n},100)  horz-line 8    !3
   graphic (39,{col0n},100)  horz-line 8    !4
   graphic (41,{col0n},100)  horz-line 8    !5
   graphic (43,{col0n},100)  horz-line 8    !6
   graphic (45,{col0n},100)  horz-line 8    !7
   graphic (47,{col0n},100)  horz-line 8    !8
   graphic (49,{col0n},100)  horz-line 8    !9
   graphic (51,{col0n},100)  horz-line 8    !10
   graphic (53,{col0n},100)  horz-line 8    !11
   graphic (55,{col0n},100)  horz-line 8    !12
   graphic (57,{col0n},100)  horz-line 8    !13
   graphic (59,{col0n},100)  horz-line 8    !14
   graphic (61,{col0n},100)  horz-line 8    !15
   graphic (63,{col0n},100)  horz-line 8    !16
   graphic (67,{col0n},100)  horz-line 8    ! for sum
   graphic (65,05,02)        vert-line 8   ! for sum vert
   graphic (63,75,02)        vert-line 8   ! for u2
   graphic (27,75,36)        vert-line 8   !Beitragsgruppe
   graphic (27,84,38)        vert-line 8   !Beitragsgruppe
   graphic (29,84,38)        vert-line 8   !Beitragsgruppe
   graphic (21,102,3)  box 1 14   !Dauer - bisher
   graphic (30,86,3)  box 1 14    !bis - Jahr
   graphic (32,86,3) box 1 14    !bis - Jahr
  else
   graphic (28,{col0n},100)  box 26 8    !Beitragsnachweis
   graphic (33,{col0n},100)  horz-line 8    !1
   graphic (35,{col0n},100)  horz-line 8    !2
   graphic (37,{col0n},100)  horz-line 8    !3
   graphic (39,{col0n},100)  horz-line 8    !4
   graphic (41,{col0n},100)  horz-line 8    !5
   graphic (43,{col0n},100)  horz-line 8    !6
   graphic (45,{col0n},100)  horz-line 8    !7
   graphic (47,{col0n},100)  horz-line 8    !8
   graphic (49,{col0n},100)  horz-line 8    !9
   graphic (51,{col0n},100)  horz-line 8    !10
   graphic (53,{col0n},100)  horz-line 8    !11
   graphic (27,75,24)        vert-line 8   !Beitragsgruppe
   graphic (27,84,26)        vert-line 8   !Beitragsgruppe
   graphic (27,99,30)        vert-line 8   !Beitragsgruppe
  end-if
   alter-printer
   font = 4
   point-size = 22
   if $PrintFormInsigBUK = 'N'
      print 'Beitragsnachweis' (31,6)
   else
      print 'Beitragsnachweis für geringfügig Beschäftigte' (30,6)
      print '(einschließlich einheitlicher Pauschsteuer)' (32,6)
   end-if
   alter-printer
   font = 4
   point-size = 13
   print 'Beitrags-' (30,76)
   print 'gruppe' (31,76)
   ! wdu05-881b8:  use EURO char from global strings table
   if $PrintFormInsigBUK = 'N'
      let $TempStr = $EUROCHAR || '*)'
      print 'DM*)' (30,92)
      print $TempStr (32,92)
   else
      print $EUROCHAR (30,90)
      print 'Cent' (30,100)
   end-if
   print 'Zeitraum:'   (7,51)
   print 'von'         (8,66)
   print 'bis'         (10,66)
   if $PrintFormInsigBUK = 'N'
      print 'Arbeitgeber'          (3,6)
      print 'Betriebs-/Firmennummer des Arbeitgebers'  (3,61)
   else
      alter-printer
      font = 4
      point-size = 10.0
      print 'Arbeitgeber'          (3,6)      bold
      print 'Betriebsnummer des Arbeitgebers'  (3,51)  bold
      print 'Steuernummer des Arbeitgebers *)'  (3,81)  bold
   end-if
   alter-printer
   font = 4
   point-size = 11.0
   print 'Tag'         (7,74)
   print 'Monat'       (7,84)
   print 'Jahr'        (7,96)
   print 'Tag'         (9,74)
   print 'Monat'       (9,84)
   print 'Jahr'        (9,96)
   if $PrintFormInsigBUK = 'N'
     print 'Rechtkreis*)'  (12,64)
      print 'Ost:'          (12,82)
      print 'West:'         (12,97)
      print 'Fälligkeit am 25. des lfd. Monats *)' (14,64)
   else
      print 'Rechtkreis **)'  (12,64)
      print 'Ost:'          (12,82)
      print 'West:'         (12,97)
      print 'Fälligkeit am 25. des lfd. Monats **)' (14,64)
   end-if
  if $Maturity = 'Y'
     print 'X'   (14,103)
  end-if
  evaluate $RegionAct
  when = '1'
     print 'X'   (12,87)
     break
  when = '2'
     print 'X'   (12,103)
     break
  when-other
     break
  end-evaluate
  if $PrintFormInsigBUK = 'N'
   print 'Dauer-Beitragsnachweis *)'                   (16,64)
   print 'bisheriger Dauer-Beitragsnachweis'           (18,64)
   print 'gilt erneut ab nächsten Monat *)'            (19,64)
  else
   print 'Dauer-Beitragsnachweis **)'                   (16,64)
   print 'bisheriger Dauer-Beitragsnachweis'           (18,64)
   print 'gilt erneut ab nächsten Monat **)'            (19,64)
!adj08-890b16: Contr. previous year
    if $Korr = 'Y'
        print 'Korrektur-Beitragsnachweis'                  (25,64)
        print 'für abgelaufene Kalenderjahre *)'            (26,64)
        graphic (26,102,3)  box 1 14
    end-if
  end-if
  if $PrintFormInsigBUK = 'N'
   print 'Beitragsnachweis enthält Beiträge'           (21,64)
   print 'aus Wertguthaben, das abgelaufenen'          (22,64)
   print 'Kalenderjahren zuzuordnen ist *)'            (23,64)
   print 'Korrektur-Beitragsnachweis'                  (25,64)
   print 'für abgelaufene Kalenderjahre *)'            (26,64)
  end-if
   do Get-Payentity-Data($Ctl_PayEntity,$EffDateTemp, $PayentityName,
                         $PayentityStreet,$PayentityStreet2,$PayentityStreet3,
                         $PoBox,$PayentityZipCity,$Nation,$Post,$Cit)
   let $Adresse_ArbG = rtrim($PayentityName,' ') || cond(rtrim($PayentityStreet,' ') <> '', ', ', '')
   || rtrim($PayentityStreet,' ') || cond(rtrim($PayentityZipCity,' ') <> '', ', ', '') ||
   rtrim($PayentityZipCity,' ')
   if $PrintFormInsigBUK = 'N'
      print $Adresse_ArbG         (4,6) WRAP 65 2 keep-top
      print $hdr_abr_GPDE_DO_BTNR           (4,61)
   else
      alter-printer
       font = 4
       point-size = 10
      print $Adresse_ArbG         (4,6) WRAP 65 2 keep-top
      print $hdr_abr_GPDE_DO_BTNR            (4,51)
      print $TaxNumber           (4,81)
   end-if
   alter-printer
   font = 4
   point-size = 13

   let $Prov_Nm = rtrim($GPDE_SI_PROV_MAND_save,' ')

   ! wdu06-881b11 DIN-address rules: moved postal+city one line up to remove blank lines
   if $PrintFormInsigBUK = 'N'
      print $Prov_Nm (10,6)
      print $KK_Name                (15,6)
      print $KK_Street              (16,6)
      print $KK_ZipCity             (17,6)
   else
      print 'Bundesknappschaft'     (15,6) bold
      print '45115 Essen'           (16,6) bold
   end-if
   if $PrintFormInsigBUK = 'N'
      print 'Beiträge zur Krankenversicherung - allgemeiner Betrag -'                       (35,6)
      print 'Beiträge zur Krankenversicherung - erhöhter Betrag -'                          (37,6)
      print 'Beiträge zur Krankenversicherung - ermäßigter Betrag -'                        (39,6)
      print 'Beiträge zur Krankenversicherung für geringfügig Beschäftigte'                 (41,6)
      print 'Beiträge zur Rentenversicherung der Arbeiter     - voller Beitrag -'           (43,6)
      print 'Beiträge zur Rentenversicherung der Angestellten - voller Beitrag -'           (45,6)
      print 'Beiträge zur Rentenversicherung der Arbeiter     - halber Beitrag -'           (47,6)
      print 'Beiträge zur Rentenversicherung der Angestellten - halber Beitrag -'           (49,6)
      print 'Beiträge zur Rentenversicherung der Arbeiter für geringfügig Beschäftigte'     (51,6)
      print 'Beiträge zur Rentenversicherung der Angestellten für geringfügig Beschäftigte' (53,6)
      print 'Beiträge zur Arbeitsförderung - voller Beitrag -'                              (55,6)
      print 'Beiträge zur Arbeitsförderung - halber Beitrag -'                              (57,6)
!adj08-890b16: RI insolvency
      print 'Insolvenzgeldumlage'                                                           (59,6)!+2 below
      print 'Beiträge zur sozialen Pflegeversicherung'                                      (61,6)
! adj07-89B11-1680582000 : 06th Sep 07 Issues with report layout.
      print 'Umlage nach dem Aufwandsausgleichsgesetz (AAG) für Krankheitsaufwendungen'     (63,6)
      print 'Umlage nach dem Aufwandsausgleichsgesetz (AAG) für Mutterschaftsaufwendungen'  (65,6)
      print 'Gesamtsumme'                                                                   (67,6) bold
      print '1000'     (35,77)
      print '2000'     (37,77)
      print '3000'     (39,77)
      print '6000'     (41,77)
      print '0100'     (43,77)
      print '0200'     (45,77)
      print '0300'     (47,77)
      print '0400'     (49,77)
      print '0500'     (51,77)
      print '0600'     (53,77)
      print '0010'     (55,77)
      print '0020'     (57,77)
      print '0050'     (59,77)
      print '0001'     (61,77)
      print ' U1 '     (63,77)
      print ' U2 '     (65,77)
   else
      print 'Beiträge zur Krankenversicherung für geringfügig Beschäftigte'                          (35,6)
      print 'Beiträge zur Rentenversicherung der Arbeiter - voller Beitrag bei Verzicht auf die'     (36,6)
      print 'Rentenversicherungsfreiheit -'                                                          (37,6)
      print 'Beiträge zur Rentenversicherung der Angestellten - voller Beitrag bei Verzicht auf die' (38,6)
      print 'Rentenversicherungsfreiheit -'                                                          (39,6)
      print 'Beiträge zur Rentenversicherung der Arbeiter für geringfügig Beschäftigte'              (41,6)
      print 'Beiträge zur Rentenversicherung der Angestellten für geringfügig Beschäftigte'          (43,6)
!adj08-890b16: RI insolvency - add Insolvenzgeldumlage
      print 'Insolvenzgeldumlage'                                                                    (45,6)!+2 below
! adj07-89B11-1680582000 : 06th Sep 07 Issues with report layout.
      print 'Umlage nach dem Aufwandsausgleichsgesetz (AAG) für Krankheitsaufwendungen'              (47,6)
      print 'Umlage nach dem Aufwandsausgleichsgesetz (AAG) für Mutterschaftsaufwendungen'           (49,6)
      print 'einheitliche Pauschsteuer'                                                              (51,6)
      print 'Gesamtsumme'                                                                            (53,6) bold
      print '6000'     (35,77)
      print '0100'     (37,77)
      print '0200'     (39,77)
      print '0500'     (41,77)
      print '0600'     (43,77)
      print '0050'     (45,77)
      print ' U1 '     (47,77)
      print ' U2 '     (49,77)
      print ' St '     (51,77)
   end-if
   if $PrintFormInsigBUK = 'N'
      graphic (67,65,8) vert-line 8   !Beitragsgruppe
      graphic (67,75,4) vert-line 8   !Beitragsgruppe
      graphic (67,84,8) vert-line 8   !Beitragsgruppe
      graphic (67,105,8) vert-line 8   !Beitragsgruppe
      graphic (65,105,8) vert-line 8   !Beitragsgruppe
      graphic (69,75,30)  horz-line 8    !1
      graphic (71,65,40)  horz-line 8    !1
      graphic (73,65,40)  horz-line 8    !1
      graphic (75,65,40)  horz-line 8    !1
      graphic (75,5,36)   horz-line 8    !1
   else
      graphic (53,50,4) vert-line 8   !Beitragsgruppe +1
      graphic (53,84,4) vert-line 8   !Beitragsgruppe
      graphic (53,105,4) vert-line 8   !Beitragsgruppe
      graphic (55,50,55)  horz-line 8    !1
      graphic (57,5,100)   horz-line 8    !1
   end-if

   alter-printer
   font = 4
   point-size = 11

   if $PrintFormInsigBUK = 'N'
      print 'Es wird bestätigt, daß die Angaben mit denen der Lohn- und Gehaltsunterlagen' (69,6)
      print 'übereinstimmen und in diesen sämtliche Entgelte enthalten sind.'   (70,6)
      alter-printer
      font = 4
      point-size = 9
      print 'Beiträge für'                                (68,66)
      print 'freiwillig'                                  (69,66)
      print 'Kranken ver-'                                (70,66)
      print 'sicherte**)'                                 (71,66)
      print 'zur Kranken-'                                (68,76)
      print 'versicherung'                                (69,76)
      print 'zur Pflege-'                                 (70,76)
      print 'versicherung'                                (71,76)
      print 'abzüglich Erstattung'                        (72,66)
! adj07-89B11-1680582000 : 06th Sep 07 Issues with report layout.
      let $temptext = 'gemäß '  || 'AAG'
      print  $temptext                                    (73,66)
      print 'zu zahlender'                                (74,66)
      print 'Betrag/Guthaben'                             (75,66)
      print 'Datum, Unterschrift'                         (76,6)
      print '*)   Zutreffendes ankreuzen'                 (76,66)
      print '**)  freiwillige Angabe des Arbeitsgebers'   (77,66)
   else
!adj08-890b16: RI insolvency +2
      print 'Es wird bestätigt, dass die Angaben mit denen der Lohn- '  (54,6)
      print 'und Gehaltsunterlagen übereinstimmen und in diesen sämt-'  (55,6)
      print 'liche Entgelte enthalten sind.'                            (56,6)
      alter-printer
      font = 4
      point-size = 9.5
      print 'abzüglich Erstattung gemäß'                        (54,51)
! adj07-89B11-1680582000 : 06th Sep 07 Issues with report layout.
      let $temptext = 'gemäß '  || 'AAG'
      print $temptext                                     (55,51)
      print 'zu zahlender'                                (56,51)
      print 'Betrag/Guthaben'                             (57,51)
      print 'Datum, Unterschrift'                         (58,6)
      print '*)  Die Steuernummer ist nur anzugeben, sofern die' (58,51)
      print '    einheitliche Pauschsteuer and die Bundesknapp-' (59,51)
      print '    schaft abgeführt wird.' (60,51)
      print '**) Zutreffendes ankreuzen'                 (61,51)
      alter-printer
      font = 4
      point-size = 16
      print 'KNAPPSCHAFT' (64,6)
      alter-printer
      font = 4
      point-size = 9
      print 'Einzugsstellennummer: 980 0000 6' (67,6)  bold
      print 'Commerzbank, Cottbus'                (69,6)
      print 'Konto 1 566 066, BLZ 180 400 00'     (70,6)
      print 'Deutsche Bank, Cottbus'              (71,6)
      print 'Konto 5 110 382, BLZ 120 700 00'     (72,6)
      print 'Dresdner Bank, Cottbus'              (69,45)
      print 'Konto 187 822 000, BLZ 180 800 00'   (70,45)
      print 'SEB, Essen'                          (71,45)
      print 'Konto 1 828 141 200, BLZ 360 101 11' (72,45)
      print 'WestLB, Dortmund'                    (69,75)
      print 'Konto 666 644, BLZ 440 500 00'       (70,75)
      alter-printer
      font = 4
      point-size = 8
      let $Strg1 = 'Bei Überweisungen bitten wir als Verwendungszweck Ihre Betriebsnummer ' ||
          'führend, also ohne Vorsätze anzugeben.'
      let $Strg2 = 'Bitte reichen Sie den Beitragsnachweis je nach Fälligkeit Ihrer Beiträge am 25. des ' ||
          'laufenden bzw. 15. des Folgemonats, bei Teilnahme am Lastschriftverfahren vier Arbeitstage ' ||
          'früher'
      let $Strg3 = 'ein.'
      print $Strg1 (74,6) bold
      print $Strg2 (76,6) bold
      print $Strg3 (77,6) bold
   end-if
   alter-printer
   font = 4
   point-size = 13
   if $PrintFormInsigBUK = 'N'
      if rtrim($SaveCurrency, ' ') = 'DEM'
         print 'X'       (30,87)
      end-if
      if rtrim($SaveCurrency, ' ') = 'EUR'
         print 'X'       (32,87)
      end-if
   end-if
     #debug show ' $EffDateTemp ' $EffDateTemp '   $PRD_END_DT = ' $PRD_END_DT   ' $Ctl_Curr_Pay_End_Dt = ' $Ctl_Curr_Pay_End_Dt ' $Emplid = ' $Emplid  '  #phase = ' #phase
   if rtrim($EffDateTemp, ' ') <> ''
!ADJ10- 1974722000 : use pay end date instead of last year.
!      do Get_Beg_Mnth($EffDateTemp,$curr_pay_beg)
!      do Get_End_Mnth($EffDateTemp,$curr_pay_end)
      do Get_Beg_Mnth($Ctl_Curr_Pay_End_Dt,$curr_pay_beg)
      do Get_End_Mnth($Ctl_Curr_Pay_End_Dt,$curr_pay_end)
      if #phase = 2
       do Get_Beg_Mnth($PRD_END_DT,$curr_pay_beg)
       do Get_End_Mnth($PRD_END_DT,$curr_pay_end)
      end-if

      do ConvertToComponents($curr_pay_beg,$ye1,$mo1,$da1)
      do ConvertToComponents($curr_pay_end,$ye2,$mo2,$da2)
          let $d1 = substr($da1,1,1)
          let $d2 = substr($da1,2,1)

          let $m1 = substr($mo1,1,1)
          let $m2 = substr($mo1,2,1)
          let $y1 = substr($ye1,1,1)
          let $y2 = substr($ye1,2,1)
          let $y3 = substr($ye1,3,1)
          let $y4 = substr($ye1,4,1)
          print $d1  (8,74)
          print $d2  (8,77)
          print $m1  (8,84)
          print $m2  (8,87)
          print $y1  (8,94)
          print $y2  (8,97)
          print $y3  (8,100)
          print $y4  (8,103)
          let $d1 = substr($da2,1,1)
          let $d2 = substr($da2,2,1)
          let $m1 = substr($mo2,1,1)
          let $m2 = substr($mo2,2,1)
          let $y1 = substr($ye2,1,1)
          let $y2 = substr($ye2,2,1)
          let $y3 = substr($ye2,3,1)
          let $y4 = substr($ye2,4,1)
          print $d1  (10,74)
          print $d2  (10,77)
          print $m1  (10,84)
          print $m2  (10,87)
          print $y1  (10,94)
          print $y2  (10,97)
          print $y3  (10,100)
          print $y4  (10,103)
   end-if
  if $PrintFormInsigBUK = 'N'
           if $Korr = 'Y'
              print 'X' (26,103)
           end-if

           !wdu-qk04: Wertguthaben aus abgelaufenen Kalenderjahren (Stoerfall)
           !
           ! wdu05b7: $StoerFall changed to $StoerfallKK: a Stoerfall happened within the list for this provider
           !if $StoerfallKK = 'Y'
              !this check box is always and default unchecked !print 'X' (23,103)              
           !end-if
  end-if
!adj08-890b16: Contr. previous year
  if $Korr = 'Y'
   print 'X' (26,103)
  end-if

#debug show 'printing step for Stoerfall-Flag -- if we have Stoerfall.'

end-procedure



!****************************************************************
begin-procedure Init-Sum-Vars-Nachweis
   !init sum vars
   let #S_SUM_1000 = 0
   let #S_SUM_2000 = 0
   let #S_SUM_3000 = 0
   let #S_SUM_6000 = 0
   let #S_SUM_0100 = 0
   let #S_SUM_0200 = 0
   let #S_SUM_0300 = 0
   let #S_SUM_0400 = 0
   let #S_SUM_0500 = 0
   let #S_SUM_0600 = 0
   let #S_SUM_0010 = 0
   let #S_SUM_0020 = 0
   let #S_SUM_0001 = 0
   let #S_U1       = 0
   let #S_U2       = 0
   let #S_SUM_FKV  = 0
   let #S_SUM_FPV  = 0
   let #S_SUM      = 0
   let #S_SUM2     = 0
   let #S_Total    = 0
   let #S_SUM_ST   = 0
end-procedure
!****************************************************************
begin-procedure Get_Before_After_Comma(#Num_In,$Format,:$Num1_Out,:$Num2_Out)
do format-number(#Num_In,$Num_In,$Format)

let #Del_Loc  = instr($Num_In,$_SDecimal,1)
let $Num1_Out = substr($Num_In,1,-1 + #Del_Loc)
let $Num2_Out = substr($Num_In,1 + #Del_Loc,2)

end-procedure
!****************************************************************
begin-procedure Print-Numbers-Nachweis
   do Header-Nachweis
   let $NoSum = 'Y'
   let #S_SUM_1000 = #sv_sum_1000
   let #S_SUM_2000 = #sv_sum_2000
   let #S_SUM_3000 = #sv_sum_3000
   let #S_SUM_6000 = #sv_sum_6000
   let #S_SUM_0100 = #sv_sum_0100
   let #S_SUM_0200 = #sv_sum_0200
   let #S_SUM_0300 = #sv_sum_0300
   let #S_SUM_0400 = #sv_sum_0400
   let #S_SUM_0500 = #sv_sum_0500
   let #S_SUM_0600 = #sv_sum_0600
   let #S_SUM_0010 = #sv_sum_0010
   let #S_SUM_0020 = #sv_sum_0020
   let #S_SUM_0001 = #sv_sum_0001
   let #S_U1       = #sv_sum_u1
   let #S_U2       = #sv_sum_u2
   let #S_SUM_FKV  = #sv_KV_Freiw_Sum
   let #S_SUM_FPV  = #sv_PV_Freiw_Sum
   let #S_SUM_ST   = #SV_SUM_St
   let #S_SUM_0050 = #UML_INSOLV_Sum_1
!wdu-qk04: #s_sum is not populated for BUK because of this
if $PrintFormInsigBUK = 'N'
   ! if not Bundesknappschaft
   alter-printer
   font = 3
   point-size = 15
   do format-number(#S_SUM_1000,$number,'B9,999,999,999,999.99')
   print $number                   (35,78)
   do format-number(#S_SUM_2000,$number,'B9,999,999,999,999.99')
   print $number                   (37,78)
   do format-number(#S_SUM_3000,$number,'B9,999,999,999,999.99')
   print $number                   (39,78)
   do format-number(#S_SUM_6000,$number,'B9,999,999,999,999.99')
   print $number                   (41,78)
   do format-number(#S_SUM_0100,$number,'B9,999,999,999,999.99')
   print $number                   (43,78)
   do format-number(#S_SUM_0200,$number,'B9,999,999,999,999.99')
   print $number                   (45,78)
   do format-number(#S_SUM_0300,$number,'B9,999,999,999,999.99')
   print $number                   (47,78)
   do format-number(#S_SUM_0400,$number,'B9,999,999,999,999.99')
   print $number                   (49,78)
   do format-number(#S_SUM_0500,$number,'B9,999,999,999,999.99')
   print $number                   (51,78)
   do format-number(#S_SUM_0600,$number,'B9,999,999,999,999.99')
   print $number                   (53,78)
   do format-number(#S_SUM_0010,$number,'B9,999,999,999,999.99')
   print $number                   (55,78)
   do format-number(#S_SUM_0020,$number,'B9,999,999,999,999.99')
   print $number                   (57,78)
!adj08-890b16 : RI insolvency
   do Format-Number(#S_SUM_0050,$number,'B9,999,999,999,999.99')
   print $number                   (59,78)
   do format-number(#S_SUM_0001,$number,'B9,999,999,999,999.99')
   print $number                   (61,78)
   do format-number(#S_U1,$number,'B9,999,999,999,999.99')
   print $number                   (63,78)
   do format-number(#S_U2,$number,'B9,999,999,999,999.99')
   print $number                   (65,78)
   let #S_SUM = #S_SUM_1000 + #S_SUM_2000 + #S_SUM_3000 + #S_SUM_0001
               + #S_SUM_0100 + #S_SUM_0200 + #S_SUM_0010 + #S_SUM_0300
               + #S_SUM_0400 + #S_SUM_0020 + #S_U1 + #S_U2
               + #S_SUM_6000 + #S_SUM_0500 + #S_SUM_0600 + #S_SUM_0050 
   do format-number(#S_SUM,$number,'99,999,999,999,999.99')
   if rtrim(ltrim($number, ' '), ' ') = $MinusNull
      let $number = '                 ' || $PlusNull
   end-if
   print $number                   (67,78)
   do format-number(#S_SUM_FKV,$number,'B9,999,999,999,999.99')
   print $number                   (69,78)
   do format-number(#S_SUM_FPV,$number,'B9,999,999,999,999.99')
   print $number                   (71,78)
   do format-number(#S_SUM_U3,$number,'B9,999,999,999,999.99')
   print $number                   (73,78)
   let #S_SUM2 = #S_SUM_FKV + #S_SUM_FPV
   let #S_Total = #S_SUM + #S_SUM2
   do format-number(#S_Total,$number,'99,999,999,999,999.99')
   if rtrim(ltrim($number, ' '), ' ') = $MinusNull
      let $number = '                 ' || $PlusNull
   end-if
   print $number                   (75,78) ! last row sum
else
   ! if Bundesknappschaft:
   alter-printer
     font= 3
     point-size = 14
   let $Format = 'B9,999,999,999,999.99'
   do Get_Before_After_Comma(#S_SUM_6000,$Format,$number1,$number2)
   print $number1                   (35,77)
   print $number2                   (35,102)
   do Get_Before_After_Comma(#S_SUM_0100,$Format,$number1,$number2)
   print $number1                   (37,77)
   print $number2                   (37,102)
   do Get_Before_After_Comma(#S_SUM_0200,$Format,$number1,$number2)
   print $number1                   (39,77)
   print $number2                   (39,102)
   do Get_Before_After_Comma(#S_SUM_0500,$Format,$number1,$number2)
   print $number1                   (41,77)
   print $number2                   (41,102)
   do Get_Before_After_Comma(#S_SUM_0600,$Format,$number1,$number2)
   print $number1                   (43,77)
   print $number2                   (43,102)
!adj08-890b16 : RI insolvency
   do Get_Before_After_Comma(#S_SUM_0050,$Format,$number1,$number2)
   print $number1                   (45,77)
   print $number2                   (45,102)
   do Get_Before_After_Comma(#S_U1,$Format,$number1,$number2)
   print $number1                   (47,77)
   print $number2                   (47,102)
   do Get_Before_After_Comma(#S_U2,$Format,$number1,$number2)
   print $number1                   (49,77)
   print $number2                   (49,102)
   do Get_Before_After_Comma(#SV_SUM_St,$Format,$number1,$number2)
   print $number1                   (51,77)
   print $number2                   (51,102)
   let #SV_SUM = #S_SUM_0100 + #S_SUM_0200 + #S_U1 + #S_U2
               + #S_SUM_6000 + #S_SUM_0500 + #S_SUM_0600 + #SV_SUM_St + #S_SUM_0050
   !wdu-qk04: fix for EBNA disk, seems like #s_sum needs to be populated as well
   let #S_SUM = #SV_SUM
   !wdu-qk04: need to verify if we really need two sets of vars and why
   do Get_Before_After_Comma(#SV_SUM,$Format,$number1,$number2)
   if ltrim($number1,' ') = '' and ltrim($number2,' ') = ''
      let $number1 = '                 0'
      let $number2 = '00'
   end-if
   print $number1                   (53,77)
   print $number2                   (53,102)
   let #SV_Total = #SV_SUM
   let #S_Total = #SV_SUM
   do Get_Before_After_Comma(#SV_Total, $Format,$number1,$number2)
   if ltrim($number1,' ') = '' and ltrim($number2,' ') = ''
      let $number1 = '                 0'
      let $number2 = '00'
   end-if
   print $number1                   (57,77)
   print $number2                   (57,102)
 end-if
end-procedure
!**********************************************************************************






begin-procedure Print-Numbers-Nachweis_KVdR
   let #S_SUM_KVdR = #sv_sum_kvdr + #sv_sum_pv_kvdr1

   let $KV_Betr = translate(edit(#sv_sum_kvdr, 'B99999.99'), '.', '')
   let $PV_Betr = translate(edit(#sv_sum_pv_kvdr1, 'B99999.99'), '.', '')
   let $GesSum  = translate(edit(#S_SUM_KVdR, 'B99999.99'), '.', '')

   alter-printer
      font = 4
      point-size = 14
   do Get-Provider-Data($EffDateTemp, $GPDE_SI_PROV_MAND_save,$KK_Name,$KK_Nummer,$KK_Street,$KK_ZipCity,
      $Health_Rate_East,$Health_Rate_West,$Beitragskonto,$Zahlstellen_nr,$Ctl_PayEntity)

   if ((rtrim($Beitragskonto, ' ') = '') and (rtrim($Zahlstellen_nr, ' ') = ''))
      do Get-SI_PRV_ACCT_DEU($GPDE_SI_PROV_MAND_save,$EffDateTemp,$Ctl_PayEntity,
      $Beitragskonto, $Zahlstellen_nr)
   end-if
   do GetTaxNumber

   print $Adresse_ArbG         (4,6) WRAP 65 2 keep-top
   graphic (2,{col0n},100)  horz-line 2

   print 'Zahlstellen-Nr.:'  (4,68)
   graphic (4,68,1)        vert-line 2
   graphic (4,71,1)        vert-line 2
   graphic (5,68,3)        horz-line 2
   graphic (4,72,1)        vert-line 2
   graphic (4,75,1)        vert-line 2
   graphic (5,72,3)        horz-line 2
   graphic (4,76,1)        vert-line 2
   graphic (4,79,1)        vert-line 2
   graphic (5,76,3)        horz-line 2
   graphic (4,80,1)        vert-line 2
   graphic (4,83,1)        vert-line 2
   graphic (5,80,3)        horz-line 2
   graphic (4,84,1)        vert-line 2
   graphic (4,87,1)        vert-line 2
   graphic (5,84,3)        horz-line 2
   graphic (4,88,1)        vert-line 8
   graphic (4,91,1)        vert-line 8
   graphic (5,88,3)        horz-line 8
   graphic (4,92,1)        vert-line 8
   graphic (4,95,1)        vert-line 8
   graphic (5,92,3)        horz-line 8
   graphic (4,96,1)        vert-line 8
   graphic (4,99,1)        vert-line 8
   graphic (5,96,3)        horz-line 8

   let $ZahlSt = rtrim(ltrim($hdr_abr_zahlstellen_nr,' '),' ')
   let $ZahlSt1 = lpad($ZahlSt,8,' ')
   let $a1 = substr($ZahlSt1,1,1)
   let $a2 = substr($ZahlSt1,2,1)
   let $a3 = substr($ZahlSt1,3,1)
   let $a4 = substr($ZahlSt1,4,1)
   let $a5 = substr($ZahlSt1,5,1)
   let $a6 = substr($ZahlSt1,6,1)
   let $a7 = substr($ZahlSt1,7,1)
   let $a8 = substr($ZahlSt1,8,1)
   print $a1 (5,69)
   print $a2 (5,73)
   print $a3 (5,77)
   print $a4 (5,81)
   print $a5 (5,85)
   print $a6 (5,89)
   print $a7 (5,93)
   print $a8 (5,97)
   graphic (7,{col0n},100)  horz-line 2

   print 'Zeitraum:'  (9,68)
   print 'vom:'  (10,68)
   print 'bis:'  (12,68)
   graphic (9,74,1)        vert-line 2
   graphic (9,77,1)        vert-line 2
   graphic (10,74,3)        horz-line 2
   graphic (9,78,1)        vert-line 2
   graphic (9,81,1)        vert-line 2
   graphic (10,78,3)        horz-line 2
   graphic (9,82,1)        vert-line 2
   graphic (9,85,1)        vert-line 2
   graphic (10,82,3)        horz-line 2
   graphic (9,86,1)        vert-line 2
   graphic (9,89,1)        vert-line 2
   graphic (10,86,3)        horz-line 2
   graphic (9,90,1)        vert-line 2
   graphic (9,93,1)        vert-line 2
   graphic (10,90,3)        horz-line 2
   graphic (9,93,1)        vert-line 8
   graphic (9,96,1)        vert-line 8
   graphic (10,93,3)        horz-line 8
   graphic (9,96,1)        vert-line 8
   graphic (9,99,1)        vert-line 8
   graphic (10,96,3)        horz-line 8
   graphic (9,99,1)        vert-line 8
   graphic (9,102,1)        vert-line 8
   graphic (10,99,3)        horz-line 8

   graphic (11,74,1)        vert-line 2
   graphic (11,77,1)        vert-line 2
   graphic (12,74,3)        horz-line 2
   graphic (11,78,1)        vert-line 2
   graphic (11,81,1)        vert-line 2
   graphic (12,78,3)        horz-line 2
   graphic (11,82,1)        vert-line 2
   graphic (11,85,1)        vert-line 2
   graphic (12,82,3)        horz-line 2
   graphic (11,86,1)        vert-line 2
   graphic (11,89,1)        vert-line 2
   graphic (12,86,3)        horz-line 2
   graphic (11,90,1)        vert-line 2
   graphic (11,93,1)        vert-line 2
   graphic (12,90,3)        horz-line 2
   graphic (11,96,1)        vert-line 8
   graphic (12,93,3)        horz-line 8
   graphic (11,96,1)        vert-line 8
   graphic (11,99,1)        vert-line 8
   graphic (12,96,3)        horz-line 8
   graphic (11,99,1)        vert-line 8
   graphic (11,102,1)        vert-line 8
   graphic (12,99,3)        horz-line 8
!adj08-890b16: Contr. previous year
    print 'Korrektur-Beitragsnachweis'                  (25,68)
    print 'für abgelaufene Kalenderjahre *)'            (26,68)
    graphic (26,102,3)  box 1 14
   if $Korr = 'Y'
     print 'X' (26,103)
   end-if

   if rtrim($EffDateTemp, ' ') <> ''
!ADJ10- 1974722000 : use pay end date instead of last year.
      do Get_Beg_Mnth($Ctl_Curr_Pay_End_Dt,$curr_pay_beg)
      do Get_End_Mnth($Ctl_Curr_Pay_End_Dt,$curr_pay_end)
      if #phase = 2
       do Get_Beg_Mnth($PRD_END_DT,$curr_pay_beg)
       do Get_End_Mnth($PRD_END_DT,$curr_pay_end)
      end-if
      do ConvertToComponents($curr_pay_beg,$ye1,$mo1,$da1)
      do ConvertToComponents($curr_pay_end,$ye2,$mo2,$da2)
          let $d1 = substr($da1,1,1)
          let $d2 = substr($da1,2,1)

          let $m1 = substr($mo1,1,1)
          let $m2 = substr($mo1,2,1)
          let $y1 = substr($ye1,1,1)
          let $y2 = substr($ye1,2,1)
          let $y3 = substr($ye1,3,1)
          let $y4 = substr($ye1,4,1)
          print $d1  (10,75)
          print $d2  (10,79)
          print $m1  (10,83)
          print $m2  (10,87)
          print $y1  (10,91)
          print $y2  (10,94)
          print $y3  (10,97)
          print $y4  (10,100)
          let $d1 = substr($da2,1,1)
          let $d2 = substr($da2,2,1)
          let $m1 = substr($mo2,1,1)
          let $m2 = substr($mo2,2,1)
          let $y1 = substr($ye2,1,1)
          let $y2 = substr($ye2,2,1)
          let $y3 = substr($ye2,3,1)
          let $y4 = substr($ye2,4,1)
          print $d1  (12,75)
          print $d2  (12,79)
          print $m1  (12,83)
          print $m2  (12,87)
          print $y1  (12,91)
          print $y2  (12,94)
          print $y3  (12,97)
          print $y4  (12,100)
   end-if


  let $Prov_Nm = rtrim($GPDE_SI_PROV_MAND_save,' ')
   if $PrintFormInsigBUK = 'N'
      print $Prov_Nm                (10,6)
      print $KK_Name                (15,6)
      print $KK_Street              (16,6)
      print $KK_ZipCity             (18,6)
   else
      print 'Bundesknappschaft'     (15,6) bold
      print '45115 Essen'           (17,6) bold
   end-if


   print 'Krankenkassen-'  (15,68)
   print 'Betriebs-Nr.:'  (16,68)
   graphic (16,68,1)        vert-line 2
   graphic (16,71,1)        vert-line 2
   graphic (17,68,3)        horz-line 2
   graphic (16,72,1)        vert-line 2
   graphic (16,75,1)        vert-line 2
   graphic (17,72,3)        horz-line 2
   graphic (16,76,1)        vert-line 2
   graphic (16,79,1)        vert-line 2
   graphic (17,76,3)        horz-line 2
   graphic (16,80,1)        vert-line 2
   graphic (16,83,1)        vert-line 2
   graphic (17,80,3)        horz-line 2
   graphic (16,84,1)        vert-line 2
   graphic (16,87,1)        vert-line 2
   graphic (17,84,3)        horz-line 2
   graphic (16,88,1)        vert-line 8
   graphic (16,91,1)        vert-line 8
   graphic (17,88,3)        horz-line 8
   graphic (16,92,1)        vert-line 8
   graphic (16,95,1)        vert-line 8
   graphic (17,92,3)        horz-line 8
   graphic (16,96,1)        vert-line 8
   graphic (16,99,1)        vert-line 8
   graphic (17,96,3)        horz-line 8

   let $KassBetrNr = rtrim(ltrim($hdr_abr_kk_nummer,' '),' ')
   let $KassSt1 = lpad($KassBetrNr,8,' ')
   let $a1 = substr($KassSt1,1,1)
   let $a2 = substr($KassSt1,2,1)
   let $a3 = substr($KassSt1,3,1)
   let $a4 = substr($KassSt1,4,1)
   let $a5 = substr($KassSt1,5,1)
   let $a6 = substr($KassSt1,6,1)
   let $a7 = substr($KassSt1,7,1)
   let $a8 = substr($KassSt1,8,1)
   print $a1  (17,69)
   print $a2  (17,73)
   print $a3  (17,77)
   print $a4  (17,81)
   print $a5  (17,85)
   print $a6  (17,89)
   print $a7  (17,93)
   print $a8  (17,97)
   alter-printer
      font = 4
      point-size = 16
   print 'Beitragsnachweis für Versorgungsempfänger' (32,{col0n}) bold
   alter-printer
      font = 4
      point-size = 13
   print 'Beitrags-'        (38,50)
   print 'Gesamtbeitrag'    (38,80)
   print 'satz'             (39,50)
   print 'Beiträge zur'     (40,{col0n})
   print 'v.H.'             (40,50)

   graphic (40,80,2) box 1 2
   graphic (40,97,2) box 1 2
   if rtrim($SaveCurrency, ' ') = 'DEM'
      print 'X'       (40,80)
   end-if
   if rtrim($SaveCurrency, ' ') = 'EUR'
      print 'X'       (40,97)
   end-if
   print 'DM/Pf*'           (40,83)
   print 'EUR/Cent*'        (40,100)

   print '-  Krankenversicherung' (42,{col0n})

   graphic (41,50,1)        vert-line 2
   graphic (41,53,1)        vert-line 2
   graphic (42,50,3)        horz-line 2
   graphic (41,54,1)        vert-line 2
   graphic (41,57,1)        vert-line 2
   graphic (42,54,3)        horz-line 2
   graphic (41,58,1)        vert-line 2
   graphic (41,61,1)        vert-line 2
   graphic (42,58,3)        horz-line 2
   graphic (41,62,1)        vert-line 2
   graphic (41,65,1)        vert-line 2
   graphic (42,62,3)        horz-line 2
   let $BeitrTemp = translate($hdr_abr_per_kvdr, '.', '')
   let $BeitrTemp1 = translate($BeitrTemp, ',', '')
   let $BeitrTemp = rtrim(ltrim($BeitrTemp1,' '),' ')
   let $BeitrTemp1 = lpad($BeitrTemp,4,' ')
   let $a1 = substr($BeitrTemp1,1,1)
   let $a2 = substr($BeitrTemp1,2,1)
   let $a3 = substr($BeitrTemp1,3,1)
   let $a4 = substr($BeitrTemp1,4,1)
   print $a1  (42,51)
   print $a2  (42,55)
   print ','  (42,57)
   print $a3  (42,59)
   print $a4  (42,63)

   graphic (41,80,1)        vert-line 2
   graphic (41,83,1)        vert-line 2
   graphic (42,80,3)        horz-line 2
   graphic (41,84,1)        vert-line 2
   graphic (41,87,1)        vert-line 2
   graphic (42,84,3)        horz-line 2
   graphic (41,88,1)        vert-line 2
   graphic (41,91,1)        vert-line 2
   graphic (42,88,3)        horz-line 2
   graphic (41,92,1)        vert-line 2
   graphic (41,95,1)        vert-line 2
   graphic (42,92,3)        horz-line 2
   graphic (41,96,1)        vert-line 2
   graphic (41,99,1)        vert-line 2
   graphic (42,96,3)        horz-line 2
   graphic (41,100,1)        vert-line 8
   graphic (41,103,1)        vert-line 8
   graphic (42,100,3)        horz-line 8
   graphic (41,104,1)        vert-line 8
   graphic (41,107,1)        vert-line 8
   graphic (42,104,3)        horz-line 8
   graphic (41,108,1)        vert-line 8
   graphic (41,111,1)       vert-line 8
   graphic (42,108,3)        horz-line 8
   let $a1 = substr($KV_Betr,1,1)
   let $a2 = substr($KV_Betr,2,1)
   let $a3 = substr($KV_Betr,3,1)
   let $a4 = substr($KV_Betr,4,1)
   let $a5 = substr($KV_Betr,5,1)
   let $a6 = substr($KV_Betr,6,1)
   let $a7 = substr($KV_Betr,7,1)
   let $a8 = substr($KV_Betr,8,1)
   print $a1 (42,81)
   print $a2 (42,85)
   print $a3 (42,89)
   print '.' (42,91)
   print $a4 (42,93)
   print $a5 (42,97)
   print $a6 (42,101)
   print ',' (42,103)
   print $a7 (42,105)
   print $a8 (42,109)

   print '-  Pflegeversicherung' (44,{col0n})
   graphic (43,50,1)        vert-line 2
   graphic (43,53,1)        vert-line 2
   graphic (44,50,3)        horz-line 2
   graphic (43,54,1)        vert-line 2
   graphic (43,57,1)        vert-line 2
   graphic (44,54,3)        horz-line 2
   graphic (43,58,1)        vert-line 2
   graphic (43,61,1)        vert-line 2
   graphic (44,58,3)        horz-line 2
   graphic (43,62,1)        vert-line 2
   graphic (43,65,1)        vert-line 2
   graphic (44,62,3)        horz-line 2
   let $BeitrTemp = translate($hdr_abr_per_pv_kvdr1, '.', '')
   let $BeitrTemp1 = translate($BeitrTemp, ',', '')
   let $BeitrTemp = rtrim(ltrim($BeitrTemp1,' '),' ')
   let $BeitrTemp1 = lpad($BeitrTemp,4,' ')
   let $a1 = substr($BeitrTemp1,1,1)
   let $a2 = substr($BeitrTemp1,2,1)
   let $a3 = substr($BeitrTemp1,3,1)
   let $a4 = substr($BeitrTemp1,4,1)
   print $a1  (44,51)
   print $a2  (44,55)
   print ','  (44,57)
   print $a3  (44,59)
   print $a4  (44,63)

   graphic (43,80,1)        vert-line 2
   graphic (43,83,1)        vert-line 2
   graphic (44,80,3)        horz-line 2
   graphic (43,84,1)        vert-line 2
   graphic (43,87,1)        vert-line 2
   graphic (44,84,3)        horz-line 2
   graphic (43,88,1)        vert-line 2
   graphic (43,91,1)        vert-line 2
   graphic (44,88,3)        horz-line 2
   graphic (43,92,1)        vert-line 2
   graphic (43,95,1)        vert-line 2
   graphic (44,92,3)        horz-line 2
   graphic (43,96,1)        vert-line 2
   graphic (43,99,1)        vert-line 2
   graphic (44,96,3)        horz-line 2
   graphic (43,100,1)        vert-line 8
   graphic (43,103,1)        vert-line 8
   graphic (44,100,3)        horz-line 8
   graphic (43,104,1)        vert-line 8
   graphic (43,107,1)        vert-line 8
   graphic (44,104,3)        horz-line 8
   graphic (43,108,1)        vert-line 8
   graphic (43,111,1)       vert-line 8
   graphic (44,108,3)        horz-line 8
   graphic (45,80,31)        horz-line 8
   let $a1 = substr($PV_Betr,1,1)
   let $a2 = substr($PV_Betr,2,1)
   let $a3 = substr($PV_Betr,3,1)
   let $a4 = substr($PV_Betr,4,1)
   let $a5 = substr($PV_Betr,5,1)
   let $a6 = substr($PV_Betr,6,1)
   let $a7 = substr($PV_Betr,7,1)
   let $a8 = substr($PV_Betr,8,1)
   print $a1 (44,81)
   print $a2 (44,85)
   print $a3 (44,89)
   print '.' (44,91)
   print $a4 (44,93)
   print $a5 (44,97)
   print $a6 (44,101)
   print ',' (44,103)
   print $a7 (44,105)
   print $a8 (44,109)
   print 'Gesamtsumme'           (51,{col0n})
   graphic (50,80,1)        vert-line 2
   graphic (50,83,1)        vert-line 2
   graphic (51,80,3)        horz-line 2
   graphic (50,84,1)        vert-line 2
   graphic (50,87,1)        vert-line 2
   graphic (51,84,3)        horz-line 2
   graphic (50,88,1)        vert-line 2
   graphic (50,91,1)        vert-line 2
   graphic (51,88,3)        horz-line 2
   graphic (50,92,1)        vert-line 2
   graphic (50,95,1)        vert-line 2
   graphic (51,92,3)        horz-line 2
   graphic (50,96,1)        vert-line 2
   graphic (50,99,1)        vert-line 2
   graphic (51,96,3)        horz-line 2
   graphic (50,100,1)        vert-line 8
   graphic (50,103,1)        vert-line 8
   graphic (51,100,3)        horz-line 8
   graphic (50,104,1)        vert-line 8
   graphic (50,107,1)        vert-line 8
   graphic (51,104,3)        horz-line 8
   graphic (50,108,1)        vert-line 8
   graphic (50,111,1)       vert-line 8
   graphic (51,108,3)        horz-line 8
   let $a1 = substr($GesSum,1,1)
   let $a2 = substr($GesSum,2,1)
   let $a3 = substr($GesSum,3,1)
   let $a4 = substr($GesSum,4,1)
   let $a5 = substr($GesSum,5,1)
   let $a6 = substr($GesSum,6,1)
   let $a7 = substr($GesSum,7,1)
   let $a8 = substr($GesSum,8,1)

   if $a6 = ' ' and $a7 = ' ' and $a8 = ' '
      let $a6 = '0'
      let $a7 = '0'
      let $a8 = '0'
   end-if
   print $a1 (51,81)
   print $a2 (51,85)
   print $a3 (51,89)
   print '.' (51,91)
   print $a4 (51,93)
   print $a5 (51,97)
   print $a6 (51,101)
   print ',' (51,103)
   print $a7 (51,105)
   print $a8 (51,109)


   graphic (60,{col0n},50)        horz-line 8
   print 'Datum, Unterschrift**' (61,{col0n})
   print $hdr_abr_header_date    (60,{col0n})
   print '*zutreffendes bitte ankreuzen'  (67,{col0n})
   print '**Bei maschinell erstelltem Beitragsnachweis kann von der Unterschrift abgesehen werden.'  (68,{col0n})

end-procedure
!**********************************************************************************
begin-procedure Print_Start_Record
    if $Is_KVdR <> 'Y'
        let $ST2 = 'BWNAC'     !5
    else
        let $ST2 = 'BWBNV'     !5
    end-if
    if $provider_type = '08'
        let $ST2 = 'BVBEI'
    end-if
    let #LaufNum = 0
    let #Total_SUM = 0
    let $ST1 = 'VOSZ'      !4
    ! wdu06-881kug: main BTNR from PayEntity ($PayentBtnr) for VOSZ and DSKO
    ! -- let $ST3 = rtrim(ltrim($hdr_abr_GPDE_DO_BTNR,' '),' ') !15
    let $ST3 = rtrim(ltrim($PayentBtnr,' '),' ') !15

    let $ST3 = rpad($ST3, 15, ' ')
    let $ST4 = rtrim(ltrim($GPDE_DV_RCVER_ID,' '),' ')  !15
    let $ST4 = rpad($ST4, 15, ' ')
    do ConvertToComponents($AsOfToday,$YT,$MT,$DT)    
    let $ST5  = $YT || $MT || $DT                   !8
    move #FileNumber to $ST6 099999                 !6
    
    let $ST7 = rtrim(ltrim($PayentityName,' '),' ') !50                
    let $ST8 = '06'                                 !2    
    if $provider_type <> '08'
        write 10 from $ST1:4 $ST2:5 $ST3:15 $ST4:15 $ST5:8 $ST6:6 $ST7:50 $ST8:2
    end-if
end-procedure







!**********************************************************************************
!wdu-qk04 analysis
begin-procedure Print_Main_Record
  if $Is_KVdR <> 'Y'
    let #LaufNum = #LaufNum + 1
    let $MN1 = 'BW02'  !4
    let $MN2 = 'BWNAC' !5
    !Betriebsnr Ersteller

    ! wdu06-881kug: main BTNR from PayEntity ($PayentBtnr) for VOSZ and DSKO
    ! -- this is the pay-entity (010-024), (043-057) is the employer!
    ! -- let $MN3 = rtrim(ltrim($hdr_abr_GPDE_DO_BTNR,' '),' ') !15
    let $MN3 = rtrim(ltrim($PayentBtnr,' '),' ') !15
    let $MN3 = rpad($MN3, 15, ' ')
        
    !Betriebsnummer KK
    let $MN4 = rtrim(ltrim($KK_Nummer,' '),' ') !15
    let $MN4 = rpad($MN4, 15, ' ')
    
    move '10' to $MN5    
    
    do Format-DateTime($sysdatetime,$DATUM, {DEFCMP},'time','')    
    let $DATUM = $DATUM || '000000'
    let $MN6 = $DATUM !20
    let $MN7 = '0'
    let $MN8 = '0'
    let $MN9 = '' !20
    let $MN9 = rpad($MN9, 20, ' ')
    let $MN10 = '' !20
    let $MN10 = rpad($MN10, 20, ' ')
    
    !Typkennzeichen 1=Dauer Beit.nachweis/15, 3=Dauerbeitnachweis/25
!adj08:normal contribution report, display 0
    let $MN11 = '0'
!    if $Korr = 'Y'
!      if $Maturity = 'N'
!         let $MN5 = '1'                      !1
!      else
!         let $MN5 = '3'                      !1
!      end-if
!    else
!      if $Maturity = 'N'
!         let $MN5 = '0'
!      else
!         let $MN5 = '2'
!      end-if
!    end-if
    !Correction mode
!adj08-890b16: Contr. previous year
!ADJ10- 1974722000 - commented year condition.
!     if $Korr = 'Y' and #phase = 2 ! and $yy09 = '2009'
!       let $MN12 = '1'
!     else
        let $MN12 = '0'
!     end-if
!    if $Korr <> 'Y'
!       let $MN6 = '0'
!    else
!       let $MN6 = '1'
!    end-if
    !Kennz Wertguthaben
    !This value is always zero as per record structure
    let $MN13 = '0'
    

    !Betriebsnr Arbeitgeber
    ! wdu06-881kug: main BTNR from PayEntity ($PayentBtnr) for VOSZ and DSKO
    ! -- wrong: we are currently reporting per payentity, so the numbers are the same!
    ! -- this is the employer-BTNR
    ! -- no: let $MN8 = $MN3  !15
    let $MN14 = rtrim(ltrim($hdr_abr_GPDE_DO_BTNR,' '),' ') !15
    let $MN14 = rpad($MN14, 15, ' ')

    !Begin-date(9), End-Date(10)
    if $Korr = 'Y'
!ADJ10- 1974722000 : use pay end date instead of last year.
!       do ConvertToComponents($EffDateTemp,$YE,$ME,$DE)
       do ConvertToComponents($Ctl_Curr_Pay_End_Dt,$YE,$ME,$DE)
      if #phase = 2
       do ConvertToComponents($PRD_END_DT,$YE,$ME,$DE)
      end-if
       
       let $MN15  =  $YE || '0000'                   !8
       
       let $MN16  = $MN15                           !8
    else
       let $MN15  = $ye1 || $mo1 || $da1            !8
       let $MN16  = $ye2 || $mo2 || $da2            !8
    end-if

    !KV allg -- Amount#01
    if #S_SUM_1000 < 0
       let $MN17 = '-'   !1       
       let #MN18 = -1 * #S_SUM_1000       
    else
       let $MN17 = '+'       
       let #MN18 = #S_SUM_1000    
    end-if    
    let $MN18 = translate(edit(#MN18, '099999999.99'), '.', '')
    let $MN63 = $MN17
    let $MN64 = $MN18
    
    if #S_SUM_2000 < 0
       let $MN19 = '-'   !1
       let #MN20 = -1 * #S_SUM_2000
    else
       let $MN19 = '+'
       let #MN20 = #S_SUM_2000
    end-if
    let $MN20 = translate(edit(#MN20, '099999999.99'), '.', '')
!adj08-890b16 : Health Ins Rates
   if #phase = 1 and $yy09 >= '2009'
!increased contribution is '0' for 2009
       let $MN20 = '00000000000'
   end-if

    if #S_SUM_3000 < 0
       let $MN21 = '-'   !1
       let #MN22 = -1 * #S_SUM_3000       
    else
       let $MN21 = '+'
       let #MN22 = #S_SUM_3000       
    end-if
    
    let $MN22 = translate(edit(#MN22, '099999999.99'), '.', '')
    let $MN65 = $MN21
    let $MN66 = $MN22

    if #S_SUM_0001 < 0
       let $MN23 = '-'   !1
       let #MN24 = -1 * #S_SUM_0001
    else
       let $MN23 = '+'
       let #MN24 = #S_SUM_0001
    end-if
    let $MN24 = translate(edit(#MN24, '099999999.99'), '.', '')

    if #S_SUM_0100 < 0
       let $MN25 = '-'   !1
       let #MN26 = -1 * #S_SUM_0100
    else
       let $MN25 = '+'
       let #MN26 = #S_SUM_0100
    end-if
    let $MN26 = translate(edit(#MN26, '099999999.99'), '.', '')
    
    if #S_SUM_0200 < 0
       let $MN27 = '-'   !1
       let #MN28 = -1 * #S_SUM_0200
    else
       let $MN27 = '+'
       let #MN28 = #S_SUM_0200
    end-if
    let $MN28 = translate(edit(#MN28, '099999999.99'), '.', '')

    if #S_SUM_0010 < 0
       let $MN29 = '-'   !1
       let #MN30 = -1 * #S_SUM_0010
    else
       let $MN29 = '+'
       let #MN30 = #S_SUM_0010
    end-if
    let $MN30 = translate(edit(#MN30, '099999999.99'), '.', '')

    if #S_SUM_0300 < 0
       let $MN31 = '-'   !1
       let #MN32 = -1 * #S_SUM_0300
    else
       let $MN31 = '+'
       let #MN32 = #S_SUM_0300
    end-if
    let $MN32 = translate(edit(#MN32, '099999999.99'), '.', '')
!adj08-890b16: RI Insolvency
!print Insolvency Contr.
!    if #S_SUM_0400 < 0
!       let $MN27 = '-'   !1
!       let #MN28 = -1 * #S_SUM_0400
!    else
!       let $MN27 = '+'
!       let #MN28 = #S_SUM_0400
!    end-if
    if #S_SUM_0050 < 0
       let $MN33 = '-'   !1
       let #MN34 = -1 * #S_SUM_0050
    else
       let $MN33 = '+'
       let #MN34 = #S_SUM_0050
    end-if
    let $MN34 = translate(edit(#MN34, '099999999.99'), '.', '')


    !AV-AG -- Amount#10
    if #S_SUM_0020 < 0
       let $MN35 = '-'   !1
       let #MN36 = -1 * #S_SUM_0020
    else
       let $MN35 = '+'
       let #MN36 = #S_SUM_0020
    end-if
    let $MN36 = translate(edit(#MN36, '099999999.99'), '.', '')

    if #S_U1 < 0
       let $MN37 = '-'   !1
       let #MN38 = -1 * #S_U1
    else
       let $MN37 = '+'
       let #MN38 = #S_U1
    end-if
    let $MN38 = translate(edit(#MN38, '099999999.99'), '.', '')

    ! -- Amount#12
    if #S_U2 < 0
       let $MN39 = '-'   !1
       let #MN40 = -1 * #S_U2
    else
       let $MN39 = '+'
       let #MN40 = #S_U2
    end-if
    let $MN40 = translate(edit(#MN40, '099999999.99'), '.', '')

    if #S_SUM_6000 < 0
       let $MN41 = '-'   !1
       let #MN42 = -1 * #S_SUM_6000
    else
       let $MN41 = '+'
       let #MN42 = #S_SUM_6000
    end-if
    let $MN42 = translate(edit(#MN42, '099999999.99'), '.', '')

    if #S_SUM_0500 < 0
       let $MN43 = '-'   !1
       let #MN44 = -1 * #S_SUM_0500
    else
       let $MN43 = '+'
       let #MN44 = #S_SUM_0500
    end-if
    let $MN44 = translate(edit(#MN44, '099999999.99'), '.', '')

    ! -- Amount#15
    if #S_SUM_0600 < 0
       let $MN45 = '-'   !1
       let #MN46 = -1 * #S_SUM_0600
    else
       let $MN45 = '+'
       let #MN46 = #S_SUM_0600
    end-if
    let $MN46 = translate(edit(#MN46, '099999999.99'), '.', '')

    ! Total -- Amount#16
    if #S_SUM < 0
       let $MN47 = '-'   !1
       let #MN48 = -1 * #S_SUM
    else
       let $MN47 = '+'
       let #MN48 = #S_SUM
    end-if
    let $MN48 = translate(edit(#MN48, '099999999.99'), '.', '')
    if #S_SUM_FKV < 0
       let $MN49 = '-'   !1
       let #MN50 = -1 * #S_SUM_FKV
    else
       let $MN49 = '+'
       let #MN50 = #S_SUM_FKV       
    end-if
    
    let $MN50 = translate(edit(#MN50, '099999999.99'), '.', '')
    let $MN67 = $MN49
    let $MN68 = $MN50
    
    if #S_SUM_FPV < 0
       let $MN51 = '-'   !1
       let #MN52 = -1 * #S_SUM_FPV
    else
       let $MN51 = '+'
       let #MN52 = #S_SUM_FPV
    end-if
    let $MN52 = translate(edit(#MN52, '099999999.99'), '.', '')
    if #S_SUM_U3 < 0
       let $MN53 = '-'   !1
       let #MN54 = -1 * #S_SUM_U3
    else
       let $MN53 = '+'
       let #MN54 = #S_SUM_U3
    end-if
    let $MN54 = translate(edit(#MN54, '099999999.99'), '.', '')
    let $MN55 = '+'
    move 0  to $MN56  09999999999 !Betrag1
    let $MN57 = '+'
    move 0  to $MN58  09999999999 !Betrag2
    let $MN59 = '+'
    move 0  to $MN60  09999999999 !Betrag3
    if #S_Total < 0
       let $MN61 = '-'   !1
       let #MN62 = -1 * #S_Total
    else
       let $MN61 = '+'
       let #MN62 = #S_Total
    end-if
    let $MN62 = translate(edit(#MN62, '099999999.99'), '.', '')
    !63 - 17, 64 - 18, 65-21, 66-22, 67-49, 68-50
    let $ArbGBez = rtrim($PayentityName,' ')
    let #LenArbG = length($ArbGBez)
    if #LenArbG > 30
       let $MN69 = substr($ArbGBez,1,30)
       let $MN70 = substr($ArbGBez,31,30)
       let $MN70 = lpad($MN70, 30, ' ')
    else
       let $MN69 = $ArbGBez
       let $MN70 = ' '
       let $MN69 = lpad($MN69, 30, ' ')
       let $MN70 = lpad($MN70, 30, ' ')
    end-if
    let $MN71 = rtrim($PayentityStreet,' ') || cond(rtrim($PoBox,' ') <> '', '/', '') ||
        rtrim($PoBox,' ')
    let $MN71 = lpad($MN71, 30, ' ')
    if rtrim($Nation,' ') <> ''
       let $MN72 = substr($Nation,1,1)
    else
       let $MN72 = '   '
    end-if    
    
    let $MN72 = rpad($MN72, 3, ' ')
    
    let $MN73 = $Post
    let $MN73 = lpad($MN73, 5, ' ')
    let $MN74 = $Cit
    let $MN74 = lpad($MN74, 25, ' ')
    let $MN75 = ' '  !Abrechnungsstelle 1
    let $MN76 = ' '  !Abrechnungsstelle 2
    let $MN77 = ' '  !Ordnungsmerkmal
    let $MN78 = ' '  !Verarbeitungsmerkmal
    let $MN79 = translate(edit(#per_kv_1000, '09.99'), '.', '')
    let $MN80 = translate(edit(#per_kv_2000, '09.99'), '.', '')
    let $MN81 = translate(edit(#per_kv_3000, '09.99'), '.', '')

!byar-90UpdA : Health Ins Rates
   if #phase = 1 and $yy09 >= '2011'
     let $MN79 = '1550'
     let $MN80 = '0000'
     let $MN81 = '1490'
   else
      !adj08-890b16 : Health Ins Rates
      if #phase = 1 and $yy09 >= '2009'
          let $MN79 = '1550'
          let $MN80 = '0000'
          let $MN81 = '1490'
          !adj09-89b18 : July Tax update
          if $HD_mm >'06' or $yy09 = '2010'
             let $MN79 = '1490'
             let $MN80 = '0000'
             let $MN81 = '1430'
          end-if
      end-if
   end-if
    if $RegionAct = '1'
       let $MN82 = 'O'
    else
       let $MN82 = 'W'
    end-if
    let $MN83 = '0'    
    
    if #LaufNum > 1 and #LaufNum < 10
       move #LaufNum to $MN84 099
    else
       move 0 to $MN84 099
    end-if
    
!adj08-890b16: RI Insolvency
    
    evaluate $SaveCurrency !$Actual_Curruncy_save
    when = 'DEM'
       let $MN85 = 'D'
       break
    when = 'EUR'
       let $MN85 = 'E'
       break
    when-other
       let $MN85 = ' '
       break
    end-evaluate
    if #S_SUM_ST < 0
       let $MN86 = '-'   !1
       let #MN87 = -1 * #S_SUM_ST
    else
       let $MN86 = '+'
       let #MN87 = #S_SUM_ST
    end-if
    let $MN87 = translate(edit(#MN87, '099999999.99'), '.', '')
    let $MN88 = rtrim(ltrim($TaxNumber,' '),' ') !20 Steuernummer ArbG
    let $MN88 = rpad($MN88, 20, ' ')
    !let $MN79 = 'E'    !Satzende
    if $provider_type <> '08'
    write 10 from $MN1:4  $MN2:5  $MN3:15  $MN4:15  $MN5:2  $MN6:20  $MN7:1  $MN8:1  $MN9:20  $MN10:20
                  $MN11:1 $MN12:1 $MN13:1 $MN14:15 $MN15:8 $MN16:8 $MN17:1 $MN18:11 $MN19:1 $MN20:11
                  $MN21:1 $MN22:11 $MN23:1 $MN24:11 $MN25:1 $MN26:11 $MN27:1 $MN28:11 $MN29:1 $MN30:11
                  $MN31:1 $MN32:11 $MN33:1 $MN34:11 $MN35:1 $MN36:11 $MN37:1 $MN38:11 $MN39:1 $MN40:11
                  $MN41:1 $MN42:11 $MN43:1 $MN44:11 $MN45:1 $MN46:11 $MN47:1 $MN48:11 $MN49:1 $MN50:11
                  $MN51:1 $MN52:11 $MN53:1 $MN54:11 $MN55:1 $MN56:11 $MN57:1 $MN58:11 $MN59:1 $MN60:11
                  $MN61:1 $MN62:11 $MN63:1 $MN64:11 $MN65:1 $MN66:11 $MN67:1 $MN68:11 $MN69:30 $MN70:30
                  $MN71:30 $MN72:3 $MN73:10 $MN74:25 $MN75:15 $MN76:15 $MN77:20 $MN78:1 $MN79:4 $MN80:4
                  $MN81:4 $MN82:1 $MN83:1 $MN84:3 $MN85:1 $MN86:1 $MN87:11 $MN88:20
    end-if
   let #Total_SUM = #Total_SUM + #S_Total
!kvdr = 'Y'
 else
   let #LaufNum = #LaufNum + 1
    let $MN1 = 'BW03'  !4
    let $MN2 = 'BWBNV' !5

    !Betriebsnr Ersteller

    ! wdu06-881kug: main BTNR from PayEntity ($PayentBtnr) for VOSZ and DSKO
    ! -- this is the pay-entity (010-024), (043-057) is the employer!
    ! -- let $MN3 = rtrim(ltrim($hdr_abr_GPDE_DO_BTNR,' '),' ') !15
    let $MN3 = rtrim(ltrim($PayentBtnr,' '),' ') !15
    let $MN3 = rpad($MN3, 15, ' ')
    
    let $MN4 = rtrim(ltrim($KK_Nummer,' '),' ') !15
    let $MN4 = rpad($MN4, 15, ' ')    
    
    move '10' to $MN5
    
    do Format-DateTime($sysdatetime,$DATUM, {DEFCMP},'time','')    
    let $DATUM = $DATUM || '000000'    
    let $MN6 = $DATUM !20
    let $MN7 = '0'
    let $MN8 = '0'
    let $MN9 = '                    ' !20
    let $MN10 = '                    ' !20
    
    if $Maturity = 'Y'
       let $MN11 = '1'                      !1
    else
       let $MN11 = '0'                      !1
    end-if
!adj08-890b16: Contr. previous year
!     if $Korr = 'Y' and #phase = 2
!        let $MN12 = '1'
!     else
        let $MN12 = '0'
!     end-if
   
    let $MN13 = '0'   !1

    ! wdu06-881kug: main BTNR from PayEntity ($PayentBtnr) for VOSZ and DSKO
    ! Betriebsnr Arbeitgeber
    !
    ! -- wrong: we are currently reporting per payentity, so the numbers are the same!
    ! -- BTNR for KVDR is: $hdr_abr_zahlstellen_nr
    ! -- no: let $MN8 = $MN3  !15
    let $MN14 = rtrim(ltrim($hdr_abr_zahlstellen_nr,' '),' ') !15
    let $MN14 = rpad($MN14, 15, ' ')

    if $Korr = 'Y'
!ADJ10- 1974722000 : use pay end date instead of last year.
!       do ConvertToComponents($EffDateTemp,$YE,$ME,$DE)
       do ConvertToComponents($Ctl_Curr_Pay_End_Dt,$YE,$ME,$DE)
      if #phase = 2
           do ConvertToComponents($PRD_END_DT,$YE,$ME,$DE)
      end-if
       
       let $MN15  =  $YE || '0000'                   !8
       
       let $MN16  = $MN15                           !8
    else
       let $MN15  = $ye1 || $mo1 || $da1            !8
       let $MN16  = $ye2 || $mo2 || $da2 
    end-if

    if #sv_sum_kvdr < 0
       let $MN17 = '-'   !1
       let #MN18 = -1 * #sv_sum_kvdr
    else
       let $MN17 = '+'
       let #MN18 = #sv_sum_kvdr
    end-if
    let $MN18 = translate(edit(#MN18, '099999999.99'), '.', '')
    let $MN63 = $MN17
    let $MN64 = $MN18    
    
    let $MN19 = '+'
    let $MN20 = '00000000000'

    let $MN21 = '+'
    let $MN22 = '00000000000'
    let $MN65 = $MN21
    let $MN66 = $MN22

    if #sv_sum_pv_kvdr1 < 0
       let $MN23 = '-'   !1
       let #MN24 = -1 * #sv_sum_pv_kvdr1
    else
       let $MN23 = '+'
       let #MN24 = #sv_sum_pv_kvdr1
    end-if
    let $MN24 = translate(edit(#MN24, '099999999.99'), '.', '')

    let $MN25 = '+'
    let $MN26 = '00000000000'
    let $MN27 = '+'
    let $MN28 = '00000000000'
    let $MN29 = '+'
    let $MN30 = '00000000000'
    let $MN31 = '+'
    let $MN32 = '00000000000'
    let $MN33 = '+'
    let $MN34 = '00000000000'
    let $MN35 = '+'
    let $MN36 = '00000000000'
    let $MN37 = '+'
    let $MN38 = '00000000000'
    let $MN39 = '+'
    let $MN40 = '00000000000'
    let $MN41 = '+'
    let $MN42 = '00000000000'
    let $MN43 = '+'
    let $MN44 = '00000000000'
    let $MN45 = '+'
    let $MN46 = '00000000000'

    if #S_SUM_KVdR < 0
       let $MN47 = '-'   !1
       let #MN48 = -1 * #S_SUM_KVdR
    else
       let $MN47 = '+'
       let #MN48 = #S_SUM_KVdR
    end-if
    let $MN48 = translate(edit(#MN48, '099999999.99'), '.', '')

    let $MN49 = '+'
    let $MN50 = '00000000000'
    let $MN67 = $MN49
    let $MN68 = $MN50
    let $MN51 = '+'
    let $MN52 = '00000000000'
    let $MN53 = '+'
    let $MN54 = '00000000000'

    let $MN55 = '+'
    let $MN56 = '00000000000'
    let $MN57 = '+'
    let $MN58 = '00000000000'
    let $MN59 = '+'
    let $MN60 = '00000000000'
    let #S_Total_KVdR = #S_SUM_KVdR
    if #S_Total_KVdR < 0
       let $MN61 = '-'   !1
       let #MN62 = -1 * #S_Total_KVdR
    else
       let $MN61 = '+'
       let #MN62 = #S_Total_KVdR
    end-if
    let $MN62 = translate(edit(#MN62, '099999999.99'), '.', '')
    
    !63 - 17, 64 - 18, 65-21, 66-22, 67-49, 68-50
    
    let $ArbGBez = rtrim($PayentityName,' ')
    let #LenArbG = length($ArbGBez)
    if #LenArbG > 30
       let $MN69 = substr($ArbGBez,1,30)
       let $MN70 = substr($ArbGBez,31,30)
       let $MN70 = lpad($MN70, 30, ' ')
    else
       let $MN69 = $ArbGBez
       let $MN70 = ' '
       let $MN69 = lpad($MN69, 30, ' ')
       let $MN70 = lpad($MN70, 30, ' ')
    end-if
    let $MN71 = rtrim($PayentityStreet,' ') || cond(rtrim($PoBox,' ') <> '', '/', '') ||
        rtrim($PoBox,' ')
    let $MN71 = lpad($MN71, 30, ' ')
    if rtrim($Nation,' ') <> ''
       let $MN72 = substr($Nation,1,1)
    else
       let $MN72 = '   '
    end-if
    let $MN72 = rpad($MN72, 3, ' ')
    let $MN73 = $Post
    let $MN73 = lpad($MN73, 5, ' ')
    let $MN74 = $Cit
    let $MN74 = lpad($MN74, 25, ' ')
    let $MN75 = ' '  !Abrechnungsstelle 1
    let $MN76 = ' '  !Abrechnungsstelle 2
    let $MN77 = ' '  !Ordnungsmerkmal
    let $MN78 = ' '  !Verarbeitungsmerkmal
    let $MN79 = translate(edit(#per_kvdr, '09.99'), '.', '')
    let $MN80 = '0000'
    let $MN81 = '0000'
   !byar11-90UpdA : Health Ins Rates
   if #phase = 1 and $yy09 >= '2011'
     let $MN79 = '1550'
   else
     !adj08-890b16 : Health Ins Rates
     if #phase = 1 and $yy09 >= '2009'
        let $MN79 = '1550'
        !adj09-89b18 : July Tax update
        if $HD_mm > '06' or $yy09 = '2010'
           let $MN79 = '1490'
        end-if
     end-if
   end-if
   
    
    let $MN82 = ' '
    let $MN83 = '0'
        
    if #LaufNum > 1 and #LaufNum < 10
       move #LaufNum to $MN84 099
    else
       move 0 to $MN84 099
    end-if

    evaluate $SaveCurrency !$Actual_Curruncy_save
    when = 'DEM'
       let $MN85 = 'D'
       break
    when = 'EUR'
       let $MN85 = 'E'
       break
    when-other
       let $MN85 = ' '
       break
    end-evaluate
    let $MN86 = '+'
    let #MN87 = 0
    let $MN87 = translate(edit(#MN87, '099999999.99'), '.', '')
    let $MN88 = ' '
    let $MN88 = rpad($MN88, 20, ' ')
    !let $MN79 = 'E'    !Satzende
    if $provider_type <> '08'
    write 10 from $MN1:4  $MN2:5  $MN3:15  $MN4:15  $MN5:2  $MN6:20  $MN7:1  $MN8:1  $MN9:20  $MN10:20
                  $MN11:1 $MN12:1 $MN13:1 $MN14:15 $MN15:8 $MN16:8 $MN17:1 $MN18:11 $MN19:1 $MN20:11
                  $MN21:1 $MN22:11 $MN23:1 $MN24:11 $MN25:1 $MN26:11 $MN27:1 $MN28:11 $MN29:1 $MN30:11
                  $MN31:1 $MN32:11 $MN33:1 $MN34:11 $MN35:1 $MN36:11 $MN37:1 $MN38:11 $MN39:1 $MN40:11
                  $MN41:1 $MN42:11 $MN43:1 $MN44:11 $MN45:1 $MN46:11 $MN47:1 $MN48:11 $MN49:1 $MN50:11
                  $MN51:1 $MN52:11 $MN53:1 $MN54:11 $MN55:1 $MN56:11 $MN57:1 $MN58:11 $MN59:1 $MN60:11
                  $MN61:1 $MN62:11 $MN63:1 $MN64:11 $MN65:1 $MN66:11 $MN67:1 $MN68:11 $MN69:30 $MN70:30
                  $MN71:30 $MN72:3 $MN73:10 $MN74:25 $MN75:15 $MN76:15 $MN77:20 $MN78:1 $MN79:4 $MN80:4   
                  $MN81:4 $MN82:1 $MN83:1 $MN84:3 $MN85:1 $MN86:1 $MN87:11 $MN88:20
   end-if
   let #Total_SUM = #Total_SUM + #S_Total_KVdR
 end-if
end-procedure
!**********************************************************************************
begin-procedure Print_End_Record
if $Is_KVdR <> 'Y'
  let $EndR1 = 'NCSZ'
  let $EndR2 = 'BWNAC'
else
  let $EndR1 = 'NCSZ'
  let $EndR2 = 'BWBNV'
end-if
let $EndR3 = $ST3
let $EndR4 = $ST4
let $EndR5 = $ST5
let $EndR6 = $ST6
move #LaufNum to $EndR7 09999999

move '06' to $EndR8

if $provider_type <> '08'
write 10 from $EndR1:4  $EndR2:5  $EndR3:15  $EndR4:15   $EndR5:8  $EndR6:6
              $EndR7:8  $EndR8:2
end-if

end-procedure
!**********************************************************************************





begin-procedure Insert-Data-SI10
! enter regular payroll data for the emplid into the local reporting table
Begin-Sql
INSERT INTO PS_GPDE_RP_SI10
 (EMPLID,
  CAL_RUN_ID,
  EMPL_RCD,
  GP_PAYGROUP,
  CAL_ID,
  RSLT_SEG_NUM,
  SLICE_END_DT,
  PAY_ENTITY,
  PRD_END_DT,
  GPDE_AL_CPAY_ENDDT,
  GPDE_RP_SIGRSS_AMT,
  GPDE_RP_SIGRS_ANLZ,
  GPDE_RP_HICNTB_AMT,
  GPDE_RP_PICNTB_AMT,
  GPDE_RP_UICNTB_AMT,
  GPDE_RP_CICNTB_AMT,
  GPDE_RP_HIVOL_AMT,
  GPDE_RP_CIVOL_AMT,
  GPDE_RP_RIGRSS_AMT,
  GPDE_RP_U1CNTB_AMT,
  GPDE_RP_U2CNTB_AMT,
  GPDE_RI_PCT1,
  GPDE_RI_PCT2,
  GPDE_RP_RIGRSM_AMT,
  GPDE_RP_U1CTBM_AMT,
  GPDE_RP_U2CTBM_AMT,
  GPDE_RI_PCT1_MC,
  GPDE_RI_PCT2_MC,
  GPDE_RP_SIGRSM_AMT,
  GPDE_RP_HICTBM_AMT,
  GPDE_RP_PICTBM_AMT,
  GPDE_RP_UICTBM_AMT,
  GPDE_RP_CICTBM_AMT,
  GPDE_RP_OAPGRS_AMT,
  GPDE_RP_AZGRS_ANLZ,
  GPDE_RP_OAPPEN_AMT,
  GPDE_RP_OAPGRS_MC,
  GPDE_RP_OAPPEN_MC,
  GPDE_RP_SIDAYS,
  GPDE_RP_AVDAYS,
  GPDE_RP_KVDAYS,
  GPDE_RP_PVDAYS,
  GPDE_RP_AVDAYS_BON,
  GPDE_RP_KVDAYS_BON,
  GPDE_RP_PVDAYS_BON,
  GPDE_RP_RVDAYS_BON,
  GPDE_RP_AVGRS_ANLZ,
  GPDE_RP_AVGRS_BON,
  GPDE_RP_AVGRS_MC,
  GPDE_RP_KVGRS_ANLZ,
  GPDE_RP_KVGRS_BON,
  GPDE_RP_KVGRS_MC,
  GPDE_RP_PVGRS_ANLZ,
  GPDE_RP_PVGRS_BON,
  GPDE_RP_PVGRS_MC,
  GPDE_RP_RVGRS_ANLZ,
  GPDE_RP_RVGRS_BON,
  GPDE_RP_RVGRS_MC,
  GPDE_RP_AVLFD_AG,
  GPDE_RP_AVLFD_AN,
  GPDE_RP_KVLFD_AG,
  GPDE_RP_KVLFD_AN,
  GPDE_RP_PVLFD_AG,
  GPDE_RP_PVLFD_AN,
  GPDE_RP_RVLFD_AG,
  GPDE_RP_RVLFD_AN,
  GPDE_RP_KVBON_AG,
  GPDE_RP_KVBON_AN,
  GPDE_RP_AVBON_AG,
  GPDE_RP_AVBON_AN,
  GPDE_RP_PVBON_AG,
  GPDE_RP_PVBON_AN,
  GPDE_RP_RVBON_AG,
  GPDE_RP_RVBON_AN,
  GPDE_RP_AVAG_MC,
  GPDE_RP_AVAN_MC,
  GPDE_RP_KVAG_MC,
  GPDE_RP_KVAN_MC,
  GPDE_RP_PVAG_MC,
  GPDE_RP_PVAN_MC,
  GPDE_RP_RVAG_MC,
  GPDE_RP_RVAN_MC,
  GPDE_RP_SIGRUNLM_A,
  GPDE_RP_SIGRUNLM_B,
  GPDE_RP_CIVLER_AMT,
  GPDE_RP_HIVLER_AMT,
  GPDE_RC_PRT_SIGN,
  GPDE_SI_PROV_AV,
  GPDE_SI_PROV_KV,
  GPDE_SI_PROV_PV,
  GPDE_SI_PROV_RV,
  GPDE_SI_PROV_UM,
  GPDE_SI_PROV_AV_M,
  GPDE_SI_PROV_KV_M,
  GPDE_SI_PROV_PV_M,
  GPDE_SI_PROV_RV_M,
  GPDE_SI_PROV_UM_M,
  GPDE_RP_AZGRS_BON,
  GPDE_RP_OAPPEN_ANL,
  GPDE_RP_OAPPEN_BON,
  GPDE_RP_AVDAYS_MC,
  GPDE_RP_KVDAYS_MC,
  GPDE_RP_PVDAYS_MC,
  GPDE_RP_RVDAYS_MC,
  GPDE_TX_MJ_LUMP,
  GPDE_AZ_RP_S03_31,
  GPDE_AZ_RP_S03_41,
  GPDE_SI_IS_KVDR,
  GPDE_SI_PV_CHILD,
  !wdu06-881kug
  GPDE_RP_KUG_KVCTB,
  GPDE_RP_KUG_PVCTB,
  GPDE_RP_KUG_RVCTB,
  GPDE_RP_KUG_KVGRS,
  GPDE_RP_KUG_PVGRS,
  GPDE_RP_KUG_RVGRS,
  ! JJJ-890B10-kug
  GPDE_KU_KUGAMT,
  GPDE_KU_KUGKKAMT,
  ! JJJ-890B10-sfn
  GPDE_RP_SFN_SI_ABL,
  ! JJJ-890B10-gz
  GPDE_RP_RV_GZ_FLG,
!adj08-890b16: RI insolvency
  GPDE_RP_GRSS_INSOL,
  GPDE_RP_UML_INSOLV,
  GPDE_RP_MARCH_CLS,
  GPDE_RP_GRS_INS_MC,
  GPDE_RP_UML_INS_MC
  )
  values
  (&GN.EMPLID,
  &GN.CAL_RUN_ID,
  &GN.EMPL_RCD,
  &GN.GP_PAYGROUP,
  &GN.CAL_ID,
  &GN.RSLT_SEG_NUM,
  &GN.SLICE_END_DT,
  &GN.PAY_ENTITY,
  &GN.PRD_END_DT,
  &GN.GPDE_AL_CPAY_ENDDT,
  &GN.GPDE_RP_SIGRSS_AMT,
  &GN.GPDE_RP_SIGRS_ANLZ,
  &GN.GPDE_RP_HICNTB_AMT,
  &GN.GPDE_RP_PICNTB_AMT,
  &GN.GPDE_RP_UICNTB_AMT,
  &GN.GPDE_RP_CICNTB_AMT,
  &GN.GPDE_RP_HIVOL_AMT,
  &GN.GPDE_RP_CIVOL_AMT,
  &GN.GPDE_RP_RIGRSS_AMT,
  &GN.GPDE_RP_U1CNTB_AMT,
  &GN.GPDE_RP_U2CNTB_AMT,
  &SI01.GPDE_RI_PCT1,
  &SI01.GPDE_RI_PCT2,
  &GN.GPDE_RP_RIGRSM_AMT,
  &GN.GPDE_RP_U1CTBM_AMT,
  &GN.GPDE_RP_U2CTBM_AMT,
  &SI01.GPDE_RI_PCT1_MC,
  &SI01.GPDE_RI_PCT2_MC,
  &GN.GPDE_RP_SIGRSM_AMT,
  &GN.GPDE_RP_HICTBM_AMT,
  &GN.GPDE_RP_PICTBM_AMT,
  &GN.GPDE_RP_UICTBM_AMT,
  &GN.GPDE_RP_CICTBM_AMT,
  &GN.GPDE_RP_OAPGRS_AMT,
  &GN.GPDE_RP_AZGRS_ANLZ,
  &GN.GPDE_RP_OAPPEN_AMT,
  &GN.GPDE_RP_OAPGRS_MC,
  &GN.GPDE_RP_OAPPEN_MC,
  &GN.GPDE_RP_SIDAYS,
  &GN.GPDE_RP_AVDAYS,
  &GN.GPDE_RP_KVDAYS,
  &GN.GPDE_RP_PVDAYS,
  &GN.GPDE_RP_AVDAYS_BON,
  &GN.GPDE_RP_KVDAYS_BON,
  &GN.GPDE_RP_PVDAYS_BON,
  &GN.GPDE_RP_RVDAYS_BON,
  &GN.GPDE_RP_AVGRS_ANLZ,
  &GN.GPDE_RP_AVGRS_BON,
  &GN.GPDE_RP_AVGRS_MC,
  &GN.GPDE_RP_KVGRS_ANLZ,
  &GN.GPDE_RP_KVGRS_BON,
  &GN.GPDE_RP_KVGRS_MC,
  &GN.GPDE_RP_PVGRS_ANLZ,
  &GN.GPDE_RP_PVGRS_BON,
  &GN.GPDE_RP_PVGRS_MC,
  &GN.GPDE_RP_RVGRS_ANLZ,
  &GN.GPDE_RP_RVGRS_BON,
  &GN.GPDE_RP_RVGRS_MC,
  &GN.GPDE_RP_AVLFD_AG,
  &GN.GPDE_RP_AVLFD_AN,
  &GN.GPDE_RP_KVLFD_AG,
  &GN.GPDE_RP_KVLFD_AN,
  &GN.GPDE_RP_PVLFD_AG,
  &GN.GPDE_RP_PVLFD_AN,
  &GN.GPDE_RP_RVLFD_AG,
  &GN.GPDE_RP_RVLFD_AN,
  &GN.GPDE_RP_KVBON_AG,
  &GN.GPDE_RP_KVBON_AN,
  &GN.GPDE_RP_AVBON_AG,
  &GN.GPDE_RP_AVBON_AN,
  &GN.GPDE_RP_PVBON_AG,
  &GN.GPDE_RP_PVBON_AN,
  &GN.GPDE_RP_RVBON_AG,
  &GN.GPDE_RP_RVBON_AN,
  &GN.GPDE_RP_AVAG_MC,
  &GN.GPDE_RP_AVAN_MC,
  &GN.GPDE_RP_KVAG_MC,
  &GN.GPDE_RP_KVAN_MC,
  &GN.GPDE_RP_PVAG_MC,
  &GN.GPDE_RP_PVAN_MC,
  &GN.GPDE_RP_RVAG_MC,
  &GN.GPDE_RP_RVAN_MC,
  &GN.GPDE_RP_SIGRUNLM_A,
  &GN.GPDE_RP_SIGRUNLM_B,
  &GN.GPDE_RP_CIVLER_AMT,
  &GN.GPDE_RP_HIVLER_AMT,
  'A',
  &SI01.GPDE_SI_PROV_AV,
  &SI01.GPDE_SI_PROV_KV,
  &SI01.GPDE_SI_PROV_PV,
  &SI01.GPDE_SI_PROV_RV,
  &SI01.GPDE_SI_PROV_UM,
  $SI01.GPDE_SI_PROV_AV_M,
  $SI01.GPDE_SI_PROV_KV_M,
  $SI01.GPDE_SI_PROV_PV_M,
  $SI01.GPDE_SI_PROV_RV_M,
!adj09:RI March Cls provider is blank, use provider from current year
!  $SI01.GPDE_SI_PROV_UM_M,
  &SI01.GPDE_SI_PROV_UM,
  &GN.GPDE_RP_AZGRS_BON,
  &GN.GPDE_RP_OAPPEN_ANL,
  &GN.GPDE_RP_OAPPEN_BON,
  &GN.GPDE_RP_AVDAYS_MC,
  &GN.GPDE_RP_KVDAYS_MC,
  &GN.GPDE_RP_PVDAYS_MC,
  &GN.GPDE_RP_RVDAYS_MC,
  &GN2.GPDE_TX_MJ_LUMP,
  &GN.GPDE_AZ_RP_S03_31,
  &GN.GPDE_AZ_RP_S03_41,
  $SI01.GPDE_SI_IS_KVDR,
  $SI01.GPDE_SI_PV_CHILD,
  ! wdu06-881kug
  &GN.GPDE_RP_KUG_KVCTB,
  &GN.GPDE_RP_KUG_PVCTB,
  &GN.GPDE_RP_KUG_RVCTB,
  &GN.GPDE_RP_KUG_KVGRS,
  &GN.GPDE_RP_KUG_PVGRS,
  &GN.GPDE_RP_KUG_RVGRS,
  ! JJJ-890B10-kug
  #kugamt,
  #kugkkamt,
  ! JJJ-890B10-sfn
  #SFNGPDE_RP_SFN_SI_ABL,
  ! JJJ-890B10-gz
  $GZFlag,
!adj08-890b16: RI insolvency
  &GN.GPDE_RP_GRSS_INSOL,
  &GN.GPDE_RP_UML_INSOLV,
  &SI01.GPDE_RP_MARCH_CLS,
  &GN.GPDE_RP_GRS_INS_MC,
  &GN.GPDE_RP_UML_INS_MC
  )
End-Sql

end-procedure
!**********************************************************************************

! <-- JJJ-890B10-kug
begin-procedure GetKugData

let #kugkkamt = 0
let #kugamt = 0

begin-select
KU01.GPDE_KU_KUGAMT
KU01.GPDE_KU_KUGKKAMT

  let #kugkkamt = &KU01.GPDE_KU_KUGKKAMT
  let #kugamt = &KU01.GPDE_KU_KUGAMT

from PS_GPDE_RP_KU01 KU01
where
KU01.EMPLID = $KUGEMPLID AND
KU01.CAL_RUN_ID =  $KUGCAL_RUN_ID AND
KU01.EMPL_RCD =  #KUGEMPL_RCD AND
KU01.GP_PAYGROUP =  $KUGGP_PAYGROUP AND
KU01.CAL_ID =  $KUGCAL_ID AND
KU01.ORIG_CAL_RUN_ID = $KUGORIG_CAL_RUN_ID AND
KU01.RSLT_SEG_NUM =  #KUGRSLT_SEG_NUM AND
KU01.SEG_END_DT =  $KUGSEG_END_DT AND
KU01.SLICE_END_DT = $KUGSLICE_END_DT

end-select


end-procedure
! --> JJJ-890B10-kug


begin-procedure Get-Data
Begin-Sql
DELETE FROM PS_GPDE_RP_SI10
End-Sql
let #Countx = 0
Begin-select
GN.EMPLID
GN.CAL_RUN_ID
GN.EMPL_RCD
GN.GP_PAYGROUP
GN.CAL_ID
GN.RSLT_SEG_NUM
GN.SLICE_END_DT
GN.PAY_ENTITY
GN.PRD_END_DT
GN.GPDE_AL_CPAY_ENDDT
GN.GPDE_RP_SIGRSS_AMT
GN.GPDE_RP_SIGRS_ANLZ
GN.GPDE_RP_HICNTB_AMT
GN.GPDE_RP_PICNTB_AMT
GN.GPDE_RP_UICNTB_AMT
GN.GPDE_RP_CICNTB_AMT
GN.GPDE_RP_HIVOL_AMT
GN.GPDE_RP_CIVOL_AMT
GN.GPDE_RP_RIGRSS_AMT
GN.GPDE_RP_U1CNTB_AMT
GN.GPDE_RP_U2CNTB_AMT
SI01.GPDE_RI_PCT1
SI01.GPDE_RI_PCT2
GN.GPDE_RP_RIGRSM_AMT
GN.GPDE_RP_U1CTBM_AMT
GN.GPDE_RP_U2CTBM_AMT
SI01.GPDE_RI_PCT1_MC
SI01.GPDE_RI_PCT2_MC
GN.GPDE_RP_SIGRSM_AMT
GN.GPDE_RP_HICTBM_AMT
GN.GPDE_RP_PICTBM_AMT
GN.GPDE_RP_UICTBM_AMT
GN.GPDE_RP_CICTBM_AMT
GN.GPDE_RP_OAPGRS_AMT
GN.GPDE_RP_AZGRS_ANLZ
GN.GPDE_RP_OAPPEN_AMT
GN.GPDE_RP_OAPGRS_MC
GN.GPDE_RP_OAPPEN_MC
GN.GPDE_RP_SIDAYS
GN.GPDE_RP_AVDAYS
GN.GPDE_RP_KVDAYS
GN.GPDE_RP_PVDAYS
GN.GPDE_RP_AVDAYS_BON
GN.GPDE_RP_KVDAYS_BON
GN.GPDE_RP_PVDAYS_BON
GN.GPDE_RP_RVDAYS_BON
GN.GPDE_RP_AVGRS_ANLZ
GN.GPDE_RP_AVGRS_BON
GN.GPDE_RP_AVGRS_MC
GN.GPDE_RP_KVGRS_ANLZ
GN.GPDE_RP_KVGRS_BON
GN.GPDE_RP_KVGRS_MC
GN.GPDE_RP_PVGRS_ANLZ
GN.GPDE_RP_PVGRS_BON
GN.GPDE_RP_PVGRS_MC
GN.GPDE_RP_RVGRS_ANLZ
GN.GPDE_RP_RVGRS_BON
GN.GPDE_RP_RVGRS_MC
GN.GPDE_RP_AVLFD_AG
GN.GPDE_RP_AVLFD_AN
GN.GPDE_RP_KVLFD_AG
GN.GPDE_RP_KVLFD_AN
GN.GPDE_RP_PVLFD_AG
GN.GPDE_RP_PVLFD_AN
GN.GPDE_RP_RVLFD_AG
GN.GPDE_RP_RVLFD_AN
GN.GPDE_RP_KVBON_AG
GN.GPDE_RP_KVBON_AN
GN.GPDE_RP_AVBON_AG
GN.GPDE_RP_AVBON_AN
GN.GPDE_RP_PVBON_AG
GN.GPDE_RP_PVBON_AN
GN.GPDE_RP_RVBON_AG
GN.GPDE_RP_RVBON_AN
GN.GPDE_RP_AVAG_MC
GN.GPDE_RP_AVAN_MC
GN.GPDE_RP_KVAG_MC
GN.GPDE_RP_KVAN_MC
GN.GPDE_RP_PVAG_MC
GN.GPDE_RP_PVAN_MC
GN.GPDE_RP_RVAG_MC
GN.GPDE_RP_RVAN_MC
GN.GPDE_RP_SIGRUNLM_A
GN.GPDE_RP_SIGRUNLM_B
GN.GPDE_RP_CIVLER_AMT
GN.GPDE_RP_HIVLER_AMT
SI01.GPDE_SI_PROV_AV
SI01.GPDE_SI_PROV_KV
SI01.GPDE_SI_PROV_PV
SI01.GPDE_SI_PROV_RV
SI01.GPDE_SI_PROV_UM
SI01.GPDE_SI_PROV_AV_M
SI01.GPDE_SI_PROV_KV_M
SI01.GPDE_SI_PROV_PV_M
SI01.GPDE_SI_PROV_RV_M
SI01.GPDE_SI_PROV_UM_M
GN.GPDE_RP_AZGRS_BON
GN.GPDE_RP_OAPPEN_ANL
GN.GPDE_RP_OAPPEN_BON
GN.GPDE_RP_AVDAYS_MC
GN.GPDE_RP_KVDAYS_MC
GN.GPDE_RP_PVDAYS_MC
GN.GPDE_RP_RVDAYS_MC
GN2.GPDE_TX_MJ_LUMP
GN.GPDE_AZ_RP_S03_31
GN.GPDE_AZ_RP_S03_41
SI01.GPDE_SI_IS_KVDR
SI01.GPDE_SI_PV_CHILD
!wdu06-881kug
GN.GPDE_RP_KUG_KVCTB
GN.GPDE_RP_KUG_PVCTB
GN.GPDE_RP_KUG_RVCTB
GN.GPDE_RP_KUG_KVGRS
GN.GPDE_RP_KUG_PVGRS
GN.GPDE_RP_KUG_RVGRS
    ! <-- JJJ-890B10-sfn
GN.GPDE_RP_SFN_SI_ABL
! -->

SI01.GPDE_RP_RV_GZ_FLG        ! JJJ-890B10-gz

    ! <-- JJJ-890B10-kug
GN.ORIG_CAL_RUN_ID
GN.SEG_END_DT
!adj08-890b16: RI insolvency
GN.GPDE_RP_GRSS_INSOL
GN.GPDE_RP_UML_INSOLV
SI01.GPDE_RP_MARCH_CLS
GN.GPDE_RP_GRS_INS_MC
GN.GPDE_RP_UML_INS_MC

    let $KUGEMPLID = &GN.EMPLID
    let $KUGCAL_RUN_ID = &GN.CAL_RUN_ID
    let #KUGEMPL_RCD = &GN.EMPL_RCD
    let $KUGGP_PAYGROUP = &GN.GP_PAYGROUP
    let $KUGCAL_ID = &GN.CAL_ID
    let $KUGORIG_CAL_RUN_ID = &GN.ORIG_CAL_RUN_ID
    let #KUGRSLT_SEG_NUM = &GN.RSLT_SEG_NUM
    let $KUGSEG_END_DT = &GN.SEG_END_DT
    let $KUGSLICE_END_DT = &GN.SLICE_END_DT

    do GetKugData

    ! --> JJJ-890B10-kug
   let #SFNGPDE_RP_SFN_SI_ABL = &GN.GPDE_RP_SFN_SI_ABL   ! JJJ-890B10-sfn

    !ChangeFor2004Bundle2: need to clear marchclause providers when no marchclause (part1)
!adj08-890b15 added &GN.GPDE_RP_SIGRUNLM_B
!adj09: RI Inslovency TU
    if &GN.GPDE_RP_KVGRS_MC <> 0 or &GN.GPDE_RP_AVGRS_MC <> 0 or
            &GN.GPDE_RP_RVGRS_MC <> 0 or &GN.GPDE_RP_PVGRS_MC <> 0 or
            &GN.GPDE_RP_KVAN_MC <> 0 or &GN.GPDE_RP_KVAG_MC <> 0 or
            &GN.GPDE_RP_RVAN_MC <> 0 or &GN.GPDE_RP_RVAG_MC <> 0 or
            &GN.GPDE_RP_AVAN_MC <> 0 or &GN.GPDE_RP_AVAG_MC <> 0 or
            &GN.GPDE_RP_PVAN_MC <> 0 or &GN.GPDE_RP_PVAG_MC <> 0 or
            &GN.GPDE_RP_RIGRSM_AMT <> 0 or &GN.GPDE_RP_U1CTBM_AMT <> 0 or
            &GN.GPDE_RP_U2CTBM_AMT <> 0 or &GN.GPDE_RP_OAPGRS_MC <> 0 or
           &GN.GPDE_RP_OAPPEN_MC <> 0 or &GN.GPDE_RP_SIGRUNLM_B <> 0  or
           &GN.GPDE_RP_GRS_INS_MC <> 0 or &GN.GPDE_RP_UML_INS_MC  <> 0
     !use marchclause providers when marchclause is applicable
     let $SI01.GPDE_SI_PROV_AV_M = &SI01.GPDE_SI_PROV_AV_M
     let $SI01.GPDE_SI_PROV_KV_M = &SI01.GPDE_SI_PROV_KV_M
     let $SI01.GPDE_SI_PROV_PV_M = &SI01.GPDE_SI_PROV_PV_M
     let $SI01.GPDE_SI_PROV_RV_M = &SI01.GPDE_SI_PROV_RV_M
     let $SI01.GPDE_SI_PROV_UM_M = &SI01.GPDE_SI_PROV_UM_M
    else
     !clear  marchclause providers when marchclause is not applicable to avoid duplicate results
     let $SI01.GPDE_SI_PROV_AV_M = ' '
     let $SI01.GPDE_SI_PROV_KV_M = ' '
     let $SI01.GPDE_SI_PROV_PV_M = ' '
     let $SI01.GPDE_SI_PROV_RV_M = ' '
     let $SI01.GPDE_SI_PROV_UM_M = ' '
    end-if
    !ChangeFor2004Bundle2: need to clear marchclause providers when no marchclause (end part1)

   let $SI01.GPDE_SI_IS_KVDR = &SI01.GPDE_SI_IS_KVDR
   if rtrim($SI01.GPDE_SI_IS_KVDR, ' ') = ''
      let $SI01.GPDE_SI_IS_KVDR = 'N'
   end-if

   !for consistency
   let $SI01.GPDE_SI_PV_CHILD = &SI01.GPDE_SI_PV_CHILD


   let $GZFlag = &SI01.GPDE_RP_RV_GZ_FLG

   do Insert-Data-SI10
FROM PS_GPDE_RP_0001 RP01a, PS_GPDE_RP_0003 GN,PS_GPDE_RP_SI01 SI01, PS_GPDE_RP_0002 GN2
WHERE RP01a.EMPLID = GN.EMPLID
  and RP01a.EMPL_RCD = GN.EMPL_RCD
  and RP01a.GP_PAYGROUP = GN.GP_PAYGROUP
  and RP01a.CAL_ID = GN.CAL_ID
  and RP01a.CAL_RUN_ID = GN.CAL_RUN_ID
  and RP01a.SEG_END_DT = GN.SEG_END_DT
  and RP01a.RSLT_SEG_NUM = GN.RSLT_SEG_NUM
  and RP01a.PAY_ENTITY = $Ctl_PayEntity
  ! only current calculation, with retros
  and RP01a.GPDE_AL_CPAY_ENDDT = $Ctl_Curr_Pay_End_Dt
  AND SI01.EMPLID = GN.EMPLID
  AND SI01.CAL_RUN_ID = GN.CAL_RUN_ID
  AND SI01.EMPL_RCD = GN.EMPL_RCD
  AND SI01.GP_PAYGROUP = GN.GP_PAYGROUP
  AND SI01.CAL_ID = GN.CAL_ID
  AND SI01.RSLT_SEG_NUM = GN.RSLT_SEG_NUM
  AND SI01.SEG_END_DT = GN.SEG_END_DT
  AND SI01.SLICE_END_DT = GN.SLICE_END_DT
  AND RP01a.EMPLID = GN2.EMPLID
  AND RP01a.CAL_RUN_ID = GN2.CAL_RUN_ID
  AND RP01a.EMPL_RCD = GN2.EMPL_RCD
  AND RP01a.GP_PAYGROUP = GN2.GP_PAYGROUP
  AND RP01a.CAL_ID = GN2.CAL_ID
  AND RP01a.RSLT_SEG_NUM = GN2.RSLT_SEG_NUM
  AND RP01a.SEG_END_DT = GN2.SEG_END_DT
End-select
! wdu05b7: moved call  'do Select_Data_Distinct' to process-main

end-procedure
!*************************************************************************




begin-procedure Select_Data_Distinct
!
! insert storno rows only for CAL_IDs where we had a retro out of the
! current calculation.
!
begin-select distinct
SI10D.EMPLID
SI10D.CAL_ID
SI10D.EMPL_RCD
SI10D.GP_PAYGROUP
    do InsertRetroData
from PS_GPDE_RP_SI10 SI10D
end-select
end-procedure



!*************************************************************************
begin-procedure InsertRetroData
Begin-select
RP03a.EMPLID
RP03a.CAL_RUN_ID
RP03a.EMPL_RCD
RP03a.GP_PAYGROUP
RP03a.CAL_ID
RP03a.RSLT_SEG_NUM
RP03a.SLICE_END_DT
RP03a.PAY_ENTITY
RP03a.PRD_END_DT
RP03a.GPDE_AL_CPAY_ENDDT
RP03a.GPDE_RP_SIGRSS_AMT
RP03a.GPDE_RP_SIGRS_ANLZ
RP03a.GPDE_RP_HICNTB_AMT
RP03a.GPDE_RP_PICNTB_AMT
RP03a.GPDE_RP_UICNTB_AMT
RP03a.GPDE_RP_CICNTB_AMT
RP03a.GPDE_RP_HIVOL_AMT
RP03a.GPDE_RP_CIVOL_AMT
RP03a.GPDE_RP_RIGRSS_AMT
RP03a.GPDE_RP_U1CNTB_AMT
RP03a.GPDE_RP_U2CNTB_AMT
SI01R.GPDE_RI_PCT1
SI01R.GPDE_RI_PCT2
RP03a.GPDE_RP_RIGRSM_AMT
RP03a.GPDE_RP_U1CTBM_AMT
RP03a.GPDE_RP_U2CTBM_AMT
SI01R.GPDE_RI_PCT1_MC
SI01R.GPDE_RI_PCT2_MC
RP03a.GPDE_RP_SIGRSM_AMT
RP03a.GPDE_RP_HICTBM_AMT
RP03a.GPDE_RP_PICTBM_AMT
RP03a.GPDE_RP_UICTBM_AMT
RP03a.GPDE_RP_CICTBM_AMT
RP03a.GPDE_RP_OAPGRS_AMT
RP03a.GPDE_RP_AZGRS_ANLZ
RP03a.GPDE_RP_OAPPEN_AMT
RP03a.GPDE_RP_OAPGRS_MC
RP03a.GPDE_RP_OAPPEN_MC
RP03a.GPDE_RP_SIDAYS
RP03a.GPDE_RP_AVDAYS
RP03a.GPDE_RP_KVDAYS
RP03a.GPDE_RP_PVDAYS
RP03a.GPDE_RP_AVDAYS_BON
RP03a.GPDE_RP_KVDAYS_BON
RP03a.GPDE_RP_PVDAYS_BON
RP03a.GPDE_RP_RVDAYS_BON
RP03a.GPDE_RP_AVGRS_ANLZ
RP03a.GPDE_RP_AVGRS_BON
RP03a.GPDE_RP_AVGRS_MC
RP03a.GPDE_RP_KVGRS_ANLZ
RP03a.GPDE_RP_KVGRS_BON
RP03a.GPDE_RP_KVGRS_MC
RP03a.GPDE_RP_PVGRS_ANLZ
RP03a.GPDE_RP_PVGRS_BON
RP03a.GPDE_RP_PVGRS_MC
RP03a.GPDE_RP_RVGRS_ANLZ
RP03a.GPDE_RP_RVGRS_BON
RP03a.GPDE_RP_RVGRS_MC
RP03a.GPDE_RP_AVLFD_AG
RP03a.GPDE_RP_AVLFD_AN
RP03a.GPDE_RP_KVLFD_AG
RP03a.GPDE_RP_KVLFD_AN
RP03a.GPDE_RP_PVLFD_AG
RP03a.GPDE_RP_PVLFD_AN
RP03a.GPDE_RP_RVLFD_AG
RP03a.GPDE_RP_RVLFD_AN
RP03a.GPDE_RP_KVBON_AG
RP03a.GPDE_RP_KVBON_AN
RP03a.GPDE_RP_AVBON_AG
RP03a.GPDE_RP_AVBON_AN
RP03a.GPDE_RP_PVBON_AG
RP03a.GPDE_RP_PVBON_AN
RP03a.GPDE_RP_RVBON_AG
RP03a.GPDE_RP_RVBON_AN
RP03a.GPDE_RP_AVAG_MC
RP03a.GPDE_RP_AVAN_MC
RP03a.GPDE_RP_KVAG_MC
RP03a.GPDE_RP_KVAN_MC
RP03a.GPDE_RP_PVAG_MC
RP03a.GPDE_RP_PVAN_MC
RP03a.GPDE_RP_RVAG_MC
RP03a.GPDE_RP_RVAN_MC
RP03a.GPDE_RP_SIGRUNLM_A
RP03a.GPDE_RP_SIGRUNLM_B
RP03a.GPDE_RP_CIVLER_AMT
RP03a.GPDE_RP_HIVLER_AMT
SI01R.GPDE_SI_PROV_AV
SI01R.GPDE_SI_PROV_KV
SI01R.GPDE_SI_PROV_PV
SI01R.GPDE_SI_PROV_RV
SI01R.GPDE_SI_PROV_UM
SI01R.GPDE_SI_PROV_AV_M
SI01R.GPDE_SI_PROV_KV_M
SI01R.GPDE_SI_PROV_PV_M
SI01R.GPDE_SI_PROV_RV_M
SI01R.GPDE_SI_PROV_UM_M
RP03a.GPDE_RP_AZGRS_BON
RP03a.GPDE_RP_OAPPEN_ANL
RP03a.GPDE_RP_OAPPEN_BON
RP03a.GPDE_RP_AVDAYS_MC
RP03a.GPDE_RP_KVDAYS_MC
RP03a.GPDE_RP_PVDAYS_MC
RP03a.GPDE_RP_RVDAYS_MC
RP02a.GPDE_TX_MJ_LUMP
RP03a.GPDE_AZ_RP_S03_31
RP03a.GPDE_AZ_RP_S03_41
SI01R.GPDE_SI_IS_KVDR
SI01R.GPDE_SI_PV_CHILD
! wdu06-881kug
RP03a.GPDE_RP_KUG_KVCTB
RP03a.GPDE_RP_KUG_PVCTB
RP03a.GPDE_RP_KUG_RVCTB
RP03a.GPDE_RP_KUG_KVGRS
RP03a.GPDE_RP_KUG_PVGRS
RP03a.GPDE_RP_KUG_RVGRS

RP03a.GPDE_RP_SFN_SI_ABL  ! JJJ-890B10-sfn

  ! <-- JJJ-890B10-kug
RP03a.ORIG_CAL_RUN_ID
RP03a.SEG_END_DT

SI01R.GPDE_RP_RV_GZ_FLG   ! JJJ-890B10-gz
!adj08-890b16: RI insolvency
RP03a.GPDE_RP_GRSS_INSOL
RP03a.GPDE_RP_UML_INSOLV
SI01R.GPDE_RP_MARCH_CLS
RP03a.GPDE_RP_GRS_INS_MC
RP03a.GPDE_RP_UML_INS_MC

    let $KUGEMPLID = &RP03a.EMPLID
    let $KUGCAL_RUN_ID = &RP03a.CAL_RUN_ID
    let #KUGEMPL_RCD = &RP03a.EMPL_RCD
    let $KUGGP_PAYGROUP = &RP03a.GP_PAYGROUP
    let $KUGCAL_ID = &RP03a.CAL_ID
    let $KUGORIG_CAL_RUN_ID = &RP03a.ORIG_CAL_RUN_ID
    let #KUGRSLT_SEG_NUM = &RP03a.RSLT_SEG_NUM
    let $KUGSEG_END_DT = &RP03a.SEG_END_DT
    let $KUGSLICE_END_DT = &RP03a.SLICE_END_DT

    do GetKugData

    ! reverse the amounts since this is the retro proc.
    let #kugkkamt = #kugkkamt * -1
    let #kugamt = #kugamt * -1


    ! --> JJJ-890B10-kug

    let #SFNGPDE_RP_SFN_SI_ABL = &RP03a.GPDE_RP_SFN_SI_ABL  ! JJJ-890B10-sfn

 !adj09: RI Inslovency TU
      !ChangeFor2004Bundle2: need to clear marchclause providers when no marchclause (part1)
         if &RP03a.GPDE_RP_KVGRS_MC <> 0 or &RP03a.GPDE_RP_AVGRS_MC <> 0 or
            &RP03a.GPDE_RP_RVGRS_MC <> 0 or &RP03a.GPDE_RP_PVGRS_MC <> 0 or
            &RP03a.GPDE_RP_KVAN_MC <> 0 or &RP03a.GPDE_RP_KVAG_MC <> 0 or
            &RP03a.GPDE_RP_RVAN_MC <> 0 or &RP03a.GPDE_RP_RVAG_MC <> 0 or
            &RP03a.GPDE_RP_AVAN_MC <> 0 or &RP03a.GPDE_RP_AVAG_MC <> 0 or
            &RP03a.GPDE_RP_PVAN_MC <> 0 or &RP03a.GPDE_RP_PVAG_MC <> 0 or
            &RP03a.GPDE_RP_RIGRSM_AMT <> 0 or &RP03a.GPDE_RP_U1CTBM_AMT <> 0 or
            &RP03a.GPDE_RP_U2CTBM_AMT <> 0 or &RP03a.GPDE_RP_OAPGRS_MC <> 0 or
           &RP03a.GPDE_RP_OAPPEN_MC <> 0 or &RP03a.GPDE_RP_GRS_INS_MC <> 0 or
           &RP03a.GPDE_RP_UML_INS_MC <> 0

     !use marchclause providers when marchclause is applicable
     let $SI01R.GPDE_SI_PROV_AV_M = &SI01R.GPDE_SI_PROV_AV_M
     let $SI01R.GPDE_SI_PROV_KV_M = &SI01R.GPDE_SI_PROV_KV_M
     let $SI01R.GPDE_SI_PROV_PV_M = &SI01R.GPDE_SI_PROV_PV_M
     let $SI01R.GPDE_SI_PROV_RV_M = &SI01R.GPDE_SI_PROV_RV_M
     let $SI01R.GPDE_SI_PROV_UM_M = &SI01R.GPDE_SI_PROV_UM_M
         else
     !clear  marchclause providers when marchclause is not applicable to avoid duplicate results
     let $SI01R.GPDE_SI_PROV_AV_M = ' '
     let $SI01R.GPDE_SI_PROV_KV_M = ' '
     let $SI01R.GPDE_SI_PROV_PV_M = ' '
     let $SI01R.GPDE_SI_PROV_RV_M = ' '
     let $SI01R.GPDE_SI_PROV_UM_M = ' '
         end-if
      !ChangeFor2004Bundle2: need to clear marchclause providers when no marchclause (end part1)

    let #RP03a.GPDE_RP_SIGRSS_AMT = &RP03a.GPDE_RP_SIGRSS_AMT * -1
    let #RP03a.GPDE_RP_SIGRS_ANLZ = &RP03a.GPDE_RP_SIGRS_ANLZ * -1
    let #RP03a.GPDE_RP_HICNTB_AMT = &RP03a.GPDE_RP_HICNTB_AMT * -1
    let #RP03a.GPDE_RP_PICNTB_AMT = &RP03a.GPDE_RP_PICNTB_AMT * -1
    let #RP03a.GPDE_RP_UICNTB_AMT = &RP03a.GPDE_RP_UICNTB_AMT * -1
    let #RP03a.GPDE_RP_CICNTB_AMT = &RP03a.GPDE_RP_CICNTB_AMT * -1
    let #RP03a.GPDE_RP_HIVOL_AMT = &RP03a.GPDE_RP_HIVOL_AMT * -1
    let #RP03a.GPDE_RP_CIVOL_AMT = &RP03a.GPDE_RP_CIVOL_AMT * -1
    let #RP03a.GPDE_RP_RIGRSS_AMT = &RP03a.GPDE_RP_RIGRSS_AMT * -1
    let #RP03a.GPDE_RP_U1CNTB_AMT = &RP03a.GPDE_RP_U1CNTB_AMT * -1
    let #RP03a.GPDE_RP_U2CNTB_AMT = &RP03a.GPDE_RP_U2CNTB_AMT * -1
    let #RP03a.GPDE_RP_RIGRSM_AMT = &RP03a.GPDE_RP_RIGRSM_AMT * -1
    let #RP03a.GPDE_RP_U1CTBM_AMT = &RP03a.GPDE_RP_U1CTBM_AMT * -1
    let #RP03a.GPDE_RP_U2CTBM_AMT = &RP03a.GPDE_RP_U2CTBM_AMT * -1
    let #RP03a.GPDE_RP_SIGRSM_AMT = &RP03a.GPDE_RP_SIGRSM_AMT * -1
    let #RP03a.GPDE_RP_HICTBM_AMT = &RP03a.GPDE_RP_HICTBM_AMT * -1
    let #RP03a.GPDE_RP_PICTBM_AMT = &RP03a.GPDE_RP_PICTBM_AMT * -1
    let #RP03a.GPDE_RP_UICTBM_AMT = &RP03a.GPDE_RP_UICTBM_AMT * -1
    let #RP03a.GPDE_RP_CICTBM_AMT = &RP03a.GPDE_RP_CICTBM_AMT * -1
    let #RP03a.GPDE_RP_OAPGRS_AMT = &RP03a.GPDE_RP_OAPGRS_AMT * -1
    let #RP03a.GPDE_RP_AZGRS_ANLZ = &RP03a.GPDE_RP_AZGRS_ANLZ * -1
    let #RP03a.GPDE_RP_OAPPEN_AMT = &RP03a.GPDE_RP_OAPPEN_AMT * -1
    let #RP03a.GPDE_RP_OAPGRS_MC = &RP03a.GPDE_RP_OAPGRS_MC * -1
    let #RP03a.GPDE_RP_OAPPEN_MC = &RP03a.GPDE_RP_OAPPEN_MC * -1
    let #RP03a.GPDE_RP_SIDAYS = &RP03a.GPDE_RP_SIDAYS * -1
    let #RP03a.GPDE_RP_AVDAYS = &RP03a.GPDE_RP_AVDAYS * -1
    let #RP03a.GPDE_RP_KVDAYS = &RP03a.GPDE_RP_KVDAYS * -1
    let #RP03a.GPDE_RP_PVDAYS = &RP03a.GPDE_RP_PVDAYS * -1
    let #RP03a.GPDE_RP_AVDAYS_BON = &RP03a.GPDE_RP_AVDAYS_BON * -1
    let #RP03a.GPDE_RP_KVDAYS_BON = &RP03a.GPDE_RP_KVDAYS_BON * -1
    let #RP03a.GPDE_RP_PVDAYS_BON = &RP03a.GPDE_RP_PVDAYS_BON * -1
    let #RP03a.GPDE_RP_RVDAYS_BON = &RP03a.GPDE_RP_RVDAYS_BON * -1
    let #RP03a.GPDE_RP_AVGRS_ANLZ = &RP03a.GPDE_RP_AVGRS_ANLZ * -1
    let #RP03a.GPDE_RP_AVGRS_BON = &RP03a.GPDE_RP_AVGRS_BON * -1
    let #RP03a.GPDE_RP_AVGRS_MC = &RP03a.GPDE_RP_AVGRS_MC * -1
    let #RP03a.GPDE_RP_KVGRS_ANLZ = &RP03a.GPDE_RP_KVGRS_ANLZ * -1
    let #RP03a.GPDE_RP_KVGRS_BON = &RP03a.GPDE_RP_KVGRS_BON * -1
    let #RP03a.GPDE_RP_KVGRS_MC = &RP03a.GPDE_RP_KVGRS_MC * -1
    let #RP03a.GPDE_RP_PVGRS_ANLZ = &RP03a.GPDE_RP_PVGRS_ANLZ * -1
    let #RP03a.GPDE_RP_PVGRS_BON = &RP03a.GPDE_RP_PVGRS_BON * -1
    let #RP03a.GPDE_RP_PVGRS_MC = &RP03a.GPDE_RP_PVGRS_MC * -1
    let #RP03a.GPDE_RP_RVGRS_ANLZ = &RP03a.GPDE_RP_RVGRS_ANLZ * -1
    let #RP03a.GPDE_RP_RVGRS_BON = &RP03a.GPDE_RP_RVGRS_BON * -1
    let #RP03a.GPDE_RP_RVGRS_MC = &RP03a.GPDE_RP_RVGRS_MC * -1
    let #RP03a.GPDE_RP_AVLFD_AG = &RP03a.GPDE_RP_AVLFD_AG * -1
    let #RP03a.GPDE_RP_AVLFD_AN = &RP03a.GPDE_RP_AVLFD_AN * -1
    let #RP03a.GPDE_RP_KVLFD_AG = &RP03a.GPDE_RP_KVLFD_AG * -1
    let #RP03a.GPDE_RP_KVLFD_AN = &RP03a.GPDE_RP_KVLFD_AN * -1
    let #RP03a.GPDE_RP_PVLFD_AG = &RP03a.GPDE_RP_PVLFD_AG * -1
    let #RP03a.GPDE_RP_PVLFD_AN = &RP03a.GPDE_RP_PVLFD_AN * -1
    let #RP03a.GPDE_RP_RVLFD_AG = &RP03a.GPDE_RP_RVLFD_AG * -1
    let #RP03a.GPDE_RP_RVLFD_AN = &RP03a.GPDE_RP_RVLFD_AN * -1
    let #RP03a.GPDE_RP_KVBON_AG = &RP03a.GPDE_RP_KVBON_AG * -1
    let #RP03a.GPDE_RP_KVBON_AN = &RP03a.GPDE_RP_KVBON_AN * -1
    let #RP03a.GPDE_RP_AVBON_AG = &RP03a.GPDE_RP_AVBON_AG * -1
    let #RP03a.GPDE_RP_AVBON_AN = &RP03a.GPDE_RP_AVBON_AN * -1
    let #RP03a.GPDE_RP_PVBON_AG = &RP03a.GPDE_RP_PVBON_AG * -1
    let #RP03a.GPDE_RP_PVBON_AN = &RP03a.GPDE_RP_PVBON_AN * -1
    let #RP03a.GPDE_RP_RVBON_AG = &RP03a.GPDE_RP_RVBON_AG * -1
    let #RP03a.GPDE_RP_RVBON_AN = &RP03a.GPDE_RP_RVBON_AN * -1
    let #RP03a.GPDE_RP_AVAG_MC = &RP03a.GPDE_RP_AVAG_MC * -1
    let #RP03a.GPDE_RP_AVAN_MC = &RP03a.GPDE_RP_AVAN_MC * -1
    let #RP03a.GPDE_RP_KVAG_MC = &RP03a.GPDE_RP_KVAG_MC * -1
    let #RP03a.GPDE_RP_KVAN_MC = &RP03a.GPDE_RP_KVAN_MC * -1
    let #RP03a.GPDE_RP_PVAG_MC = &RP03a.GPDE_RP_PVAG_MC * -1
    let #RP03a.GPDE_RP_PVAN_MC = &RP03a.GPDE_RP_PVAN_MC * -1
    let #RP03a.GPDE_RP_RVAG_MC = &RP03a.GPDE_RP_RVAG_MC * -1
    let #RP03a.GPDE_RP_RVAN_MC = &RP03a.GPDE_RP_RVAN_MC * -1
    let #RP03a.GPDE_RP_SIGRUNLM_A = &RP03a.GPDE_RP_SIGRUNLM_A * -1
    let #RP03a.GPDE_RP_SIGRUNLM_B = &RP03a.GPDE_RP_SIGRUNLM_B * -1
    let #RP03a.GPDE_RP_CIVLER_AMT = &RP03a.GPDE_RP_CIVLER_AMT * -1
    let #RP03a.GPDE_RP_HIVLER_AMT = &RP03a.GPDE_RP_HIVLER_AMT * -1
    let #RP03a.GPDE_RP_AZGRS_BON = &RP03a.GPDE_RP_AZGRS_BON * -1
    let #RP03a.GPDE_RP_OAPPEN_ANL = &RP03a.GPDE_RP_OAPPEN_ANL * -1
    let #RP03a.GPDE_RP_OAPPEN_BON = &RP03a.GPDE_RP_OAPPEN_BON * -1
    let #RP03a.GPDE_RP_AVDAYS_MC = &RP03a.GPDE_RP_AVDAYS_MC * -1
    let #RP03a.GPDE_RP_KVDAYS_MC = &RP03a.GPDE_RP_KVDAYS_MC * -1
    let #RP03a.GPDE_RP_PVDAYS_MC = &RP03a.GPDE_RP_PVDAYS_MC * -1
    let #RP03a.GPDE_RP_RVDAYS_MC = &RP03a.GPDE_RP_RVDAYS_MC * -1
    let #RP03a.GPDE_AZ_RP_S03_31 = &RP03a.GPDE_AZ_RP_S03_31 * -1
    let #RP03a.GPDE_AZ_RP_S03_41 = &RP03a.GPDE_AZ_RP_S03_41 * -1
    let #RP02a.GPDE_TX_MJ_LUMP =  &RP02a.GPDE_TX_MJ_LUMP * -1
    let $SI01R.GPDE_SI_IS_KVDR = &SI01R.GPDE_SI_IS_KVDR

    if rtrim($SI01R.GPDE_SI_IS_KVDR, ' ') = ''
       let $SI01R.GPDE_SI_IS_KVDR = 'N'
    end-if

    ! for conformity
    let $SI01R.GPDE_SI_PV_CHILD = &SI01R.GPDE_SI_PV_CHILD
    ! wdu06-881kug
    let #RP03a.GPDE_RP_KUG_KVCTB = &RP03a.GPDE_RP_KUG_KVCTB * -1
    let #RP03a.GPDE_RP_KUG_PVCTB = &RP03a.GPDE_RP_KUG_PVCTB * -1
    let #RP03a.GPDE_RP_KUG_RVCTB = &RP03a.GPDE_RP_KUG_RVCTB * -1
    let #RP03a.GPDE_RP_KUG_KVGRS = &RP03a.GPDE_RP_KUG_KVGRS * -1
    let #RP03a.GPDE_RP_KUG_PVGRS = &RP03a.GPDE_RP_KUG_PVGRS * -1
    let #RP03a.GPDE_RP_KUG_RVGRS = &RP03a.GPDE_RP_KUG_RVGRS * -1

    let $GZFlag = &SI01R.GPDE_RP_RV_GZ_FLG
!adj08-890b16: RI insolvency
    let #RP03a.GPDE_RP_GRSS_INSOL = &RP03a.GPDE_RP_GRSS_INSOL * -1
    let #RP03a.GPDE_RP_UML_INSOLV = &RP03a.GPDE_RP_UML_INSOLV * -1
    let #SI01R.GPDE_RP_MARCH_CLS  = &SI01R.GPDE_RP_MARCH_CLS
    let #RP03a.GPDE_RP_GRS_INS_MC = &RP03a.GPDE_RP_GRS_INS_MC * -1
    let #RP03a.GPDE_RP_UML_INS_MC = &RP03a.GPDE_RP_UML_INS_MC * -1

       do Filldat
FROM PS_GPDE_RP_0001 RP01b, PS_GPDE_RP_0003 RP03a ,
      PS_GPDE_RP_SI01 SI01R, PS_GPDE_RP_0002 RP02a
WHERE RP03a.EMPLID = &SI10D.EMPLID
  AND RP03a.EMPL_RCD = &SI10D.EMPL_RCD
  AND RP03a.GP_PAYGROUP = &SI10D.GP_PAYGROUP
  AND RP03a.CAL_ID       = &SI10D.CAL_ID
  AND SI01R.EMPLID = RP03a.EMPLID
  AND SI01R.CAL_RUN_ID = RP03a.CAL_RUN_ID
  AND SI01R.EMPL_RCD = RP03a.EMPL_RCD
  AND SI01R.GP_PAYGROUP = RP03a.GP_PAYGROUP
  AND SI01R.CAL_ID = RP03a.CAL_ID
  AND SI01R.RSLT_SEG_NUM = RP03a.RSLT_SEG_NUM
  AND SI01R.SEG_END_DT = RP03a.SEG_END_DT
  AND SI01R.SLICE_END_DT = RP03a.SLICE_END_DT
  AND RP01b.EMPLID = RP03a.EMPLID
  AND RP01b.CAL_RUN_ID = RP03a.CAL_RUN_ID
  AND RP01b.EMPL_RCD = RP03a.EMPL_RCD
  AND RP01b.GP_PAYGROUP = RP03a.GP_PAYGROUP
  AND RP01b.CAL_ID = RP03a.CAL_ID
  AND RP01b.RSLT_SEG_NUM = RP03a.RSLT_SEG_NUM
  AND RP01b.SEG_END_DT = RP03a.SEG_END_DT
  AND RP01b.GPDE_AL_CPAY_ENDDT = RP03a.GPDE_AL_CPAY_ENDDT
  AND RP03a.GPDE_AL_CPAY_ENDDT =
  (select MAX(BX.GPDE_AL_CPAY_ENDDT) from PS_GPDE_RP_0003 BX
    where BX.EMPLID = RP03a.EMPLID
      AND BX.EMPL_RCD = RP03a.EMPL_RCD
      AND BX.GP_PAYGROUP = RP03a.GP_PAYGROUP
      AND BX.CAL_ID = RP03a.CAL_ID
      AND BX.GPDE_AL_CPAY_ENDDT < $Ctl_Curr_Pay_End_Dt)
  AND SI01R.PRD_END_DT < $Ctl_Curr_Pay_End_Dt

  AND RP01b.EMPLID = RP02a.EMPLID
  AND RP01b.CAL_RUN_ID = RP02a.CAL_RUN_ID
  AND RP01b.EMPL_RCD = RP02a.EMPL_RCD
  AND RP01b.GP_PAYGROUP = RP02a.GP_PAYGROUP
  AND RP01b.CAL_ID = RP02a.CAL_ID
  AND RP01b.RSLT_SEG_NUM = RP02a.RSLT_SEG_NUM
  AND RP01b.SEG_END_DT = RP02a.SEG_END_DT
end-select
end-procedure
!****************************************************************



begin-procedure Filldat
! enter storno payroll data for the emplid into the local reporting table.
! these rows complement all data except the last row for the +/- display.
Begin-Sql
INSERT INTO PS_GPDE_RP_SI10
 (EMPLID,
  CAL_RUN_ID,
  EMPL_RCD,
  GP_PAYGROUP,
  CAL_ID,
  RSLT_SEG_NUM,
  SLICE_END_DT,
  PAY_ENTITY,
  PRD_END_DT,
  GPDE_AL_CPAY_ENDDT,
  GPDE_RP_SIGRSS_AMT,
  GPDE_RP_SIGRS_ANLZ,
  GPDE_RP_HICNTB_AMT,
  GPDE_RP_PICNTB_AMT,
  GPDE_RP_UICNTB_AMT,
  GPDE_RP_CICNTB_AMT,
  GPDE_RP_HIVOL_AMT,
  GPDE_RP_CIVOL_AMT,
  GPDE_RP_RIGRSS_AMT,
  GPDE_RP_U1CNTB_AMT,
  GPDE_RP_U2CNTB_AMT,
  GPDE_RI_PCT1,
  GPDE_RI_PCT2,
  GPDE_RP_RIGRSM_AMT,
  GPDE_RP_U1CTBM_AMT,
  GPDE_RP_U2CTBM_AMT,
  GPDE_RI_PCT1_MC,
  GPDE_RI_PCT2_MC,
  GPDE_RP_SIGRSM_AMT,
  GPDE_RP_HICTBM_AMT,
  GPDE_RP_PICTBM_AMT,
  GPDE_RP_UICTBM_AMT,
  GPDE_RP_CICTBM_AMT,
  GPDE_RP_OAPGRS_AMT,
  GPDE_RP_AZGRS_ANLZ,
  GPDE_RP_OAPPEN_AMT,
  GPDE_RP_OAPGRS_MC,
  GPDE_RP_OAPPEN_MC,
  GPDE_RP_SIDAYS,
  GPDE_RP_AVDAYS,
  GPDE_RP_KVDAYS,
  GPDE_RP_PVDAYS,
  GPDE_RP_AVDAYS_BON,
  GPDE_RP_KVDAYS_BON,
  GPDE_RP_PVDAYS_BON,
  GPDE_RP_RVDAYS_BON,
  GPDE_RP_AVGRS_ANLZ,
  GPDE_RP_AVGRS_BON,
  GPDE_RP_AVGRS_MC,
  GPDE_RP_KVGRS_ANLZ,
  GPDE_RP_KVGRS_BON,
  GPDE_RP_KVGRS_MC,
  GPDE_RP_PVGRS_ANLZ,
  GPDE_RP_PVGRS_BON,
  GPDE_RP_PVGRS_MC,
  GPDE_RP_RVGRS_ANLZ,
  GPDE_RP_RVGRS_BON,
  GPDE_RP_RVGRS_MC,
  GPDE_RP_AVLFD_AG,
  GPDE_RP_AVLFD_AN,
  GPDE_RP_KVLFD_AG,
  GPDE_RP_KVLFD_AN,
  GPDE_RP_PVLFD_AG,
  GPDE_RP_PVLFD_AN,
  GPDE_RP_RVLFD_AG,
  GPDE_RP_RVLFD_AN,
  GPDE_RP_KVBON_AG,
  GPDE_RP_KVBON_AN,
  GPDE_RP_AVBON_AG,
  GPDE_RP_AVBON_AN,
  GPDE_RP_PVBON_AG,
  GPDE_RP_PVBON_AN,
  GPDE_RP_RVBON_AG,
  GPDE_RP_RVBON_AN,
  GPDE_RP_AVAG_MC,
  GPDE_RP_AVAN_MC,
  GPDE_RP_KVAG_MC,
  GPDE_RP_KVAN_MC,
  GPDE_RP_PVAG_MC,
  GPDE_RP_PVAN_MC,
  GPDE_RP_RVAG_MC,
  GPDE_RP_RVAN_MC,
  GPDE_RP_SIGRUNLM_A,
  GPDE_RP_SIGRUNLM_B,
  GPDE_RP_CIVLER_AMT,
  GPDE_RP_HIVLER_AMT,
  GPDE_RC_PRT_SIGN,
  GPDE_SI_PROV_AV,
  GPDE_SI_PROV_KV,
  GPDE_SI_PROV_PV,
  GPDE_SI_PROV_RV,
  GPDE_SI_PROV_UM,
  GPDE_SI_PROV_AV_M,
  GPDE_SI_PROV_KV_M,
  GPDE_SI_PROV_PV_M,
  GPDE_SI_PROV_RV_M,
  GPDE_SI_PROV_UM_M,
  GPDE_RP_AZGRS_BON,
  GPDE_RP_OAPPEN_ANL,
  GPDE_RP_OAPPEN_BON,
  GPDE_RP_AVDAYS_MC,
  GPDE_RP_KVDAYS_MC,
  GPDE_RP_PVDAYS_MC,
  GPDE_RP_RVDAYS_MC,
  GPDE_TX_MJ_LUMP,
  GPDE_AZ_RP_S03_31,
  GPDE_AZ_RP_S03_41,
  GPDE_SI_IS_KVDR,
  GPDE_SI_PV_CHILD,
  !wdu06-881kug
  GPDE_RP_KUG_KVCTB,
  GPDE_RP_KUG_PVCTB,
  GPDE_RP_KUG_RVCTB,
  GPDE_RP_KUG_KVGRS,
  GPDE_RP_KUG_PVGRS,
  GPDE_RP_KUG_RVGRS,
  ! JJJ-890B10-kug
  GPDE_KU_KUGAMT,
  GPDE_KU_KUGKKAMT,
  ! JJJ-890B10-sfn
  GPDE_RP_SFN_SI_ABL,
  ! JJJ-890B10-gz
  GPDE_RP_RV_GZ_FLG,
  !adj08-890b16: RI insolvency
  GPDE_RP_GRSS_INSOL,
  GPDE_RP_UML_INSOLV,
  GPDE_RP_MARCH_CLS,
  GPDE_RP_GRS_INS_MC,
  GPDE_RP_UML_INS_MC
  )
   values
  (&RP03a.EMPLID,
  &RP03a.CAL_RUN_ID,
  &RP03a.EMPL_RCD,
  &RP03a.GP_PAYGROUP,
  &RP03a.CAL_ID,
  &RP03a.RSLT_SEG_NUM,
  &RP03a.SLICE_END_DT,
  &RP03a.PAY_ENTITY,
  &RP03a.PRD_END_DT,
  &RP03a.GPDE_AL_CPAY_ENDDT,
  #RP03a.GPDE_RP_SIGRSS_AMT,
  #RP03a.GPDE_RP_SIGRS_ANLZ,
  #RP03a.GPDE_RP_HICNTB_AMT,
  #RP03a.GPDE_RP_PICNTB_AMT,
  #RP03a.GPDE_RP_UICNTB_AMT,
  #RP03a.GPDE_RP_CICNTB_AMT,
  #RP03a.GPDE_RP_HIVOL_AMT ,
  #RP03a.GPDE_RP_CIVOL_AMT ,
  #RP03a.GPDE_RP_RIGRSS_AMT,
  #RP03a.GPDE_RP_U1CNTB_AMT,
  #RP03a.GPDE_RP_U2CNTB_AMT,
  &SI01R.GPDE_RI_PCT1,
  &SI01R.GPDE_RI_PCT2,
  #RP03a.GPDE_RP_RIGRSM_AMT,
  #RP03a.GPDE_RP_U1CTBM_AMT,
  #RP03a.GPDE_RP_U2CTBM_AMT ,
  &SI01R.GPDE_RI_PCT1_MC,
  &SI01R.GPDE_RI_PCT2_MC,
  #RP03a.GPDE_RP_SIGRSM_AMT,
  #RP03a.GPDE_RP_HICTBM_AMT,
  #RP03a.GPDE_RP_PICTBM_AMT,
  #RP03a.GPDE_RP_UICTBM_AMT,
  #RP03a.GPDE_RP_CICTBM_AMT,
  #RP03a.GPDE_RP_OAPGRS_AMT,
  #RP03a.GPDE_RP_AZGRS_ANLZ,
  #RP03a.GPDE_RP_OAPPEN_AMT,
  #RP03a.GPDE_RP_OAPGRS_MC ,
  #RP03a.GPDE_RP_OAPPEN_MC ,
  #RP03a.GPDE_RP_SIDAYS ,
  #RP03a.GPDE_RP_AVDAYS ,
  #RP03a.GPDE_RP_KVDAYS ,
  #RP03a.GPDE_RP_PVDAYS ,
  #RP03a.GPDE_RP_AVDAYS_BON ,
  #RP03a.GPDE_RP_KVDAYS_BON ,
  #RP03a.GPDE_RP_PVDAYS_BON ,
  #RP03a.GPDE_RP_RVDAYS_BON ,
  #RP03a.GPDE_RP_AVGRS_ANLZ ,
  #RP03a.GPDE_RP_AVGRS_BON ,
  #RP03a.GPDE_RP_AVGRS_MC ,
  #RP03a.GPDE_RP_KVGRS_ANLZ ,
  #RP03a.GPDE_RP_KVGRS_BON ,
  #RP03a.GPDE_RP_KVGRS_MC ,
  #RP03a.GPDE_RP_PVGRS_ANLZ,
  #RP03a.GPDE_RP_PVGRS_BON ,
  #RP03a.GPDE_RP_PVGRS_MC ,
  #RP03a.GPDE_RP_RVGRS_ANLZ ,
  #RP03a.GPDE_RP_RVGRS_BON ,
  #RP03a.GPDE_RP_RVGRS_MC ,
  #RP03a.GPDE_RP_AVLFD_AG ,
  #RP03a.GPDE_RP_AVLFD_AN ,
  #RP03a.GPDE_RP_KVLFD_AG ,
  #RP03a.GPDE_RP_KVLFD_AN ,
  #RP03a.GPDE_RP_PVLFD_AG ,
  #RP03a.GPDE_RP_PVLFD_AN ,
  #RP03a.GPDE_RP_RVLFD_AG ,
  #RP03a.GPDE_RP_RVLFD_AN ,
  #RP03a.GPDE_RP_KVBON_AG ,
  #RP03a.GPDE_RP_KVBON_AN ,
  #RP03a.GPDE_RP_AVBON_AG ,
  #RP03a.GPDE_RP_AVBON_AN ,
  #RP03a.GPDE_RP_PVBON_AG ,
  #RP03a.GPDE_RP_PVBON_AN ,
  #RP03a.GPDE_RP_RVBON_AG ,
  #RP03a.GPDE_RP_RVBON_AN ,
  #RP03a.GPDE_RP_AVAG_MC ,
  #RP03a.GPDE_RP_AVAN_MC ,
  #RP03a.GPDE_RP_KVAG_MC ,
  #RP03a.GPDE_RP_KVAN_MC ,
  #RP03a.GPDE_RP_PVAG_MC ,
  #RP03a.GPDE_RP_PVAN_MC ,
  #RP03a.GPDE_RP_RVAG_MC ,
  #RP03a.GPDE_RP_RVAN_MC ,
  #RP03a.GPDE_RP_SIGRUNLM_A ,
  #RP03a.GPDE_RP_SIGRUNLM_B ,
  #RP03a.GPDE_RP_CIVLER_AMT ,
  #RP03a.GPDE_RP_HIVLER_AMT ,
  'R',
  &SI01R.GPDE_SI_PROV_AV,
  &SI01R.GPDE_SI_PROV_KV,
  &SI01R.GPDE_SI_PROV_PV,
  &SI01R.GPDE_SI_PROV_RV,
  &SI01R.GPDE_SI_PROV_UM,
  $SI01R.GPDE_SI_PROV_AV_M,
  $SI01R.GPDE_SI_PROV_KV_M,
  $SI01R.GPDE_SI_PROV_PV_M,
  $SI01R.GPDE_SI_PROV_RV_M,
!adj09:RI March Cls provider value is blank, use provider from current year
!$SI01R.GPDE_SI_PROV_UM_M,
  &SI01R.GPDE_SI_PROV_UM,
  #RP03a.GPDE_RP_AZGRS_BON ,
  #RP03a.GPDE_RP_OAPPEN_ANL,
  #RP03a.GPDE_RP_OAPPEN_BON,
  #RP03a.GPDE_RP_AVDAYS_MC ,
  #RP03a.GPDE_RP_KVDAYS_MC ,
  #RP03a.GPDE_RP_PVDAYS_MC ,
  #RP03a.GPDE_RP_RVDAYS_MC,
  #RP02a.GPDE_TX_MJ_LUMP,
  #RP03a.GPDE_AZ_RP_S03_31,
  #RP03a.GPDE_AZ_RP_S03_41,
  $SI01R.GPDE_SI_IS_KVDR,
  $SI01R.GPDE_SI_PV_CHILD,
  !wdu06-881kug
  #RP03a.GPDE_RP_KUG_KVCTB,
  #RP03a.GPDE_RP_KUG_PVCTB,
  #RP03a.GPDE_RP_KUG_RVCTB,
  #RP03a.GPDE_RP_KUG_KVGRS,
  #RP03a.GPDE_RP_KUG_PVGRS,
  #RP03a.GPDE_RP_KUG_RVGRS ,
  ! JJJ-890B10-kug
  #kugamt,
  #kugkkamt,
  ! JJJ-890B10-sfn
  #SFNGPDE_RP_SFN_SI_ABL,
  ! JJJ-890B10-gz
  $GZFlag,
!adj08-890b16: RI insolvency
  #RP03a.GPDE_RP_GRSS_INSOL,
  #RP03a.GPDE_RP_UML_INSOLV,
  #SI01R.GPDE_RP_MARCH_CLS,
  #RP03a.GPDE_RP_GRS_INS_MC,
  #RP03a.GPDE_RP_UML_INS_MC
  )
  end-sql
end-procedure




begin-procedure MarkNewVersionRows
! wdu06-881b11: changed the logic for marking new version rows ('N')
! replaces procedures: Initial_OldNew_Row and UpdData_OLNW
!
begin-sql
update PS_GPDE_RP_SI10
set GPDE_RC_PRT_SIGN = 'N'
where GPDE_RC_PRT_SIGN = 'A'
  AND GPDE_AL_CPAY_ENDDT = $Ctl_Curr_Pay_End_Dt
  AND PRD_END_DT < $Ctl_Curr_Pay_End_Dt
end-sql
end-procedure



! wdu06-881b11: removed old logic for marking new version rows ('N')
! --- !****************************************************************
! --- begin-procedure Initial_OldNew_Row
! --- begin-select
! --- OLNW.EMPLID            &OLNW.EMPLID
! --- OLNW.EMPL_RCD          &OLNW.EMPL_RCD
! --- OLNW.GP_PAYGROUP       &OLNW.GP_PAYGROUP
! --- OLNW.CAL_ID            &OLNW.CAL_ID
! --- OLNW.RSLT_SEG_NUM      &OLNW.RSLT_SEG_NUM
! --- OLNW.SLICE_END_DT      &OLNW.SLICE_END_DT
! ---    do UpdData_OLNW
! --- from PS_GPDE_RP_SI10 OLNW
! --- where OLNW.GPDE_RC_PRT_SIGN = 'R'
! --- end-select
! --- end-procedure
! --- !****************************************************************
! --- begin-procedure UpdData_OLNW
! --- begin-sql
! --- update PS_GPDE_RP_SI10
! --- set GPDE_RC_PRT_SIGN = 'N'
! --- where EMPLID = &OLNW.EMPLID
! ---   AND EMPL_RCD = &OLNW.EMPL_RCD
! ---   AND GP_PAYGROUP = &OLNW.GP_PAYGROUP
! ---   AND CAL_ID = &OLNW.CAL_ID
! ---   AND SLICE_END_DT = &OLNW.SLICE_END_DT
! ---   AND GPDE_RC_PRT_SIGN = 'A'
! ---   AND GPDE_AL_CPAY_ENDDT = $Ctl_Curr_Pay_End_Dt
! ---   AND PRD_END_DT < $Ctl_Curr_Pay_End_Dt
! --- end-sql
! --- end-procedure
! --- !****************************************************************




begin-procedure Prepare-Print-Data
!
! create a list of all affected providers out of the employees actual providers.
!
begin-sql
  delete from PS_GPDE_RP_SI10A
end-sql

begin-sql
  delete from PS_GPDE_RP_SI10B
end-sql

! each row in GPDE_RP_SI10 has a number of provider fields.
! for current or retro periods, we need all providers.
let $TempField = 'SI10T.GPDE_SI_PROV_KV'
let $TempField1 = 'SI10T.GPDE_SI_PROV_KV'
do ExtractProvider

let $TempField = 'SI10T.GPDE_SI_PROV_PV'
let $TempField1 = 'SI10T.GPDE_SI_PROV_PV'
do ExtractProvider
let $TempField = 'SI10T.GPDE_SI_PROV_RV'
let $TempField1 = 'SI10T.GPDE_SI_PROV_RV'
do ExtractProvider
let $TempField = 'SI10T.GPDE_SI_PROV_AV'
let $TempField1 = 'SI10T.GPDE_SI_PROV_AV'
do ExtractProvider
let $TempField = 'SI10T.GPDE_SI_PROV_UM'
let $TempField1 = 'SI10T.GPDE_SI_PROV_UM'
do ExtractProvider
let $TempField = 'SI10T.GPDE_SI_PROV_KV_M'
let $TempField1 = 'SI10T.GPDE_SI_PROV_KV_M'
do ExtractProvider
let $TempField = 'SI10T.GPDE_SI_PROV_PV_M'
let $TempField1 = 'SI10T.GPDE_SI_PROV_PV_M'
do ExtractProvider
let $TempField = 'SI10T.GPDE_SI_PROV_RV_M'
let $TempField1 = 'SI10T.GPDE_SI_PROV_RV_M'
do ExtractProvider
let $TempField = 'SI10T.GPDE_SI_PROV_AV_M'
let $TempField1 = 'SI10T.GPDE_SI_PROV_AV_M'
do ExtractProvider
let $TempField = 'SI10T.GPDE_SI_PROV_UM_M'
let $TempField1 = 'SI10T.GPDE_SI_PROV_UM_M'
do ExtractProvider
! wdu05b7: moved statements to process-main
! --- do Prepare_Fill_Result_Data
! --- do Prepare_Result_Data_Freiw
end-procedure
!****************************************************************



begin-procedure Prepare_Fill_Result_Data
!
! select all providers in a loop
!
!
let #Countr = 1
begin-select distinct
B2.GPDE_SI_PROV_MAND &B2.GPDE_SI_PROV_MAND=char
  if rtrim(&B2.GPDE_SI_PROV_MAND,' ') <> ''
       ! sum data over the emplids for this provider only !
       ! wdu05b7: split of marchclause and other fields
       ! -------------------------------------------------------
       ! we need to split marchclause and regular prev-year rows and make
       ! 2 rows out of one.
       !    - we want 1 row with the marchclause values only
       !    - we want 1 row with the NON-marchclause values only
       ! we achieve this by running this procedure twice with the
       ! parameter:
       !    $MarchSplit = 'M'   ==> we want marchclause values only
       !                        no write happens when there are no march values.
       !                        Machclauses get the non-march fields cleared.
       !    $MarchSplit = 'N'   ==> we want normal values only
       !                        Machclauses get the march fields cleared.
       !                        Non-Marchclause rows just get stored
       ! all values that we do not need, we set to zero
       ! -------------------------------------------------------
       let $MarchSplit = 'M'
       do Fill_Result_Data
       let $MarchSplit = 'N'
       do Fill_Result_Data
       !
  end-if
from PS_GPDE_RP_SI10B B2
end-select
end-procedure
!****************************************************************



! JJJ-890B10-kug
begin-procedure Fill_Result_Data
!
! the purpose of this procedure is to select only those amounts, which belong
! to the currently checked provider (&B2.GPDE_SI_PROV_MAND) and ignore data
! for the other providers an emplid might have
!
! rows with Marchclause will create 2 result rows, others only one.
!
begin-select
B3.EMPLID
B3.CAL_RUN_ID
B3.EMPL_RCD
B3.GP_PAYGROUP
B3.CAL_ID
B3.RSLT_SEG_NUM
B3.SLICE_END_DT
B3.PAY_ENTITY
B3.PRD_END_DT
B3.GPDE_AL_CPAY_ENDDT
B3.GPDE_RP_SIGRSS_AMT
B3.GPDE_RP_SIGRS_ANLZ
B3.GPDE_RP_HICNTB_AMT
B3.GPDE_RP_PICNTB_AMT
B3.GPDE_RP_UICNTB_AMT
B3.GPDE_RP_CICNTB_AMT
B3.GPDE_RP_HIVOL_AMT
B3.GPDE_RP_CIVOL_AMT
B3.GPDE_RP_RIGRSS_AMT
B3.GPDE_RP_U1CNTB_AMT
B3.GPDE_RP_U2CNTB_AMT
B3.GPDE_RI_PCT1
B3.GPDE_RI_PCT2
B3.GPDE_RP_RIGRSM_AMT
B3.GPDE_RP_U1CTBM_AMT
B3.GPDE_RP_U2CTBM_AMT
B3.GPDE_RI_PCT1_MC
B3.GPDE_RI_PCT2_MC
B3.GPDE_RP_SIGRSM_AMT
B3.GPDE_RP_HICTBM_AMT
B3.GPDE_RP_PICTBM_AMT
B3.GPDE_RP_UICTBM_AMT
B3.GPDE_RP_CICTBM_AMT
B3.GPDE_RP_OAPGRS_AMT
B3.GPDE_RP_AZGRS_ANLZ
B3.GPDE_RP_OAPPEN_AMT
B3.GPDE_RP_OAPGRS_MC
B3.GPDE_RP_OAPPEN_MC
B3.GPDE_RP_SIDAYS
B3.GPDE_RP_AVDAYS
B3.GPDE_RP_KVDAYS
B3.GPDE_RP_PVDAYS
B3.GPDE_RP_AVDAYS_BON
B3.GPDE_RP_KVDAYS_BON
B3.GPDE_RP_PVDAYS_BON
B3.GPDE_RP_RVDAYS_BON
B3.GPDE_RP_AVGRS_ANLZ
B3.GPDE_RP_AVGRS_BON
B3.GPDE_RP_AVGRS_MC
B3.GPDE_RP_KVGRS_ANLZ
B3.GPDE_RP_KVGRS_BON
B3.GPDE_RP_KVGRS_MC
B3.GPDE_RP_PVGRS_ANLZ
B3.GPDE_RP_PVGRS_BON
B3.GPDE_RP_PVGRS_MC
B3.GPDE_RP_RVGRS_ANLZ
B3.GPDE_RP_RVGRS_BON
B3.GPDE_RP_RVGRS_MC
B3.GPDE_RP_AVLFD_AG
B3.GPDE_RP_AVLFD_AN
B3.GPDE_RP_KVLFD_AG
B3.GPDE_RP_KVLFD_AN
B3.GPDE_RP_PVLFD_AG
B3.GPDE_RP_PVLFD_AN
B3.GPDE_RP_RVLFD_AG
B3.GPDE_RP_RVLFD_AN
B3.GPDE_RP_KVBON_AG
B3.GPDE_RP_KVBON_AN
B3.GPDE_RP_AVBON_AG
B3.GPDE_RP_AVBON_AN
B3.GPDE_RP_PVBON_AG
B3.GPDE_RP_PVBON_AN
B3.GPDE_RP_RVBON_AG
B3.GPDE_RP_RVBON_AN
B3.GPDE_RP_AVAG_MC
B3.GPDE_RP_AVAN_MC
B3.GPDE_RP_KVAG_MC
B3.GPDE_RP_KVAN_MC
B3.GPDE_RP_PVAG_MC
B3.GPDE_RP_PVAN_MC
B3.GPDE_RP_RVAG_MC
B3.GPDE_RP_RVAN_MC
B3.GPDE_RP_SIGRUNLM_A
B3.GPDE_RP_SIGRUNLM_B
B3.GPDE_RP_CIVLER_AMT
B3.GPDE_RP_HIVLER_AMT
B3.GPDE_RC_PRT_SIGN
B3.GPDE_SI_PROV_AV
B3.GPDE_SI_PROV_KV
B3.GPDE_SI_PROV_PV
B3.GPDE_SI_PROV_RV
B3.GPDE_SI_PROV_UM
B3.GPDE_SI_PROV_AV_M
B3.GPDE_SI_PROV_KV_M
B3.GPDE_SI_PROV_PV_M
B3.GPDE_SI_PROV_RV_M
B3.GPDE_SI_PROV_UM_M
B3.GPDE_RP_AZGRS_BON
B3.GPDE_RP_OAPPEN_ANL
B3.GPDE_RP_OAPPEN_BON
B3.GPDE_RP_AVDAYS_MC
B3.GPDE_RP_KVDAYS_MC
B3.GPDE_RP_PVDAYS_MC
B3.GPDE_RP_RVDAYS_MC
B3.GPDE_TX_MJ_LUMP
B3.GPDE_AZ_RP_S03_31
B3.GPDE_AZ_RP_S03_41
B3.GPDE_SI_IS_KVDR
B3.GPDE_SI_PV_CHILD
! wdu06-881kug
B3.GPDE_RP_KUG_KVCTB
B3.GPDE_RP_KUG_PVCTB
B3.GPDE_RP_KUG_RVCTB
B3.GPDE_RP_KUG_KVGRS
B3.GPDE_RP_KUG_PVGRS
B3.GPDE_RP_KUG_RVGRS
! JJJ-890B10-kug
B3.GPDE_KU_KUGAMT
B3.GPDE_KU_KUGKKAMT
! JJJ-890B10-sfn
B3.GPDE_RP_SFN_SI_ABL
! JJJ-890B10-gz
B3.GPDE_RP_RV_GZ_FLG
!adj08-890b16: RI insolvency
B3.GPDE_RP_GRSS_INSOL
B3.GPDE_RP_UML_INSOLV
B3.GPDE_RP_MARCH_CLS
B3.GPDE_RP_GRS_INS_MC
B3.GPDE_RP_UML_INS_MC
   let $ExistProv = 'N'
   ! first we read all values to variables.
   ! if we find out, that the provider is not our current provider
   ! then we just set the amounts to 0 later.
   let #B3.GPDE_RP_SIGRSS_AMT = &B3.GPDE_RP_SIGRSS_AMT
   let #B3.GPDE_RP_SIGRS_ANLZ = &B3.GPDE_RP_SIGRS_ANLZ
   let #B3.GPDE_RP_HICNTB_AMT = &B3.GPDE_RP_HICNTB_AMT
   let #B3.GPDE_RP_PICNTB_AMT = &B3.GPDE_RP_PICNTB_AMT
   let #B3.GPDE_RP_UICNTB_AMT = &B3.GPDE_RP_UICNTB_AMT
   let #B3.GPDE_RP_CICNTB_AMT = &B3.GPDE_RP_CICNTB_AMT
   let #B3.GPDE_RP_HIVOL_AMT  = &B3.GPDE_RP_HIVOL_AMT
   let #B3.GPDE_RP_CIVOL_AMT  = &B3.GPDE_RP_CIVOL_AMT
   let #B3.GPDE_RP_RIGRSS_AMT = &B3.GPDE_RP_RIGRSS_AMT
   let #B3.GPDE_RP_U1CNTB_AMT = &B3.GPDE_RP_U1CNTB_AMT
   let #B3.GPDE_RP_U2CNTB_AMT = &B3.GPDE_RP_U2CNTB_AMT
   let #B3.GPDE_RI_PCT1       = &B3.GPDE_RI_PCT1
   let #B3.GPDE_RI_PCT2       = &B3.GPDE_RI_PCT2
   let #B3.GPDE_RP_RIGRSM_AMT = &B3.GPDE_RP_RIGRSM_AMT
   let #B3.GPDE_RP_U1CTBM_AMT = &B3.GPDE_RP_U1CTBM_AMT
   let #B3.GPDE_RP_U2CTBM_AMT = &B3.GPDE_RP_U2CTBM_AMT
   let #B3.GPDE_RI_PCT1_MC    = &B3.GPDE_RI_PCT1_MC
   let #B3.GPDE_RI_PCT2_MC    = &B3.GPDE_RI_PCT2_MC
   let #B3.GPDE_RP_SIGRSM_AMT = &B3.GPDE_RP_SIGRSM_AMT
   let #B3.GPDE_RP_HICTBM_AMT = &B3.GPDE_RP_HICTBM_AMT
   let #B3.GPDE_RP_PICTBM_AMT = &B3.GPDE_RP_PICTBM_AMT
   let #B3.GPDE_RP_UICTBM_AMT = &B3.GPDE_RP_UICTBM_AMT
   let #B3.GPDE_RP_CICTBM_AMT = &B3.GPDE_RP_CICTBM_AMT
   let #B3.GPDE_RP_OAPGRS_AMT = &B3.GPDE_RP_OAPGRS_AMT
   let #B3.GPDE_RP_AZGRS_ANLZ = &B3.GPDE_RP_AZGRS_ANLZ
   let #B3.GPDE_RP_OAPPEN_AMT = &B3.GPDE_RP_OAPPEN_AMT
   let #B3.GPDE_RP_OAPGRS_MC  = &B3.GPDE_RP_OAPGRS_MC
   let #B3.GPDE_RP_OAPPEN_MC  = &B3.GPDE_RP_OAPPEN_MC
   let #B3.GPDE_RP_SIDAYS     = &B3.GPDE_RP_SIDAYS
   let #B3.GPDE_RP_AVDAYS     = &B3.GPDE_RP_AVDAYS
   let #B3.GPDE_RP_KVDAYS     = &B3.GPDE_RP_KVDAYS
   let #B3.GPDE_RP_PVDAYS     = &B3.GPDE_RP_PVDAYS
   let #B3.GPDE_RP_AVDAYS_BON = &B3.GPDE_RP_AVDAYS_BON
   let #B3.GPDE_RP_KVDAYS_BON = &B3.GPDE_RP_KVDAYS_BON
   let #B3.GPDE_RP_PVDAYS_BON = &B3.GPDE_RP_PVDAYS_BON
   let #B3.GPDE_RP_RVDAYS_BON = &B3.GPDE_RP_RVDAYS_BON
   let #B3.GPDE_RP_AVGRS_ANLZ = &B3.GPDE_RP_AVGRS_ANLZ
   let #B3.GPDE_RP_AVGRS_BON  = &B3.GPDE_RP_AVGRS_BON
   let #B3.GPDE_RP_AVGRS_MC   = &B3.GPDE_RP_AVGRS_MC
   let #B3.GPDE_RP_KVGRS_ANLZ = &B3.GPDE_RP_KVGRS_ANLZ
   let #B3.GPDE_RP_KVGRS_BON  = &B3.GPDE_RP_KVGRS_BON
   let #B3.GPDE_RP_KVGRS_MC   = &B3.GPDE_RP_KVGRS_MC
   let #B3.GPDE_RP_PVGRS_ANLZ = &B3.GPDE_RP_PVGRS_ANLZ
   let #B3.GPDE_RP_PVGRS_BON  = &B3.GPDE_RP_PVGRS_BON
   let #B3.GPDE_RP_PVGRS_MC   = &B3.GPDE_RP_PVGRS_MC
   let #B3.GPDE_RP_RVGRS_ANLZ = &B3.GPDE_RP_RVGRS_ANLZ
   let #B3.GPDE_RP_RVGRS_BON  = &B3.GPDE_RP_RVGRS_BON
   let #B3.GPDE_RP_RVGRS_MC   = &B3.GPDE_RP_RVGRS_MC
   let #B3.GPDE_RP_AVLFD_AG   = &B3.GPDE_RP_AVLFD_AG
   let #B3.GPDE_RP_AVLFD_AN   = &B3.GPDE_RP_AVLFD_AN
   let #B3.GPDE_RP_KVLFD_AG   = &B3.GPDE_RP_KVLFD_AG
   let #B3.GPDE_RP_KVLFD_AN   = &B3.GPDE_RP_KVLFD_AN
   let #B3.GPDE_RP_PVLFD_AG   = &B3.GPDE_RP_PVLFD_AG
   let #B3.GPDE_RP_PVLFD_AN   = &B3.GPDE_RP_PVLFD_AN
   let #B3.GPDE_RP_RVLFD_AG   = &B3.GPDE_RP_RVLFD_AG
   let #B3.GPDE_RP_RVLFD_AN   = &B3.GPDE_RP_RVLFD_AN
   let #B3.GPDE_RP_KVBON_AG   = &B3.GPDE_RP_KVBON_AG
   let #B3.GPDE_RP_KVBON_AN   = &B3.GPDE_RP_KVBON_AN
   let #B3.GPDE_RP_AVBON_AG   = &B3.GPDE_RP_AVBON_AG
   let #B3.GPDE_RP_AVBON_AN   = &B3.GPDE_RP_AVBON_AN
   let #B3.GPDE_RP_PVBON_AG   = &B3.GPDE_RP_PVBON_AG
   let #B3.GPDE_RP_PVBON_AN   = &B3.GPDE_RP_PVBON_AN
   let #B3.GPDE_RP_RVBON_AG   = &B3.GPDE_RP_RVBON_AG
   let #B3.GPDE_RP_RVBON_AN   = &B3.GPDE_RP_RVBON_AN
   let #B3.GPDE_RP_AVAG_MC    = &B3.GPDE_RP_AVAG_MC
   let #B3.GPDE_RP_AVAN_MC    = &B3.GPDE_RP_AVAN_MC
   let #B3.GPDE_RP_KVAG_MC    = &B3.GPDE_RP_KVAG_MC
   let #B3.GPDE_RP_KVAN_MC    = &B3.GPDE_RP_KVAN_MC
   let #B3.GPDE_RP_PVAG_MC    = &B3.GPDE_RP_PVAG_MC
   let #B3.GPDE_RP_PVAN_MC    = &B3.GPDE_RP_PVAN_MC
   let #B3.GPDE_RP_RVAG_MC    = &B3.GPDE_RP_RVAG_MC
   let #B3.GPDE_RP_RVAN_MC    = &B3.GPDE_RP_RVAN_MC
   let #B3.GPDE_RP_SIGRUNLM_A = &B3.GPDE_RP_SIGRUNLM_A
   let #B3.GPDE_RP_SIGRUNLM_B = &B3.GPDE_RP_SIGRUNLM_B
   let #B3.GPDE_RP_CIVLER_AMT = &B3.GPDE_RP_CIVLER_AMT
   let #B3.GPDE_RP_HIVLER_AMT = &B3.GPDE_RP_HIVLER_AMT
   let #B3.GPDE_RP_AZGRS_BON = &B3.GPDE_RP_AZGRS_BON
   let #B3.GPDE_RP_OAPPEN_ANL = &B3.GPDE_RP_OAPPEN_ANL
   let #B3.GPDE_RP_OAPPEN_BON = &B3.GPDE_RP_OAPPEN_BON
   let #B3.GPDE_RP_AVDAYS_MC     = &B3.GPDE_RP_AVDAYS_MC
   let #B3.GPDE_RP_KVDAYS_MC     = &B3.GPDE_RP_KVDAYS_MC
   let #B3.GPDE_RP_PVDAYS_MC     = &B3.GPDE_RP_PVDAYS_MC
   let #B3.GPDE_RP_RVDAYS_MC     = &B3.GPDE_RP_RVDAYS_MC
   let #B3.GPDE_TX_MJ_LUMP       = &B3.GPDE_TX_MJ_LUMP
   let #B3.GPDE_AZ_RP_S03_31     = &B3.GPDE_AZ_RP_S03_31
   let #B3.GPDE_AZ_RP_S03_41     = &B3.GPDE_AZ_RP_S03_41
   !
  !wdu06-881kug
   let #B3.GPDE_RP_KUG_KVCTB     = &B3.GPDE_RP_KUG_KVCTB
   let #B3.GPDE_RP_KUG_PVCTB     = &B3.GPDE_RP_KUG_PVCTB
   let #B3.GPDE_RP_KUG_RVCTB     = &B3.GPDE_RP_KUG_RVCTB
   let #B3.GPDE_RP_KUG_KVGRS     = &B3.GPDE_RP_KUG_KVGRS
   let #B3.GPDE_RP_KUG_PVGRS     = &B3.GPDE_RP_KUG_PVGRS
   let #B3.GPDE_RP_KUG_RVGRS     = &B3.GPDE_RP_KUG_RVGRS

   ! JJJ-890B10-kug
   let #B3.GPDE_KU_KUGAMT            = &B3.GPDE_KU_KUGAMT
   let #B3.GPDE_KU_KUGKKAMT          = &B3.GPDE_KU_KUGKKAMT

   ! JJJ-890B10-sfn
   let #B3.GPDE_RP_SFN_SI_ABL        = &B3.GPDE_RP_SFN_SI_ABL

   ! JJJ-890B10-gz
   let $GZFlag = &B3.GPDE_RP_RV_GZ_FLG
!adj08-890b16: RI insolvency
    let #B3.GPDE_RP_MARCH_CLS  = &B3.GPDE_RP_MARCH_CLS
   !
   ! is our provider selected now (for KV)?
   ! if it is NOT our provider which is selected, then make amounts zero
   !
   !
   ! GUl07-890B10 Marchclause with SI-Provider Change <--
   ! to avoid the preparation of obsolete data in GPDE_RP_SI10A we look at
   ! normal pay only during the preparation of non marchclause (MarchSplit = N)
   if $MarchSplit = 'N'
       if &B3.GPDE_SI_PROV_KV = &B2.GPDE_SI_PROV_MAND
          ! yes it is, keep the populated values
          let $ExistProv = 'Y'
       else
          ! no, this is not our provider, discard the numbers
          let #B3.GPDE_RP_KVGRS_ANLZ = 0
          let #B3.GPDE_RP_KVGRS_BON = 0
          let #B3.GPDE_RP_KVBON_AG = 0
          let #B3.GPDE_RP_KVBON_AN = 0
          let #B3.GPDE_RP_KVLFD_AG = 0
          let #B3.GPDE_RP_KVLFD_AN = 0

          !ChangeFor2004Bundle2: voluntary amounts need reset too.
          let #B3.GPDE_RP_HIVOL_AMT   = 0
          let #B3.GPDE_RP_HIVLER_AMT  =  0

       end-if
       if &B3.GPDE_SI_PROV_AV = &B2.GPDE_SI_PROV_MAND
          let $ExistProv = 'Y'
       else
          let #B3.GPDE_RP_AVGRS_ANLZ = 0
          let #B3.GPDE_RP_AVGRS_BON = 0
          let #B3.GPDE_RP_AVBON_AG = 0
          let #B3.GPDE_RP_AVBON_AN = 0
          let #B3.GPDE_RP_AVLFD_AG = 0
          let #B3.GPDE_RP_AVLFD_AN = 0
       end-if
       if &B3.GPDE_SI_PROV_PV = &B2.GPDE_SI_PROV_MAND
          let $ExistProv = 'Y'
       else
          let #B3.GPDE_RP_PVGRS_ANLZ = 0
          let #B3.GPDE_RP_PVGRS_BON = 0
          let #B3.GPDE_RP_PVBON_AG = 0
          let #B3.GPDE_RP_PVBON_AN = 0
          let #B3.GPDE_RP_PVLFD_AG = 0
          let #B3.GPDE_RP_PVLFD_AN = 0

          !ChangeFor2004Bundle2: voluntary amounts need reset too.
          let #B3.GPDE_RP_CIVOL_AMT   = 0
          let #B3.GPDE_RP_CIVLER_AMT  =  0

       end-if
       if &B3.GPDE_SI_PROV_RV = &B2.GPDE_SI_PROV_MAND
          let $ExistProv = 'Y'
       else
          let #B3.GPDE_RP_RVGRS_ANLZ = 0
          let #B3.GPDE_RP_RVGRS_BON = 0
          let #B3.GPDE_RP_RVBON_AG = 0
          let #B3.GPDE_RP_RVBON_AN = 0
          let #B3.GPDE_RP_RVLFD_AG = 0
          let #B3.GPDE_RP_RVLFD_AN = 0
          let #B3.GPDE_RP_AZGRS_ANLZ = 0
          let #B3.GPDE_RP_AZGRS_BON = 0
          let #B3.GPDE_RP_OAPPEN_ANL = 0
          let #B3.GPDE_RP_OAPPEN_BON = 0
          let #B3.GPDE_AZ_RP_S03_31     = 0
          let #B3.GPDE_AZ_RP_S03_41     = 0
          ! wdu06-881kug  --- more fixes required here ---
          let #B3.GPDE_RP_KUG_RVGRS = 0

          ! JJJ-890B10-kug query
          let #B3.GPDE_KU_KUGAMT            = 0
          let #B3.GPDE_KU_KUGKKAMT          = 0

       end-if
   end-if

   ! to avoid the preparation of obsolete data in GPDE_RP_SI10A we look at
   ! March Clause pay only during the preparation of marchclause (MarchSplit = M)
   if $MarchSplit = 'M'
       if &B3.GPDE_SI_PROV_AV_M = &B2.GPDE_SI_PROV_MAND
          let $ExistProv = 'Y'
       else
          let #B3.GPDE_RP_AVGRS_MC = 0
          let #B3.GPDE_RP_AVAG_MC = 0
          let #B3.GPDE_RP_AVAN_MC = 0
       end-if
       if &B3.GPDE_SI_PROV_KV_M = &B2.GPDE_SI_PROV_MAND
          let $ExistProv = 'Y'
       else
          let #B3.GPDE_RP_KVGRS_MC = 0
          let #B3.GPDE_RP_KVAG_MC = 0
          let #B3.GPDE_RP_KVAN_MC = 0
       end-if
       if &B3.GPDE_SI_PROV_PV_M = &B2.GPDE_SI_PROV_MAND
          let $ExistProv = 'Y'
       else
          let #B3.GPDE_RP_PVGRS_MC = 0
          let #B3.GPDE_RP_PVAG_MC = 0
          let #B3.GPDE_RP_PVAN_MC = 0
       end-if
       if &B3.GPDE_SI_PROV_RV_M = &B2.GPDE_SI_PROV_MAND
          let $ExistProv = 'Y'
       else
          let #B3.GPDE_RP_RVGRS_MC = 0
          let #B3.GPDE_RP_RVAG_MC = 0
          let #B3.GPDE_RP_RVAN_MC = 0

          let #B3.GPDE_RP_OAPGRS_MC  = 0
          let #B3.GPDE_RP_OAPPEN_MC  = 0
       end-if
   end-if
     ! GUl07-890B10 Marchclause with SI-Provider Change -->
   if $ExistProv = 'N'
        do CX_ZeroTotalGrossVars_B3     ! wdu05-881b8: reset Total Gross
        do CX_ZeroNormalVars_B3         ! set non-march variables to zero
        do CX_ZeroMarchVars_B3          ! set march-clause variables to zero
   end-if

   ! -----------------------------------------------------------------------------
   ! Umlage does not use the $ExistProv logic, because if we set it to yes,
   ! then a row is printed on the regular Beitragsabrechnung, which is not wanted
   ! -----------------------------------------------------------------------------
!adj08-890b16: RI insolvency
   if &B3.GPDE_SI_PROV_UM = &B2.GPDE_SI_PROV_MAND
      let #B3.GPDE_RP_RIGRSS_AMT = &B3.GPDE_RP_RIGRSS_AMT
      let #B3.GPDE_RP_U1CNTB_AMT = &B3.GPDE_RP_U1CNTB_AMT
      let #B3.GPDE_RP_U2CNTB_AMT = &B3.GPDE_RP_U2CNTB_AMT
      let #B3.GPDE_RP_GRSS_INSOL = &B3.GPDE_RP_GRSS_INSOL
      let #B3.GPDE_RP_UML_INSOLV = &B3.GPDE_RP_UML_INSOLV
   else
      let #B3.GPDE_RP_RIGRSS_AMT = 0
      let #B3.GPDE_RP_U1CNTB_AMT = 0
      let #B3.GPDE_RP_U2CNTB_AMT = 0
      let #B3.GPDE_RP_GRSS_INSOL = 0
      let #B3.GPDE_RP_UML_INSOLV = 0
   end-if
!adj09-890b19: RI insolvency TU
   if &B3.GPDE_SI_PROV_UM_M = &B2.GPDE_SI_PROV_MAND
      let #B3.GPDE_RP_RIGRSM_AMT = &B3.GPDE_RP_RIGRSM_AMT
      let #B3.GPDE_RP_U1CTBM_AMT = &B3.GPDE_RP_U1CTBM_AMT
      let #B3.GPDE_RP_U2CTBM_AMT = &B3.GPDE_RP_U2CTBM_AMT
      let #B3.GPDE_RP_GRS_INS_MC = &B3.GPDE_RP_GRS_INS_MC
      let #B3.GPDE_RP_UML_INS_MC = &B3.GPDE_RP_UML_INS_MC
   else
      let #B3.GPDE_RP_RIGRSM_AMT = 0
      let #B3.GPDE_RP_U1CTBM_AMT = 0
      let #B3.GPDE_RP_U2CTBM_AMT = 0
      let #B3.GPDE_RP_GRS_INS_MC = 0
      let #B3.GPDE_RP_UML_INS_MC = 0
   end-if
   if $ExistProv = 'N'
      let $Sgn = 'N'
   else
      let $Sgn = 'Y'
   end-if

   if (#B3.GPDE_RP_KVGRS_MC <> 0 or #B3.GPDE_RP_AVGRS_MC <> 0 or
      #B3.GPDE_RP_RVGRS_MC <> 0 or #B3.GPDE_RP_PVGRS_MC <> 0 or
      #B3.GPDE_RP_KVAN_MC <> 0 or #B3.GPDE_RP_KVAG_MC <> 0 or
      #B3.GPDE_RP_RVAN_MC <> 0 or #B3.GPDE_RP_RVAG_MC <> 0 or
      #B3.GPDE_RP_AVAN_MC <> 0 or #B3.GPDE_RP_AVAG_MC <> 0 or
      #B3.GPDE_RP_PVAN_MC <> 0 or #B3.GPDE_RP_PVAG_MC <> 0 or
      #B3.GPDE_RP_RIGRSM_AMT <> 0 or #B3.GPDE_RP_U1CTBM_AMT <> 0 or
      #B3.GPDE_RP_U2CTBM_AMT <> 0 or #B3.GPDE_RP_OAPGRS_MC <> 0 or
      #B3.GPDE_RP_OAPPEN_MC <> 0  or #B3.GPDE_RP_SIGRUNLM_B <> 0 or
      #B3.GPDE_RP_GRS_INS_MC <> 0 or #B3.GPDE_RP_UML_INS_MC <> 0  ) !adj09: RI Inslovency TU
       and ( #B3.GPDE_RP_MARCH_CLS <> 0 )
      !adj08-March Clause
      let #GPDE_RP_MARCH_CLS = 1
   else
      let #GPDE_RP_MARCH_CLS = 0
   end-if
   let $B3.GPDE_SI_IS_KVDR = &B3.GPDE_SI_IS_KVDR
   let $B3.GPDE_SI_PV_CHILD = &B3.GPDE_SI_PV_CHILD
   ! wdu05b7: split of marchclause and other fields
   ! -------------------------------------------------------
   ! we need to split marchclause and regular prev-year rows and make
   ! 2 rows out of one.
   !    - we want 1 row with the marchclause values only
   !    - we want 1 row with the NON-marchclause values only
   ! we achieve this by running this procedure twice with the
   ! parameter:
   !    $MarchSplit = 'M'   ==> we want marchclause values only (executed first)
   !    $MarchSplit = 'N'   ==> we want normal values only
   ! values we do not need. we set to zero
   ! -------------------------------------------------------

   if $MarchSplit = 'M'
        ! this is the split turn, only marchlause will write a row with MC-values only
        ! we do the split only for real marchclauses
        if #GPDE_RP_MARCH_CLS = 1
            ! set all non-march fields to zero and create row
            do CX_ZeroNormalVars_B3         ! set non-march variables to zero
            ! Umlage handling separate
            let #B3.GPDE_RP_RIGRSS_AMT = 0
            let #B3.GPDE_RP_U1CNTB_AMT = 0
            let #B3.GPDE_RP_U2CNTB_AMT = 0
!adj09-12.4
            let #B3.GPDE_RP_GRSS_INSOL = 0
            let #B3.GPDE_RP_UML_INSOLV = 0

            ! write
            do InsertResultData
        !else
        !rows without marchclause do nothing
        end-if
   else
        ! this is the normal turn, every row makes a write here
        ! if we have a marchclause, then we clear all marchclause fields
        if #GPDE_RP_MARCH_CLS = 1
            ! set all march fields to zero and reset MARCH-flag
            do CX_ZeroMarchVars_B3
            !
            ! the values which are zeroed in CX_ZeroTotalGrossVars_B3
            ! contain the unlimited SI-Gross dependent on Marchclause Y/N
            ! This means in a mc-row it is the unlimited mc gross, in a non mc-row it is the normal gross.
            ! So if we go thru the non-march print of a march row, we need to delete it.
            !
            do CX_ZeroTotalGrossVars_B3     ! wdu05-881b8: clean up total gross in case we also have VJ-Gross

            let #GPDE_RP_MARCH_CLS = 0
            ! Umlage handling is separate
            let #B3.GPDE_RP_RIGRSM_AMT = 0
            let #B3.GPDE_RP_U1CTBM_AMT = 0
            let #B3.GPDE_RP_U2CTBM_AMT = 0
!adj09-12.4
            let #B3.GPDE_RP_GRS_INS_MC = 0
            let #B3.GPDE_RP_UML_INS_MC = 0
       !else

        ! it is a normal row, just pass it on
        end-if
        ! every row makes a write here
        do InsertResultData
   end-if

   ! increment a counter as AUX-key to avoid duplicates
   let #Countr = #Countr + 1
from PS_GPDE_RP_SI10 B3
where B3.GPDE_SI_PROV_AV = &B2.GPDE_SI_PROV_MAND or
      B3.GPDE_SI_PROV_KV = &B2.GPDE_SI_PROV_MAND or
      B3.GPDE_SI_PROV_PV = &B2.GPDE_SI_PROV_MAND or
      B3.GPDE_SI_PROV_RV = &B2.GPDE_SI_PROV_MAND or
      B3.GPDE_SI_PROV_UM = &B2.GPDE_SI_PROV_MAND or
      B3.GPDE_SI_PROV_AV_M = &B2.GPDE_SI_PROV_MAND or
      B3.GPDE_SI_PROV_KV_M = &B2.GPDE_SI_PROV_MAND or
      B3.GPDE_SI_PROV_PV_M = &B2.GPDE_SI_PROV_MAND or
      B3.GPDE_SI_PROV_RV_M = &B2.GPDE_SI_PROV_MAND or
      B3.GPDE_SI_PROV_UM_M = &B2.GPDE_SI_PROV_MAND
end-select
end-procedure
!****************************************************************




begin-procedure InsertResultData

! info on GPDE_RP_CHAR01:
! info on GPDE_RP_CHAR02: contains $Sgn, which is 'Y' when the current provider is Einzugsstelle
!adj08-890b16: RI Inslovency
begin-sql
insert into PS_GPDE_RP_SI10A(EMPLID,CAL_RUN_ID,EMPL_RCD,GP_PAYGROUP,CAL_ID,RSLT_SEG_NUM,SLICE_END_DT,
CAL_SEQ_NUM,PAY_ENTITY,PRD_END_DT,GPDE_AL_CPAY_ENDDT,GPDE_SI_PROV_MAND,GPDE_RP_SIGRSS_AMT,
GPDE_RP_SIGRS_ANLZ,GPDE_RP_HICNTB_AMT,GPDE_RP_PICNTB_AMT,GPDE_RP_UICNTB_AMT,GPDE_RP_CICNTB_AMT,
GPDE_RP_HIVOL_AMT,GPDE_RP_CIVOL_AMT,GPDE_RP_RIGRSS_AMT,GPDE_RP_U1CNTB_AMT,GPDE_RP_U2CNTB_AMT,
GPDE_RI_PCT1,GPDE_RI_PCT2,GPDE_RP_RIGRSM_AMT,GPDE_RP_U1CTBM_AMT,GPDE_RP_U2CTBM_AMT,
GPDE_RI_PCT1_MC,GPDE_RI_PCT2_MC,GPDE_RP_SIGRSM_AMT,
GPDE_RP_HICTBM_AMT,GPDE_RP_PICTBM_AMT,GPDE_RP_UICTBM_AMT,GPDE_RP_CICTBM_AMT,GPDE_RP_OAPGRS_AMT,
GPDE_RP_AZGRS_ANLZ,GPDE_RP_OAPPEN_AMT,GPDE_RP_OAPGRS_MC,GPDE_RP_OAPPEN_MC,GPDE_RP_SIDAYS,
GPDE_RP_AVDAYS,GPDE_RP_KVDAYS,GPDE_RP_PVDAYS,GPDE_RP_AVDAYS_BON,GPDE_RP_KVDAYS_BON,
GPDE_RP_PVDAYS_BON,GPDE_RP_RVDAYS_BON,GPDE_RP_AVGRS_ANLZ,GPDE_RP_AVGRS_BON,GPDE_RP_AVGRS_MC,
GPDE_RP_KVGRS_ANLZ,GPDE_RP_KVGRS_BON,GPDE_RP_KVGRS_MC,GPDE_RP_PVGRS_ANLZ,GPDE_RP_PVGRS_BON,
GPDE_RP_PVGRS_MC,GPDE_RP_RVGRS_ANLZ,GPDE_RP_RVGRS_BON,GPDE_RP_RVGRS_MC,GPDE_RP_AVLFD_AG,
GPDE_RP_AVLFD_AN,GPDE_RP_KVLFD_AG,GPDE_RP_KVLFD_AN,GPDE_RP_PVLFD_AG,GPDE_RP_PVLFD_AN,
GPDE_RP_RVLFD_AG,GPDE_RP_RVLFD_AN,GPDE_RP_KVBON_AG,GPDE_RP_KVBON_AN,GPDE_RP_AVBON_AG,
GPDE_RP_AVBON_AN,GPDE_RP_PVBON_AG,GPDE_RP_PVBON_AN,GPDE_RP_RVBON_AG,GPDE_RP_RVBON_AN,GPDE_RP_AVAG_MC,
GPDE_RP_AVAN_MC,GPDE_RP_KVAG_MC,GPDE_RP_KVAN_MC,GPDE_RP_PVAG_MC,GPDE_RP_PVAN_MC,GPDE_RP_RVAG_MC,
GPDE_RP_RVAN_MC,GPDE_RP_SIGRUNLM_A,GPDE_RP_SIGRUNLM_B,GPDE_RP_CIVLER_AMT,GPDE_RP_HIVLER_AMT,
GPDE_RC_PRT_SIGN,GPDE_RP_CHAR01,GPDE_RP_CHAR02,GPDE_RP_AZGRS_BON,GPDE_RP_OAPPEN_ANL,GPDE_RP_OAPPEN_BON,
GPDE_RP_AVDAYS_MC,GPDE_RP_KVDAYS_MC,GPDE_RP_PVDAYS_MC,GPDE_RP_RVDAYS_MC,GPDE_TX_MJ_LUMP,GPDE_RP_MARCH_CLS,
GPDE_AZ_RP_S03_31,GPDE_AZ_RP_S03_41,GPDE_SI_IS_KVDR,GPDE_SI_PV_CHILD
,GPDE_RP_KUG_KVCTB,GPDE_RP_KUG_PVCTB,GPDE_RP_KUG_RVCTB
,GPDE_RP_KUG_KVGRS,GPDE_RP_KUG_PVGRS,GPDE_RP_KUG_RVGRS
,GPDE_KU_KUGAMT, GPDE_KU_KUGKKAMT
, GPDE_RP_SFN_SI_ABL , GPDE_RP_RV_GZ_FLG, GPDE_RP_GRSS_INSOL,GPDE_RP_UML_INSOLV, GPDE_RP_GRS_INS_MC
,GPDE_RP_UML_INS_MC)
values (&B3.EMPLID,&B3.CAL_RUN_ID,&B3.EMPL_RCD,&B3.GP_PAYGROUP,
&B3.CAL_ID,&B3.RSLT_SEG_NUM,&B3.SLICE_END_DT,#Countr,&B3.PAY_ENTITY,&B3.PRD_END_DT,&B3.GPDE_AL_CPAY_ENDDT
,&B2.GPDE_SI_PROV_MAND,#B3.GPDE_RP_SIGRSS_AMT,#B3.GPDE_RP_SIGRS_ANLZ,#B3.GPDE_RP_HICNTB_AMT
,#B3.GPDE_RP_PICNTB_AMT,#B3.GPDE_RP_UICNTB_AMT,#B3.GPDE_RP_CICNTB_AMT,#B3.GPDE_RP_HIVOL_AMT
,#B3.GPDE_RP_CIVOL_AMT,#B3.GPDE_RP_RIGRSS_AMT,#B3.GPDE_RP_U1CNTB_AMT,#B3.GPDE_RP_U2CNTB_AMT
,#B3.GPDE_RI_PCT1,#B3.GPDE_RI_PCT2,#B3.GPDE_RP_RIGRSM_AMT,#B3.GPDE_RP_U1CTBM_AMT,#B3.GPDE_RP_U2CTBM_AMT
,#B3.GPDE_RI_PCT1_MC,#B3.GPDE_RI_PCT2_MC,#B3.GPDE_RP_SIGRSM_AMT,#B3.GPDE_RP_HICTBM_AMT,#B3.GPDE_RP_PICTBM_AMT,
#B3.GPDE_RP_UICTBM_AMT,#B3.GPDE_RP_CICTBM_AMT,#B3.GPDE_RP_OAPGRS_AMT,#B3.GPDE_RP_AZGRS_ANLZ,#B3.GPDE_RP_OAPPEN_AMT,
#B3.GPDE_RP_OAPGRS_MC,#B3.GPDE_RP_OAPPEN_MC,#B3.GPDE_RP_SIDAYS,#B3.GPDE_RP_AVDAYS,#B3.GPDE_RP_KVDAYS
,#B3.GPDE_RP_PVDAYS,#B3.GPDE_RP_AVDAYS_BON,#B3.GPDE_RP_KVDAYS_BON,#B3.GPDE_RP_PVDAYS_BON
,#B3.GPDE_RP_RVDAYS_BON,#B3.GPDE_RP_AVGRS_ANLZ,#B3.GPDE_RP_AVGRS_BON,#B3.GPDE_RP_AVGRS_MC
,#B3.GPDE_RP_KVGRS_ANLZ,#B3.GPDE_RP_KVGRS_BON,#B3.GPDE_RP_KVGRS_MC,#B3.GPDE_RP_PVGRS_ANLZ
,#B3.GPDE_RP_PVGRS_BON,#B3.GPDE_RP_PVGRS_MC,#B3.GPDE_RP_RVGRS_ANLZ,#B3.GPDE_RP_RVGRS_BON
,#B3.GPDE_RP_RVGRS_MC,#B3.GPDE_RP_AVLFD_AG,#B3.GPDE_RP_AVLFD_AN,#B3.GPDE_RP_KVLFD_AG
,#B3.GPDE_RP_KVLFD_AN,#B3.GPDE_RP_PVLFD_AG,#B3.GPDE_RP_PVLFD_AN,#B3.GPDE_RP_RVLFD_AG
,#B3.GPDE_RP_RVLFD_AN,#B3.GPDE_RP_KVBON_AG,#B3.GPDE_RP_KVBON_AN,#B3.GPDE_RP_AVBON_AG
,#B3.GPDE_RP_AVBON_AN,#B3.GPDE_RP_PVBON_AG,#B3.GPDE_RP_PVBON_AN,#B3.GPDE_RP_RVBON_AG
,#B3.GPDE_RP_RVBON_AN,#B3.GPDE_RP_AVAG_MC,#B3.GPDE_RP_AVAN_MC,#B3.GPDE_RP_KVAG_MC
,#B3.GPDE_RP_KVAN_MC,#B3.GPDE_RP_PVAG_MC,#B3.GPDE_RP_PVAN_MC,#B3.GPDE_RP_RVAG_MC
,#B3.GPDE_RP_RVAN_MC,#B3.GPDE_RP_SIGRUNLM_A,#B3.GPDE_RP_SIGRUNLM_B,#B3.GPDE_RP_CIVLER_AMT,
#B3.GPDE_RP_HIVLER_AMT,&B3.GPDE_RC_PRT_SIGN,'N',$Sgn,#B3.GPDE_RP_AZGRS_BON,#B3.GPDE_RP_OAPPEN_ANL,
#B3.GPDE_RP_OAPPEN_BON,#B3.GPDE_RP_AVDAYS_MC,#B3.GPDE_RP_KVDAYS_MC,#B3.GPDE_RP_PVDAYS_MC,#B3.GPDE_RP_RVDAYS_MC,
#B3.GPDE_TX_MJ_LUMP,#GPDE_RP_MARCH_CLS,#B3.GPDE_AZ_RP_S03_31,#B3.GPDE_AZ_RP_S03_41
,$B3.GPDE_SI_IS_KVDR,$B3.GPDE_SI_PV_CHILD
,#B3.GPDE_RP_KUG_KVCTB,#B3.GPDE_RP_KUG_PVCTB,#B3.GPDE_RP_KUG_RVCTB
,#B3.GPDE_RP_KUG_KVGRS,#B3.GPDE_RP_KUG_PVGRS,#B3.GPDE_RP_KUG_RVGRS
, #B3.GPDE_KU_KUGAMT, #B3.GPDE_KU_KUGKKAMT
, #B3.GPDE_RP_SFN_SI_ABL, $GZFlag, #B3.GPDE_RP_GRSS_INSOL, #B3.GPDE_RP_UML_INSOLV
, #B3.GPDE_RP_GRS_INS_MC ,#B3.GPDE_RP_UML_INS_MC )
end-sql
end-procedure
!****************************************************************



begin-procedure Prepare_Result_Data_Freiw
begin-select
DF.EMPLID
DF.EMPL_RCD
DF.GP_PAYGROUP
DF.CAL_ID
DF.RSLT_SEG_NUM
DF.GPDE_SI_PROV_MAND
    do UpdDataFr
from PS_GPDE_RP_SI10A DF
where DF.GPDE_RC_PRT_SIGN = 'R' and
    (DF.GPDE_RP_CIVOL_AMT <> 0 OR
      DF.GPDE_RP_HIVOL_AMT <> 0)
end-select
end-procedure
!****************************************************************



begin-procedure UpdDataFr
begin-sql
update PS_GPDE_RP_SI10A
set GPDE_RP_CHAR01 = 'Y'
where EMPLID = &DF.EMPLID and
      EMPL_RCD = &DF.EMPL_RCD and
      GP_PAYGROUP = &DF.GP_PAYGROUP and
      CAL_ID = &DF.CAL_ID and
      RSLT_SEG_NUM = &DF.RSLT_SEG_NUM and
      GPDE_RC_PRT_SIGN = 'N' and
      GPDE_SI_PROV_MAND = &DF.GPDE_SI_PROV_MAND
end-sql
end-procedure




!****************************************************************
begin-procedure ExtractProvider
begin-select distinct
[$TempField] &TempFld=char
   do InsetNewRow
from PS_GPDE_RP_SI10 SI10T
where [$TempField1] not in
      (select B1.GPDE_SI_PROV_MAND from PS_GPDE_RP_SI10B B1)
end-select

end-procedure
!****************************************************************
begin-procedure InsetNewRow
begin-sql
insert into PS_GPDE_RP_SI10B(GPDE_SI_PROV_MAND)
values (&TempFld)
end-sql
end-procedure
!**********************************************************************************





begin-procedure Get-Header-Data-Abr_Umlage
!
! currently not used
!
   do Get-Provider-Data($EffDateTemp,$Prov_Umlage,
      $hdr_abr_kk_name,$hdr_abr_kk_nummer,$hdr_abr_kk_street,
          $hdr_abr_kk_zipcity,$hdr_abr_health_rate_east,$hdr_abr_health_rate_west,
      $hdr_abr_beitragskonto,$hdr_abr_zahlstellen_nr,$Ctl_PayEntity)
   do Get-SI_PRV_ACCT_DEU($Prov_Umlage, $EffDateTemp, $Ctl_PayEntity,
      $hdr_abr_beitragskonto, $hdr_abr_zahlstellen_nr)
   do Get-Payentity-Data($Ctl_PayEntity, $EffDateTemp, $hdr_abr_Payentity_name,
      $hdr_abr_Payentity_street,$hdr_abr_Payentity_street2,$hdr_abr_Payentity_street3,
      $hdr_PoBox,$hdr_abr_Payentity_zip_city,$hdr_Nation,$Post,$Cit)
   do Get-Print-Date($EffDateTemp, $hdr_abr_curr_pay_end_dt)
   do Format-DateTime($AsOfToday, $hdr_abr_header_date, {DEFDATE}, '', '')
   do Get-KV-Rates($GPDE_SI_REGION_U,$hdr_abr_kk_nummer, $EffDateTemp,$hdr_abr_per_kv_1000,
      $hdr_abr_per_kv_2000,$hdr_abr_per_kv_3000,$hdr_abr_per_kv_6000,$hdr_abr_per_kvdr,$ActEffDt,
      #per_kv_1000,#per_kv_2000,#per_kv_3000,#per_kv_6000,#per_kvdr)
   do Get-RV-AV-PV-Rates($EffDateTemp, $GPDE_SI_REGION_U,
      $GPDE_TX_MINER_save,$hdr_abr_per_pv_0001,$hdr_abr_per_rv_0100,
          $hdr_abr_per_rv_0200,$hdr_abr_per_rv_0300,$hdr_abr_per_rv_0400,
      $hdr_abr_per_rv_0500,$hdr_abr_per_rv_0600,$hdr_abr_per_av_0010,
          $hdr_abr_per_av_0020,$hdr_abr_per_pv_kvdr1,$hdr_abr_per_pv_kvdr2)
   do Get-UV-Rates($EffDateTemp, $GPDE_SI_REGION_U,
      $hdr_abr_kk_nummer,$hdr_abr_per_uv1,$hdr_abr_per_uv2,$ActEffDt_UV)
end-procedure




!****************************************************************
begin-procedure InitialCurrcy
let #CurrCy = 0
while #CurrCy < 20
   put '' into CurrencyData(#CurrCy) Currcy1
   put 0  into CurrencyData(#CurrCy) Currcy2
   put 0  into CurrencyData(#CurrCy) Currcy3
   let #CurrCy = #CurrCy + 1
end-while
end-procedure





!********************************************************************************************
begin-procedure Get_End_Mnth($Dte1,:$Dte2)
 if rtrim($Dte1,' ') <> ''
  do ConvertToComponents($Dte1,$tmp1_yy,$tmp1_mm,$tmp1_dd)
  let  #tmp1_mm  = to_number($tmp1_mm)
  let  #tmp1_yy  = to_number($tmp1_yy)
  if #tmp1_mm = 2
     move 28 to #MonthDays1
     if (((mod(#tmp1_yy,4) = 0) and (mod(#tmp1_yy,100) != 0)) or
        (mod(#tmp1_yy,400) = 0))
         add 1 to #MonthDays1
     end-if
   else
     if #tmp1_mm = 4 or #tmp1_mm = 6 or #tmp1_mm = 9 or #tmp1_mm = 11
         move 30 to #MonthDays1
     else
         move 31 to #MonthDays1
     end-if
   end-if
   let $MonthDays1 = to_char(#MonthDays1)
   let $E_DT_tmp1 = $tmp1_yy  || $tmp1_mm  || $MonthDays1 || '0000'
   do Format-DateTime($E_DT_tmp1,$Dte2, {DEFCMP},'','native')
 end-if
end-procedure
!
!
!
! ----------------- big procedures --------------------------
!
!  code extracted from other places for clearness
!

begin-procedure CX_VarAssignAmounts_BeitAbr
  ! put monetary stuff in variables
  let #PT.GPDE_RP_SIGRSS_AMT  =     &PT.GPDE_RP_SIGRSS_AMT
  let #PT.GPDE_RP_HICNTB_AMT  =     &PT.GPDE_RP_HICNTB_AMT
  let #PT.GPDE_RP_HICTBM_AMT  =     &PT.GPDE_RP_HICTBM_AMT
  let #PT.GPDE_RP_CICNTB_AMT  =     &PT.GPDE_RP_CICNTB_AMT
  let #PT.GPDE_RP_CICTBM_AMT  =     &PT.GPDE_RP_CICTBM_AMT
  let #PT.GPDE_RP_PICNTB_AMT  =     &PT.GPDE_RP_PICNTB_AMT
  let #PT.GPDE_RP_PICTBM_AMT  =     &PT.GPDE_RP_PICTBM_AMT
  let #PT.GPDE_RP_UICNTB_AMT  =     &PT.GPDE_RP_UICNTB_AMT
  let #PT.GPDE_RP_UICTBM_AMT  =     &PT.GPDE_RP_UICTBM_AMT
  let #PT.GPDE_RP_OAPGRS_AMT  =     &PT.GPDE_RP_OAPGRS_AMT
  let #PT.GPDE_RP_OAPPEN_AMT  =     &PT.GPDE_RP_OAPPEN_AMT
  let #PT.GPDE_RP_OAPGRS_MC   =     &PT.GPDE_RP_OAPGRS_MC
  let #PT.GPDE_RP_OAPPEN_MC   =     &PT.GPDE_RP_OAPPEN_MC
  let #PT.GPDE_RP_RIGRSS_AMT  =   &PT.GPDE_RP_RIGRSS_AMT
  let #PT.GPDE_RP_U1CNTB_AMT  =   &PT.GPDE_RP_U1CNTB_AMT
  let #PT.GPDE_RP_U2CNTB_AMT  =   &PT.GPDE_RP_U2CNTB_AMT
  let #PT.GPDE_RI_PCT1        =   &PT.GPDE_RI_PCT1
  let #PT.GPDE_RI_PCT2        =   &PT.GPDE_RI_PCT2
  let #PT.GPDE_RP_RIGRSM_AMT  =   &PT.GPDE_RP_RIGRSM_AMT
  let #PT.GPDE_RP_U1CTBM_AMT  =   &PT.GPDE_RP_U1CTBM_AMT
  let #PT.GPDE_RP_U2CTBM_AMT  =   &PT.GPDE_RP_U2CTBM_AMT
  let #PT.GPDE_RI_PCT1_MC     =   &PT.GPDE_RI_PCT1_MC
  let #PT.GPDE_RI_PCT2_MC     =   &PT.GPDE_RI_PCT2_MC
  let #PT.GPDE_RP_AVGRS_ANLZ  =     &PT.GPDE_RP_AVGRS_ANLZ
  let #PT.GPDE_RP_AVGRS_BON   =      &PT.GPDE_RP_AVGRS_BON
  let #PT.GPDE_RP_AVGRS_MC    =       &PT.GPDE_RP_AVGRS_MC
  let #PT.GPDE_RP_KVGRS_ANLZ  =     &PT.GPDE_RP_KVGRS_ANLZ
  let #PT.GPDE_RP_KVGRS_BON   =     &PT.GPDE_RP_KVGRS_BON
  let #PT.GPDE_RP_KVGRS_MC    =       &PT.GPDE_RP_KVGRS_MC
  let #PT.GPDE_RP_PVGRS_ANLZ  =     &PT.GPDE_RP_PVGRS_ANLZ
  let #PT.GPDE_RP_PVGRS_BON     =   &PT.GPDE_RP_PVGRS_BON
  let #PT.GPDE_RP_PVGRS_MC     =    &PT.GPDE_RP_PVGRS_MC
  let #PT.GPDE_RP_RVGRS_ANLZ     =  &PT.GPDE_RP_RVGRS_ANLZ
  let #PT.GPDE_RP_RVGRS_BON      =  &PT.GPDE_RP_RVGRS_BON
  let #PT.GPDE_RP_RVGRS_MC       =  &PT.GPDE_RP_RVGRS_MC
  let #PT.GPDE_RP_AVLFD_AG      =   &PT.GPDE_RP_AVLFD_AG
  let #PT.GPDE_RP_AVLFD_AN       =  &PT.GPDE_RP_AVLFD_AN
  let #PT.GPDE_RP_KVLFD_AG       =  &PT.GPDE_RP_KVLFD_AG
  let #PT.GPDE_RP_KVLFD_AN       =  &PT.GPDE_RP_KVLFD_AN
  let #PT.GPDE_RP_PVLFD_AG       =  &PT.GPDE_RP_PVLFD_AG
  let #PT.GPDE_RP_PVLFD_AN       =  &PT.GPDE_RP_PVLFD_AN
  let #PT.GPDE_RP_RVLFD_AG        = &PT.GPDE_RP_RVLFD_AG
  let #PT.GPDE_RP_RVLFD_AN    =     &PT.GPDE_RP_RVLFD_AN
  let #PT.GPDE_RP_KVBON_AG       =  &PT.GPDE_RP_KVBON_AG
  let #PT.GPDE_RP_KVBON_AN       =  &PT.GPDE_RP_KVBON_AN
  let #PT.GPDE_RP_AVBON_AG        = &PT.GPDE_RP_AVBON_AG
  let #PT.GPDE_RP_AVBON_AN       =  &PT.GPDE_RP_AVBON_AN
  let #PT.GPDE_RP_PVBON_AG       =  &PT.GPDE_RP_PVBON_AG
  let #PT.GPDE_RP_PVBON_AN       =  &PT.GPDE_RP_PVBON_AN
  let #PT.GPDE_RP_RVBON_AG       =  &PT.GPDE_RP_RVBON_AG
  let #PT.GPDE_RP_RVBON_AN       =  &PT.GPDE_RP_RVBON_AN
  let #PT.GPDE_RP_AVAG_MC        =  &PT.GPDE_RP_AVAG_MC
  let #PT.GPDE_RP_AVAN_MC        =  &PT.GPDE_RP_AVAN_MC
  let #PT.GPDE_RP_KVAG_MC        =  &PT.GPDE_RP_KVAG_MC
  let #PT.GPDE_RP_KVAN_MC        =  &PT.GPDE_RP_KVAN_MC
  let #PT.GPDE_RP_PVAG_MC        =  &PT.GPDE_RP_PVAG_MC
  let #PT.GPDE_RP_PVAN_MC       =   &PT.GPDE_RP_PVAN_MC
  let #PT.GPDE_RP_RVAG_MC        =  &PT.GPDE_RP_RVAG_MC
  let #PT.GPDE_RP_RVAN_MC        =  &PT.GPDE_RP_RVAN_MC
  let #PT.GPDE_RP_SIGRUNLM_A     =  &PT.GPDE_RP_SIGRUNLM_A
  let #PT.GPDE_RP_SIGRUNLM_B     =  &PT.GPDE_RP_SIGRUNLM_B
  let $RetroSign                 =  &PT.GPDE_RC_PRT_SIGN
  let #PT.GPDE_RP_HIVOL_AMT   =   &PT.GPDE_RP_HIVOL_AMT
  let #PT.GPDE_RP_CIVOL_AMT   =   &PT.GPDE_RP_CIVOL_AMT
  let #PT.GPDE_RP_HIVLER_AMT  =   &PT.GPDE_RP_HIVLER_AMT
  let #PT.GPDE_RP_CIVLER_AMT  =   &PT.GPDE_RP_CIVLER_AMT
  let #PT.GPDE_RP_AZGRS_BON   =  &PT.GPDE_RP_AZGRS_BON
  let #PT.GPDE_RP_OAPPEN_ANL  =  &PT.GPDE_RP_OAPPEN_ANL
  let #PT.GPDE_RP_OAPPEN_BON  =  &PT.GPDE_RP_OAPPEN_BON
  let #PT.GPDE_RP_AZGRS_ANLZ  = &PT.GPDE_RP_AZGRS_ANLZ
  let #PT.GPDE_TX_MJ_LUMP     = &PT.GPDE_TX_MJ_LUMP
  let #PT.GPDE_AZ_RP_S03_31   = &PT.GPDE_AZ_RP_S03_31
  let #PT.GPDE_AZ_RP_S03_41   = &PT.GPDE_AZ_RP_S03_41
  ! wdu06-881kug
  let #PT.GPDE_RP_KUG_KVCTB   = &PT.GPDE_RP_KUG_KVCTB
  let #PT.GPDE_RP_KUG_PVCTB   = &PT.GPDE_RP_KUG_PVCTB
  let #PT.GPDE_RP_KUG_RVCTB   = &PT.GPDE_RP_KUG_RVCTB
  let #PT.GPDE_RP_KUG_KVGRS   = &PT.GPDE_RP_KUG_KVGRS
  let #PT.GPDE_RP_KUG_PVGRS   = &PT.GPDE_RP_KUG_PVGRS
  let #PT.GPDE_RP_KUG_RVGRS   = &PT.GPDE_RP_KUG_RVGRS

end-procedure







begin-procedure CX_BlankTheNonRegion_BeitAbr  ! blank out values from non-applicable regions (RK)
  if $SI_GPDE_SIC_REGION <> $RegionAct
     let #PT.GPDE_RP_CICNTB_AMT = 0
     let #PT.GPDE_RP_CICTBM_AMT = 0
     let #PT.GPDE_RP_CIVOL_AMT   = 0
     let #PT.GPDE_RP_CIVLER_AMT  =  0

     !ChangeFor2004Bundle2:  reset xVLFD/BON fields too (next 6 lines)
     let #PT.GPDE_RP_PVLFD_AN = 0
     let #PT.GPDE_RP_PVLFD_AG = 0
     let #PT.GPDE_RP_PVBON_AN = 0
     let #PT.GPDE_RP_PVBON_AG = 0
     let #PT.GPDE_RP_PVAN_MC = 0
     let #PT.GPDE_RP_PVAG_MC = 0

     ! wdu06-881kug
     let #PT.GPDE_RP_KUG_PVCTB = 0
     let #PT.GPDE_RP_KUG_PVGRS = 0
  end-if

  if $SI_GPDE_SIH_REGION <> $RegionAct
     let #PT.GPDE_RP_HICNTB_AMT = 0
     let #PT.GPDE_RP_HICTBM_AMT = 0
     let #PT.GPDE_RP_HIVOL_AMT   =   0
     let #PT.GPDE_RP_CIVOL_AMT   =   0
     let #PT.GPDE_RP_HIVLER_AMT  =   0
     let #PT.GPDE_RP_CIVLER_AMT  =   0

     !ChangeFor2004Bundle2:  reset xVLFD/BON fields too (next 6 lines)
     let #PT.GPDE_RP_KVLFD_AN = 0
     let #PT.GPDE_RP_KVLFD_AG = 0
     let #PT.GPDE_RP_KVBON_AN = 0
     let #PT.GPDE_RP_KVBON_AG = 0
     let #PT.GPDE_RP_KVAN_MC = 0
     let #PT.GPDE_RP_KVAG_MC = 0

     if ($SI_GPDE_SIP_REGION <> $RegionAct)
        let #PT.GPDE_RP_U1CNTB_AMT  =   0
        let #PT.GPDE_RP_U2CNTB_AMT  =   0
        let #PT.GPDE_RP_U1CTBM_AMT  =   0
        let #PT.GPDE_RP_U2CTBM_AMT  =   0
     end-if

     ! wdu06-881kug
     let #PT.GPDE_RP_KUG_KVCTB = 0
     let #PT.GPDE_RP_KUG_KVGRS = 0

   end-if

   if $SI_GPDE_SIP_REGION <> $RegionAct
      let #PT.GPDE_RP_PICNTB_AMT = 0
      let #PT.GPDE_RP_PICTBM_AMT = 0
      let #PT.GPDE_RP_OAPGRS_AMT  =  0
      let #PT.GPDE_RP_OAPPEN_AMT  =  0
      let #PT.GPDE_RP_OAPPEN_ANL  =  0
      let #PT.GPDE_RP_OAPPEN_BON  =  0
      let #PT.GPDE_RP_OAPGRS_MC   =  0
      let #PT.GPDE_RP_OAPPEN_MC   =  0
      let #PT.GPDE_RP_U1CNTB_AMT  =   0
      let #PT.GPDE_RP_U2CNTB_AMT  =   0
      let #PT.GPDE_RP_U1CTBM_AMT  =   0
      let #PT.GPDE_RP_U2CTBM_AMT  =   0

      let #PT.GPDE_AZ_RP_S03_31   = 0
      let #PT.GPDE_AZ_RP_S03_41   = 0

      !ChangeFor2004Bundle2:  reset xVLFD/BON fields too (next 6 lines)
      let #PT.GPDE_RP_RVLFD_AN = 0
      let #PT.GPDE_RP_RVLFD_AG = 0
      let #PT.GPDE_RP_RVBON_AN = 0
      let #PT.GPDE_RP_RVBON_AG = 0
      let #PT.GPDE_RP_RVAN_MC = 0
      let #PT.GPDE_RP_RVAG_MC = 0

     ! wdu06-881kug
     let #PT.GPDE_RP_KUG_RVCTB = 0
     let #PT.GPDE_RP_KUG_RVGRS = 0
   end-if
   if $SI_GPDE_SIU_REGION <> $RegionAct
      let #PT.GPDE_RP_UICNTB_AMT = 0
      let #PT.GPDE_RP_UICTBM_AMT = 0

      !ChangeFor2004Bundle2:  reset xVLFD/BON fields too (next 6 lines)
      let #PT.GPDE_RP_AVLFD_AN = 0
      let #PT.GPDE_RP_AVLFD_AG = 0
      let #PT.GPDE_RP_AVBON_AN = 0
      let #PT.GPDE_RP_AVBON_AG = 0
      let #PT.GPDE_RP_AVAN_MC = 0
      let #PT.GPDE_RP_AVAG_MC = 0

   end-if
end-procedure




begin-procedure CX_NoCurrencyConversion_BeitAbr
! wdu06-881b11 we no longer need conversion since 1/1/2006
! because we do not print corrections into the previous year
! but we need currency
  let $Current_RT_Type   = &PBD.CUR_RT_TYPE
  let $Current_DT_EX_RT  = &PBD.GPDE_ASOF_DT_EX_RT
  if rtrim($Current_DT_EX_RT, ' ') = ''
     let $Current_DT_EX_RT = $AsOfToday
  end-if
  if rtrim($Current_RT_Type, ' ') = ''
      let $Current_RT_Type = $BaseRtType
  end-if

  let $Actual_Curruncy = &PBD.CURRENCY_CD

  let $Actual_Curruncy_save = $Actual_Curruncy
  let $Actual_Curruncy_save_N = $Actual_Curruncy
  let $Actual_Curruncy_s  = $Actual_Curruncy
  let $SaveCurrency = $Actual_Curruncy_save
  if $Actual_Curruncy_save = 'DEM'
     let $Actual_Curruncy_save = 'DM'
  end-if
  if $Actual_Curruncy_save = 'EUR'
     let $Actual_Curruncy_save = $EUROCHAR
  end-if
end-procedure





begin-procedure CX_VarAssignUnits_BeitAbr
  ! put non-monetary stuff in variables
  let $Emplid                = &PBD.EMPLID
  let #EmplRcd               = &PBD.EMPL_RCD
  let $EE_Name               = rtrim(&PERN.NAME,' ')
  let $SI_Provider           = $GPDE_SI_PROV_MAND
  let $SV_Code               = $GPDE_DV_SV_CODE
  let #SI.GPDE_RP_MARCH_CLS  = &PT.GPDE_RP_MARCH_CLS    !wdu08-881b8 take from GPDE_RP_SI10A
  let $Ctl_Pay_End_Dt        = $PRD_END_DT
  let $KV_Code               = substr($SV_Code,1,1)
  let $AV_Code               = substr($SV_Code,3,1)
  let $RV_Code               = substr($SV_Code,2,1)
  let $PV_Code               = substr($SV_Code,4,1)
  let $PT.GPDE_RP_CHAR02     = &PT.GPDE_RP_CHAR02
  let #SV_Days               = &PT.GPDE_RP_SIDAYS
  let #SV_Gross              = #PT.GPDE_RP_SIGRSS_AMT
  let #PT.GPDE_RP_SIDAYS     = &PT.GPDE_RP_SIDAYS
  let #PT.GPDE_RP_AVDAYS     = &PT.GPDE_RP_AVDAYS
  let #PT.GPDE_RP_KVDAYS     = &PT.GPDE_RP_KVDAYS
  let #PT.GPDE_RP_PVDAYS     = &PT.GPDE_RP_PVDAYS
  let #PT.GPDE_RP_RVDAYS_MC  = &PT.GPDE_RP_RVDAYS_MC
  let #PT.GPDE_RP_AVDAYS_MC  = &PT.GPDE_RP_AVDAYS_MC
  let #PT.GPDE_RP_KVDAYS_MC  = &PT.GPDE_RP_KVDAYS_MC
  let #PT.GPDE_RP_PVDAYS_MC  = &PT.GPDE_RP_PVDAYS_MC
  let #PT.GPDE_RP_KVDAYS_BON = &PT.GPDE_RP_KVDAYS_BON
  let #PT.GPDE_RP_RVDAYS_BON = &PT.GPDE_RP_RVDAYS_BON
  let #PT.GPDE_RP_AVDAYS_BON = &PT.GPDE_RP_AVDAYS_BON
  let #PT.GPDE_RP_PVDAYS_BON = &PT.GPDE_RP_PVDAYS_BON
end-procedure





begin-procedure CX_SvAmountDistribution_BeitAbr
! distribute amounts to contrib-group-sums
  if $KV_Code = '0'
     let #PT.GPDE_RP_KVDAYS = 0
     let #PT.GPDE_RP_KVDAYS_MC = 0
     let #PT.GPDE_RP_KVDAYS_BON = 0
  end-if
  if $AV_Code = '0'
     let #PT.GPDE_RP_AVDAYS = 0
     let #PT.GPDE_RP_AVDAYS_MC = 0
     let #PT.GPDE_RP_AVDAYS_BON = 0
  end-if
  if $RV_Code = '0'
     let #PT.GPDE_RP_SIDAYS = 0
     let #PT.GPDE_RP_RVDAYS_MC = 0
     let #PT.GPDE_RP_RVDAYS_BON = 0
     let #SV_Days = 0
  end-if
  if $PV_Code = '0'
     let #PT.GPDE_RP_PVDAYS = 0
     let #PT.GPDE_RP_PVDAYS_MC = 0
     let #PT.GPDE_RP_PVDAYS_BON = 0
  end-if

  if $Is_KVdR = 'Y'
     let #PT.GPDE_RP_AVBON_AG  = 0
     let #PT.GPDE_RP_KVBON_AG  = 0
     let #PT.GPDE_RP_PVBON_AG  = 0
     let #PT.GPDE_RP_RVBON_AG  = 0
     let #PT.GPDE_RP_AVBON_AN  = 0
     let #PT.GPDE_RP_KVBON_AN  = 0
     let #PT.GPDE_RP_PVBON_AN  = 0
     let #PT.GPDE_RP_RVBON_AN  = 0
     let #PT.GPDE_RP_KVGRS_BON = 0
     let #PT.GPDE_RP_AVGRS_BON = 0
     let #PT.GPDE_RP_PVGRS_BON = 0
     let #PT.GPDE_RP_RVGRS_BON = 0
     let #PT.GPDE_RP_AVBON_AG  = 0
     let #PT.GPDE_RP_KVBON_AG  = 0
     let #PT.GPDE_RP_PVBON_AG  = 0
     let #PT.GPDE_RP_RVBON_AG  = 0
     let #PT.GPDE_RP_AVBON_AN  = 0
     let #PT.GPDE_RP_KVBON_AN  = 0
     let #PT.GPDE_RP_PVBON_AN  = 0
     let #PT.GPDE_RP_RVBON_AN  = 0
     let #PT.GPDE_RP_KVGRS_BON = 0
     let #PT.GPDE_RP_AVGRS_BON = 0
     let #PT.GPDE_RP_PVGRS_BON = 0
     let #PT.GPDE_RP_RVGRS_BON = 0
  end-if

  if $MarchCL = 'Y' and $Vorj = 'N'
     let #AV-AG_Sum_Temp    = #PT.GPDE_RP_AVAG_MC + #PT.GPDE_RP_AVBON_AG
     let #KV-AG_Sum_Temp    = #PT.GPDE_RP_KVAG_MC + #PT.GPDE_RP_KVBON_AG
     let #PV-AG_Sum_Temp    = #PT.GPDE_RP_PVAG_MC + #PT.GPDE_RP_PVBON_AG
     let #RV-AG_Sum_Temp    = #PT.GPDE_RP_RVAG_MC + #PT.GPDE_RP_RVBON_AG + #PT.GPDE_RP_OAPPEN_MC
     let #AV-AN_Sum_Temp    = #PT.GPDE_RP_AVAN_MC + #PT.GPDE_RP_AVBON_AN
     let #KV-AN_Sum_Temp    = #PT.GPDE_RP_KVAN_MC + #PT.GPDE_RP_KVBON_AN
     let #PV-AN_Sum_Temp    = #PT.GPDE_RP_PVAN_MC + #PT.GPDE_RP_PVBON_AN
     let #RV-AN_Sum_Temp    = #PT.GPDE_RP_RVAN_MC + #PT.GPDE_RP_RVBON_AN
     let #Brutto_Sum_TempKV = #PT.GPDE_RP_KVGRS_MC + #PT.GPDE_RP_KVGRS_BON
     let #Brutto_Sum_TempAV = #PT.GPDE_RP_AVGRS_MC + #PT.GPDE_RP_AVGRS_BON
     let #Brutto_Sum_TempPV = #PT.GPDE_RP_PVGRS_MC + #PT.GPDE_RP_PVGRS_BON
     let #Brutto_Sum_TempRV = #PT.GPDE_RP_RVGRS_MC + #PT.GPDE_RP_RVGRS_BON + #PT.GPDE_RP_OAPGRS_MC
  else
     let #AV-AG_Sum_Temp    = #PT.GPDE_RP_AVLFD_AG + #PT.GPDE_RP_AVBON_AG
     let #KV-AG_Sum_Temp    = #PT.GPDE_RP_KVLFD_AG + #PT.GPDE_RP_KVBON_AG + #PT.GPDE_RP_KUG_KVCTB
     let #PV-AG_Sum_Temp    = #PT.GPDE_RP_PVLFD_AG + #PT.GPDE_RP_PVBON_AG + #PT.GPDE_RP_KUG_PVCTB
     let #RV-AG_Sum_Temp    = #PT.GPDE_RP_RVLFD_AG + #PT.GPDE_RP_RVBON_AG + #PT.GPDE_RP_KUG_RVCTB +
         #PT.GPDE_RP_OAPPEN_ANL + #PT.GPDE_RP_OAPPEN_BON + &PT.GPDE_AZ_RP_S03_41
     let #AV-AN_Sum_Temp    = #PT.GPDE_RP_AVLFD_AN + #PT.GPDE_RP_AVBON_AN
     let #KV-AN_Sum_Temp    = #PT.GPDE_RP_KVLFD_AN + #PT.GPDE_RP_KVBON_AN
     let #PV-AN_Sum_Temp    = #PT.GPDE_RP_PVLFD_AN + #PT.GPDE_RP_PVBON_AN
     let #RV-AN_Sum_Temp    = #PT.GPDE_RP_RVLFD_AN + #PT.GPDE_RP_RVBON_AN
     let #Brutto_Sum_TempKV = #PT.GPDE_RP_KVGRS_ANLZ + #PT.GPDE_RP_KVGRS_BON + #PT.GPDE_RP_KUG_KVGRS
     let #Brutto_Sum_TempAV = #PT.GPDE_RP_AVGRS_ANLZ + #PT.GPDE_RP_AVGRS_BON
     let #Brutto_Sum_TempPV = #PT.GPDE_RP_PVGRS_ANLZ + #PT.GPDE_RP_PVGRS_BON + #PT.GPDE_RP_KUG_PVGRS
     let #Brutto_Sum_TempRV = #PT.GPDE_RP_RVGRS_ANLZ + #PT.GPDE_RP_RVGRS_BON + #PT.GPDE_RP_KUG_RVGRS +
         #PT.GPDE_RP_AZGRS_ANLZ + #PT.GPDE_RP_AZGRS_BON +  &PT.GPDE_AZ_RP_S03_31
  end-if
  let #SV_St      = #PT.GPDE_TX_MJ_LUMP
  let #HICNTB_AMT = #KV-AG_Sum_Temp + #KV-AN_Sum_Temp
  if $Is_KVdR = 'Y'
     let #SV_KVDR = #HICNTB_AMT
     let #sv_sum_kvdr  = #sv_sum_kvdr + #HICNTB_AMT
     let #Brutto_kvdr_Sum = #Brutto_kvdr_Sum + #Brutto_Sum_TempKV
     let #KV-AG_kvdr_Sum = #KV-AG_kvdr_Sum + #KV-AG_Sum_Temp
     let #KV-AN_kvdr_Sum = #KV-AN_kvdr_Sum + #KV-AN_Sum_Temp
  else
     evaluate $KV_Code
     when = '1'
          let #SV_1000 = #HICNTB_AMT
          let #sv_sum_1000 = #sv_sum_1000 +  #HICNTB_AMT
          let #Brutto_1000_Sum = #Brutto_1000_Sum + #Brutto_Sum_TempKV
          let #KV-AG_1000_Sum = #KV-AG_1000_Sum + #KV-AG_Sum_Temp
          let #KV-AN_1000_Sum = #KV-AN_1000_Sum + #KV-AN_Sum_Temp
          break
     when = '2'
          let #SV_2000 = #HICNTB_AMT
          let #sv_sum_2000  = #sv_sum_2000 + #HICNTB_AMT
          let #Brutto_2000_Sum = #Brutto_2000_Sum + #Brutto_Sum_TempKV
          let #KV-AG_2000_Sum = #KV-AG_2000_Sum + #KV-AG_Sum_Temp
          let #KV-AN_2000_Sum = #KV-AN_2000_Sum + #KV-AN_Sum_Temp
          break
     when = '3'
          let #SV_3000 = #HICNTB_AMT
          let #sv_sum_3000 = #sv_sum_3000 +  #HICNTB_AMT
          let #Brutto_3000_Sum = #Brutto_3000_Sum + #Brutto_Sum_TempKV
          let #KV-AG_3000_Sum = #KV-AG_3000_Sum + #KV-AG_Sum_Temp
          let #KV-AN_3000_Sum = #KV-AN_3000_Sum + #KV-AN_Sum_Temp
          break
     when = '6'
          let #SV_6000 = #HICNTB_AMT
          let #sv_sum_6000 = #sv_sum_6000 +  #HICNTB_AMT
          let #Brutto_6000_Sum = #Brutto_6000_Sum + #Brutto_Sum_TempKV
          let #KV-AG_6000_Sum = #KV-AG_6000_Sum + #KV-AG_Sum_Temp
          let #KV-AN_6000_Sum = #KV-AN_6000_Sum + #KV-AN_Sum_Temp
          break
     end-evaluate
  end-if
  let #CICNTB_AMT = #PV-AG_Sum_Temp + #PV-AN_Sum_Temp
  if $Is_KVdR = 'Y'
     let #SV_PV_KVDR1 = #CICNTB_AMT
     let #sv_sum_pv_kvdr1  = #sv_sum_pv_kvdr1 + #CICNTB_AMT
     let #Brutto_kvdr1_Sum = #Brutto_kvdr1_Sum + #Brutto_Sum_TempPV
     let #PV-AG_kvdr_Sum = #PV-AG_kvdr_Sum + #PV-AG_Sum_Temp
     let #PV-AN_kvdr_Sum = #PV-AN_kvdr_Sum + #PV-AN_Sum_Temp
  else
     if &SI.GPDE_SI_STATUS_PV = '6'
         let #SV_PV_KVDR2 = #CICNTB_AMT
         let #sv_sum_pv_kvdr2 = #sv_sum_pv_kvdr2 + #CICNTB_AMT
         let #Brutto_kvdr2_Sum = #Brutto_kvdr2_Sum + #Brutto_Sum_TempPV
     else
         let #SV_0001     = #CICNTB_AMT
         let #sv_sum_0001 = #sv_sum_0001 + #CICNTB_AMT
         let #Brutto_0001_Sum = #Brutto_0001_Sum + #Brutto_Sum_TempPV
         let #PV-AG_0001_Sum = #PV-AG_0001_Sum + #PV-AG_Sum_Temp
         let #PV-AN_0001_Sum = #PV-AN_0001_Sum + #PV-AN_Sum_Temp
     end-if
  end-if


  let #PICNTB_AMT = #RV-AG_Sum_Temp + #RV-AN_Sum_Temp
  ! wdu06-881b11 $RvMerge2005: check if RV groups 2,4,6 are merged into 1,2,3
  if $RvMerge2005 = 'Y'
          ! Y: yes, all amounts for RV-Group 2 go to 1, 4 go to 3, 6 go to 5 in summation
          evaluate $RV_Code
          when = '1'
          when = '2'
                let #SV_0100     =  #PICNTB_AMT
                let #sv_sum_0100 =  #sv_sum_0100 + #PICNTB_AMT
                let #Brutto_0100_Sum = #Brutto_0100_Sum + #Brutto_Sum_TempRV
                let #RV-AG_0100_Sum = #RV-AG_0100_Sum + #RV-AG_Sum_Temp
                let #RV-AN_0100_Sum = #RV-AN_0100_Sum + #RV-AN_Sum_Temp
                break
          when = '3'
          when = '4'
                let #SV_0300     =  #PICNTB_AMT
                let #sv_sum_0300 =  #sv_sum_0300 + #PICNTB_AMT
                let #Brutto_0300_Sum = #Brutto_0300_Sum + #Brutto_Sum_TempRV
                let #RV-AG_0300_Sum = #RV-AG_0300_Sum + #RV-AG_Sum_Temp
                let #RV-AN_0300_Sum = #RV-AN_0300_Sum + #RV-AN_Sum_Temp
                break
          when = '5'
          when = '6'
                let #SV_0500     =  #PICNTB_AMT
                let #sv_sum_0500 =  #sv_sum_0500 + #PICNTB_AMT
                let #Brutto_0500_Sum = #Brutto_0500_Sum + #Brutto_Sum_TempRV
                let #RV-AG_0500_Sum = #RV-AG_0500_Sum + #RV-AG_Sum_Temp
                let #RV-AN_0500_Sum = #RV-AN_0500_Sum + #RV-AN_Sum_Temp
                break
          when-other
                break
          end-evaluate
  else
         ! $RvMerge2005 = N: no, we have separate sums for all groups
          evaluate $RV_Code
          when = '1'
                let #SV_0100     =  #PICNTB_AMT
                let #sv_sum_0100 =  #sv_sum_0100 + #PICNTB_AMT
                let #Brutto_0100_Sum = #Brutto_0100_Sum + #Brutto_Sum_TempRV
                let #RV-AG_0100_Sum = #RV-AG_0100_Sum + #RV-AG_Sum_Temp
                let #RV-AN_0100_Sum = #RV-AN_0100_Sum + #RV-AN_Sum_Temp
                break
          when = '2'
                let #SV_0200     =  #PICNTB_AMT
                let #sv_sum_0200 =  #sv_sum_0200 + #PICNTB_AMT
                let #Brutto_0200_Sum = #Brutto_0200_Sum + #Brutto_Sum_TempRV
                let #RV-AG_0200_Sum = #RV-AG_0200_Sum + #RV-AG_Sum_Temp
                let #RV-AN_0200_Sum = #RV-AN_0200_Sum + #RV-AN_Sum_Temp
                break
          when = '3'
                let #SV_0300     =  #PICNTB_AMT
                let #sv_sum_0300 =  #sv_sum_0300 + #PICNTB_AMT
                let #Brutto_0300_Sum = #Brutto_0300_Sum + #Brutto_Sum_TempRV
                let #RV-AG_0300_Sum = #RV-AG_0300_Sum + #RV-AG_Sum_Temp
                let #RV-AN_0300_Sum = #RV-AN_0300_Sum + #RV-AN_Sum_Temp
                break
          when = '4'
                let #SV_0400     =  #PICNTB_AMT
                let #sv_sum_0400 =  #sv_sum_0400 + #PICNTB_AMT
                let #Brutto_0400_Sum = #Brutto_0400_Sum + #Brutto_Sum_TempRV
                let #RV-AG_0400_Sum = #RV-AG_0400_Sum + #RV-AG_Sum_Temp
                let #RV-AN_0400_Sum = #RV-AN_0400_Sum + #RV-AN_Sum_Temp
                break
          when = '5'
                let #SV_0500     =  #PICNTB_AMT
                let #sv_sum_0500 =  #sv_sum_0500 + #PICNTB_AMT
                let #Brutto_0500_Sum = #Brutto_0500_Sum + #Brutto_Sum_TempRV
                let #RV-AG_0500_Sum = #RV-AG_0500_Sum + #RV-AG_Sum_Temp
                let #RV-AN_0500_Sum = #RV-AN_0500_Sum + #RV-AN_Sum_Temp
                break
          when = '6'
                let #SV_0600     =  #PICNTB_AMT
                let #sv_sum_0600 =  #sv_sum_0600 + #PICNTB_AMT
                let #Brutto_0600_Sum = #Brutto_0600_Sum + #Brutto_Sum_TempRV
                let #RV-AG_0600_Sum = #RV-AG_0600_Sum + #RV-AG_Sum_Temp
                let #RV-AN_0600_Sum = #RV-AN_0600_Sum + #RV-AN_Sum_Temp
                break
          when-other
                break
          end-evaluate
  end-if


  let #UICNTB_AMT = #AV-AG_Sum_Temp + #AV-AN_Sum_Temp
  evaluate $AV_Code
     when = '1'
        let #SV_0010     =  #UICNTB_AMT
        let #sv_sum_0010 =  #sv_sum_0010 + #UICNTB_AMT
        let #Brutto_0010_Sum = #Brutto_0010_Sum + #Brutto_Sum_TempAV
        let #AV-AG_0010_Sum = #AV-AG_0010_Sum + #AV-AG_Sum_Temp
        let #AV-AN_0010_Sum = #AV-AN_0010_Sum + #AV-AN_Sum_Temp
        break
     when = '2'
        let #SV_0020     =  #UICNTB_AMT
        let #sv_sum_0020 =  #sv_sum_0020 + #UICNTB_AMT
        let #Brutto_0020_Sum = #Brutto_0020_Sum + #Brutto_Sum_TempAV
        let #AV-AG_0020_Sum = #AV-AG_0020_Sum + #AV-AG_Sum_Temp
        let #AV-AN_0020_Sum = #AV-AN_0020_Sum + #AV-AN_Sum_Temp
        break
  end-evaluate

  ! wdu06-881kug AZ code removed and added at the _temp assignments above

  if $MarchCL = 'Y' and $Vorj = 'N'
     let #SV_U_Gross    =  #PT.GPDE_RP_RIGRSM_AMT
     let #SV_U1         =  #PT.GPDE_RP_U1CTBM_AMT
     let #SV_U2         =  #PT.GPDE_RP_U2CTBM_AMT
     let #PT.GPDE_RI_PCT1 = &PT.GPDE_RI_PCT1_MC
     let #PT.GPDE_RI_PCT2 = &PT.GPDE_RI_PCT2_MC
  else
     let #SV_U_Gross    =  #PT.GPDE_RP_RIGRSS_AMT
     let #SV_U1         =  #PT.GPDE_RP_U1CNTB_AMT
     let #SV_U2         =  #PT.GPDE_RP_U2CNTB_AMT
     let #PT.GPDE_RI_PCT1 = &PT.GPDE_RI_PCT1
     let #PT.GPDE_RI_PCT2 = &PT.GPDE_RI_PCT2
  END-IF
  let #sv_sum_U1     =  #sv_sum_U1  + #SV_U1
  let #sv_sum_U2     =  #sv_sum_U2  + #SV_U2
  let #AG_U1_Sum     =  #sv_sum_U1
  let #AG_U2_Sum     =  #sv_sum_U2
  if #SV_U1 <> 0
     let  #Brutto_U1_Sum =  #Brutto_U1_Sum + #SV_U_Gross
  end-if
  if #SV_U2 <> 0
     let  #Brutto_U2_Sum =  #Brutto_U2_Sum + #SV_U_Gross
  end-if
end-procedure
!skip separate pages for Refund Insurance provider IDs
begin-procedure Check_Rfnd_Recv
let $ValidRcv = 'N'
begin-select
RF.GPDE_SI_RFND_PRV

 let $RF.GPDE_SI_RFND_PRV = rtrim(&RF.GPDE_SI_RFND_PRV, ' ')
 let $RF.GPDE_SI_PROV_MAND = rtrim($GPDE_SI_PROV_MAND, ' ')
 if $RF.GPDE_SI_RFND_PRV = $RF.GPDE_SI_PROV_MAND
     let $ValidRcv = 'T'
 end-if
FROM PS_GPDE_AL_PE_RFPR RF
WHERE RF.PAY_ENTITY = $Ctl_PayEntity
AND RF.EFFDT = ( SELECT MAX(RF1.EFFDT) FROM PS_GPDE_AL_PE_RFPR RF1
                 WHERE RF1.PAY_ENTITY = RF.PAY_ENTITY
                 AND RF1.PAY_ENTITY = $Ctl_PayEntity
                 AND RF1.EFFDT <=  $Ctl_Curr_Pay_End_Dt
AND EXISTS ( SELECT 'X' FROM PS_GPDE_AL_PE_SID SID
             WHERE SID.PAY_ENTITY = RF.PAY_ENTITY
            !AND SID.EFFDT = RF.EFFDT
             AND SID.PAY_ENTITY = $Ctl_PayEntity
             AND SID.EFFDT = (SELECT MAX(SID1.EFFDT) FROM PS_GPDE_AL_PE_SID SID1
                              WHERE SID1.PAY_ENTITY = SID.PAY_ENTITY
                              AND SID1.GPDE_SI_PROV = SID.GPDE_SI_PROV
                              AND SID1.PAY_ENTITY = $Ctl_PayEntity
                              AND SID1.EFFDT <= $Ctl_Curr_Pay_End_Dt)
           )
)
end-select
end-procedure

begin-procedure CX_CondPrintUmlage_BeitAbr
! print Umlage if applicable
!adj09-1890181000-Check Gross Insol & and UML Insol
!adj- 'SV-Umlage' has to be eliminated for Pension Fund Receivers
 if $provider_type <> '08'
   if #SV_U1 <> 0 or #SV_U2 <> 0 or #PT.GPDE_RP_UML_INSOLV <> 0 or #PT.GPDE_RP_GRSS_INSOL <> 0 or #PT.GPDE_RP_GRS_INS_MC <> 0 or #PT.GPDE_RP_UML_INS_MC <> 0 and $Is_KVdR <> 'Y'
     let $WasPrintedData = 'Y'
     let #zaehler = #zaehler + 1
     use-report Abrechnung_Umlage
     do Print-EE-Data-Umlage        ! #################
   end-if
 end-if
end-procedure


begin-procedure CX_CondPrintEmplAbr_BeitAbr
  ! print EE-Data-Abr (Abrechnung) if applicable (if provider was requested(?))
   if $PT.GPDE_RP_CHAR02 <> 'N'
     ! wdu05-881b8: status variables $WasPrintedData and #zaehler needed to go from here to Print-EE-Data-Abr
     ! because we do not know if we really print. All values might be zero(!) then we dont.
     ! show '--> CX_CondPrintEmplAbr_BeitAbr'
     use-report abrechnung
     do Get-Header-Data-Abr
     do Print-EE-Data-Abr           ! ##########################
   end-if
end-procedure




begin-procedure CX_CondPrintVolAbr_BeitAbr
  ! print EE-SVF-Data (Abrechnung) if freiw. KV

  !ChangeFor2004_Bundle2_Jan: added IF Marchcl condition ...
  !freiwillige KV nicht mit Maerzklausel
  if $MarchCL = 'N'
    let #SV_FKV     = #PT.GPDE_RP_HIVOL_AMT
    if #SV_FKV <> 0
       let #SV_Hivler  = #PT.GPDE_RP_HIVLER_AMT
    else
       let #SV_Hivler = 0
    end-if
    let #SV_FPV     = #PT.GPDE_RP_CIVOL_AMT
    if #SV_FPV <> 0
       let #SV_Civler  = #PT.GPDE_RP_CIVLER_AMT
    else
       let #SV_Civler = 0
    end-if
    if (#PT.GPDE_RP_CIVOL_AMT <> 0 OR #PT.GPDE_RP_HIVOL_AMT <> 0 or &PT.GPDE_RP_CHAR01 = 'Y')  and $Is_KVdR <> 'Y'
       use-report Freiwillig
       let $WasPrintedData = 'Y'
       let #zaehler = #zaehler + 1
       do Print-SVF-Data                    ! ######################
       let #sum_fpv = #sum_fpv + #SV_FPV
       let #sum_fkv = #sum_fkv + #SV_FKV
       let #sum_Hivler  = #sum_Hivler + #SV_Hivler
       let #sum_Civler  = #sum_Civler + #SV_Civler
       let $PrintF = 'Y'
       let #sv_PV_Freiw_Sum = #sv_PV_Freiw_Sum + #SV_FPV
       let #sv_KV_Freiw_Sum = #sv_KV_Freiw_Sum + #SV_FKV
       if #SV_FKV <> 0
          let #Brutto_KV_Freiw_Sum = #Brutto_KV_Freiw_Sum + #PT2.GPDE_RP_SIGRSS_AMT
          let #KV-AG_Freiw_Sum = #KV-AG_Freiw_Sum + #SV_Hivler
       end-if
       if #SV_FPV <> 0
          let #Brutto_PV_Freiw_Sum = #Brutto_PV_Freiw_Sum + #PT2.GPDE_RP_SIGRSS_AMT
          let #PV-AG_Freiw_Sum = #PV-AG_Freiw_Sum + #SV_Civler
       end-if
    end-if
  end-if
  !end-if freiw-kv
  !ChangeFor2004_Bundle2_Jan: added IF Marchcl condition ... (end)
end-procedure


begin-procedure CX_ZeroNormalVars_B3
      let #B3.GPDE_RP_SIGRSS_AMT = 0
      let #B3.GPDE_RP_SIGRS_ANLZ = 0
      let #B3.GPDE_RP_HICNTB_AMT = 0
      let #B3.GPDE_RP_PICNTB_AMT = 0
      let #B3.GPDE_RP_UICNTB_AMT = 0
      let #B3.GPDE_RP_CICNTB_AMT = 0
      let #B3.GPDE_RP_HIVOL_AMT  = 0
      let #B3.GPDE_RP_CIVOL_AMT  = 0
      let #B3.GPDE_RP_OAPGRS_AMT = 0
      let #B3.GPDE_RP_AZGRS_ANLZ = 0
      let #B3.GPDE_RP_OAPPEN_AMT = 0
      let #B3.GPDE_RP_SIDAYS     = 0
      let #B3.GPDE_RP_AVDAYS     = 0
      let #B3.GPDE_RP_KVDAYS     = 0
      let #B3.GPDE_RP_PVDAYS     = 0
      let #B3.GPDE_RP_AVDAYS_BON = 0
      let #B3.GPDE_RP_KVDAYS_BON = 0
      let #B3.GPDE_RP_PVDAYS_BON = 0
      let #B3.GPDE_RP_RVDAYS_BON = 0
      let #B3.GPDE_RP_AVGRS_ANLZ = 0
      let #B3.GPDE_RP_AVGRS_BON  = 0
      let #B3.GPDE_RP_KVGRS_ANLZ = 0
      let #B3.GPDE_RP_KVGRS_BON  = 0
      let #B3.GPDE_RP_PVGRS_ANLZ = 0
      let #B3.GPDE_RP_PVGRS_BON  = 0
      let #B3.GPDE_RP_RVGRS_ANLZ = 0
      let #B3.GPDE_RP_RVGRS_BON  = 0
      let #B3.GPDE_RP_AVLFD_AG   = 0
      let #B3.GPDE_RP_AVLFD_AN   = 0
      let #B3.GPDE_RP_KVLFD_AG   = 0
      let #B3.GPDE_RP_KVLFD_AN   = 0
      let #B3.GPDE_RP_PVLFD_AG   = 0
      let #B3.GPDE_RP_PVLFD_AN   = 0
      let #B3.GPDE_RP_RVLFD_AG   = 0
      let #B3.GPDE_RP_RVLFD_AN   = 0
      let #B3.GPDE_RP_KVBON_AG   = 0
      let #B3.GPDE_RP_KVBON_AN   = 0
      let #B3.GPDE_RP_AVBON_AG   = 0
      let #B3.GPDE_RP_AVBON_AN   = 0
      let #B3.GPDE_RP_PVBON_AG   = 0
      let #B3.GPDE_RP_PVBON_AN   = 0
      let #B3.GPDE_RP_RVBON_AG   = 0
      let #B3.GPDE_RP_RVBON_AN   = 0
      let #B3.GPDE_RP_SIGRUNLM_A = 0
      ! wdu05-881b8: total amounts may not be always reset (GPDE_RP_SIGRUNLM_B)
      !      let #B3.GPDE_RP_SIGRUNLM_B = 0
      let #B3.GPDE_RP_CIVLER_AMT = 0
      let #B3.GPDE_RP_HIVLER_AMT = 0
      let #B3.GPDE_RP_AZGRS_BON = 0
      let #B3.GPDE_RP_OAPPEN_ANL = 0
      let #B3.GPDE_RP_OAPPEN_BON = 0
      let #B3.GPDE_AZ_RP_S03_31     = 0
      let #B3.GPDE_AZ_RP_S03_41     = 0

      ! wdu06-881kug
      let #B3.GPDE_RP_KUG_KVCTB = 0
      let #B3.GPDE_RP_KUG_PVCTB = 0
      let #B3.GPDE_RP_KUG_RVCTB = 0
      let #B3.GPDE_RP_KUG_KVGRS = 0
      let #B3.GPDE_RP_KUG_PVGRS = 0
      let #B3.GPDE_RP_KUG_RVGRS = 0

end-procedure


begin-procedure CX_ZeroMarchVars_B3
      let #B3.GPDE_RP_OAPGRS_MC  = 0
      let #B3.GPDE_RP_OAPPEN_MC  = 0

      let #B3.GPDE_RP_AVGRS_MC   = 0
      let #B3.GPDE_RP_KVGRS_MC   = 0
      let #B3.GPDE_RP_RVGRS_MC   = 0
      let #B3.GPDE_RP_PVGRS_MC   = 0

      let #B3.GPDE_RP_AVAG_MC    = 0
      let #B3.GPDE_RP_AVAN_MC    = 0
      let #B3.GPDE_RP_KVAG_MC    = 0
      let #B3.GPDE_RP_KVAN_MC    = 0
      let #B3.GPDE_RP_PVAG_MC    = 0
      let #B3.GPDE_RP_PVAN_MC    = 0
      let #B3.GPDE_RP_RVAG_MC    = 0
      let #B3.GPDE_RP_RVAN_MC    = 0

      let #B3.GPDE_RP_AVDAYS_MC     = 0
      let #B3.GPDE_RP_KVDAYS_MC     = 0
      let #B3.GPDE_RP_PVDAYS_MC     = 0
      let #B3.GPDE_RP_RVDAYS_MC     = 0

      let #B3.GPDE_RP_SIGRSM_AMT = 0
      let #B3.GPDE_RP_HICTBM_AMT = 0
      let #B3.GPDE_RP_PICTBM_AMT = 0
      let #B3.GPDE_RP_UICTBM_AMT = 0
      let #B3.GPDE_RP_CICTBM_AMT = 0

end-procedure


begin-procedure CX_ZeroTotalGrossVars_B3
        let #B3.GPDE_RP_SIGRUNLM_B = 0
end-procedure





begin-procedure ATZ2004Lookup
! wdu05-881b8 ATZ2004Lookup for ZBE/UB
! Depending on the begin of the ATZ contract, different labels need to be printed
! To avoid multiple database selects, we do caching ourselves as good as possible.
! $ATZStichtag contains the begin date for the new legislative rules.
! The difference is mainly, that we need to show 'ZBE' instead of 'Unterschiedsbetrag'.

! First check, if we have tested this emplid already.
! If we have tested the emplid already once, then we are done and reuse the values.
if ( $Emplid <> $AZEmplid )
    let $ATZEmplid = $Emplid
    ! a new emplid was read, determine the AZ contract begin date only once
    let $ATZ2004 = 'N'
BEGIN-SELECT
AZEE1.BGN_DT
     ! (in the unlikely case of multiple entries, we use the last one.)
     ! wdu890b7 platform date format fix ATZ-Date
     do Format-DateTime(&AZEE1.BGN_DT, $ATZStichtx, {DEFCMP},'','')
     if ( $ATZStichtx >= $ATZStichtag )
        let $ATZ2004 = 'Y'
     else
        let $ATZ2004 = 'N'
     end-if
FROM PS_GPDE_AZ_EE AZEE1
WHERE AZEE1.EMPLID = $Emplid
AND AZEE1.EMPL_RCD = #EmplRcd
order by AZEE1.BGN_DT
END-SELECT

    ! for first time execution populate labels
     if ( $ATZ2004 = 'Y' )
        ! print labels new law
        let $UBTEXT_EGAVJ = 'Zus. beitpfl. Einnahme EGA VJ'
        let $UBTEXT_EGA   = 'Zus. beitpfl. Einnahme EGA'
        let $UBTEXT       = 'Zus. beitpfl. Einnahme'
        let $UBTEXT_VJ    = 'Zus. beitpfl. Einnahme Vorjahr'
        let $UBTEXT_KG    = 'Zus. beitpfl. Einnahme KG'
        let $UBTEXT_KGVJ  = 'Zus. bpfl. Einnahme KG Vorjahr'
     else
        ! print labels old law
        let $UBTEXT_EGAVJ = 'Unterschiedsbetrag EGA VJ'
        let $UBTEXT_EGA   = 'Unterschiedsbetrag EGA'
        let $UBTEXT       = 'Unterschiedsbetrag'
        let $UBTEXT_VJ    = 'Unterschiedsbetrag Vorjahr'
        let $UBTEXT_KG    = 'Unterschiedsbetrag KG'
        let $UBTEXT_KGVJ  =  'Unterschiedsbetrag KG Vorjahr'
     end-if
end-if

end-procedure


!********************************************************************************************
begin-procedure Get_Beg_Mnth($Dte1,:$Dte2)
 if rtrim($Dte1,' ') <> ''
  do ConvertToComponents($Dte1,$tmp1_yy,$tmp1_mm,$tpm1_dd)
  let $B_DT_tmp1 = $tmp1_yy  || $tmp1_mm  || '01' || '0000'
  do Format-DateTime($B_DT_tmp1,$Dte2, {DEFCMP},'','native')
 end-if
end-procedure
!****************************************************************







!**************************************************************
!
! DSKO (Datensatz Kommunikation)
!
! copied from DEUEV
!**************************************************************
begin-procedure WriteDSKO

let $XK1 = 'DSKO'
if $Is_KVdR <> 'Y'
    let $XK2 = 'BWNAC'
else
    let $XK2 = 'BWBNV'
end-if

if $provider_type = '08'
    let $XK2 = 'BVBEI'
end-if
! wdu06-881kug: main BTNR from PayEntity ($PayentBtnr) for VOSZ and DSKO
! -- let $XK3 = rtrim(ltrim($hdr_abr_GPDE_DO_BTNR,' '),' ')  !15     $Absender_Nbr
let $XK3 = rtrim(ltrim($PayentBtnr,' '),' ')  !15     $Absender_Nbr

if  $GPDE_DV_RCVER_ID = '17625773'
    let $CONFIRM_EMAIL = 'K'    
    !show 'confirm email ' $CONFIRM_EMAIL
end-if

let $XK4 = rtrim(ltrim($GPDE_DV_RCVER_ID,' '),' ')      !15     $Empf_Nbr
let $XK4 = rpad($XK4, 15, ' ')


let $XK23 = {CONFIRM_ERR_FREE}    !jjj-89b13-1738246000

let $XK24 = $CONFIRM_EMAIL        !byar11-90updE-12434166
let $XK25 = '   '                 !jjj-89b13-1738246000


let $XK5 = '02'             ! VERSION_DSKO ! jjj-89b13-1738246000
! wdu2004: new version:  we use the date and time from $SysDateTime

do Format-DateTime($sysdatetime,$DSKO_Datum_Erstellung, {DEFCMP},'time','')
let $XK6 = $DSKO_Datum_Erstellung  || '000000'

let $XK7 = '00'                          !FEKZ+FEAN
let $XK8 = $XK3                          !BBNRVU = $XK3

! jjj-89B11-1674660000: 20th Jul 07 Changes for writing new MODID.
do Get_VersionNr

let $XK9 = $PRODID                     !PROD-ID (7)
let $XK10 = $MODID                     !MOD-ID  (8)


! -----------------------------------------------
! wdu05-881b9 changed address logic for DSKO and Begleitzettel
!
! ADDRESS1 is defined to be the street and number now
! ADDRESS2..4 ignored because content unknown
!

! -----------------------------------------------
!
! Assignments to DSKO fields
!
let $XK11 = $hdr_abr_Payentity_name !NAME1 (30)
let $XK12 = ' '                    !NAME2 (30)
let $XK13=  ' '                    !NAME3 (30)
let $XK14= $Post                   !PLZ-BETRIEB (10)
let $XK15= $Cit                    !ORT-BETRIEB (34)

let $XK16= $hdr_abr_Payentity_street !STRASSE-BETRIEB       = by definition ADDRESS1
let $XK17= ' '                        !HAUSNR-BETRIEB        not available separately
!clerk-info
let $XK18 = $SBA_Sex                  !ANREDE M/W
let $XK19 = $SBA_Name                 !NAME ANSPRECHPARTNER
let $XK20 = $SBA_Phone                !TEL
let $XK21 = $SBA_Fax                  !FAX
let $XK22 = $SBA_Email                !EMAIL

! Chg-Char replaces special chars in names and addresses
do Chg-Char($XK11,$XK11)
do Chg-Char($XK12,$XK12)
do Chg-Char($XK13,$XK13)
do Chg-Char($XK15,$XK15)
do Chg-Char($XK16,$XK16)
do Chg-Char($XK17,$XK17)
do Chg-Char($XK18,$XK18)
do Chg-Char($XK19,$XK19)

! if $provider_type <> '08'
write 10 from $XK1:4 $XK2:5 $XK3:15 $XK4:15 $XK5:2 $XK6:20 $XK7:2 $XK8:15 $XK9:7 $XK10:8
 $XK11:30 $XK12:30 $XK13:30 $XK14:10 $XK15:34 $XK16:33 $XK17:9 $XK18:1 $XK19:30 $XK20:20
 $XK21:20 $XK22:70
 $XK23:1 $XK24:1 $XK25:3   !jjj-89b10
! end-if
    !add 1 to #RecordCounter
    let #LaufNum = #LaufNum + 1
end-procedure


!**********************************************************
begin-procedure Chg-Char($in, :$out)

move '' to $out
move 1 to #pos

while #pos <= length($in)
 let $x = substr($in,#pos,1)
 evaluate $x
  when = 'Ä'
    let $x = '['
    break
  when = 'ä'
    let $x = '{'
    break
  when = 'Ö'
    let $x = '\'
    break
  when = 'ö'
    let $x = '|'
    break
  when = 'Ü'
    let $x = ']'
    break
  when = 'ü'
    let $x = '}'
    break
  when = 'ß'
    let $x = '~'
    break
  when = 'è'
    let $x = 'e'
    break
  when = 'é'
    let $x = 'e'
    break
  when = 'ê'
    let $x = 'e'
    break
  when = 'ë'
    let $x = 'e'
    break
  when = 'É'
    let $x = 'E'
    break
  when = 'à'
    let $x = 'a'
    break
  when = 'â'
    let $x = 'a'
    break
  when = 'å'
    let $x = 'a'
    break
  when = 'Å'
    let $x = 'A'
    break
  when = 'ï'
    let $x ='i'
    break
  when = 'î'
    let $x = 'i'
    break
  when = 'ì'
    let $x = 'i'
    break
  when = 'í'
    let $x = 'i'
    break
  when = 'ô'
    let $x = 'o'
    break
  when = 'ò'
    let $x = 'o'
    break
  when = 'ó'
    let $x = 'o'
    break
  when = 'û'
    let $x = 'u'
    break
  when = 'ú'
    let $x = 'u'
    break
  when = 'ù'
    let $x = 'u'
    break
  when = 'ñ'
    let $x = 'n'
    break
  when = 'Ñ'
    let $x = 'N'
    break
  when = 'Ç'
    let $x = 'C'
    break
  when-other
    let $x = substr($in,#pos,1)
    break
 end-evaluate
 let $out = $out || $x
 add 1 to #pos
end-while
end-procedure ! Switch-Character-Set
!**********************************************************




begin-procedure CX_SetFilenamesKVDR
! wdu05 890b2: force max 8 char base-filename on MVS
! define all filenames up-front

if $CloseFlag = 'Y'
    let $TestExtension = ''
  else
    let $TestExtension = '_' || rtrim($Ctl_PayEntity,' ') || '_' || rtrim($GPDE_DV_RCVER_ID,' ') || '_' || rtrim($FileNumber,' ') || '.txt'
  end-if

#ifdef MVS
    let $FileExtension = ''
    let $FileNm = $outputdir || 'EBNZ'  || '{FILESUFFIX}'
    Let $FileNm1 = $outputdir || 'IEBNZ' || '{FILESUFFIX}'
    let $Dateiname1 = 'EBNZ'
    let $reportdir1k = $outputdir || 'SVABREDR' || $FileExtension  || '{FILESUFFIX}'
    let $reportdir2k = $outputdir || 'SVSUMMDR' || $FileExtension || '{FILESUFFIX}'
    let $reportdir3k = $outputdir || 'SVNACHDR' || $FileExtension || '{FILESUFFIX}'
#else
    let $FileNm = $outputdir || 'EBNZ' || rtrim($DakotaNumber,' ') || $TestExtension || '{FILESUFFIX}'
    Let $FileNm1 = $outputdir || 'EBNZ' || rtrim($DakotaNumber,' ') || $TestExtension || '.htm' || '{FILESUFFIX}'
    let $Dateiname1 = 'EBNZ' || $DakotaNumber

    let $reportdir1k = $outputdir ||  'SV-Abrechnung_KVdR_' ||
       $prcs_process_instance || $FileExtension  || '{FILESUFFIX}'
    let $reportdir2k = $outputdir || 'SV-Summe_KVdR_' || $prcs_process_instance ||
       $FileExtension || '{FILESUFFIX}'
    let $reportdir3k = $outputdir || 'SV-Nachweis_KVdR_' ||
       $prcs_process_instance || $FileExtension || '{FILESUFFIX}'
#endif

if rtrim($GPDE_DV_RCVER_ID,' ') <> '' and $provider_type <> '08'
  open $FileNm as 10 for-writing record=678:VARY
  open $FileNm1 as 11 for-writing record=256:FIXED_NOLF
  let $XY = '<HTML><HEAD><TITLE>' || $Receiver_Name || ' ' ||
             rtrim($Receiver_Name,' ') || '.' || rtrim($DakotaNumber,' ') || '_KVdR' ||
             '</TITLE></HEAD><BODY>' || ' <A HREF=' || $Dateiname1 ||
             '>' || $Dateiname1 || '</A>' || ' </BODY></HTML>'
  write 11 from $XY
  CLOSE 11
end-if
end-procedure
!**********************************************************




 begin-procedure CX_SetFilenamesNonKVDR
! wdu05 890b2: force max 8 char base-filename on MVS
! define all filenames up-front
   if $CloseFlag = 'Y'
    let $TestExtension = ''
  else
    let $TestExtension = '_' || rtrim($Ctl_PayEntity,' ') || '_' || rtrim($GPDE_DV_RCVER_ID,' ') || '_' || rtrim($FileNumber,' ') || '.txt'
  end-if

#ifdef MVS
    let $FileExtension = ''
    let $FileNm = $outputdir || 'EBNA'  || '{FILESUFFIX}'
    Let $FileNm1 = $outputdir || 'IEBNA' || '{FILESUFFIX}'
    let $Dateiname1 = 'EBNA'
    let $reportdir1n = $outputdir ||  'SVABRECH' || $FileExtension  || '{FILESUFFIX}'
    let $reportdir2n = $outputdir || 'SVSUMME' || $FileExtension || '{FILESUFFIX}'
    let $reportdir3n = $outputdir || 'SVNACHWS' || $FileExtension || '{FILESUFFIX}'
    let $reportdir4n = $outputdir || 'SVUMLAGE' || $FileExtension || '{FILESUFFIX}'
    let $reportdir5n = $outputdir || 'SVFREIWL' || $FileExtension || '{FILESUFFIX}'
#else
    let $FileNm = $outputdir || 'EBNA' || rtrim($DakotaNumber,' ') || $TestExtension || '{FILESUFFIX}'
    let $FileNm1 = $outputdir || 'EBNA' || rtrim($DakotaNumber,' ') || $TestExtension || '.htm' || '{FILESUFFIX}'
    let $Dateiname1 = 'EBNA' || $DakotaNumber    

    let $reportdir1n = $outputdir ||  'SV-Abrechnung_' ||
        $prcs_process_instance || $FileExtension  || '{FILESUFFIX}'
    let $reportdir2n = $outputdir || 'SV-Summe_' || $prcs_process_instance ||
        $FileExtension || '{FILESUFFIX}'
    let $reportdir3n = $outputdir || 'SV-Nachweis_' ||
        $prcs_process_instance || $FileExtension || '{FILESUFFIX}'
    let $reportdir4n = $outputdir || 'SV-Umlage_' || $prcs_process_instance ||
        $FileExtension || '{FILESUFFIX}'
    let $reportdir5n = $outputdir || 'SV-Freiwillig_' ||
        $prcs_process_instance || $FileExtension || '{FILESUFFIX}'
#endif

if rtrim($GPDE_DV_RCVER_ID,' ') <> '' and $provider_type <> '08'
  open $FileNm as 10 for-writing record=678:VARY
  open $FileNm1 as 11 for-writing record=128:FIXED_NOLF
  let $XY = '<HTML><HEAD><TITLE>' || $Receiver_Name || ' ' ||
             rtrim($Receiver_Name,' ') || '.' || rtrim($DakotaNumber,' ') ||
             '</TITLE></HEAD><BODY>' || ' <A HREF=' || $Dateiname1 ||
             '>' || $Dateiname1 || '</A>' || ' </BODY></HTML>'
  write 11 from $XY
  CLOSE 11
end-if
end-procedure








begin-procedure Print_KUG
! wdu06-881kug -- KUG printing needs more details
!
! code derived from Print_ATZ
!
 if #PT.GPDE_RP_KUG_KVCTB <> 0 or #PT.GPDE_RP_KUG_PVCTB <> 0
    or #PT.GPDE_RP_KUG_RVCTB <> 0 or #PT.GPDE_RP_KUG_KVGRS <> 0
    or #PT.GPDE_RP_KUG_PVGRS <> 0 or #PT.GPDE_RP_KUG_RVGRS <> 0
    ! - print if any gross or contributions
    ! show '*** (Print_KUG) ' $Emplid
     if $Vorj = 'N' and $march = 'Y'
         goto NoPr2k
     end-if

     ! prepare data
     do Format-Number(#PT.GPDE_RP_KUG_KVCTB,$PT.GPDE_RP_KUG_KVCTB,'B999,999.99')
     do Format-Number(#PT.GPDE_RP_KUG_PVCTB,$PT.GPDE_RP_KUG_PVCTB,'B999,999.99')
     do Format-Number(#PT.GPDE_RP_KUG_RVCTB,$PT.GPDE_RP_KUG_RVCTB,'B999,999.99')
     do Format-Number(#PT.GPDE_RP_KUG_KVGRS,$PT.GPDE_RP_KUG_KVGRS,'B99,999,999.99')
     do Format-Number(#PT.GPDE_RP_KUG_PVGRS,$PT.GPDE_RP_KUG_PVGRS,'B999,999.99')
     do Format-Number(#PT.GPDE_RP_KUG_RVGRS,$PT.GPDE_RP_KUG_RVGRS,'B999,999.99')

     do CheckMinusNull_KUG

     ! addup sums
     let #KV-AG_Sum = #KV-AG_Sum + #PT.GPDE_RP_KUG_KVCTB
     let #PV-AG_Sum = #PV-AG_Sum + #PT.GPDE_RP_KUG_PVCTB
     let #RV-AG_Sum = #RV-AG_Sum + #PT.GPDE_RP_KUG_RVCTB
     let #KV-Brutto_Sum = #KV-Brutto_Sum + #PT.GPDE_RP_KUG_KVGRS
     let #PV-Brutto_Sum = #PV-Brutto_Sum + #PT.GPDE_RP_KUG_PVGRS
     let #RV-Brutto_Sum = #RV-Brutto_Sum + #PT.GPDE_RP_KUG_RVGRS

     let #mm = 5 + #current-line
     if #mm > 55
        new-page
     end-if
     let #currLineV = -17 + #current-line
     let #currLineN = -16 + #current-line
     graphic (#currLineN,1,180) box 4 2
     graphic (#currLineV,14,4) vert-line 1
     graphic (#currLineV,48,4) vert-line 1
     graphic (#currLineV,55,4) vert-line 1
     graphic (#currLineV,62,4) vert-line 1
     graphic (#currLineV,69,4) vert-line 1
     graphic (#currLineV,76,4) vert-line 1
     graphic (#currLineV,80,4) vert-line 1
     graphic (#currLineV,100,4) vert-line 1
     if $PrintFormInsigBUK = 'N'
        graphic (#currLineV,116,4) vert-line 1
        graphic (#currLineV,132,4) vert-line 1
        graphic (#currLineV,148,4) vert-line 1
        graphic (#currLineV,164,4) vert-line 1
     else
        graphic (#currLineV,113,4) vert-line 1
        graphic (#currLineV,126,4) vert-line 1
        graphic (#currLineV,139,4) vert-line 1
        graphic (#currLineV,152,4) vert-line 1
        graphic (#currLineV,165,4) vert-line 1
     end-if


       let #TempCol = 1 + #currLineV
       ! no sidays here
       let #TempCol = 1 + #TempCol
       ! Line 2 in Box
       alter-printer
       font = 3
       point-size = 16
       ! no unlimited gross here
       ! contribution groups
       print $KV_Code (#TempCol,48)  edit 99999
       print $RV_Code (#TempCol,55)  edit 99999
       print $AV_Code (#TempCol,62)  edit 99999
       print $PV_Code (#TempCol,69)  edit 99999
       print $GZFlag   (#TempCol,76)  edit 999
       let $GZFlag = ''                         ! JJJ-890B10P2 qk07


       print $PT.GPDE_RP_KUG_KVGRS  (#TempCol,80)
       if $PrintFormInsigBUK = 'N'
         print $PT.GPDE_RP_KUG_RVGRS  (#TempCol,100)
       else
         print $PT.GPDE_RP_KUG_RVGRS  (#TempCol,97)
       end-if


      alter-printer
       font = 4
       point-size = 13
         if $march = 'N' or $Vorj = 'Y'
           if $Vorj = 'Y'
             print 'KUG Fiktivlohn VJ'  (#TempCol,25)
           else
             print 'KUG Fiktivlohn'     (#TempCol,25)
           end-if
         else
            print 'KUG Fiktivlohn'   (#TempCol,25)
         end-if

       let #TempCol = 1 + #TempCol
       ! Line 3 in Box
       alter-printer
       font = 3
       point-size = 16

       if $PrintFormInsigBUK = 'N'
          print $PT.GPDE_RP_KUG_PVGRS  (#TempCol,100)
          print $PT.GPDE_RP_KUG_KVCTB    (#TempCol,116)
          print $PT.GPDE_RP_KUG_RVCTB    (#TempCol,132)
          ! no: print $PT.GPDE_RP_AVLFD_AG    (#TempCol,148)
          print $PT.GPDE_RP_KUG_PVCTB    (#TempCol,164)
       else
          print $PT.GPDE_RP_KUG_PVGRS  (#TempCol,97)
          print $PT.GPDE_RP_KUG_KVCTB    (#TempCol,110)
          print $PT.GPDE_RP_KUG_RVCTB    (#TempCol,123)
          ! no: print $PT.GPDE_RP_AVLFD_AG    (#TempCol,136)
          print $PT.GPDE_RP_KUG_PVCTB    (#TempCol,149)
       end-if

         ! JJJ-890B10-kug Line 4
         let #TempCol = 1 + #TempCol
       let #kugamt = &PT.GPDE_KU_KUGAMT
       let #kugkkamt = &PT.GPDE_KU_KUGKKAMT
       let #kugtotamt = #kugamt + #kugkkamt
       if #kugtotamt <> 0
          do Format-Number(#kugtotamt , $KUGTOTAMT,'B999,999.99')
          let $KUGTOTAMT = $KUGTOTAMT || '**'
          print  $KUGTOTAMT           (#TempCol,82)
       end-if


       alter-printer
       font = 4
       point-size = 13
     if $march = 'Y' and $Vorj = 'N'
        let $MarzKlStr = 'Märzklausel'
        print $MarzKlStr (#TempCol,25)
     end-if
 end-if
NoPr2k:
end-procedure



! ---------------------------------------------------------------
#include 'gpdesi10.sqc'  !procs specific to this file.
#include 'gpdeut01.sqc'  !sqr strings table procedures
#include 'gpdeut02.sqc'  !get ask report parameters
#include 'gpdeut04.sqc'  !get pay entity data
#include 'gpdeut07.sqc'  !utilities, file handling
#include 'rotname1.sqc'  !rotate-name procedure
#include 'curdttim.sqc'  !get-current-datetime procedure
#include 'readxlat.sqc'  !read-translate-table procedure
#include 'datetime.sqc'  !routines for date and time formatting
#include 'datemath.sqc'  !function for date-calculation
#include 'validdt.sqc'   !validate date routine
#include 'number.sqc'    !routines to format numbers
#include 'stdapi.sqc'    !routines to update run status
#include 'sqrtrans.sqc'  !sqr strings table procedures
